define("MsPortalImpl.Controls/Controls/Visualization/MonitorChartV2/Utils/AjaxService",["require","exports"],(function(n,t){"use strict";function r(n){return Q(i.ajax({uri:n.uri,type:n.type,dataType:"json",headers:n.headers,contentType:n.contentType,data:n.data,setAuthorizationHeader:n.setAuthorizationHeader,useRawAjax:n.useRawAjax}))}Object.defineProperty(t,"__esModule",{value:!0});t.ajaxService=void 0;var i=MsPortalFx.Base.Net2;t.ajaxService=r}));
define("MsPortalImpl.Controls/Controls/Visualization/MonitorChartV2/Utils/Debouncer",["require","exports"],(function(n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Debouncer=void 0;t.Debouncer=MsPortalFx.Base.Debouncer}));
define("MsPortalImpl.Controls/Controls/Visualization/MonitorChartV2/AI/ME/Shared/RequestBatcher",["require","exports","MsPortalImpl.Controls/Controls/Visualization/MonitorChartV2/Utils/AjaxService","MsPortalImpl.Controls/Controls/Visualization/MonitorChartV2/Utils/Debouncer","MsPortalImpl.Controls/Controls/Visualization/MonitorChartV2/Utils/MappedUtils","MsPortalImpl.Controls/Controls/Visualization/MonitorChartV2/AI/ME/Constants","MsPortalImpl.Controls/Controls/Visualization/MonitorChartV2/AI/ME/Telemetry"],(function(n,t,i,r,u,f,e){"use strict";function y(n,t,i,r){var h,e,u,o;return(i===3&&(h=t&&t.resourceId),t&&(t.queryName===f.QueryNames.MDMV2MetricResult||t.queryName===f.QueryNames.MDMVV2SummaryResult?e="MDM_MetricResult_Queue":t.queryName===f.QueryNames.MDMV2Namespace?e="MDM_Namespace_Queue":t.queryName===f.QueryNames.GetToken||t.queryName===f.QueryNames.GetResource?e="DraftTokenAndResourceMetadata":(t.queryName===f.QueryNames.AiArmKustoMetricResult||t.queryName===f.QueryNames.NamedQueryMetricResult)&&(e="Kusto_MetricResult_Queue")),u=k(n,h),u&&s[u])?s[u]:(o=p(n,t,h,i,e,r).then((function(n){return n&&n.content})),u&&(s[u]=o,o.finally((function(){delete s[u]}))),o)}function p(n,t,i,r,f,e){var s=Q.defer(),o=u.getUrlEndpoint(n.uri),h=f||o,l=w(o,h,r===3?c:v,r,e);return l.execute([{request:{uri:i||n.uri.substr(o.length),options:n,additionalPayload:n.additionalPayload,httpMethod:n.type,queryMetadata:t},responseDeferred:s}]),s.promise}function w(n,t,i,u,f){t=t.toLowerCase();var e=l[t];return e||(e=l[t]=new r.Debouncer(function(n,t){return n.concat(t)},function(t){for(var r=t;r.length;)t=r,r=t.splice(h),t&&t.length>0&&b(t,n,i,u,f);return Q()},a,!1,{maxBatchSize:h})),e}function b(n,t,r,u,s){var w=e.AddOperation("RequesteBatcher.executeBatch",s),b=w.opTimer,d=w.opStop,a=[],v=[],y=[],h=n[0].request.options,k=u===3,l,p;return n.forEach((function(n){var i,t;n.request&&(v.push(n.request.queryMetadata.queryName),y.push(n.request.queryMetadata.resourceId),i=decodeURI(n.request.uri),k?a.push({relativeUrl:i,additionalPayload:n.request.additionalPayload,httpMethod:o}):(t={httpMethod:n.request.httpMethod||"GET",relativeUrl:i},t.httpMethod===o&&(t.content=n.request.options.data,t.content&&typeof t.content=="string"&&(t.content=JSON.parse(t.content))),a.push(t)))})),l=t+"/",l+=k?c:r,h.uri=l,h.data=JSON.stringify({requests:a}),h.type=o,p={resourceId:y.toString(),queryName:v.toString(),containerName:"BaseBatchService"},i.ajaxService(h,p,b).then((function(t){var i=t.responses||[];return n.forEach((function(t,r){var f=n[r].responseDeferred,u=i[r];u&&u.httpStatusCode<400?f.resolve(u):f.reject(u)})),Q()}),(function(t){n.forEach((function(n){n.responseDeferred.reject(t)}));d();var i={WithinBatch:!0,BatchUrl:l,QueryNames:v.toString(),ResourceIds:y.toString(),Url:l,Type:h.type},r={QueryCount:n.length};return e.logAjaxQuery(b,p,f.Result.Fail,t,i,r),Q()}))}function k(n,t){var i,r;return n&&n.type&&n.uri&&(i=n.type.toLowerCase()+n.uri.toLowerCase()+(n.setAuthorizationHeader||"false"),t&&(i+=t),n.type===o&&n.data&&(i+=typeof n.data=="string"?n.data:JSON.stringify(n.data)),n.headers&&n.headers["additional-payload"]&&(r=n.headers["additional-payload"],i+=r.querySession,i+=r.includeServersInfo,r.configuration&&(i+=r.configuration.Id))),i}Object.defineProperty(t,"__esModule",{value:!0});t.batch=void 0;var h=20,a=10,v="batch?api-version=2015-11-01",c="QuickPulseService.svc/batchquery?type=detailed",o="POST",l={},s={};t.batch=y}));
define("MsPortalImpl.Controls/Controls/Visualization/MonitorChartV2/Utils/ArmBatcher",["require","exports","Fx/Ajax"],(function(n,t,i){"use strict";function r(n){var t={options:2,type:n.type,uri:n.uri};return n.data&&(t.content=n.data,t.content&&typeof t.content=="string"&&(t.content=JSON.parse(t.content))),Q(i.batch(t)).then((function(n){return n.content}))}Object.defineProperty(t,"__esModule",{value:!0});t.armBatch=void 0;t.armBatch=r}));
define("MsPortalImpl.Controls/Controls/Visualization/MonitorChartV2/AI/ME/Shared/AjaxHelper",["require","exports","MsPortalImpl.Controls/Controls/Visualization/MonitorChartV2/Utils/AjaxService","MsPortalImpl.Controls/Controls/Visualization/MonitorChartV2/Utils/ArmBatcher","MsPortalImpl.Controls/Controls/Visualization/MonitorChartV2/Utils/ArmConfigProvider","MsPortalImpl.Controls/Controls/Visualization/MonitorChartV2/Utils/MappedUtils","MsPortalImpl.Controls/Controls/Visualization/MonitorChartV2/AI/ME/Constants","MsPortalImpl.Controls/Controls/Visualization/MonitorChartV2/AI/ME/Telemetry","MsPortalImpl.Controls/Controls/Visualization/MonitorChartV2/AI/ME/Utilities/Util","MsPortalImpl.Controls/Controls/Visualization/MonitorChartV2/AI/ME/Shared/RequestBatcher"],(function(n,t,i,r,u,f,e,o,s,h){"use strict";function a(n){var t=n&&n[c]&&parseInt(n[c],10)||20;return t*1e3}function v(n,t,i,r){var u=t.headers||{};if((n===3||n===4)&&(u.Accept="application/json, text/javascript, */*; q=0.01"),n===3){if(t.getAuthorizationToken)return t.getAuthorizationToken().then((function(n){return u.Authorization=n,u}))}else r&&(u["x-ms-client-request-id"]=r),s.isHostedInShell()||(u["Content-Type"]=t.contentType||"application/json"),i.context&&i.context.sessionId&&(u["x-ms-client-session-id"]=i.context.sessionId),n===1&&(u["x-ms-command-name"]=s.isHostedInShell()?"Metrics_shell":"Metrics_iframe",u["x-ms-effective-local"]=window.locale||"");return Q(u)}function y(n,t,i,r){if(r){var u=n===1&&o.getClientRequestId(i&&i.headers)||t;r.clientRequestIds||(r.clientRequestIds=[]);r.clientRequestIds.push(u)}}function p(n,t){if(t&&t===e.QueryNames.QuickPulseQuery)return 3;if(n){if(s.isArmEndpoint(n))return 1;if(s.isLegacyEndpoint(n))return 4;if(s.isMISTEndpoint(n))return 5}return 0}Object.defineProperty(t,"__esModule",{value:!0});t.Ajax=void 0;var c="Retry-After",l=(function(){function n(){this.initialAjaxSentDefer=Q.defer()}return n.prototype.fetchArm=function(n,t,i,r,f,e,o){var s,h;return f===void 0&&(f="GET"),s={uri:n.indexOf("https://")!==0&&u.GetArmEndpoint()+n||n,type:f,dataType:"json",invokeApi:"api/invoke",setAuthorizationHeader:!0,data:e,resourceId:t},o&&(s.contentType=o),h={resourceId:t,queryName:i},this.fetch(s,h,r)},n.prototype.fetchArmCollection=function(n,t,i,r){return this._fetchArmCollectionInner(n,t,i,[],r)},n.prototype.fetchStaticFile=function(n,t,i){var r={uri:n,type:"GET",dataType:"json"};return this._ajaxService(r,t,i)},n.prototype._fetchArmCollectionInner=function(n,t,i,r,u){var f=this;return this.fetchArm(n,t,i,u).then((function(n){return n&&(n.value&&(r=r.concat(n.value)),n.nextLink)?f._fetchArmCollectionInner(n.nextLink,t,i,r,u):r}))},n.prototype.fetch=function(n,t,i){var w=this,b=o.AddOperation("AjaxHelper.fetch",i),u=b.opTimer,k=b.opStop,d=n.type||"GET",h,r,c,l,a;return n.type=d,n.dataType="json",h=n.data,h&&typeof h=="object"&&(n.data=JSON.stringify(h)),r=p(n.uri,t&&t.queryName),c=r===1||r===4||r===5,s.isHostedInShell()&&(n.setAuthorizationHeader=c,n.useRawAjax=!c),l=s.GUID(),a=v(r,n,u,l).then((function(i){return n.headers=i,r===4||r===0||f.isFeatureFlagEnabled("disablemetricsbatching")?w._ajaxService(n,t,u):w._batch(n,t,r,u)})),a.catch((function(i){y(r,l,i,u);o.logAjaxQuery(u,t,e.Result.Fail,i,{Url:n.uri,Type:n.type})})).finally(k),a},n.prototype.fetchDraftWithRetry=function(n,t,i,r){n.uri=u.GetArmEndpoint()+n.uri;var f=Q.defer();return this._fetchDraftWithRetryInternal(f,n,t,0,r,i),f.promise},n.prototype._fetchDraftWithRetryInternal=function(n,t,i,r,u,f){var e=this;this.fetch(t,i,u).then((function(t){Array.isArray(t)&&t.length>0&&!t.some((function(n){return n.status===200}))?n.reject(t[0]):n.resolve(t)})).catch((function(o){var s,h;r<3&&o&&o.status===429?(s=a(o.headers),setTimeout((function(){e._fetchDraftWithRetryInternal(n,t,i,r+1,u,f)}),s)):(h={},h.Url=t.uri,n.reject(o))}))},n.prototype._batch=function(n,t,i,u){var f=o.AddOperation("AjaxHelper._batch",u).opStop;return this._handleInitialQuery(),s.isHostedInShell()&&i===1?r.armBatch(n,t,i,u).finally(f):h.batch(n,t,i,u).finally(f)},n.prototype._ajaxService=function(n,t,r){return this._handleInitialQuery(),i.ajaxService(n,t,r)},n.prototype._handleInitialQuery=function(){this.initialAjaxSentDefer.promise.isFulfilled()||this.initialAjaxSentDefer.resolve(!0)},n})();t.Ajax=l}))