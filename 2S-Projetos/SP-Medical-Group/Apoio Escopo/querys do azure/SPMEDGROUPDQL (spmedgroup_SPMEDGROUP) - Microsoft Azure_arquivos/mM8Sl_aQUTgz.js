define("MsPortalImpl/UI/Compositions/UI.Composition.Selectable2Registrar",["require","exports","Fx/DependencyInjection","MsPortalImpl/Base/Base.Selectable2","MsPortalImpl/UI/UI.BladeOpener","MsPortalImpl/UI/Compositions/UI.Composition.BladeOpener","MsPortalImpl/Base/Base.ImplUtils","MsPortalImpl/Base/Base.Events","MsPortalImpl/UI/UI.LinkHandler"],(function(n,t,i,r,u,f,e,o,s){"use strict";function lt(n,t,i,r){var f=new Map,u=function(){at(f,t,i)};r?ko.computed(n,u).extend({rateLimit:{timeout:100,method:"notifyWhenChangesStop"}}):u()}function at(n,t,i){var r=it(t);ko.ignoreDependencies((function(){var t=[];n.forEach((function(n,i){r.has(i)||t.push(n)}));t.forEach((function(t){n.delete(t.selectable)}));r.forEach((function(t,r){n.has(r)||(vt(i.diContainer,t,i),n.set(r,t))}))}))}function vt(n,t,i){var r=i.getBladeOpener(),u={invocationInputArguments:[{valuesFrom:[{referenceType:0,property:t.path}]}]},f=p(i.diContainer,t.selectable);r.registerInvocationProperty(u,undefined,f)}function yt(n,t,i,r){var u=n.filter((function(n){return n.type===10}));if(u.length===0)return!0;if(!pt(u,i.locator))return!1;var o=et(t),f=o[r],e={};return u.forEach((function(n){var u=n.selectable,r=p(i.diContainer,u);e[r.id]=u;r.registerForDispose({dispose:function(){var n=MsPortalFx.clone(f(),!1);delete n[r.id];f(n)}});ko.reactor(r,(function(){r.isSelected()&&t.internal.activeOpenBladeCommand(n)}))})),f(e),!0}function pt(n,t){function f(i){var u=n.filter((function(n){return!n[i]}));return u.length&&b.error(r.format(u.length,i,t)),!!u.length}var r,u,i;return(n=n||[],r="Found {0} OpenBladeCommmand2 items with a null or undefined '{1}' property. Source: '{2}'",["id","selectable"].some(f))?!1:(u=n.map((function(n){return n.id})),i=ti(u),i.length)?(b.error("Found multiple OpenBladeCommand2 items have the same id. Ids must be unique. Duplicate Id(s): '{0}', Source: '{1}'".format(JSON.stringify(i),t)),!1):!0}function d(n){var t=MsPortalFx.Base.ProxiedObservables.data(n,h);return t||(t=h+wt++,MsPortalFx.Base.ProxiedObservables.data(n,h,t)),t}function bt(n,t,i,r,f){var v=this,h=l(r),e,c,a=ko.observable(),y=function(n){var i=n;ko.reactor(t,(function(){var t=i.activationState(),r;t&&(r=t.current&&t.current.item,r!==c&&(a(n.value()),c=r,c&&e&&(e.trigger($.Event("fxselectableactivated",{activated:a})),e=null)))}))},s=w(n,"FxGrid_"+f,h,y);return{activated:a,invokeClick:function(n,t,r){var f=h&&h.internal&&h.internal.elements||ko.observableArray(),u=o.getOrCreateFxElement(t[0],f);s?(e=t,s.invokeClickCallback(3,h,i,n,u,{row:r,element:u})):n({row:r,element:u})},openBlade:function(t,i,r){return __awaiter(v,void 0,void 0,(function(){return __generator(this,(function(){return s&&(e=i,n.get(u.BladeOpener).openBlade(t,{selectable:s,flags:0,selectedItem:r})),[2]}))}))},openContextPane:function(t,i,r){return __awaiter(v,void 0,void 0,(function(){return __generator(this,(function(){return s&&(e=i,n.get(u.BladeOpener).openBlade(t,{selectable:s,flags:1,selectedItem:r})),[2]}))}))}}}function g(n,t,i,r){var f=l(i),e,u;if(f)return e=d(t),u=w(n,e,f),u.onClick=function(){u.invokeClickCallback(1,f,t,r)},u}function kt(n,t,i,r){var u=g(n,t,i,$.noop),f=u,e=l(i);return f.onClick=function(n){u.invokeClickCallback(3,e,t,r,undefined,n.item,n.metadata)},f}function dt(n,t){t?(n.closest(".fxs-part-content").find("."+a).removeClass(v),n.addClass(v)):n.removeClass(v)}function gt(t,r,u,f){var o=f||new FxImpl.TriggerableLifetimeManager,g;f||ko.utils.domNodeDisposal.addDisposeCallback(t,(function(){o.dispose()}));var l=$(t),nt=r.$data,tt=r.$dicontainer||i.container,y=ot(tt,o,l,h,d(nt)),p=t.tagName==="A",w=!0,v=!0,it=function(n){n=v||!!n;t.setAttribute("aria-disabled",""+n);l.toggleClass("azc-text-disabled",n);var i=ko.unwrap(r.$tabIndex),u=n?-1:i||0;t.setAttribute("tabindex",""+u)},rt=function(){return!0},a,b=ko.observable(""),ut=s.getLinkTelemetryLogger(l,b,"LinkRightClicked");t.addEventListener("contextmenu",(function(){ut()}));ko.reactor(o,(function(){var f,i;try{a&&a.dispose();a=o.createChildLifetime();i=ko.unwrap(u);b(((f=i)===null||f===void 0?void 0:f.telemetryName)||"");ko.ignoreDependencies((function(){var o,u,l,f,h;typeof i=="function"?(u=i,l=function(i){i.stopPropagation();var r=p?t.getAttribute(c)||"":"";if(s.defaultHref===r)i.preventDefault();else if(p&&i.type==="keydown"&&(i.which===13||i.which===32&&"button"===t.getAttribute("role"))||"BUTTON"===t.tagName&&(32===i.which||13===i.which))return;Q.isPromiseAlike(u)&&e.logToExtension(n,t,2,FxImpl.createError("fxclick binding argument is not a callback function. The click handler is "+u));y.invokeClick(nt,u,i)},o=l):o=i;f=s.getUriAndHandler(a,tt,o,!p);h=v;f.uri.subscribeAndRun(a,(function(n){if(v=!n,(r.$disabled||h!==v)&&(h=v,it(r.$disabled&&r.$disabled())),p){var i=!1;w&&(i=!!t.getAttribute(c));i&&n===s.defaultHref||(n?(t.setAttribute(c,n),w=!1):(t.removeAttribute(c),w=!1))}}));f.errorMessage.subscribeAndRun(a,(function(i){i&&e.logToExtension(n,t,1,FxImpl.createError("fxclick failure: "+MsPortalFx.getLogFriendlyMessage(i)))}));rt=f.handler}))}catch(h){e.logToExtension(n,t,2,FxImpl.createError("fxclick failed to read value: "+MsPortalFx.getLogFriendlyMessage(h)))}}));ko.reactor(o,[r.$disabled,r.$tabIndex],it);t.classList.add(k);g=function(i){if(ko.unwrap(r.$disabled)||"true"===t.getAttribute("aria-disabled")){if("click"===i.type||"keydown"===i.type&&(13===i.which||32===i.which&&("BUTTON"===t.tagName||"button"===t.getAttribute("role"))))return!1}else try{return rt(i,y,b())}catch(u){e.logToExtension(n,t,2,FxImpl.createError("fxclick failed to execute click handler",{innerErrors:u,data:{databind:$(t).attr("data-bind")}}))}};o.registerForDispose([function(){return t.classList.remove(k)},l.setEvents(["click",g,],["keydown",g,]),]);y.activated.subscribeAndRun(o,(function(n){var t=!!n;dt(l,t);t&&l.trigger($.Event("fxselectableactivated",{activated:y.activated}))}))}function nt(n,t){try{var i=ko.unwrap(n[t]);return(Array.isArray(i)||typeof i!="object")&&(i=undefined),i}catch(r){return undefined}}function tt(n,t){return n?n+"."+t:t}function it(n){var t=new Map;return y(n,"content",t),y(n,"container",t,ht),y(n,"internal",t,ct),t}function y(n,t,i,r){for(var s=nt(n,t),c={path:t,value:s,unprocessedChildProperties:r?r.slice():rt(s)},f=[c],e,o,u,h;f.length;)e=f[f.length-1],e.unprocessedChildProperties.length?(o=e.unprocessedChildProperties.shift(),u=nt(e.value,o),u&&(ut.isSelectable2(u)?i.set(u,{path:tt(e.path,o),selectable:u}):f.length<st&&(h={path:tt(e.path,o),value:u,unprocessedChildProperties:rt(u)},f.push(h)))):f.pop()}function rt(n){return Object.keys(n).filter((function(n){return!ni(n)}))}function ni(n){return n.charCodeAt(0)===95&&!(n.charCodeAt(1)===109&&n.charCodeAt(2)===115&&n.charCodeAt(3)===80&&n.charCodeAt(4)===111&&n.charCodeAt(5)===114&&n.charCodeAt(6)===116&&n.charCodeAt(7)===97&&n.charCodeAt(8)===108&&n.charCodeAt(9)===70&&n.charCodeAt(10)===120)}function ti(n){var t={},i=[];return(n||[]).forEach((function(n){t[n]&&i.push(n);t[n]=!0})),i}Object.defineProperty(t,"__esModule",{value:!0});t.discoverSelectables=t.attachFxClickHandler=t.getListSelectableWithClickHandler=t.getSelectableWithClickHandler=t.createFxColumnSelectable=t.registerOpenBladeCommands=t.registerSelectables=void 0;var ut=FxImpl,ft=MsPortalFx.Base.Diagnostics,et=f.createOrGetInternalSelectionState,ot=r.getFxClickSelectable,p=r.getOrCreate,l=r.findExtensionViewModel,w=r.getOrCreateOpenBladeSelectable,b=ft.createLog(n),h="fxclick",c="href",k="fxs-fxclick",st=15,ht=["_msPortalFxShell","_msPortalFxOpenBladeSelectable","_msPortalFxSelectable","_msPortalFxSelectable2",],ct=["selectable","activeOpenBladeCommand",];t.registerSelectables=lt;t.registerOpenBladeCommands=yt;var a="msportalfx-activated",v=a+" ext-"+a,wt=0;t.createFxColumnSelectable=bt;t.getSelectableWithClickHandler=g;t.getListSelectableWithClickHandler=kt;t.attachFxClickHandler=gt;t.discoverSelectables=it}))