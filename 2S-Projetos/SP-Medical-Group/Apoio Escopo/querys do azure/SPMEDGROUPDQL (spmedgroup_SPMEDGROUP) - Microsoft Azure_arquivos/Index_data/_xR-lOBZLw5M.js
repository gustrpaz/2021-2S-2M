define("@microsoft/azureportal-reactview/internal/LighthouseMetrics",["require","exports","@microsoft/azureportal-reactview/Environment","@microsoft/azureportal-reactview/internal/ReactInternal","@microsoft/azureportal-reactview/internal/LighthouseNormalization","@microsoft/azureportal-reactview/internal/ReactInternal","@microsoft/azureportal-reactview/Az"],(function(n,t,i,r,u,f,e){"use strict";function k(n){var o,p=Date.now()-n,t=performance.now()-p;a(t);var h,l=(o={},o.CumulativeLayoutShift=0,o),u=function(t,i){l[t]=i;var r=(t==="FirstContentfulPaint"||t==="LargestContentfulPaint"||t==="TimeToInteractive")&&i?i+n:undefined;c.forEach((function(n){return n(t,i,l,r)}))},w=new Promise(function(n,t){return window.require(["web-vitals"],n,t)});w.then((function(n){var i=n.getLCP,r=n.getFCP,e=n.getCLS;i((function(n){d(h,window.performance.now());f();u("LargestContentfulPaint",n.value-t)}));r((function(n){var i=n.value;h=i;u("FirstContentfulPaint",i-t)}));e((function(n){return u("CumulativeLayoutShift",n.value)}),!0)})).catch((function(n){i.isFeatureEnabled("lighthouse")&&console.warn("Lighthouse metrics cannot be measured.");e.log([{level:2,message:n,area:"LighthouseMetrics",timestamp:Date.now()}]);f()}));var s=v(t,u),b=s.noteLongTask,k=s.noteAsyncOperation,d=s.tryLog,y=new PerformanceObserver(function(n){if(r.isDisposed()){f();return}n.getEntries().forEach((function(n){n.entryType==="longtask"&&b(n);n.entryType==="resource"&&k(n)}))}),f=function(){y.disconnect();f=function(){}};y.observe({entryTypes:["longtask","resource"]})}function v(n,t){var r=[],u=[],f=(function(){var t=n;return function(n,i){var f={startTime:t,endTime:n};f.endTime-f.startTime>5e3&&r.push(f);i&&(t=n+i,u.push({startTime:n+50,duration:i-50}))}})(),e=[],s=function(n){e.push(n)},i,h=function(o,s){var h,c,a,v;if(!i&&o){f(s);var l=function(n){var r=n.timeToInteractive,u=n.totalBlockingTime;i=!0;t("TimeToInteractive",r);t("TotalBlockingTime",u)},y=function(n){var t=Math.max(n.startTime,o),i=n.endTime,r,u,s,f,h;if(i<o||i-t<5e3)return undefined;for(r=[],e.forEach((function(n){var u=n.startTime,e=n.duration,f=u+e;f>t&&(u<i&&r.push({time:u,isAddRef:!0}),f<i&&r.push({time:f}))})),r.sort((function(n,t){return n.time<t.time?-1:1})),u=0,s=function(n){if(u<=2&&n>t+5e3)return t},f=0,h=r;f<h.length;f++){var c=h[f],l=c.time,a=c.isAddRef,v=s(l);if(typeof v=="number")return v;if(u===3&&!a&&(t=l,i-t<5e3))return undefined;u+=a?1:-1}return s(i)},p=function(t){var i=y(t),f,r;if(typeof i=="number")return f=i-n,r=0,u.forEach((function(n){var t=n.startTime,f=n.duration,u=t+f;u<=o||t>=i||(r+=Math.min(u,i)-Math.max(t,o))})),l({timeToInteractive:f,totalBlockingTime:r}),"break"};for(h=0,c=r;h<c.length;h++)if(a=c[h],v=p(a),v==="break")break;i||l({timeToInteractive:undefined,totalBlockingTime:undefined})}};return o=s,{noteLongTask:function(n){var t=n.startTime,i=n.duration;f(t,i)},noteAsyncOperation:s,tryLog:h}}function y(n,t){t=t||performance.now();n.catch((function(){})).then((function(){o===null||o===void 0?void 0:o({startTime:t,duration:performance.now()-t})}))}function p(n){return c.add(n),function(){c.delete(n)}}Object.defineProperty(t,"__esModule",{value:!0});t.noteCallFromFrame=t.forceCompleteMeasure=t.measureTimeToInteractive=t.startMeasure=void 0;var w=__InternalAzurePortal.AzInternalApi,l=w.internalApi,s=f.getBaseFunctionProxy(),h=l.getBladeContext(),c=new Set,a,b=new Promise(function(n){return a=n}),o;t.startMeasure=k;t.measureTimeToInteractive=v;t.forceCompleteMeasure=(function(){var i=8e3,r=function(){document.getElementById("__bladeTitleMain").click()},t,n=function(n){return new Promise(function(i){var r=p((function(u,f,e){t=e;u===n&&(r(),i(f))}))})},e=n("FirstContentfulPaint"),u,f=Promise.all([n("FirstContentfulPaint"),n("LargestContentfulPaint"),n("TimeToInteractive"),n("TotalBlockingTime"),new Promise(function(n){return setTimeout(n,250)}),]).then((function(){return u=!0,t}));return function(){return u?Promise.resolve(t):(Promise.all([b,e,]).then((function(n){var e=n[0],o=n[1],u=performance.now()-e-o,t;u>i?r():(t=setTimeout((function(){t=null;r()}),i-u),f.then((function(){t&&clearTimeout(t)})))})),f)}})();t.noteCallFromFrame=y;p((function(n,t,r,f){i.isFeatureEnabled("lighthouse")&&h.then((function(i){var r;if(t){var f=u.normalizeMetric(n,t),e=f.score,o=f.maxScore,s=f.utilizedPercent;r={value:t.toFixed(n==="CumulativeLayoutShift"?3:0),score:e.toFixed(2),maxScore:o.toFixed(2),utilizedPercent:s.toFixed(2)}}else r={value:undefined};console.info(__assign(__assign({metric:n},r),{blade:i.id,bladeInstance:i.instanceId}))}));l.logLighthouse(r);n==="TimeToInteractive"&&i.isFeatureEnabled("networktelemetry")&&h.then((function(n){s.invoke("___runtime___onInteractive",{bladeInstanceId:n.instanceId,time:f},!0)}))}));s.onInvoke((function(n,t){if(n!=="___runtime___waitForExtensionIdle"&&n!=="___runtime___onInteractive"&&n!=="___ajax___trace"){var i=performance.now();t=t||h.then((function(n){return s.invoke("___runtime___waitForExtensionIdle",{bladeName:n.id.split("/")[3],bladeInstanceId:n.instanceId})}));y(t,i)}}))}))