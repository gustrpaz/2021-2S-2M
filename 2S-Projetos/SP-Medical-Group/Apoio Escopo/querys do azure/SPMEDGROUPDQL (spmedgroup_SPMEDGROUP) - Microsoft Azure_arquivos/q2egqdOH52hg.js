define("_generated/Less/MsPortalImpl/Controls/Forms/DropDown.css",["module"],(function(n){"use strict";return{css:'.fxc-group-dropdown{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;box-sizing:border-box;position:relative;height:auto;line-height:inherit;font-size:13px}.fxc-group-dropdown .azc-formElementContainer{position:relative}.fxc-group-dropdown .azc-formElementContainer .axc-textBox{height:23px}.fxc-group-dropdown .azc-formElementContainer .azc-textBox-wrapper{line-height:16px}.fxc-group-dropdown .azc-formElementContainer .azc-textBox-wrapper .azc-input{padding-right:23px}.fxc-group-dropdown .fxc-dropdown-multifilter{display:none}.fxc-group-dropdown .fxc-dropdown-multifilter .azc-textBox-wrapper .azc-input{padding-right:8px}.fxc-group-dropdown.fxc-dropdown-filter .fxc-dropdown-multifilter{display:block}.fxc-group-dropdown .fxc-dd-text-wrapper .azc-input{min-height:24px}.fxc-group-dropdown [aria-expanded="true"] .azc-textBox-wrapper input,.fxc-group-dropdown [aria-expanded="true"] .fxc-dropdown-open.azc-input{border-radius:2px 2px 0 0 !important}.fxc-group-dropdown .fxc-dropdown-popup{border-radius:0 0 2px 2px !important}.fxc-group-dropdown.fxc-popup-opened-up .fxc-dropdown-popup{border-radius:2px 2px 0 0 !important}.fxc-group-dropdown.fxc-popup-opened-up [aria-expanded="true"] .azc-textBox-wrapper input,.fxc-group-dropdown.fxc-popup-opened-up [aria-expanded="true"] .fxc-dropdown-open.azc-input{border-radius:0 0 2px 2px !important}.fxc-left-label .fxc-dd-text-wrapper{min-height:24px;position:relative}.fxc-left-label .fxc-dropdown-open.azc-input{position:absolute}.fxc-dropdown-open.azc-input{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:block;padding:2px 30px 2px 8px;width:100%;box-sizing:border-box;border-width:1px;border-style:solid}.fxc-dropdown-open.azc-input input{display:none}.fxc-dropdown-option{line-height:24px;position:relative;cursor:pointer}.fxc-dd-noresults,.fxc-dropdown-option,.fxc-dropdown-option-label{padding:4px 0 4px 8px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.fxc-dropdown-option-label{color:#0078d4;border-top:1px solid #f3f2f1;line-height:23px;font-weight:600}.fxc-dd-noresults{font-style:italic;text-align:center;opacity:.7}.fxc-dropdown-option-disabled{cursor:default;opacity:.35}.fxc-group-dropdown .azc-formControl .fxc-dropdown-select{opacity:1;outline:none;padding-left:0}.fxc-group-dropdown .azc-textBox-wrapper input{padding-right:20px}.fxc-dropdown-popup-dock{position:fixed;display:flex;flex-direction:column}.fxc-dropdown-popup-dock .fxc-dropdown-multifilter>.msportalfx-form-formelement{padding:8px !important}.fxc-dropdown-popup-dock input{border-top-width:0;border-left-width:0;border-right-width:0}.fxc-popup-opened-up .fxc-dropdown-popup-dock{order:2}.fxc-inner-popup{overflow:auto;overflow-x:hidden}.fxc-dropdown-option-wrapper{position:inherit}.fxc-dropdown-popup{width:100%;position:fixed;max-height:700px;z-index:150;overflow:hidden;overscroll-behavior-y:contain;-ms-scroll-chaining:none}.fxc-dropdown-popup svg{pointer-events:none}.fxc-dropdown-hidden{visibility:hidden;left:-10000px;top:-10000px}.fxc-dropdown-hidden .fxc-dropdown-virtual-height{display:none}.fxc-dropdown-open{cursor:pointer}.msportalfx-form-formelement-disabled .fxc-dropdown-open{cursor:default}.fxc-dropdown-placeholder{opacity:.8}.fxc-group-dropdown-arrow{position:absolute;width:26px;height:calc(100% - 4px);right:2px;top:2px;font-weight:600;transition-property:background-color,border-color;transition-duration:200ms;transition-timing-function:cubic-bezier(.4,0,.23,1)}.fxc-group-dropdown-arrow:hover{background-color:#f3f2f1}.fxs-mode-dark .fxc-group-dropdown-arrow:hover{background-color:#333}.fxs-mode-dark .fxc-dropdown-popup{outline-color:#808080;outline-width:1px;outline-style:auto}.fxc-dd-caret{height:13px;width:13px;pointer-events:none;position:absolute;top:calc(50% - 7px);right:7px}.fxc-dd-caret>svg{height:13px;width:13px}.msportalfx-form-formelement-disabled .fxc-dd-caret{fill:#a19f9d !important}.fxc-dropdown-check{height:14px;width:14px;min-width:14px;border-width:1px;border-style:solid;padding:2px;top:calc(50% - 10px);position:absolute;border-radius:2px;border-color:#323130;transition-property:background-color,border-color;transition-duration:200ms;transition-timing-function:cubic-bezier(.4,0,.23,1)}.fxc-dropdown-check .fxc-dd-svg{display:none}.fxs-mode-dark .fxc-dropdown-check{border-color:#fff}.fxc-group-dropdown:not(.fxc-dropdown-selectall-partial) .fxc-dropdown-option:not(.fxs-portal-selected):hover .fxc-dd-svg,.fxc-group-dropdown .fxc-dropdown-option:not(.fxc-dropdown-option-disabled):not(.fxs-portal-selected):not(.fxc-dropdown-selectall):hover .fxc-dd-svg{display:block;fill:#605e5c}.fxc-dropdown-multiselect .fxs-portal-selected,.fxc-dropdown-multiselect .fxs-portal-hover:hover{background-color:transparent !important}.fxc-dropdown-multiselect .fxc-dropdown-option.fxs-portal-selected .fxc-dropdown-check{border-color:#0078d4;background-color:#0078d4}.fxc-dropdown-multiselect .fxc-dropdown-option.fxs-portal-selected .fxc-dd-svg{display:block;fill:white}.fxc-dropdown-multiselect .fxc-dropdown-option.fxs-portal-selected:hover .fxc-dropdown-check{background-color:#005a9e;border-color:#005a9e}.fxc-dropdown-multiselect .fxc-dropdown-option.fxs-portal-selected.fxc-dropdown-option-disabled .fxc-dropdown-check{background-color:#c8c6c4}.fxc-group-dropdown .azc-input{outline:none}.fxc-dropdown-keynav{outline-style:solid;outline-width:1px;outline-offset:-1px}.fxs-mode-light .fxc-dropdown-keynav{outline-color:#605e5c}.fxs-mode-dark .fxc-dropdown-keynav{outline-color:#fff}.fxc-dd-svg{height:12px;width:12px;margin-top:-4px;margin-left:1px}.fxc-dropdown-multiselect .fxc-dropdown-option>span{display:inline-block;padding-left:28px}.fxc-dropdown-selectall-all .fxc-dropdown-selectall .fxc-dropdown-check .fxc-dd-svg{display:block}.fxc-dropdown-selectall{position:relative}.fxc-dropdown-selectall span.azc-bg-muted-80-10{display:none}.fxc-dropdown-selectall-partial .fxc-dropdown-selectall .azc-bg-muted-80-10{width:10px;height:10px;position:absolute;top:11px;left:13px;display:block;padding:0;background-color:#0078d4}.fxc-dropdown-selectall-partial .fxc-dropdown-selectall:hover .azc-bg-muted-80-10{background-color:#005a9e}.fxc-dropdown-selectall-partial .fxc-dropdown-selectall .fxc-dd-svg{display:none}.fxt-dd-prewrap{white-space:pre-wrap}.fxc-dropdown-virtual-height{display:none}.fxc-dropdown-virtual .fxc-dropdown-selectall{z-index:1}.fxc-dropdown-virtual .fxc-dropdown-option-wrapper{position:fixed;overflow:hidden}.fxc-dropdown-virtual .fxc-dropdown-virtual-height{display:block;position:relative;pointer-events:none}.fxc-dropdown-virtual .fxc-dd-noresults{position:absolute;bottom:-20px;width:100%;display:none}.fxc-group-dropdown .azc-dockedballoon-validation{display:none}.fxc-group-dropdown:not(.azc-validationBelowCtrl) .azc-validatableControl-invalid .fxc-dd-text-wrapper .fxc-TextField{width:calc(100% - 13px + 1px)}.fxc-group-dropdown:not(.azc-validationBelowCtrl) .azc-validatableControl-invalid .fxc-dd-text-wrapper .azc-input.azc-formControl{border-color:#a4262c !important}.fxc-group-dropdown:not(.azc-validationBelowCtrl) .azc-validatableControl-invalid>.azc-dockedballoon-validation{display:block;width:13px;position:absolute;right:0;top:0;height:100% !important;border-top-right-radius:2px;border-bottom-right-radius:2px}.fxc-group-dropdown:not(.azc-validationBelowCtrl) .azc-validatableControl-invalid .azc-dockedballoon-anchor{top:calc(50% - 12px);left:calc(50% - 2px);position:absolute}.fxc-group-dropdown:not(.azc-validationBelowCtrl) .azc-validatableControl-invalid .fxc-group-dropdown-arrow{right:13px}.fxc-group-dropdown.azc-validationBelowCtrl .azc-validatableControl-invalid .fxc-dd-text-wrapper .azc-input.azc-formControl{border:1px solid #a4262c}.fxc-dropdown-filter .azc-formElementSubLabelContainer.azc-validatableControl-invalid .azc-dockedballoon-validation{margin-right:-13px}',moduleId:n.id}}));
define("MsPortalImpl/Controls/Forms/DropDown",["require","exports","MsPortalImpl/TsxStringMode/Tsx","MsPortalImpl/TsxStringMode/Tsx","MsPortalImpl/Resources/ImplScriptResources","FxInternal/Controls/DropDown","MsPortalImpl/Interactions/Interactions.DismissHandler","MsPortalImpl.Controls/Fields/TextField","MsPortalImpl.Controls/Controls/Base/ViewModelBase","MsPortalImpl/Base/Base.KeyboardHelper","MsPortalImpl.Controls/Fields/Base/LabelAndBalloonWidget","MsPortalImpl/Controls/Helpers/Validators","MsPortalImpl/Base/Base.BrowserDetection","MsPortalImpl/Widgets/Widgets.Common","Viva.Controls/Util/Viva.Resize","Viva.Controls/Controls/Viva.Balloon","MsPortalImpl/Base/Base.FeatureDetection","MsPortalImpl/Base/Base.Timers","MsPortalImpl/Base/JQueryHelper","MsPortalImpl/Weave/Util","FxInternal/Css","MsPortalImpl/Interactions/Interactions.PortalReader","_generated/Less/MsPortalImpl/Controls/Forms/DropDown.css"],(function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt){"use strict";function ii(n){return Array.isArray(n)?n:[n]}function ci(n){return MsPortalFx.merge.apply([],n)}function or(n){return parseInt(n.css("max-height").replace("px",""))}var dt,ri;Object.defineProperty(t,"__esModule",{value:!0});t.DropDown=t.Widget=void 0;g.injectCss(tt);var li=MsPortalFx.Base,sr=MsPortalFx.ViewModels.Controls,at=li.Images,hr=MsPortalFx.ViewModels.Forms.TextBox.ViewModel,cr=li.Diagnostics.Telemetry,ui=MsPortalFx.deepEquals,fi=50,ai=50,ot=MsPortalFx.isNullOrUndefined,vi=35,st=32,yi=704,ei=MsPortalFx.isFeatureEnabled("ci"),oi=[27,9,16,40,38,18,112,13,35,36],pi="fxc-dropdown-filter",wi="fxs-br-primary",ut="fxc-dropdown-option",gt="fxc-dropdown-option-disabled",ht="fxc-dropdown-keynav",ni="msportalfx-tooltip-overflow",yt="fxs-portal-selected",bi="fxs-portal-hover",ki="fxc-dropdown-check",lr="fxc-dropdown-multiselect",di="fxc-dropdown-multifilter",pt="fxc-dropdown-selectall",gi="fxc-dropdown-selectall-all",nr="fxc-dropdown-selectall-partial",rt="fxc-dropdown-popup",ti="fxc-dropdown-hidden",lt="fxc-dropdown-open",tr="fxc-group-dropdown",vt="azc-formElementContainer",ct="azc-input",wt="fxc-dd-text-wrapper",bt="fxc-dropdown-virtual-height",ft="fxc-dropdown-popup-dock",it="fxc-inner-popup",et="fxc-dropdown-option-wrapper",kt="fxc-dd-noresults",ir="fxs-portal-bg-txt-br",rr="fxc-group-dropdown-arrow",ur="[role='treeitem']:not(."+kt+")",si="DropDown.itemText",hi="",ar="bottom",fr=u.DropDown.filterTextbox,vr=i("div",{"class":vt},i("label",{"aria-busy":"true","aria-live":"assertive","aria-atomic":"true","class":"fxs-hide-accessible-label","data-bind":{text:"$ctl._ariaLive"}}),i("div",{"class":[wt],"data-bind":{attr:{id:'$ctl._comboBox() ? $ctl._comboboxContainerId() : ""',"aria-label":'$ctl._comboBox() ? "'+u.Controls.combobox+'" : ""',"aria-labelledby":'$ctl._comboBox() ? (ko.unwrap($data.data.label) ? $ctl._labelId() : $ctl._comboboxContainerId()) : ""'}}},i(r.KoIfNot,{condition:"$ctl._comboBox"},i("div",{"class":["azc-formControl",ct,lt,ni,"azc-validation-border","fxc-dropdown-input"],role:"combobox","aria-haspopup":"dialog","aria-autocomplete":"none","read-only":"true","data-canfocus":"true","data-bind":{untrustedContentDeprecated:"$ctl._stringOrHtmlToDisplay",css:(dt={},dt["azc-disabled"]="$disabled()",dt["fxs-br-dirty"]="data.dirty()",dt),attr:{id:"$ctl._comboBoxFilterId",tabindex:"$tabIndex","aria-disabled":"$disabled()","aria-labelledby":"$ctl._labelAndComboboxIds()","aria-controls":"$ctl._dialogContainerId","aria-expanded":"$data.data.isPopUpOpen().toString()"}}}))),i(r.KoIfNot,{condition:"$ctl._comboBox"},i("span",{"class":[rr,lt,ir],role:"button",tabindex:"-1","aria-label":u.toggle},i("span",{"class":["fxc-dd-caret","fxs-portal-svg"],"data-bind":{image:"$ctl._icon"}}))),i("div",{"class":[ti,rt,"fxc-control-border","azc-bg-default","msportalfx-shadow-level2"],"data-bind":{attr:{id:"$ctl._dialogContainerId",role:'$ctl._comboBox() ? null : "dialog"'}}},i(r.KoIfNot,{condition:"$ctl._comboBox"},i("div",{"class":ft+" "+ir},i("div",{"class":[di]}))),i("div",{role:"tree",tabindex:"-1","aria-label":u.DropDown.optionContainer,"data-canfocus":"true","data-bind":{attr:{id:"$ctl._optionContainerId","aria-multiselectable":"$ctl._multiselectActivated()"}}},i(r.KoIf,{condition:"$ctl._showMultiselectSelectAll()"},i("div",{role:"treeitem","aria-posinset":"1","class":[ut,ni,pt,bi,"fxs-portal-background"],"data-bind":{attr:{id:"$ctl._multiSelectSelectAllId","aria-label":'"'+u.dropDownSelectAll+'"',"aria-selected":"$ctl._allSelected().toString()","aria-setsize":"$ctl._descendantItemOnlyIndex + 1"},css:(ri={},ri[yt]="$ctl._allSelected",ri)}},i("span",{"class":"azc-bg-muted-80-10"}),i("div",{"class":[ki]},i("span",{"class":["fxc-dd-svg","fxs-portal-svg"],"data-bind":{image:"$ctl._checkMarkIcon"}})),i("span",{"data-bind":{text:'"'+u.dropDownSelectAll+'"'}}))),i("div",{"class":[it]},i(r.KoIf,{condition:"$ctl._popupOnce"},i("div",{"class":bt}),i("div",{"class":et},i(r.KoForEach,{items:"$ctl._paneItemsMap"},i(r.KoIf,{condition:"$ctl._isGroup($data)"},i(r.KoIf,{condition:"$data.text"},i("div",{"class":["fxc-dropdown-option-label",ni],"data-bind":{untrustedContentDeprecated:"text",css:"$ctl._setClasses($data)",attr:{"aria-label":"ko.unwrap($data.ariaLabel) || null"}}}))),i(r.KoIf,{condition:"$ctl._isItem($data)"},i("div",{role:"treeitem","class":[ut,ni],"data-bind":{attr:{"aria-selected":"MsPortalFx.isUndefined($ctl._isSelected($data)) ? null : $ctl._isSelected($data).toString()",id:"$ctl._getInternalItem($data).id()","aria-disabled":"(ko.unwrap($data.disabled) || ko.unwrap($ctl._getInternalItem($data).headerDisabled)) || null","aria-label":"ko.unwrap($data.ariaLabel) || null","aria-posinset":"$ctl._showMultiselectSelectAll() ? $ctl._getInternalItem($data).itemIndex + 1 : $ctl._getInternalItem($data).itemIndex","aria-setsize":"$ctl._showMultiselectSelectAll() ? $ctl._descendantItemOnlyIndex + 1 : $ctl._descendantItemOnlyIndex"},css:"$ctl._setClasses($data)"}},i(r.KoIf,{condition:"$ctl._multiselectActivated"},i("div",{"class":[ki]},i("span",{"class":["fxc-dd-svg","fxs-portal-svg"],"data-bind":{image:"$ctl._checkMarkIcon"}}))),i("span",{"class":"fxs-portal-svg","data-bind":{untrustedContentDeprecated:"text"}})))),i(r.KoIf,{condition:"$ctl._showStatusMessage()"},i("div",{role:"treeitem","class":[kt]},i("span",{"data-bind":{untrustedContent:"$ctl._statusMessage"}}))))))))),er=(function(n){function t(t,i,r){var f=n.call(this,t,i,r)||this;return f._selectedValues=ko.observableArray([]),f._checkMarkIcon=at.Check({palette:99}),f._canFilter=!0,f._filterActivated=ko.observable(!1),f._filterInPopUp=ko.observable(!1),f._filterReadOnly=ko.observable(!1),f._filterStringChangedByVM=!1,f._filtering=ko.observable(!1),f._customFilterResults=ko.observableArray(null),f._customItemReplacement=!1,f._oldItems=[],f._multiselectActivated=ko.observable(!1),f._multiselectSelectAll=ko.observable(!1),f._showMultiselectSelectAll=ko.observable(!1),f._allSelected=ko.observable(!1),f._multiSelectSelectAllId=ko.observable(""),f._labelId=ko.observable(""),f._comboboxContainerId=ko.observable(""),f._labelAndComboboxIds=ko.observable(""),f._optionContainerId=ko.observable(""),f._dialogContainerId=ko.observable(""),f._comboBoxFilterId=ko.observable(""),f._ariaLive=ko.observable(""),f._popupOnce=ko.observable(!1),f._virtualize=ko.observable(!1),f._flattenItemsMap=ko.observableArray([]),f._filteredItems=ko.observableArray([]),f._paneItemsMap=ko.observableArray([]),f._itemsMap=new Map,f._topItemIndex=ko.observable(0),f._maxItemsInPopup=fi,f._stringOrHtmlToDisplay=ko.observable(""),f._icon=ko.observable(at.CaretDown()),f._showStatusMessage=ko.observable(!1),f._statusMessage=ko.observable({htmlTemplate:u.Search.noResults}),f._pendingTimer=null,f._comboBox=ko.observable(!1),f._comboBoxAddedItem=null,f._popupGuard=!1,f._openPopupUp=undefined,f._keyDownOnScrollBar=!1,f._widthOfInput=0,f._defaultItemHeight=st,f._descendantIndex=0,f._descendantItemOnlyIndex=0,f._isTouch=a.isTouch,f._subscribedToPopupMaxWidth=!1,f._setTemplate(),f._attachEvents(),f._initializeSubscriptions(),f}return __extends(t,n),t.prototype._countItems=function(n,t){var r=this,i;return t===void 0&&(t=!1),i=0,n&&(t&&(n=ci(n.map((function(n){return r._unwrapGroupChildren(n)})))),n.forEach((function(n){r._isItem(n)&&i++}))),i},t.prototype._unwrapGroupChildren=function(n){var r=this,i,t;if(!ot(n))return(this._getInternalItem(n),this._isGroup(n)&&n.children)?(i=ko.unwrap(n.children),t=ci(i.map((function(n){return r._unwrapGroupChildren(n)}))),t.unshift(n),t):n},t.prototype._setClasses=function(n){var i,t,u=ko.unwrap(n.disabled)||ko.unwrap(this._getInternalItem(n).headerDisabled),r=(i={},i[gt]=u,i);return this._isItem(n)?$.extend(r,(t={},t[bi]=!ko.unwrap(u),t[yt]=this._isSelected(n),t)):$.extend(r,{"fxc-dropdown-group":!0}),r},t.prototype._setItems=function(n,t){var s,e,r,u;n===void 0&&(n=0);t===void 0&&(t=!1);var i=[],h=this._maxItemsInPopup+(this._multiselectSelectAll()&&!this._showMultiselectSelectAll()?1:0),o=!1,f=this.vm.filterString();for(this._comboBox()&&(this._filtering()&&f?(s=this._flattenItemsMap().some((function(n){var t=ko.unwrap(n.value);return typeof t=="string"&&t===f?!0:!1})),s?this._comboBoxAddedItem=null:(this._comboBoxAddedItem={text:{htmlTemplate:"<div class=\"fxt-dd-prewrap\" data-bind='text: text'><\/div>",viewModel:{text:f}},value:f},i.push(this._comboBoxAddedItem))):!this._comboBoxAddedItem||this._comboBoxAddedItem.value!==this.vm._msPortalFxWidgetValue()||i.push(this._comboBoxAddedItem)),e=i.length,r=n;r<n+h-e;r++)u=void 0,!t&&this._useFilteringArray()?(u=this._filteredItems()[r],o=!0):u=this._flattenItemsMap()[r],u&&i.push(u);if(this._topItemIndex(n),this._paneItemsMap(i),this._virtualize()){var c=o?this._filteredItems():this._flattenItemsMap(),l=this.element.findByClassName(kt).outerHeight()||0,a=Math.max(c.length+e,i.length)*this._defaultItemHeight+l;this.element.findByClassName(bt).height(a)}this.element.toggleClass("fxc-dropdown-noitems",!i.length)},t.prototype._useFilteringArray=function(){return this._filtering()&&this._filteredItems&&!this._customItemReplacement},t.prototype._findMatches=function(n){var t=this;n===void 0&&(n="");var i=this._customFilterResults(),r=this._filtering()&&(n!==""||!!i),f=function(u){var e=[];return u&&u.forEach((function(u){var o,s;t._isItem(u)?r&&(i&&i.includes(ko.unwrap(u.value))?e.push(u):i||(o=v.getStringFromHtmlContent(t._diContainer,ko.unwrap(u.text),t.element[0],si),o&&n&&o.toLocaleLowerCase().includes(n.toLocaleLowerCase())&&e.push(u))):t._isGroup(u)&&(s=f(ko.unwrap(u.children)),s.length&&(e.push(u),e=e.concat(s)))})),e},e=f(this.vm.items());r?(this.element.findByClassName(it).scrollTop(0),this._filteredItems(e),this._setItems(),this._ariaLive(u.DropDown.filterResult.format(this._countItems(e),this.vm.filterString())),this._setDropDownWidth()):(this._filtering(!1),this._setItems())},t.prototype._setTemplate=function(){var i=this,n,t,r,u;this.element.addClass(tr+" msportalfx-form-formelement azc-fabric");n=this._labelHelper=new c.LabelAndBalloonWidgetHelper(this._diContainer,this.ltm,this.vm);this._required=ko.computed(this.ltm,(function(){var t=0!==i.vm.validations.filter(i.ltm,(function(n){return 1===n.type}))().length;return t||n.required()}));t=$(vr);n.appendWidgetToDom(this.element,t);n.attachSubLabelClass(this.element);n.attachKeyboardEvents(this.element);n.insertLabelBefore(t);this._labelId(n.labelId);this._comboBoxFilterId(n.labelId+"textbox");this._filterInPopupId=n.labelId+"filter";this._comboboxContainerId(n.labelId+"combobox");this._optionContainerId(n.labelId+"aria");this._dialogContainerId(n.labelId+"dialog");this._multiSelectSelectAllId(n.labelId+"selectall");this._labelAndComboboxIds(this._labelId());r=this.vm.ariaLabel;u=MsPortalFx.initObservable(this.vm.label);r&&ko.reactor(this.ltm,[u,r],(function(n,t){var r=(t||"").trim();i._labelAndComboboxIds(r?i._comboBoxFilterId():n&&i._labelId())}));this._bindDescendants({},this.element.findByClassName(vt));this._validator=new l.Validators(this._diContainer,this.ltm,this,this.element.findByClassName(vt));this.vm.showValidationMessagesBelowControl?(this.element.addClass(c.validationMessageBelowControlClass),n.insertValidationMessageBelowControlAfter(t,this._validator.validationResults)):n.insertValidationMessageHidden(t,this._validator.validationResults);n.insertSubLabelAfter(t);t.findByClassName(ct).attr("aria-describedby",n.errMsgId);this._validator.validationResults.subscribeAndRun(this.ltm,(function(i){var r=i.filter((function(n){return n.state!==0&&!n.valid})).map((function(n){return n.message})).join(" ").trim();c.toggleAriaErrorMessage(t.findByClassName(ct),n.errMsgId,!!r)}));this._widthOfInput=$(this.element.findByClassName(vt)[0]).width()},t.prototype._initializeSubscriptions=function(){var n=this,i=this.vm,t=this.ltm,a=this.element.find("."+wt),r=MsPortalFx.initObservable(i.multiselect,!1),f=MsPortalFx.initObservable(i.filter,!1),e,o,s,h,c,l;this._comboBox(!!i.isComboBoxCtrl&&f());ko.reactor(t,[f,this._comboBox],(function(t,i){n._filterInPopUp(t&&!i)}));e=function(t){n._multiselectActivated(t);n.element.toggleClass(lr,t);n._filterActivated()?(n._removeFiltering(),n._setupFiltering()):n._updateSelected(i.value())};r.subscribeAndRun(t,(function(t){t?e(t):n._multiselectActivated()&&e(t)}));f.subscribeAndRun(t,(function(t){t?n._setupFiltering():n._filterActivated()&&n._removeFiltering()}));this._ariaLive.subscribe(t,(function(){n.element.find("[aria-live='assertive']").attr("aria-busy","false")}));i.items.subscribeAndRun(t,(function(r){var e,f,o;n._descendantIndex=n._descendantItemOnlyIndex=0;e=MsPortalFx.deepEquals(n._oldItems,r);n.vm.isPopUpOpen()&&n._filtering()&&!e&&(n._customItemReplacement=!0,n._ariaLive(u.DropDown.filterResult.format(n._countItems(r),n._textBoxViewModel.value())));n._currentItemsLifeTime&&(n._currentItemsLifeTime.dispose(),n._currentItemsLifeTime=null);ot(r)?n._paneItemsMap([]):(f=ci(r.map((function(t){return n._unwrapGroupChildren(t)}))),n._flattenItemsMap(f),o=!ei&&f.length>fi,o?(n._virtualize(!0),n._popupOnce()||n._setItems()):(n._virtualize(!1),n._maxItemsInPopup=fi),n.element.toggleClass("fxc-dropdown-virtual",o),ei&&(n._maxItemsInPopup=1e4),n._comboBox()&&n.vm.suppressSelectedUpdate()||n._setItems(0,n._filtering()),n.vm.isPopUpOpen()&&n._setMaxItemsShow(),f.forEach((function(r){if(n._isGroup(r)){ko.isObservable(r.children)&&(n._currentItemsLifeTime||(n._currentItemsLifeTime=t.createChildLifetime()),r.children.subscribe(n._currentItemsLifeTime,(function(){i.items.notifySubscribers(n.vm.items())})));var u=ko.unwrap(r.disabled);r.children&&u&&(ko.isObservable(r.disabled)?(n._currentItemsLifeTime||(n._currentItemsLifeTime=t.createChildLifetime()),r.disabled.subscribeAndRun(n._currentItemsLifeTime,(function(t){ko.unwrap(r.children).forEach((function(i){n._getInternalItem(i).headerDisabled(t)}))}))):ko.unwrap(r.children).forEach((function(t){n._getInternalItem(t).headerDisabled(u)})))}})));n._customFilterResults(undefined);n._updateSelected(i.value());n.vm.isPopUpOpen()&&Q.nextTick((function(){n.vm.isPopUpOpen()&&!n.ltm.isDisposed()&&n._setDropDownWidth()}));e||n._setDropDownPosition();n._oldItems=r}));o=i.selectAllState;o&&o.subscribeAndRun(t,(function(t){n._setSelectAllClass(t)}));s=MsPortalFx.initObservable(i.selectAll);ko.reactor(t,[s,r],(function(t,i){n._multiselectSelectAll(t&&i);n._setSelectAllClass()}));ko.reactor(t,[this.vm.items,this._filtering,this.vm.filterString,r,s],(function(t,i,r,u,f){var e=n._showMultiselectSelectAll();u&&f?n._showMultiselectSelectAll(t&&!!t.length&&(!i||r==="")):n._showMultiselectSelectAll(!1);e!==n._showMultiselectSelectAll()&&n._setDropDownPosition()}));i.value.subscribeAndRun(t,(function(t){n._updateSelected(t)}));ko.isObservable(i.multiItemDisplayText)&&i.multiItemDisplayText.subscribe(t,(function(){n._setDisplayString()}));this.$disabled.subscribeAndRun(t,(function(t){t&&n._closeDropdown();n.element.toggleClass("msportalfx-form-formelement-disabled",t)}));h=!0;v.waitForBindings(this.element[0]).then((function(){n.vm.isPopUpOpen.subscribeAndRun(t,(function(t){n._popupGuard||(t?(n._openDropdown(!0),n._setFocus()):h||n._closeDropdown(!0,!0))}));h=!1}));i.ariaLabel&&i.ariaLabel.subscribeAndRun(t,(function(t){var r=a.find("#"+n._comboBoxFilterId()),u=(t||"").trim();u.length?r.attr({"aria-labelledby":null,"aria-label":u}):ko.unwrap(i.label)?r.attr("aria-labelledby",n._labelId()):r.attr("aria-labelledby",null)}));this._required.subscribeAndRun(t,(function(t){n._setAttribute("aria-required",t)}));i.valid.subscribeAndRun(t,(function(t){n._setAttribute("aria-invalid",!t)}));i.loading.subscribeAndRun(t,(function(t){n.disabled(t);t?(n._closeDropdown(),n._icon(at.Loading.Spinner())):n._icon(at.CaretDown());n._setDisplayString()}));this._validator.validationState.subscribe(this.ltm,(function(t){t===3?n._pendingTimer=setTimeout((function(){n._icon(at.Loading.Spinner())}),ai):(n._pendingTimer&&clearTimeout(n._pendingTimer),n._pendingTimer=null,n._icon(at.CaretDown()))}));ko.reactor(this.ltm,[MsPortalFx.initObservable(i.placeholder)],(function(){n._setDisplayString()}));c=MsPortalFx.initObservable(this.vm.statusMessage,undefined);l=MsPortalFx.initObservable(this.vm.showStatusMessage,undefined);ko.reactor(t,[this._paneItemsMap,this.vm.isPopUpOpen,c,l],(function(t,i,r,f){if(ot(f)&&!n._comboBox()){var e=i&&t.length===0;e&&ot(r)&&(n._filtering()?n._statusMessage({htmlTemplate:u.Search.noResults}):n._statusMessage({htmlTemplate:u.DropDown.noItems}));n._showStatusMessage(e)}else n._showStatusMessage(f);ot(r)||(n._statusMessage(r),i&&n._showStatusMessage()&&n._setDropDownWidth())}));this._customFilterResults.subscribe(t,(function(t){t&&n._findMatches()}))},t.prototype._setFocus=function(){this.vm&&this.vm.isPopUpOpen()&&(ko.unwrap(this.vm.filter)?$(this.element.find("input")[0]).focus():this.element.find("div."+ct+"[role='combobox']").focus())},t.prototype._attachEvents=function(){var n=this,f=function(){n.vm.isPopUpOpen()?n._closeDropdown():n._openDropdown()},i=function(t){var r=n.vm,o,s,u,h,i,l,f,e,c;t.hasClass(pt)?r.selectAllOverride?r.selectAllOverride():(f=r._msPortalFxWidgetValue,e=[],ot(f())||(e=ii(f())),c=n._getItemValues(r.items()),e&&e.length===c.length?f([]):f(c)):(o=t.hasClass(gt),t.parentsUntil("."+rt).each((function(n,t){if($(t).hasClass(gt)){o=!0;return}})),o||(s=ko.dataFor(t[0]),u=s&&ko.unwrap(s.value),n._multiselectActivated()?(h=r._msPortalFxWidgetValue(),i=[],ot(h)||(i=ii(h)),i.length?MsPortalFx.isUndefined(l=MsPortalFx.find(i,(function(n){return ui(n,u)})))?i.push(u):MsPortalFx.remove(i,l):i=[u],r._msPortalFxWidgetValue(i)):(r._msPortalFxWidgetValue(u),n._setFocus(),n._closeDropdown(!n._filtering()))));n.element.trigger("fxvaluechanged")},e=function(t){var r=n.element.findByClassName(rt).find("."+ut+":not(."+pt+"):not(."+gt+")");(r.length===1||t&&!!r.length)&&i($(r[0]))},o=this.element.findByClassName(rt),r=!1;this.ltm.registerForDispose([this.element.setEvents(["touchstart",function(){n._isTouch||n._filterReadOnly(!0);n._isTouch=!0},],["click",function(n){n.stopPropagation()},],["mousedown",function(n){n.stopPropagation();$(n.target).closest("."+rr).length>0&&n.preventDefault()},],["mouseup",function(t){t.stopPropagation();$(t.target).closest("."+lt).length>0&&(t.preventDefault(),f(),n._setFocus())},],["keydown",function(t){var i,u,f;t.which===9&&n._filtering()&&e();i=n.element.findByClassName(it);u=function(n){n.preventDefault();n.stopPropagation()};switch(t.which){case 38:case 40:f=n.element.findByClassName(ht);f.length||(f=$(n.element.findByClassName(yt)[0]));u(t);n._handleArrowKey(t,t.which===40,f);break;case 36:n.vm.isPopUpOpen()&&!oi.includes(t.which)&&(i.scrollTop(0),u(t));break;case 35:n.vm.isPopUpOpen()&&!oi.includes(t.which)&&(i.scrollTop(i[0].scrollHeight),u(t));break;case 34:n.vm.isPopUpOpen()&&(i.scrollTop(i.scrollTop()+i.height()),u(t));break;case 33:n.vm.isPopUpOpen()&&(i.scrollTop(i.scrollTop()-i.height()),u(t));break;case 13:r=!0}n._checkOnShowStatusMessage()},],["keyup",function(t){var u=n.element.findByClassName(ht);(t.which===13||t.which===32)&&(n._comboBox()||$(t.target).is("a")||n.element.findByClassName(ht).length&&t.preventDefault(),t.stopPropagation());switch(t.which){case 13:r&&(r=!1,u&&u.length?i(u):t.which===13&&n.vm.isPopUpOpen()&&(n._filtering()||n._comboBox())?e(!0):($(t.target).hasClass(lt)||n._comboBox()&&!n.vm.isPopUpOpen())&&f())}}]),o.setEvents(["mouseup",function(t){t.stopPropagation();n.element.findByClassName(ht).removeClass(ht);var r=$(t.target).closest("."+ut);r&&r.length&&i(r)}],["wheel",function(t){var i=$(t.target);if(n._virtualize()&&(i.hasClass(ut)||i.parentsUntil("."+ut))){var u=t.originalEvent.deltaY>0?100:-100,r=o.findByClassName(it),f=r.scrollTop()+u;r.scrollTop(f);n._checkOnShowStatusMessage()}}]),!(a.isIPadOS||a.isAndroidOrMobile)&&$(window).setEvents(["resize."+rt,function(){n._closeDropdown()},]),]);var s=this.element.closest(".fxs-blade-content-container")[0],u=s&&ko.dataFor(s),t=u&&u.data&&u.data.bladeName;this._extensionName=t&&t.extensionName;this._extensionName&&(this._telemetrySource=["Extension",this._extensionName,"Blade",t&&t.name].join("/"));y.track(this.ltm,this.element,(function(){n._widthOfInput=$(n.element.findByClassName(vt)[0]).width();n.vm.isPopUpOpen()&&n._setDropDownPosition()}))},t.prototype._setAttribute=function(n,t){var i=this.element.find(!this._filterInPopUp()&&this._filterActivated()?".fxc-TextField input":"."+ct+"."+lt);MsPortalFx.isNull(t)?i.removeAttr(n):i.attr(n,t);this._filterInPopUp()&&(i=this.element.find(".fxc-TextField input"),MsPortalFx.isNull(t)?i.removeAttr(n):i.attr(n,t))},t.prototype._isSelected=function(n){var i=ko.unwrap(n.disabled)||ko.unwrap(this._getInternalItem(n).headerDisabled),t;if(!i||this._multiselectActivated())return this._isItem(n)?(t=ko.unwrap(n.value),typeof t=="object"?this._selectedValues().some((function(n){return ui(n,t)})):this._selectedValues().includes(t)):void 0},t.prototype._updateSelected=function(n){var r=this,t=ii(n),i;this._selectedValues(t);i=!1;t&&t.length&&(i=this._flattenItemsMap().some((function(n){if(r._isItem(n)){var i=t.some((function(t){return ui(t,ko.unwrap(n.value))}));return i&&(r._currentItem=n),i}})));i||(this._currentItem=null);this.vm.suppressSelectedUpdate()||this._setDisplayString();this._multiselectSelectAll()&&this._setSelectAllClass()},t.prototype._setSelectAllClass=function(n){var t,i,r;if(n===void 0&&(n=null),this._multiselectSelectAll()&&!this.vm.selectAllState){var u=this.vm.value(),e=this._getItemValues(this.vm.items()),f=u&&u.length;this._allSelected(f===e.length);t=this._allSelected();this.element.findByClassName(pt).toggleClass(yt,t);this.element.toggleClass(gi,t);this.element.toggleClass(nr,!t&&!!f)}else if(n!==null){i=!1;r=!1;switch(n){case 1:r=!0;break;case 2:i=!0}this.element.toggleClass(gi,i);this.element.toggleClass(nr,r)}},t.prototype._setupFiltering=function(){var n=this,r,s,e;this._filterLifeTime&&this._filterLifeTime.dispose();this.element.addClass(pi);this._filterActivated(!0);var t=this.vm,f=this._filterLifeTime=this.ltm.createChildLifetime(),i=this._textBoxViewModel=new hr(f,{emptyValueText:MsPortalFx.initObservable(this.vm.filterPlaceholder,""),valueUpdateTrigger:sr.ValueUpdateTrigger.Input,readOnly:this._filterReadOnly});i.dirty=this.vm.dirty;r=$(document.createElement("div"));this.element.find(this._filterInPopUp()?"."+di:"#"+this._comboboxContainerId()).prepend(r);s=new o.WidgetUIState({diContainer:this._diContainer,vm:i});this._textBoxWidget=new o.Widget(r,i,{},s);t.showSearchIcon&&t.showSearchIcon.subscribeAndRun(this._textBoxWidget.ltm,(function(t){n._textBoxWidget&&s.vivaTextBoxViewModel.showSearchIcon(t)}));r.find(".azc-text-label").removeAttr("aria-hidden");r.findByClassName(ct).attr("aria-describedby",this._labelHelper.errMsgId);this._filterComputed=ko.computed(f,[i.value],(function(i){var r,f;if(!ot(i)){if(n._filterStringChangedByVM)n._openDropdown(),n._filterStringChangedByVM=!1;else if(t.filterString()===i&&!(i===""&&t.customFilter&&n._filterByUser))return;n._canFilter&&(t.isPopUpOpen()||n._openDropdown(),t.filterString(i),t.isPopUpOpen()&&(n._comboBox()?(r=t.customFilter,n.vm.suppressSelectedUpdate(!0),n.vm.value(i),n._filtering(!0),r?r(i).then((function(){n.vm.suppressSelectedUpdate(!1);n._setItems(0,!0);n._filtering(!1)})):(n.vm.suppressSelectedUpdate(!1),n._setItems(0,!0),n._filtering(!1)),n.vm._msPortalFxViewModelValueChangesAreClean&&n.vm.dirty(!0)):i!==""||t.customFilter?n._customItemReplacement?n._customItemReplacement&&t.customFilter&&t.customFilter(i).then((function(){t.isPopUpOpen()&&n._canFilter&&(n._filtering(!0),n._ariaLive(u.DropDown.filterResult.format(n._countItems(t.items(),!0),n.vm.filterString())))})):t.customFilter?(f=t.items(),t.customFilter(i).then((function(i){if(t.isPopUpOpen()&&n._canFilter&&(n._filtering(!0),!n._customItemReplacement)){var r=t.items(),e=i&&i.length||0;MsPortalFx.deepEquals(f,r)?n._customFilterResults(i||null):(n._customItemReplacement=!0,e=n._countItems(r,!0));n._ariaLive(u.DropDown.filterResult.format(e,n.vm.filterString()))}}))):i&&!t.customFilter&&(n._filtering(!0),n._findMatches(i)):(n._filtering(!1),n._setItems(0,!0),n._setDropDownWidth()),n._checkOnShowStatusMessage()));n._filterByUser&&(n._filterByUser=!1)}}));(!ei||this.element.parents(".fxc-pill").length)&&this._filterComputed.extend({throttle:ai});t.filterString.subscribe(f,(function(t){i.value()!==t&&(n._filterStringChangedByVM=!0,i.value(t))}));this._filterInPopUp()||(i.valid=t.valid);this.$disabled.subscribeAndRun(f,i.disabled);e=r.find("input");e.on("mouseup",(function(){n.vm.isPopUpOpen()||n._openDropdown()})).on("keydown",(function(){n._filterByUser=!0})).on("keyup",(function(t){if(n.vm.isPopUpOpen()||oi.includes(t.which)||h.getModifierKeys(t)!==0)switch(t.which){case 112:case 27:var i=$.Event("keydown");i.which=t.which;n.element.trigger(i)}else n._openDropdown(),n._filtering(!0)}));e.attr({id:this._filterInPopUp()?this._filterInPopupId:this._comboBoxFilterId(),role:"combobox","aria-readonly":null,"aria-multiline":null,autocomplete:"off","aria-required":this._required(),"aria-invalid":!t.valid(),"aria-label":fr,"aria-labelledby":null,"aria-autocomplete":"list","aria-haspopup":"tree","aria-expanded":"true","aria-controls":this._optionContainerId()});this._comboBox()&&t.isPopUpOpen.subscribeAndRun(f,(function(n){e.attr({"aria-expanded":n})}));this._updateSelected(t.value())},t.prototype._removeFiltering=function(){this.element.removeClass(pi);this._filterActivated(!1);this._filterLifeTime&&this._filterLifeTime.dispose();this._textBoxViewModel=null;this._textBoxWidget.dispose();this._textBoxWidget.element.remove();this._textBoxWidget=null;this.element.find("."+ct+"."+lt).attr({"aria-required":this._required(),"aria-invalid":!this.vm.valid()})},t.prototype.dispose=function(){this._checkExistsOrRegisterDestroyId(n.prototype.dispose)||(n.prototype.dispose.call(this),this._filterActivated()&&this._removeFiltering(),this.vm.isPopUpOpen(!1),this._cleanElement(tr,"msportalfx-form-formelement"))},t.prototype._handleArrowKey=function(n,t,i){var u,f,o;if(this.vm.isPopUpOpen()){if(t&&n.altKey)this._closeDropdown();else if(u=this.element.findByClassName(rt).find("."+ut),f=this.element.findByClassName(it),u&&u.length&&i){var e=u.toArray().indexOf(i[0]),s=this.element.findByClassName(ht),r=void 0;if(s[0]||!i[0]?(o=$(s[0]||u[0]).outerHeight(!0),t?u.length>e+1?r=$(u[e+1]):this._virtualize()&&this._topItemIndex()+this._maxItemsInPopup+ +(this._multiselectSelectAll()&&!this._showMultiselectSelectAll())<(this._useFilteringArray()?this._filteredItems:this._flattenItemsMap)().length&&(f[0].scrollTop+=o,this._setItems(this._topItemIndex()+1),r=this.element.find("."+ut).last()):e>0?1===e&&this._virtualize()&&this._showMultiselectSelectAll()&&this._topItemIndex()>0?(this._setItems(this._topItemIndex()-1),r=f.find("."+ut).first(),f[0].scrollTop-=o):r=$(u[e-1]):this._virtualize()&&this._topItemIndex()>0&&(this._setItems(this._topItemIndex()-1),r=f.find("."+ut).first(),f[0].scrollTop-=o)):r=i,r&&r.length&&(s.removeClass(ht),r.addClass(ht),this._setAttribute("aria-activedescendant",r.attr("id")),!this._virtualize())){var c=r.outerHeight(),y=this.element.findByClassName(rt),p=y.height(),w=f.height(),h=r.position().top-(this._showMultiselectSelectAll()?st:0),l=this.element.findByClassName(ft).outerHeight()||0,a=this._openPopupUp?w:p-(this._showMultiselectSelectAll()?st:0),v=a<h+c;(v||h<(this._openPopupUp?0:l))&&(f[0].scrollTop+=h-(v?a-c:!this._openPopupUp&&l))}}}else this._openDropdown()},t.prototype._setDisplayString=function(){var s=ko.unwrap(this.vm.loading),h=!1,n,f,i,e,l,o;if(this._multiselectActivated()){var c=ko.unwrap(this.vm.multiItemDisplayText),a=this.vm.value(),y=ii(a),p=this.vm.items&&this.vm.items()||[],w=this._getItemValues(p),r=y.filter((function(n){return w.includes(n)}))||[],t=u.dropDownXSelected.format(r.length);s?t=u.dropDownLoading:ot(c)?r.length===1&&(t=this._currentItem&&ko.unwrap(this._currentItem.selectedItemOverride||this._currentItem.text)):t=c.format(r.length);this._stringOrHtmlToDisplay(t);this._ariaLive(v.getStringFromHtmlContent(this._diContainer,t,this.element[0],si))}else n=this._currentItem,s&&(n={text:u.dropDownLoading,value:null}),f=ko.unwrap(this.vm.placeholder)||"",i=f,n&&(i=n.selectedItemOverride?ko.unwrap(n.selectedItemOverride):ko.unwrap(n.text)),this._stringOrHtmlToDisplay(i),this._comboBox()&&!this._filtering()&&(this._canFilter=!1,e=this._textBoxWidget.element.find("input"),n?(l=v.getStringFromHtmlContent(this._diContainer,i,this.element[0],si),e.val(l)):(this._textBoxViewModel.value(undefined),o=this.vm.value(),typeof o=="string"&&e.val(o)),this._canFilter=!0),h=f.length&&!n;this.element.find("."+lt+".azc-formControl").toggleClass("fxc-dropdown-placeholder",!!h)},t.prototype._setMaxItemsShow=function(){var n,t;this._popupOnce()&&this._virtualize()&&(n=or(this.element.findByClassName(rt)),this._filterInPopUp()&&(n-=this.element.findByClassName(ft).outerHeight()||0),this._showMultiselectSelectAll()&&(n-=st),t=Math.floor(n/this._defaultItemHeight),this._maxItemsInPopup!==t&&(this._maxItemsInPopup=t,this._setItems(this._topItemIndex())))},t.prototype._openDropdown=function(n){var t=this,o,c,r,u,s,l,a,f,h,i;this.$disabled()||this.vm.isPopUpOpen()&&!n||(o=performance.now(),c=!this._popupOnce(),this._popupOnce(!0),this._popupGuard=!0,this.vm.isPopUpOpen(!0),this._popupGuard=!1,this.element.findByClassName(vt).addClass(wi),p.hideAllBalloons(null,this.element),r=this.element.findByClassName(rt),this._checkHeightOfItems(r.find(ur)),this._setDropDownPosition(),this._selectedValues().length&&this._flattenItemsMap().some((function(n,i){if(t._isSelected(n))return t._setAttribute("aria-activedescendant",t._getInternalItem(n).id()),t._virtualize()&&i>t._maxItemsInPopup&&(t.element.findByClassName(it)[0].scrollTop=i*t._defaultItemHeight,t._checkOnShowStatusMessage()),!0})),this._virtualize()?this._checkOnShowStatusMessage():(i=this.element.findByClassName(yt),i&&i.length&&i.position().top>r.height()&&(this.element.findByClassName(it)[0].scrollTop=i.position().top)),this._filterActivated()&&(this._isTouch?(r.focus(),this._filterReadOnly(!1)):this.element.find("input").focus(),this._announce||(this._announce=new nt.PortalReader(this.ltm,{removalDelayMs:1})),this._announce.read(fr)),u=function(n){var r=t.element.findByClassName("azc-formElementContainer")[0],i=$(n).closest(".azc-dockedballoon-balloon").attr("id"),u=!(r===n)&&!$.contains(r,n)&&!(i&&(t.element.find(".azc-dockedballoon-anchor[aria-owns='"+i+"']").length||t.element.find(".azc-dockedballoon-anchor[aria-controls='"+i+"']").length));return u?2:0},s={dismissFn:function(){t._closeDropdown()},shouldDismissOnFocusOutFn:u,shouldDismissOnMouseDownFn:u,shouldDismissOnMouseWheelFn:u,shouldDismissOnScroll:!this._isTouch,logName:"dropdown"},(!this._dismissHandleLifetime||this._dismissHandleLifetime.isDisposed())&&(e.dismissByLogName("dropdown"),e.register(s),l=this._dismissHandleLifetime=this.ltm.createChildLifetime(),l.registerForDispose((function(){e.unregister(s)}))),a=b.throttle(this.ltm,(function(){t._setDropDownWidth()}),200),this._setMaxItemsShow(),f=this.element.findByClassName(it),h=f.scrollTop()||0,this._dismissHandleLifetime.registerForDispose([f.setEvents(["scroll",function(){if(t._virtualize()){var n=f.scrollTop(),r=t._showStatusMessage()&&h<n,i=Math.floor(n/t._defaultItemHeight)+(r?1:0);h=n;t._topItemIndex(i);t._setItems(i);t._checkOnShowStatusMessage();a()}},],["mousedown",function(){t._keyDownOnScrollBar=!0},],["mouseup",function(){t._keyDownOnScrollBar=!1;t._setDropDownWidth()},]),]),this._resetPopUpUIForEdge(r,!1),this._multiselectActivated()||(i=r.findByClassName("fxs-portal-selected"),i&&i.addClass("fxc-dropdown-keynav")),setTimeout((function(){var i,n=t.element.findByClassName(it),u=n[0]&&(n[0].clientHeight<n[0].scrollHeight?w.getScrollbarWidth():0)||0,f=t.vm.popupWidthHint,o=!!f&&f()||0,e,r;t.element.findByClassName(et).css("max-width",t._calculatePopupMaxWidth(o)-u);t._virtualize()&&(e=n.width(),r=(i={},i.width=e-u,i),t.element.findByClassName(bt).css(r),t.element.findByClassName(et).css(r))}),st),cr.trace({action:"DropDownOpened",extension:this._extensionName,source:this._telemetrySource,name:this.vm.telemetryName||"",duration:performance.now()-o,data:{itemsCount:this.vm.items&&this.vm.items()&&this.vm.items().length||0,firstOpen:c,duration:performance.now()-o}}))},t.prototype._setDropDownPosition=function(){var b=this,s,e,n,a,v,y,p;if(this.vm.isPopUpOpen()){var u="top",ut=this._widthOfInput,t=this.element.findByClassName(rt),f=this.vm.popupWidthHint,ot=!!f&&f()||0,k=this.element.find("."+wt),h=k.offset(),c={},i={},d=$(window).height(),r=h.top+k.height()-$(window).scrollTop(),l=r-(this._multiselectSelectAll()?st:0)-vi-$(document).find(".fxs-topbar").height()-(((s=$(document).find(".fxs-journey-breadcrumb")[0]||$(document).find(".fxs-breadcrumb-container")[0])===null||s===void 0?void 0:s.offsetHeight)||0),g=0,nt=$(document).findByClassName("fxs-portal-console");nt.hasClass("fxs-display-none")||(g=nt.height());e=d-h.top-this.element.height()-vi-g;n=e;MsPortalFx.isUndefined(this._openPopupUp)?(this._virtualize()||t.height()>e)&&l>e?(u="bottom",this._openPopupUp=!0):this._openPopupUp=!1:this._openPopupUp&&(u="bottom");this._openPopupUp&&(n=l,r=d-h.top);a=!!this.element.closest(".fxs-modal")[0];c[u]=a?hi:r;i[u]=a?hi:r;this._openPopupUp&&(n=l);n>yi&&(n=yi);var tt=this.element.findByClassName(et),ht=this.element.findByClassName(ft).outerHeight()||0,o=n-ht;this._virtualize()&&(n=n-o%this._defaultItemHeight,$.extend(c,{"max-height":n}),this._showMultiselectSelectAll()&&(o-=st));i["max-height"]=o;tt.css("max-height",o);v=function(n){var i=b.element.findByClassName(it),r=i[0]&&(i[0].clientHeight<i[0].scrollHeight?w.getScrollbarWidth():0)||0,u=n-(0<r?r:0);t.find("."+bt).css("max-width",u+"px");t.find("."+et).css("max-width",u+"px");t.find("."+ft).css("max-width",n+"px");i.css("max-width",n+"px")};y=this._calculatePopupMaxWidth(ot);t.removeClass(ti).css({"max-width":y+"px",width:ut}).removeAttr("aria-hidden");v(y);this._subscribedToPopupMaxWidth||(this._subscribedToPopupMaxWidth=!0,f&&f.subscribe(this.ltm,(function(n){var i=b._calculatePopupMaxWidth(n);n=n||0;t.css({"max-width":i+"px"});v(i)})));t.css("top","").css("bottom","").css(c);this.element.findByClassName(it).css("top","").css("bottom","").css(i);this._virtualize()&&tt.css("top",i.top+(this._openPopupUp?"":this._showMultiselectSelectAll()?st:0)).css("bottom",i.bottom);this.element.toggleClass("fxc-popup-opened-up",this._openPopupUp);(this._filterInPopUp()||this._multiselectSelectAll())&&(p={},this._openPopupUp&&$.extend(p,{bottom:r}),this.element.findByClassName(ft).css(p));this._setDropDownWidth()}},t.prototype._calculatePopupMaxWidth=function(n){var t,i=this.element.findByClassName(rt);switch(n){case-1:t=i.parent().find("."+wt).width();break;default:t=0<n&&n}return t||f.defaultPopupMaxWidth},t.prototype._checkHeightOfItems=function(n){if(this._virtualize()){var t=undefined,i=!1;n.each((function(n,r){t?t!==r.offsetHeight&&(i=!0):t=r.offsetHeight}));!i&&t&&t!==this._defaultItemHeight&&(this._defaultItemHeight=t)}},t.prototype._setDropDownWidth=function(){var r,k,h,d,u,t,c,l,e;if(this.vm.isPopUpOpen()&&!this._keyDownOnScrollBar){var i=this.element.findByClassName(rt),a=i.width(),n=this._widthOfInput,tt=this.element.find("."+wt),v=tt.offset(),y=v.left,o=$(window).width()-v.left-this._widthOfInput,p="right",b=o,ut=$(document).findByClassName("fxs-sidebar-bar").width(),s=y-ut;if(o>s&&(p="left",b=y,s=o),r=0,k=i.find("[role='treeitem'] > span"),k.each((function(n,t){t.offsetWidth>r&&(r=t.offsetWidth)})),this._checkHeightOfItems(i.find(ur)),r>n&&(n=r+w.getScrollbarWidth()+16,h=s+this._widthOfInput-20,n>h&&(n=h)),n<a&&(n=a),d=!!this.element.closest(".fxs-modal")[0],u={},u[p]=d?hi:b,u.width=n,i.css(u),this._filterInPopUp()||this._multiselectSelectAll()){var ot=this.element.findByClassName(ft),g=this.vm.popupWidthHint,ht=!!g&&g()||0;ot.css({width:n,"max-width":this._calculatePopupMaxWidth(ht)})}if(this._virtualize()){t=or(i);t-=this.element.findByClassName(ft).outerHeight()||0;t=t-t%this._defaultItemHeight;var f=this.element.findByClassName(it),ct=this.element.findByClassName(et),nt=t-(this._showMultiselectSelectAll()?st:0);f.css({width:n,"max-height":nt});ct.css({"max-height":nt});c=f[0]&&(f[0].clientHeight<f[0].scrollHeight?w.getScrollbarWidth():0)||0;this.element.findByClassName(bt).css("width",n-c);this.element.findByClassName(et).css("width",n-c)}else this.element.findByClassName(it).css("width","auto");l=this.element.findByClassName(ft).outerHeight()||0;e=this._openPopupUp?"0 0 "+l+"px":l+"px 0 0";this.element.findByClassName(pt).css({margin:this._openPopupUp?"":e});this.element.findByClassName(it).css({margin:this._openPopupUp||!this._showMultiselectSelectAll()?e:""});this.element.findByClassName(et).css({margin:this._virtualize()?e:""})}},t.prototype._closeDropdown=function(n,t){var u=this,i,r;(t===void 0&&(t=!1),this.vm.isPopUpOpen()||t)&&(this._canFilter=!1,this._filtering()&&(this._filtering(!1),this._customFilterResults()&&this._customFilterResults(undefined)),i=ko.unwrap(this.vm.showStatusMessage),i||this._showStatusMessage(!1),[wi,ht].forEach((function(n){u.element.find("."+n).removeClass(n)})),r=this.element.findByClassName(it),r[0].scrollTop=0,this._setItems(),this._resetDropDownPosition(),this._setAttribute("aria-activedescendant",null),this._popupGuard=!0,this.vm.isPopUpOpen(!1),this._popupGuard=!1,this._openPopupUp=undefined,this._filterActivated()&&(this._isTouch&&this._filterReadOnly(!0),this._filterInPopUp()?(this._resetTextBox(),this.element.find("div."+ct+"[role='combobox']").focus()):n||this._setDisplayString()),this._dismissHandleLifetime&&this._dismissHandleLifetime.dispose(),this._canFilter=!0)},t.prototype._resetTextBox=function(){this._textBoxWidget.element.find("input").val("");this._textBoxViewModel.value(undefined);this.vm.filterString(undefined)},t.prototype._resetPopUpUIForEdge=function(n,t){a.isIe11&&(n.css("opacity",0),setTimeout((function(){n.toggleClass(ti,t).css("opacity",1)}),50),!t||a.isIe11&&!!n.closest(".fxc-pill-editor").length||k.jBody.hide().show(0))},t.prototype._resetDropDownPosition=function(){var n={top:"",bottom:"",left:"",right:"",width:""},t=this.element.findByClassName(rt);t.css(n).attr("aria-hidden","true").addClass(ti);this.element.findByClassName(et).css(n);this.element.findByClassName(it).css(n);this.element.findByClassName(ft).css(n);this._resetPopUpUIForEdge(t,!0)},t.prototype._getItemValues=function(n,t){var i=this;return t===void 0&&(t=[]),(ko.unwrap(n)||[]).forEach((function(n){if(!ko.unwrap(n.disabled))if(i._isItem(n)){var r=ko.unwrap(n.value);t.includes(r)||t.push(ko.unwrap(n.value))}else i._isGroup(n)&&i._getItemValues(n.children,t)})),t},t.prototype._getInternalItem=function(n){var t,i;return this._itemsMap.has(n)?this._itemsMap.get(n):(t=this._isItem(n),t&&this._descendantItemOnlyIndex++,i={index:this._descendantIndex,itemIndex:t?this._descendantItemOnlyIndex:null,id:ko.observable(this._optionContainerId()+this._descendantIndex),headerDisabled:ko.observable(!1)},this._descendantIndex++,this._itemsMap.set(n,i),i)},t.prototype._isItem=function(n){return n&&n.hasOwnProperty("value")&&!n.hasOwnProperty("children")},t.prototype._isGroup=function(n){return n&&(n.hasOwnProperty("children")||!n.hasOwnProperty("value"))},t.prototype._checkOnShowStatusMessage=function(){var i=this.element.findByClassName(et),f;if(this._virtualize()&&this._showStatusMessage()){var n=this.element.findByClassName(it),t=n[0],r=t&&t.scrollHeight,u=r&&(t.clientHeight>=r||Math.abs(r-t.scrollTop-n.height())<3);n.findByClassName(kt).css({display:u?"block":"none"});i.css({overflow:u?"visible":""});this._openPopupUp&&(f=n.css(ar),i.css({bottom:parseInt(f)+(u?this.element.findByClassName(kt).height():0)}))}else i.css({overflow:""})},t})(s.Widget);t.Widget=er;t.DropDown=d.createControlComponentForKO({widgetCtor:er})}))