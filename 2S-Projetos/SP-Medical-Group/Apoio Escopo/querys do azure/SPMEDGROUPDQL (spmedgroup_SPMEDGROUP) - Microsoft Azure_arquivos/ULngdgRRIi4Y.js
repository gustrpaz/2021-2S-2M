define("MsPortalImpl.Controls/Controls/SearchBox.Component",["require","exports","Weave/DirectMode","Weave","_generated/MsPortalImpl/Svg/Startup/Search.svg","_generated/MsPortalImpl/Svg/Startup/Close.svg","MsPortalImpl/Resources/ImplScriptResources","MsPortalImpl.Controls/Fields/TextField.Component","FxInternal/Weave/Util","MsPortalImpl/Weave/Util","Fx/Weave"],(function(n,t,i,r,u,f,e,o,s,h,c){"use strict";function l(n){var a=n.vm,l=n.state,v=o.TextFieldInner({vm:l.textFieldViewModel,state:l.textFieldState});return i(r.GetContext,{fn:function(n){var y=h.aggregateContext(n,a,l),o=y.disabled,p=y.tabIndex;return i(r.SetContext,{disabled:o,tabIndex:p},i("div",{className:"fxc-search-icon fxs-portal-svg-secondary",image:u}),i("div",{role:"combobox",tabindex:"-1",className:[t.comboBoxClass,v.parentClassName],"aria-haspopup":"listbox","aria-disabled":o},v.weaveNode),i("div",{className:[t.iconDiscardClass,"fxs-portal-svg-secondary"],role:"button","aria-hidden":"true",title:e.Controls.SearchBox.deleteButtonLabel,tabindex:-1,image:MsPortalFx.Base.Images.CustomImageWithOptions(f,{customClass:"msportalfx-search-discard-icon"})}),i("ul",{role:"listbox",className:["azc-bg-default","fxs-portal-border",t.listClass,{"fxs-display-none":r.composeComputation([l.popupOpen,c.toComputation(a.hideSuggestions)],(function(n,t){return!n||t}))},],tabindex:"-1","aria-label":MsPortalFx.encodeAttribute(e.DropDown.optionContainer),"aria-disabled":o},i(r.ForEach,{collection:c.toComputation(l.currentItems),fn:function(n){var t=n.item;return i("li",{role:"option",className:"fxs-portal-hover",title:t},t)}}),i(r.If,{condition:c.toComputation(l.currentItems).compose(s.isEmptyArray),concealmentBehavior:"remove",trueFn:function(){return i("li",{role:"option",className:"fxc-search-no-result","aria-disabled":"true",title:e.Search.noResults},e.Search.noResults)}})))}})}Object.defineProperty(t,"__esModule",{value:!0});t.SearchBoxInner=t.listClass=t.iconDiscardClass=t.comboBoxClass=void 0;t.comboBoxClass="fxc-searchbox-container";t.iconDiscardClass="fxc-search-discard-icon";t.listClass="fxc-search-list";t.SearchBoxInner=l}));
define("_generated/Less/MsPortalImpl.Controls/Controls/SearchBox.css",["module"],(function(n){"use strict";return{css:".fxc-search{display:block;position:relative}.fxc-search .azc-form-labelcontainer{display:none !important}.fxc-search-icon{top:4px;left:6px}.fxc-search-discard-icon{height:8px;width:8px;position:absolute;top:2px;right:7px;cursor:pointer;display:none}.fxc-search-populated .fxc-search-discard-icon{display:block}.fxc-search .azc-textBox{display:block}.fxc-search .azc-textBox .azc-textBox-wrapper input{padding-left:29px;padding-right:24px}.fxc-search ul{padding:0;margin:0;position:absolute;width:100%;z-index:150}.fxc-search li{border-left:1px solid;border-left-color:inherit;border-right:1px solid;border-right-color:inherit;list-style-type:none;border-top-width:0;border-bottom-width:0;padding:9px 32px;cursor:pointer;overflow-x:hidden;white-space:nowrap;text-overflow:ellipsis}.fxc-search li:last-child{border-bottom:1px solid;border-bottom-color:inherit}.fxc-search.azc-fabric .fxc-search-discard-icon{top:2px;right:2px;padding:6px}.fxc-search.azc-fabric .msportalfx-search-discard-icon{padding-bottom:6px}.fxc-search.azc-fabric .azc-textBox .azc-textBox-wrapper .azc-input{padding-left:24px}.fxc-searchbox-container[aria-disabled=true]+.fxc-search-discard-icon{display:none}.fxc-search-no-result{pointer-events:none}",moduleId:n.id}}));
define("MsPortalImpl.Controls/Controls/SearchBox",["require","exports","MsPortalImpl.Controls/Controls/Base/OptionsBase","MsPortalImpl.Controls/Controls/Base/Base","MsPortalImpl/Base/Base.KeyboardHelper","MsPortalImpl/Resources/ImplScriptResources","MsPortalImpl.Controls/Controls/SearchBox.Component","MsPortalImpl.Controls/Fields/TextField","MsPortalImpl/Weave/Util","MsPortalImpl/Interactions/Interactions.PortalReader","FxInternal/Css","_generated/Less/MsPortalImpl.Controls/Controls/SearchBox.css","Weave"],(function(n,t,i,r,u,f,e,o,s,h,c,l,a){"use strict";function w(n,t){return n.update?n.update(t||""):Q([])}function ft(n){return n.hasOwnProperty("valueUpdateTimeout")}var b,k;Object.defineProperty(t,"__esModule",{value:!0});t.SearchBox=t.Widget=t.WidgetUIState=t.InnerTsxComponent=void 0;c.injectCss(l);var d=MsPortalFx.ViewModels,it=d.Controls,rt=d.Forms.TextBox.ViewModel,y=MsPortalFx.isNullOrUndefined,ut=5,p="fxs-portal-selected",v="fxc-search-populated",g="fxc-search",nt=f.Controls.searchBox,tt=MsPortalFx.encodeAttribute(nt);t.InnerTsxComponent=e.SearchBoxInner;b=(function(n){function t(t){var i=n.call(this)||this,r;return i.popupOpen=a.makeWritableComputation(!1),i.currentItems=ko.observableArray(),r=t.vm,i.textFieldViewModel=new rt(i._ltm,{label:ko.observable(nt),emptyValueText:r.placeholder,valueUpdateTrigger:it.ValueUpdateTrigger.Input}),i.textFieldState=new o.WidgetUIState({diContainer:t.diContainer,vm:i.textFieldViewModel}),i}return __extends(t,n),t})(r.WidgetUIState);t.WidgetUIState=b;k=(function(n){function t(t,i,r,u){var f=n.call(this,t,i,r,u)||this,c,s,l,p,b,k,a;return f._clickedInsideWidget=!1,f._events=[],f._ignoreTextBoxValueUpdate=!1,f._busy=ko.observable(!1),f._dirty=!1,f._forceDismiss=!1,f._announce=new h.PortalReader(f.ltm,{idPrefix:"searchbox"}),c=f.ltm,s=f.state.textFieldViewModel.value,t.addClass(g),t.toggleClass("azc-fabric",ft(f.options)),f._attachEventHandlers(),l=f.options.defaultText,y(l)||(s(l),f._originalText=l,l&&f.element.addClass(v)),p=f.options._msPortalFxValue,b=!1,p&&(p.subscribeAndRun(c,s),b=!!p()),k=function(n){f._ignoreTextBoxValueUpdate||(f._originalText=n,clearTimeout(f._typingTimer),n?f._typingTimer=setTimeout((function(){f.isDisposed()||f._updateDropdown(n)}),f.options.updateFrequency):(f.element.removeClass(v),f.state.currentItems([]),w(f.options)))},b?s.subscribeAndRun(c,k):s.subscribe(c,k),f.options._msPortalFxresetTrigger((function(){return f._reset()})),a=f.options.resultLimit,y(a)?f._unchangingResultLimit=ut:ko.isObservable(a)?a.subscribe(c,(function(n){var t=f.state.currentItems();n<t.length&&f.state.currentItems(t.slice(0,n))})):f._unchangingResultLimit=a,f.ltm.registerForDispose(new o.Widget(t.findByClassName(e.comboBoxClass),f.state.textFieldViewModel,{weaveContext:f.weaveContext},f.state.textFieldState)),f._accessibility(),f.state.currentItems.subscribeAndRun(c,(function(n){f._forceDismiss?(f._dirty=!1,f._forceDismiss=!1):!f._dirty&&s()&&f.element.findByClassName("azc-input")[0]===document.activeElement?f._dirty=!0:s()||(f._dirty=!1);var t=!!(n.length||f._dirty);f.state.popupOpen(t);f._comboBoxElement.attr("aria-expanded",t);f._searchBoxElement.removeAttr("aria-activedescendant")})),f}return __extends(t,n),t.prototype.dispose=function(){this.element.removeClass(g);MsPortalFx.disposeDisposable(this._events);this._events=[];n.prototype.dispose.call(this)},t.prototype._accessibility=function(){var n=this,t=this.element.find("label").attr("id"),r=t+"-for",i=t+"-listbox";this._activeItemId=t+"-active";this._comboBoxElement=this.element.findByClassName(e.comboBoxClass);this._searchBoxElement=this._comboBoxElement.find("#"+r);this._listBoxElement=this.element.find("> ul");this._listBoxElement.attr("id",i);this._comboBoxElement.attr("aria-owns",i);this._searchBoxElement.attr({role:"searchbox","aria-controls":i,"aria-autocomplete":"list","aria-placeholder":this.options.placeholder()});this._busy.subscribeAndRun(this.ltm,(function(t){n._searchBoxElement.attr("aria-busy",t);n._listBoxElement.attr("aria-busy",t)}));this.options.ariaLabel.subscribeAndRun(this.ltm,(function(i){var r=(i||"").trim();r?(n._comboBoxElement.attr({"aria-labelledby":null,"aria-label":r}),n._searchBoxElement.attr({"aria-labelledby":null,"aria-label":r})):(n._comboBoxElement.attr("aria-label",tt),n._comboBoxElement.attr("aria-labelledby",t),n._searchBoxElement.attr("aria-label",tt),n._searchBoxElement.attr("aria-labelledby",t))}));this.options.hideSuggestions.subscribeAndRun(this.ltm,(function(t){n._searchBoxElement.attr("autocomplete",t?null:"off")}))},t.prototype._reset=function(){return this._updateTextBoxWithOutOpeningDropDown(""),this._dirty=!1,this.state.currentItems([]),this.element.removeClass(v),clearTimeout(this._typingTimer),Q()},t.prototype._attachEventHandlers=function(){var n=this,t=function(){if(n.options&&n.options.submit){var t=n.state.textFieldViewModel.value();n._busy(!0);n.options.submit(t,n._originalText).finally((function(){n._busy(!1)}));n._originalText=t;n.state.popupOpen(!1)}};this._events.push(this.element.setEvents(["mousedown",function(t){var i=$(t.target);i.is("li")&&(n._clickedInsideWidget=!0,$(i).click())},],["keydown",function(t){(t.which===38&&n.state.popupOpen.value||t.which===40)&&t.preventDefault()},],["keyup",function(i){var f=n.element.findByClassName(p),o,r,h=function(t){t.addClass(p).attr({id:n._activeItemId,"aria-selected":!0});n._searchBoxElement.attr("aria-activedescendant",n._activeItemId)},c=function(t,i,r){t.length?(t.removeClass(p).removeAttr("id aria-selected"),i&&i.length?(n._updateTextBoxWithOutOpeningDropDown(i.text()),h(i)):n._updateTextBoxWithOutOpeningDropDown(n._originalText)):(n._updateTextBoxWithOutOpeningDropDown(r.text()),h(r))},s;if(u.getModifierKeys(i)===0)switch(i.which){case 13:i.stopPropagation();clearTimeout(n._typingTimer);n.state.currentItems([]);t();break;case 27:n.state.currentItems([]);n.state.textFieldViewModel.value("");case 9:n.state.popupOpen(!1);break;case 8:case 46:n.state.textFieldViewModel.value()===""&&(n._dirty=!1,n.state.popupOpen(!1));break;case 40:if(s=n.state.textFieldViewModel.value(),!n.state.popupOpen.value&&s){n._updateDropdown(s);break}if(o=f.next("li"),r=n.element.find("."+e.listClass+" li").first(),r.attr("disabled")==="disabled")break;c(f,o,r);break;case 38:if(n.state.popupOpen.value){if(o=f.prev("li"),r=n.element.find("."+e.listClass+" li").last(),r.attr("disabled")==="disabled")break;c(f,o,r)}}},],["focusout",function(){n._forceDismiss=!0;n.state.popupOpen(!1);n._clickedInsideWidget||(n.state.currentItems([]),n._updateTextBoxWithOutOpeningDropDown(n._originalText))},],["click",function(i){var r=$(i.target);r.is("li")&&(n._updateTextBoxWithOutOpeningDropDown(r.text()),n.state.currentItems([]),t());n._clickedInsideWidget=!1},]));this._events.push(this.element.findByClassName(e.iconDiscardClass).setEvents(["click",function(){n._busy(!0);w(n.options).finally((function(){n._busy(!1)}));n._originalText="";n._reset();t();n.element.findByClassName("azc-input").focus()},]))},t.prototype._updateTextBoxWithOutOpeningDropDown=function(n){this._ignoreTextBoxValueUpdate=!0;this.state.textFieldViewModel.value(n);this._ignoreTextBoxValueUpdate=!1},t.prototype._updateDropdown=function(n){var t=this;this.element.addClass(v);this._busy(!0);MsPortalFx.Base.Promises.cancelOnDispose(this.ltm,(function(){return w(t.options,n)})).then((function(i){i=i||[];var u=i.length,r=t._unchangingResultLimit;y(r)&&(r=t.options.resultLimit());r&&i.length>r&&(i=i.slice(0,r));t.state.currentItems(i);t._announce.read(f.DropDown.filterResult.format(u,n))})).finally((function(){t._busy(!1)}))},t})(i.Widget);t.Widget=k;t.SearchBox=s.createControlComponent({widgetCtor:k,widgetUIStateCtor:b,innerComponent:e.SearchBoxInner})}))