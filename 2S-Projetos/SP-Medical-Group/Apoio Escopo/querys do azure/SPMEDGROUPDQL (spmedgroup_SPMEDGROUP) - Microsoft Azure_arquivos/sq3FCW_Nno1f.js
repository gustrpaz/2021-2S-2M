define("Viva.Controls/Controls/Base/Viva.ItemList",["require","exports","MsPortalImpl/Base/Base.KeyboardHelper","Viva.Controls/Util/Viva.TemplateEngine","Viva.Controls/Util/Viva.Util","Viva.Controls/Controls/Base/Viva.ValidatableControl","WeaveDOM/DirectRender/DataAttribute"],(function(n,t,i,r,u,f,e){"use strict";var o;return (function(n){function a(n,t,i){var u=n,r=t,f=function(n){var t;r.hasOwnProperty(n)&&(t=r[n],t!==undefined&&(u[n]=ko.isObservable(t)?t:ko.observable(t)))},e=i||Object.keys(r)||[];e.forEach(f)}var o="azc-itemList",h='<ul class=\'azc-input azc-optionPicker-list\' data-bind=\'foreach: data.values, css: { "azc-no-border": !data.values || !data.values().length }, attr: { "aria-disabled": $disabled, role: $ctl._roleGroup, "aria-labelledby": data.label }\'><!-- ko template: { name: "itemTemplate", context: { $disabled: disabled, $tabIndex: _tabindex } } --><!-- /ko --><\/ul>',c='<li data-bind=\'text: text, attr: { role: $ctl._role, "aria-checked": $ctl._ariaSelected($data), "aria-disabled": $disabled, disabled: $disabled, tabindex: $tabIndex }, css: { "azc-itemlist-selected": selected()}\' />',l=0,v=(function(){function n(n,t,i,r){this._destroyIds=[];this._ltm=new FxImpl.TriggerableLifetimeManager;this.text=ko.observable();this.value=ko.observable();this.selected=ko.observable(i||!1);this.disabled=ko.observable(r||!1);this.ariaLabel=ko.observable();this._tabindex=ko.observable(-1);this.text(n);this.value(t)}return n.prototype._checkExistsOrRegisterDestroyId=function(n){return u.existsOrRegisterId(this._destroyIds,n)},n.prototype.isDestroyed=function(){return this._destroyIds.length>0},n.prototype.dispose=function(){this._checkExistsOrRegisterDestroyId(null)||this._ltm.dispose()},n.prototype.populateFromObject=function(n){a(this,n,["text","value","description","selected","disabled","ariaLabel"])},n})(),t,s;n.ItemValue=v;t=(function(n){function t(t){var i=n.call(this,t)||this;return i.label=t.label||null,i.values=ko.observableArray(),i}return __extends(t,n),t})(f.ViewModel);n.ViewModel=t;s=(function(n){function u(i,u,f){var e=this;return f=f||{},f.viewModelType=f.viewModelType||t,e=n.call(this,i,u,f)||this,e.weaveContext||(e.templateEngine=new r.StringTemplateEngine,e._setName(),e._setRole(),e.templateEngine.setTemplate("itemTemplate",e._attachItemTemplate())),e.element.addClass(o),e.weaveContext||e.element.html(h),e._attachEvents(),e.weaveContext||e._bindDescendants(),e.options.values.map(e.ltm,(function(n,t){n.registerForDispose(t)})),e}return __extends(u,n),u.prototype.dispose=function(){this._checkExistsOrRegisterDestroyId(n.prototype.dispose)||(this._cleanElement(o),n.prototype.dispose.call(this))},Object.defineProperty(u.prototype,"options",{get:function(){return this._options},enumerable:!1,configurable:!0}),u.prototype._getElementToFocus=function(){return this.widget().find("li[tabindex=0]")[0]||null},u.prototype._setName=function(){var n=this.options;n.name||(n.name="__azc-itemList"+l++)},u.prototype._setRole=function(){this._role="item";this._roleGroup="itemList"},u.prototype._attachItemTemplate=function(){return c},u.prototype._set=function(n){n.selected(!0)},u.prototype._isSameValue=function(n,t){return n===t||n!==undefined&&n!==null&&t!==undefined&&t!==null&&n.text===t.text&&n.value===t.value},u.prototype._initializeSubscriptions=function(t){var i=this,r;n.prototype._initializeSubscriptions.call(this,t);t.values.subscribe(this.ltm,(function(){i._valueChangedSubscriber(t.value())}));this._createPerItemSubscriptions(this.options.values());this.options.values.subscribe(this.ltm,(function(n){i._createPerItemSubscriptions(n)}));t.value.subscribeAndRun(this.ltm,(function(n){i._valueChangedSubscriber(n)}));r=!0;t.disabled.subscribeAndRun(this.ltm,(function(n){i._widgetDisabledSubscriber(n,r);r=!1}))},u.prototype._valueChangedSubscriber=function(n){var t=this;n&&(n.selected()||n.selected(!0));this.options.values().forEach((function(i){i!==n&&t._unselectItemValue(i)}));n?n._tabindex(0):this._setUnselectedTabIndex()},u.prototype._widgetDisabledSubscriber=function(n,t){var i=this.options.value(),r=this.element;n?(r.attr("aria-disabled",!0),i&&i._tabindex(-1)):(r.removeAttr("aria-disabled"),t||this.options.value.notifySubscribers(i))},u.prototype._createPerItemSubscriptions=function(n){var t=this;this._itemltm&&this._itemltm.dispose();this._itemltm=this.ltm.createChildLifetime();n.forEach((function(n){n.selected.subscribeAndRun(t._itemltm,t._itemSelectedSubscriber(n),t);n.disabled.subscribeAndRun(t._itemltm,t._itemDisabledSubscriber(n),t)}))},u.prototype._itemSelectedSubscriber=function(n){return function(t){t?this.options.value(n):n===this.options.value()&&this.options.value(null)}},u.prototype._itemDisabledSubscriber=function(n){return function(t){var i;t?(n._tabindex(-1),n===this.options.value()&&this.options.value(null)):(i=n.selected(),i&&n.selected.notifySubscribers(i))}},u.prototype._attachEvents=function(){var n=this;this.ltm.registerForDispose(this.element.setEvents(["click.itemList","li",function(t){var i=n.weaveContext?e.getElementData(this):ko.dataFor(this);n.$disabled()||i.disabled()||i.selected()||(n._clicked(i),t.stopPropagation())}],["focusin.itemList","li",function(){var t,i;n.element.find("[aria-checked=true]").length||(t=n.options.values(),i=n.weaveContext?e.getElementData(this):ko.dataFor(this),t.forEach((function(n){i!==n&&n._tabindex(-1)})))}],["focusout.itemList","li",function(){n.element.find("[aria-checked=true]").length||n._setUnselectedTabIndex()}],["keydown.itemList","li",function(t){var f=$(this),r,u,o=f.parent().find("li"),s=i.getModifierKeys(t),e=!1;if(s===0)switch(t.which){case 13:case 32:f.click();e=!0;break;case 37:case 38:for(r=f.index()-1;r>=0;r--)if(u=o.eq(r),!n._isItemDisabled(u)){u.click().focus();break}e=!0;break;case 39:case 40:for(r=f.index()+1;r<=n.options.values().length;r++)if(u=o.eq(r),!n._isItemDisabled(u)){u.click().focus();break}e=!0}return!e}]))},u.prototype._clicked=function(n){this._set(n)},u.prototype._isItemDisabled=function(n){return n.attr("aria-disabled")==="true"},u.prototype._setUnselectedTabIndex=function(){var n=0,f=this.options.values().length,t=f-1,r=!1,u=!1,i=this.options.values();if(!this.$disabled())for(n=0;n<=t;n++,t--)if(r||i[n].disabled()||(i[n]._tabindex(0),r=!0),u||i[t].disabled()||(i[t]._tabindex(0),u=!0),r&&u)break},u.prototype._unselectItemValue=function(n){n.selected(!1);n._tabindex(-1)},u.prototype._ariaSelected=function(n){return n.selected().toString()},u.prototype._ariaLabel=function(n){return(n.ariaLabel()||"").trim()||undefined},u})(f.Widget);n.Widget=s})(o||(o={})),o}))