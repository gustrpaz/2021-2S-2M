define("MsPortalImpl/Base/Base.HierarchyMap",["require","exports"],(function(n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.HierarchyMap=void 0;var i="##-##",r=(function(){function n(){this._observable=ko.observableArray()}return n.prototype.addItem=function(n,t){if(n&&n.length){if(n.some((function(n){return!n})))throw new Error("Invalid path segment");else if(this._getItemIndex(n)>=0)throw new Error("Duplicate path '"+JSON.stringify(n)+"'.");}else throw new Error("Invalid path");this._observable.push({path:n,_pathKey:n.join(i),value:t})},n.prototype.removeItem=function(n){var t=this._getItemIndex(n);t>=0&&this._observable.splice(t,1)},n.prototype.removeItemsInPath=function(n){var t=[];this._getItemsWithPath(n,!0,(function(n,i){return!n&&t.push(i)}));this._observable(t)},n.prototype._getItemIndex=function(n){var t=n.join(i);return MsPortalFx.findIndex(this._observable.peek(),(function(n){return n._pathKey===t}))},n.prototype.getItem=function(n){var t=this._getItemIndex(n);return t>=0?this._observable.peek()[t]:null},n.prototype.getItemsInPath=function(n){return this._getItemsWithPath(n,!0)},n.prototype.getItemsUnderPath=function(n){return this._getItemsWithPath(n,!1)},n.prototype.getObservable=function(){return this._observable},n.prototype._getItemsWithPath=function(n,t,r){var u=n.join(i);return this._observable.peek().filter((function(i){var f=i._pathKey.startsWith(u)&&(t||i.path.length>n.length);return r&&r(f,i),f}))},n})();t.HierarchyMap=r}));
define("MsPortalImpl/UI/Compositions/UI.Composition.Journey",["require","exports","MsPortalImpl/Base/Base.HierarchyMap","MsPortalImpl/Services/Services.EditScopeManagement","MsPortalImpl/UI/Compositions/UI.Composition","MsPortalImpl/UI/Compositions/UI.Composition.Base","MsPortalImpl/UI/Compositions/UI.Composition.Finder","MsPortalImpl/Widgets/Widgets.Journey","Fx/ResourceManagement","MsPortalImpl/Widgets/Widgets.Portal.init","MsPortalImpl/UI/Compositions/UI.Composition.Blade"],(function(n,t,i,r,u,f,e,o,s,h){"use strict";function c(n,t){return n.id===t.id}function v(n,t){return new l(n,t)}var a,l;Object.defineProperty(t,"__esModule",{value:!0});t.create=t.Instance=void 0;a=u.CompositionType;l=(function(n){function t(t,r,u,f,e,o){var s=n.call(this,"Journey",t,null,u,f,e)||this;return s.journeyBlades=ko.observableArray(),s.lastModifiedTime=ko.observable(Date.now()),s.originTile=r,s._updateBladesMetadata(),s._ambientSettings=o||new i.HierarchyMap,s._setupEditScopeReactor(s.originTile),s}return __extends(t,n),Object.defineProperty(t.prototype,"ambientSettings",{get:function(){return this._ambientSettings},enumerable:!1,configurable:!0}),t.prototype.getCompositionType=function(){return a.Journey},t.prototype.getDeepLink=function(){var n=this;return Q(this.await(7).then((function(){var t=n.children,i=t.length;return i?t[i-1].getDeepLink():n.diContainer.get(e.Finder).findPartsContainer(n.originTile).getDeepLink()})))},t.prototype.isStartedWithContextBlade=function(){var n=this.children;return n.length>0&&!!(n[0].flags&1)},t.prototype.observeEditScopeChanges=function(n,t){this._observeEditScopeChanges(n,t,!0)},t.prototype._observeEditScopeChanges=function(n,t,i){var u=this;ko.computed(n,(function(){var s=t.editScopeId&&t.editScopeId(),e,l,a,o;if(s){var y=u.diContainer.get(r.EditScopeManager).getStateObservable(s),v=y(),h=v===2,c=v===1||h,n=t.ownerLocatable.journeyPath,f=u._ambientSettings;c?(e=void 0,l=f.getItem(n),l?(a=l.value,a&&(o=a.editScope,o&&(o.dirty!==c||o.saving!==h)&&(f.removeItem(n),e=!0))):e=!0,e&&f.addItem(n,{type:t.ownerType,editScope:{editScopeId:s,dirty:c,saving:h,disposeOnSelectionChange:t.disposeOnSelectionChange,disposeOnJourneyDiscard:i}})):f.removeItem(n)}}))},t.prototype.removeChildAt=function(t,i){n.prototype.removeChildAt.call(this,t,i);this._updateBladesMetadata()},t.prototype._addChildrenInternal=function(t,i){n.prototype._addChildrenInternal.call(this,t,i);this._updateBladesMetadata()},t.prototype._setupEditScopeReactor=function(n){var t=this;n&&n.await(7).then((function(){if(!t.isDisposed()&&n.partDefinition.editScopeType){var i=n,r={editScopeId:n.editScopeId,ownerType:n.locator.type,ownerLocatable:n,disposeOnSelectionChange:!1};t._observeEditScopeChanges(i,r,!1)}}))},t.prototype._updateBladesMetadata=function(){var t=this.journeyBlades;if(t){var r=t(),i=MsPortalFx.unique(this.children,c),n=[];r.forEach((function(t){var r=MsPortalFx.find(i,(function(n){return c(t,n)}));r&&(n.push(t),t.subtitle(r.subtitle()),t.title(r.title()))}));n=MsPortalFx.pushUnique(n,i,c);t(n)}},t.prototype._compose=function(n,t){var r=this,i;n.options.getJourneyWidget()||(i=new o.ViewModel(this.id,function(){return h.getPortalViewModel(r.diContainer).getRootPageDisplayType()},this.diContainer),this.widget=new o.Widget(n.options.getJourneyArea(),i));t.resolve()},t.prototype.getCurrentResourceId=function(){for(var n,i=this.children,t=i.length-1;t>=0;t--)if(n=i[t].assetId(),n&&s.ArmId.parse(n,!0).kind!==0)return n},t})(f.Instance);t.Instance=l;t.create=v}));
define("MsPortalImpl/UI/Compositions/UI.Composition.BladeOpener.Handler",["require","exports","Fx/DependencyInjection","MsPortalImpl/Base/Telemetry","MsPortalImpl/Base/Base.Pipeline","MsPortalImpl/Extension/Extension.Definition.Locator","MsPortalImpl/UI/UI.ContextPane","MsPortalImpl/UI/UI.JourneyManager","MsPortalImpl/UI/Compositions/UI.Composition","MsPortalImpl/UI/Compositions/UI.Composition","MsPortalImpl/UI/Compositions/UI.Composition.BladeOpenerBase","MsPortalImpl/UI/Compositions/UI.Composition.BladeOpener.Helpers","MsPortalImpl/UI/Compositions/UI.Composition.Finder","MsPortalImpl/UI/Compositions/UI.Composition.PropertyBinding","MsPortalImpl/Extension/ViewModelManager","MsPortalImpl/UI/Compositions/UI.Composition.Journey","MsPortalImpl/UI/Compositions/UI.Composition.Blade"],(function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y){"use strict";function it(n,t,i,r,u,f,e){var o=e.invocationInput,s=!0,h=o.selectableSetV1&&u,c;if(u===undefined||h&&h.length===0)c=i.getCloseOwnedDetailBladesHandler(o)||function(){return et(n,i,r.bladesClosedByPart,o)},s=c();else return ut(n,t,i,r,u,f,e);return{succeeded:s,bladeOpenPromise:undefined,reboundBlade:undefined}}function rt(n,t,i){var u=n.referenceExtension,r=function(){return u.processMessages()};r().then((function(){var s="Set invocation property '"+t.source.property+"' of master '"+n.masterModelId+"' to value.",h;p.verbose("START: "+s,i);var e=t.source.property,f=g(n,t),o=f&&f.isSelected;if(f&&o&&i!==undefined?(h=ot(f,n.masterModelId),h.setInternalSelectedValue(i),o()||o(!0)):v.setModelValue(n.masterModel,e,i),e.indexOf("activatedItems")>=0){var l=e.replace("activatedItems","selectedItems"),c=w(n.masterModel,l),u=c.exists&&c.value;ko.isObservable(u)&&Array.isArray(u())&&r().then((function(){u.splice.apply(u,[0,u().length].concat(i))}))}p.verbose("END: "+s,i)}))}function ut(n,t,i,u,f,h,c){var at=n.get(a.Finder),v=c.invocationInput,vt=c.additionalInputs,yt=c.detailsDefinition,l=Q.defer(),d=function(){l.resolve([])},pt=f,tt=!0,wt=i.getCloseOtherDetailBladesHandler(v,yt)||function(t,r){return ft(n,i,u,v,vt,t,r)},bt=function(n){return i.onBladesOpening(n)},kt=n.get(o.JourneyManager),it,rt,b,ut,st,g,ht,nt,lt;if(!Array.isArray(f)||pt.length)if(rt=!!((t===null||t===void 0?void 0:t.flags)&2),b=n.get(e.RightContextPane),tt=wt(t,b)){ut="getCompositionType"in(b.getContent()||{});ut||t.flags&1||h.menu||b.close();var et=at.findBlades(u.container,!!((t===null||t===void 0?void 0:t.flags)&32)),ot=void 0,w=et[0];et.length===1&&w.widget&&~t.flags&64&&!rt==!(w.flags&2)&&(ot=!0,st=v.selectableSetV1?f[0]:f,g=k(i.referenceComposition?i.referenceComposition.locator.toString():i.masterModelId,st,v),r.isDesktopTraceEnabled&&p.verbose("[BladeOpener] Rebinding blade.\n  "+w+".\n  New Model: "+ko.toJSON(g)),it=w,ht=w.rebindAsync(g),u.selectable2?ht.finally(d):d());ot||(bt([t]),nt=void 0,t.locator.name!=="##NOT_SPECIFIED##"&&(lt=n.get(y.ViewModelManager),lt.tryEarlyGetViewModel(t.locator.getExtensionName(),t.locator.name,t.model,{isPrefetch:!0,menuId:t.defaultMenuItemId,inContextPane:!!(t.flags&1),isMenuBladeContent:(function(){var u=n.get(a.Finder),t=u.findPartsContainer(i.referenceComposition),r=t&&t.getCompositionType()===s.CompositionType.Blade&&t.bladeDefinition;return!!(r&&r.menuBlade)})(),menuContentOverride:t.contentBladeReference}),nt=!0),MsPortalFx.tryImmediateResolve(nt?Q.delay(0):Q(),(function(){n.isDisposed()?l.reject(new MsPortalFx.Errors.DisposedCanceledError):kt.openBlade(h,t).then((function(n){if(n)n.onDispose((function(){ct(i,u.bladesClosedByPart,n,v,!!u.selectable2,f)}));l.resolve([n])}))})),u.previousInvocationPromise=l.promise.finally((function(){u.previousInvocationPromise=undefined})))}else d();return l.promise.then((function(n){var e=u.selectable2,t=c.invocationOutputs,r,f,o,s;n=n||[];r=n.filter((function(n){return e||!((n===null||n===void 0?void 0:n.flags)&2)}));f=r.length===1?r[0]:undefined;n.filter((function(n){return!!n})).forEach(u.bladeOpenedCallbacks.fire);!e&&r.length>0&&Array.isArray(t)&&t.length>0&&(f?f.await(7).then((function(){i.addOutputBindings(f,t)})):(o=n.map((function(n){return n.getDiagnosticsData()})),s="Unable to create output binding with detail blade, multiple detail blades found."+("\nMaster Model Debug Id: "+i.masterModelId+".")+("\nOutput Arguments: "+ko.toJSON(t,null,2))+("\nDetail Blades: "+ko.toJSON(o,null,2)),p.error(s)))})),{succeeded:tt,bladeOpenPromise:l.promise,reboundBlade:it}}function ft(n,t,i,r,u,f,e){var p=n.get(o.JourneyManager),tt=n.get(a.Finder),k=tt.findSiblingBlades(t.referenceComposition,!!(f.flags&32)),it=function(n){return t.isBladeOpenedByMaster(n)&&n.masterInvocationProperty===r.source.property},s,l,v=!0,rt=!1,c=e&&e.getContent(),d,g,nt,w,y;if(c&&c.id&&k.some((function(n){return n.id===c.id}))&&(c=null),s=k.filter((function(n){var t=!1,i=n.bladeDefinition,o=!!((f===null||f===void 0?void 0:f.flags)&2),s=!!(n.flags&2),r,e;return n.isDisposed()||o!==s||(!it(n)||(i===null||i===void 0?void 0:i.attributes)&1||(f===null||f===void 0?void 0:f.flags)&64?t=!0:(r=n.locator.equals(f.locator),r?(e=at(f.model,u),t=!h.deepSubset(n.getBindableContainer().getViewModel(),e),l=n):t=!0)),t})),d=b(n,s),s.length===k.length&&l&&ht(l,f)&&(MsPortalFx.remove(s,l),s=s.concat(tt.findBlades(l)),g=p.discardEditsOfBlade(l,{includeSelf:!1,includeDescendants:!0,force:d}),v=g.successful,rt=v&&g.confirmationRequired),v&&!rt&&(nt=!0,c&&c.id&&(nt=p.confirmBladesCanClose([c])),v=d?nt:p.confirmBladesCanClose(s)),v)for(w=s.length-1;w>=0;w--)y=s[w],it(y)&&(t.removeOutputBindings(y),i.bladesClosedByPart.set(y,!0)),p.forceCloseBlade(y,1,{openBlade:!0});return v}function et(n,t,i,r){var s=n.get(o.JourneyManager),c,f,e,l;if(!s.activeJourney())return!0;var v=n.get(a.Finder),u=v.findBlades(t.referenceComposition).filter((function(n){return!n.isDisposed()&&n.masterInvocationProperty===r.source.property&&t.isBladeOpenedByMaster(n)})),y=b(n,u),h=y||s.confirmBladesCanClose(u);if(h)for(c=g(t,r)||{},f=u.length-1;f>=0;f--)e=u[f],l=c._msPortalFxDelayedBladeSelection,i.set(e,!0),t.removeOutputBindings(e),s.forceCloseBlade(e,1,{openBlade:l});return h}function b(n,t){var i=n.get(o.JourneyManager).activeJourney();return t.every((function(n){var t;if(!n.isInitialized)return!0;if(t=!!n.bladeDefinition.actionBar,n.shouldAlertOnClose(t))if(t){var u=n.getViewModel(2),r=u&&u.content(),f=r&&r.output&&r.output(),e=f&&f.status;if(e!==3)return!1}else return!1;return i.ambientSettings.getItemsInPath(n.journeyPath).every((function(n){return n&&n.value&&n.value.type===1?!n.value.editScope||n.value.editScope.disposeOnSelectionChange:!1}))}))}function ot(n,t){var i=n;if(n)return i.lock&&i.setInternalSelectedValue&&i.isLocked||(p.error("selectable is not a framework implementation, view model = '"+t+"'"),i={lock:d,setInternalSelectedValue:function(t){n.selectedValue(t)},isLocked:d}),i}function g(n,t){var i=t.source.property.lastIndexOf("."),r=i>0?t.source.property.substring(0,i):"";return w(n.masterModel,r).value}function st(n,t,i){var r=t.referenceExtension;return c.mapDynamicSelectionToBladeLocator(n,i,f.Locator.forExtension(r.name),t.masterModelId)}function ht(n,t){var r,i=[],u=n.widget;u&&(i=u.options.commandBar.menuItems(),n.children.forEach((function(n){n.children.forEach((function(n){var t=n.widget;t&&(i=i.concat(t.options.commands))}))})));var f=t.masterDetailsDefinition,e=f&&!!f.parameterCollector,o=((r=n.bladeDefinition)===null||r===void 0?void 0:r.attributes)&1||t.flags&64,s=!n.isDisabled&&n.bladeDefinition&&!n.bladeDefinition.waitForInputsSet&&!o&&!e&&i.every((function(n){return n.canRebind}));return s||o||e||p.warning("Unable to rebind Blade '"+n.id+"', it was either disabled, cleared, or one of its commands was executing. Will close and reopen blade instead."),s}function ct(n,t,i,r,u,f){var e=n.referenceComposition&&n.referenceComposition.id,o;e&&e!==i.masterPartId||(o=t.get(i),n.removeOutputBindings(i),o||lt(n,r,u,f))}function lt(n,t,i,r){var u=w(n.masterModel,t.source.property).value,f=ko.toJS(u),e;Array.isArray(f)?u.splice(0,f.length):(e=i&&r.flags&64?ko.unwrap(u)!==r:!1,e||v.setModelValue(n.masterModel,t.source.property,undefined))}function at(n,t){var r=n,i;return n&&t&&t.length&&(i={},t.forEach((function(n){i[n.targetProperty]=!0})),r=MsPortalFx.forEachKey(n,(function(n,t,r){i[n]||(r[n]=t)}),{})),r}Object.defineProperty(t,"__esModule",{value:!0});t.shouldSkipPromptForBladesWithEdits=t.OpenBladeHandler=void 0;var nt=MsPortalFx.Base.Diagnostics,k=l.mapMasterModelToBladeModel,p=nt.createLog(n),d=MsPortalFx.noop,w=v.getModelValue,tt=(function(){function t(n,t,i){this._diContainer=n;this._options=t;this._resources=i}return t.prototype.createDescriptor=function(n,t){var f=t.value,u,r,h;if(f!==undefined&&(!Array.isArray(f)||f.length)){var i=t.invocationInput.selectableSetV1?f[0]:f,it=!!this._resources.selectable2,c=this._resources.registrationInfo,e=c.invocationInput,o=c.detailsDefinition,p=c.additionalInputs,a=k(this._options.masterModelId,i,e),v=e.opensDynamicBlades?st(this._diContainer,this._options,i):this._resources.detailsBladeLocator;v=l.getMappedBladeLocator(this._diContainer,v,a,this._resources.container);var s=void 0,y=void 0,w=!1,b=!!o.asSubJourney,d=!1,g=!1,nt=!1,tt="";e.opensDynamicBlades&&i&&(s=i.openInContextPane,y=i.persistentContextPane,it&&(w=!!(i.flags&2),b=!!(i.flags&8),d=!!(i.flags&128),g=!!(i.flags&256),nt=!!(i.flags&64),tt=i.telemetryName));s===undefined&&(s=o.openInContextPane,y=o.persistentContextPane);u=s?1:0;y&&(u|=2);w||(u|=4);b&&(u|=8);d&&(u|=16);g&&(u|=32);nt&&(u|=64);r={locator:v,masterInvocationProperty:e.source.property,bindings:p.slice(0),model:a,masterInputKeys:Object.keys(a),masterDetailsDefinition:o,flags:u};p.forEach((function(n){r.model[n.targetProperty]=n.source.constantValue}));this._options.configureBindings&&r.bindings&&r.bindings.length&&this._options.configureBindings(r.bindings);this._options.configureBladeDescriptor(r);i&&(r.openedByContext=i.context,i.defaultMenuItemId&&(r.defaultMenuItemId=i.defaultMenuItemId,r.contentBladeReference=i.contentBladeReference,i.flags|=64));r.telemetryName=tt;h=this._options.referenceComposition&&this._options.referenceComposition.partDefinition;i&&(i.assetType&&i.detailBladeInputs?r.originAssetType=i.assetType:i.originAssetType&&i.detailBladeInputs&&i.detailBlade?(r.originAssetType=i.originAssetType,r.originAssetTypeExtension=i.originExtension):h&&(r.originAssetType=h&&h.assetType,r.originAssetTypeExtension=this._options.referenceExtension&&this._options.referenceExtension.name));t.descriptor=r}},t.prototype.openBlade=function(n,t){var r=this._options,i=this._resources,f=t.invocationInput,e=i.container,o=t.value,u,s;return(c.traceInvocationChange(p,"Executing invocation property change",this._diContainer,r,f,o),e&&e.onInvocationStarted(),u=it(this._diContainer,t.descriptor,r,i,o,e,i.registrationInfo),u.succeeded?(i.resettingMasterArrayValue=!1,i.prevValue=o):i.resettingMasterArrayValue?(p.error("Resetting value of master '{0}' also caused a prompt".format(r.masterModelId),0,i.prevValue),i.resettingMasterArrayValue=!1):(i.resettingMasterArrayValue=f.selectableSetV1,rt(r,f,i.prevValue)),t.reboundBlade=u.reboundBlade,s=u.bladeOpenPromise,s)?s.then((function(n){t.openedBlades=n})):null},__decorate([__metadata("fx:diagnostics",[n,"OpenBladeHandler.prototype"]),u.Step(4),__metadata("design:type",Function),__metadata("design:paramtypes",[u.Task,Object]),__metadata("design:returntype",void 0)],t.prototype,"createDescriptor",null),__decorate([__metadata("fx:diagnostics",[n,"OpenBladeHandler.prototype"]),u.Step(5),__metadata("design:type",Function),__metadata("design:paramtypes",[u.Task,Object]),__metadata("design:returntype",void 0)],t.prototype,"openBlade",null),__decorate([__metadata("fx:diagnostics",[n,"OpenBladeHandler"]),i.Class("pipeline"),__metadata("design:paramtypes",[i.Container,c.Configuration,c.Resources])],t)})();t.OpenBladeHandler=tt;t.shouldSkipPromptForBladesWithEdits=b}))