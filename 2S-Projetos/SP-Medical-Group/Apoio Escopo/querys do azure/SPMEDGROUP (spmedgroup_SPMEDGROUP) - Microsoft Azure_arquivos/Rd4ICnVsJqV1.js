define("MsPortalImpl.Controls/Fields/Section.shim",["require","exports","Weave/DirectMode","FxInternal/WeaveControls/Section.Component.Internal","Weave","Fx/Weave","MsPortalImpl/Weave/Components","Fx/Weave/Components/PcControl","FxInternal"],(function(n,t,i,r,u,f,e,o,s){"use strict";function v(n){var t=n.vm;if(a&&l(t)&&t.style()===1)return r.SectionInner(h(t,!1),undefined)}function h(t,r){function h(n){return i(u.Fragment,null,y(n),i(u.Aggregatable,{dirty:o}))}var o=f.toComputation(t.dirty);return{name:r?null:f.toComputation(t.name).compose((function(t){return t?i(e.HtmlOrKo,{require:n,content:t}):null})),children:f.toComputation(t.children).composeArray(s.identity).cMap(f.toValueOrComputation).cMap(h),disabled:f.toComputation(t.disabled),leftLabelPosition:!!(t.leftLabelPosition&&t.leftLabelPosition()),leftLabelWidth:t.leftLabelWidth&&t.leftLabelWidth(),smartAlignLabel:!!t.smartAlignLabel}}function c(n){return n&&n.htmlTemplate&&n.controlType!==23}function l(n){return!!n.leftLabelWidth||!!n.smartAlignLabel}function y(t){return c(t)?i("div",{className:"fxt-tabs-inner"},i(e.Ko,{content:t,require:n})):t?i(o.PcControl,{className:t.controlType===15?null:"fxc-section-control",vm:t,container:null}):void 0}Object.defineProperty(t,"__esModule",{value:!0});t.isAmdViewModel=t.isHtmlContent=t.shimFxSectionVMToSectionInnerProps=t.tryWeaveSectionInnerContent=void 0;var a=MsPortalFx.isFeatureEnabled("weavesection");t.tryWeaveSectionInnerContent=v;t.shimFxSectionVMToSectionInnerProps=h;t.isHtmlContent=c;t.isAmdViewModel=l}));
define("MsPortalImpl.Controls/Fields/Section",["require","exports","MsPortalImpl/TsxStringMode/Tsx","MsPortalImpl/TsxStringMode/Tsx","_generated/MsPortalImpl/Svg/Startup/Ellipsis.svg","MsPortalImpl/Resources/ImplScriptResources","MsPortalImpl/Resources/ImplScriptResources","MsPortalImpl/Interactions/Interactions.DismissHandler","Viva.Controls/Util/Viva.TemplateEngine","MsPortalImpl.Controls/Controls/Base/Loadable","MsPortalImpl/Base/Base.SvgHelper","MsPortalImpl/Base/JQueryHelper","MsPortalImpl/Base/Base.BrowserDetection","MsPortalImpl/Base/Base.KnockoutTemplateSanitizer","MsPortalImpl/Base/Base.Timers","Viva.Controls/Util/Viva.Resize","MsPortalImpl/Widgets/Widgets.Common","MsPortalImpl/Weave/Util","MsPortalImpl.Controls/Fields/Section.shim","FxInternal/Css","FxInternal/_generated/Less/WeaveControls/Section.Component.css","Fx/Controls/Section"],(function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt){"use strict";function ci(n,t,i){return Math.min(Math.max(n,t),i)}var ft,ut,vt;Object.defineProperty(t,"__esModule",{value:!0});t.Section=t.Widget=t.tryWeaveInnerContent=t.createVm=void 0;d.injectCss(g);var li=MsPortalFx.Base,yt=li.Diagnostics.Telemetry,ai=3e3,vi=window.document.implementation.createHTMLDocument(""),pt="fxc-section",wt="fxc-section-name",yi="fxc-section-invalid",pi="fxc-section-dirty",rt="fxc-section-wrapper",ht="fxc-section-row",bt="fxc-section-column",kt="fxc-section-dependent",dt="fxc-section-tabs",gt="fxc-section-control",ni="fxc-section-singlecontrol",tt="fxc-tabs-menu",ti="fxc-tabs-menu-content",wi="fxc-tabs-menu-active",ii="fxc-tabs-menu-open",bi="fxc-section-tab-dirty",ki="fxc-tab-required-item",di="fxc-tab-invalid-item",ct="fxc-tabs-itemslist",ri="fxc-tabs-container",et="fxc-section-tab-item",ui="fxc-section-tab-item-icon",lt="msportalfx-form",ot="msportalfx-form-regular",st="fxc-left-label-fixed",fi="fxc-smart-labels",ei="msportalfx-tooltip-overflow",at="fxs-portal-border",oi=i(r.KoIf,{condition:"$parent.allowClosableTabs"},i("span",{"class":ui,"data-bind":{image:"MsPortalFx.Base.Images.Discard()"}})),si=function(n){var t;return n===void 0&&(n=!1),i(r.KoIf,{condition:"$data && $data.visible && ko.unwrap($data.visible)"},i("div",{role:"tab","class":et,"data-bind":{attr:{id:"$ctl._tabUsedId($index(), "+n+", false)",tabindex:"$ctl._focused($index(), "+n+")","aria-controls":"$ctl._tabUsedId($index(), "+n+", true)","aria-selected":'$data.active() ? "true" : "false"',"aria-setsize":"$ctl._tabSetSize","aria-posinset":"$ctl._tabPosInSet($index())","aria-invalid":"!$data.valid()","aria-disabled":"$data.disabled"},css:(t={"azc-br-active fxs-portal-text":"$data.active()"},t[bi]="$data.dirty",t["fxc-tab-disabled azc-fill-disabled"]="$data.disabled",t[ki]="$data.required",t[di]="!$data.valid()",t)}},i("span",{"class":[ti,ei]},i("span",{"data-bind":{untrustedContentDeprecated:"$data.name"}}),oi),i("span",{"aria-hidden":"true","class":[ti,ei,"fxc-section-tab-placeholder"]},i("span",{"data-bind":{untrustedContentDeprecated:"$data.name"}}),oi),i(r.KoIf,{condition:"$data.required"},i("label",{"class":"fxs-hide-accessible-label"},e.required))))},gi=i(r.Root,null,i(r.KoIf,{condition:"$data.name"},i("div",{"class":["fxc-section-legend azc-br-muted",wt],"data-bind":{untrustedContentDeprecated:"$data.name"}})),i(r.KoIf,{condition:"$data.style() === 4"},i("div",{"class":[ri,at]},i("div",{role:"tablist","class":[ct,"fxc-tabs-headers"],"data-bind":{css:(ft={},ft["fxc-tab-required"]="$data.showRequiredStatusOnTabs",ft["fxc-tab-invalid"]="$data.showValidationStatusOnTabs",ft)}},i(r.KoForEach,{items:"$data.children"},si())),i("div",{"class":tt},i("span",{tabindex:"0",role:"button","aria-expanded":"false","class":"fxs-portal-svg-secondary","data-bind":{attr:{"aria-label":"$ctl._menuBtnAriaLabel",title:"$ctl._menuBtnAriaLabel"}}},c.getSvgReferenceOrFallBackToData(u).outerHTML),i("div",{"class":[ct,"azc-bg-default","msportalfx-shadow-level2"]},i(r.KoForEach,{items:"$data.children"},si(!0))))),i(r.KoForEach,{items:"$data.children"},i(r.KoIf,{condition:"$data"},i("div",{role:"tabpanel","data-bind":{pcControl:"$data.tabSection",visible:"visible() && active()",attr:{id:"$ctl._panelUsedId($index(), false)","aria-labelledby":"$ctl._panelUsedId($index(), true)"}}})))),i(r.KoIfNot,{condition:"$data.style() === 4"},i(r.KoForEach,{items:"$data.children"},i(r.KoIf,{condition:"$ctl._verifyHtmlContent($data)"},i("div",{"class":"fxt-tabs-inner","data-bind":{untrustedContent:"$data"}})),i(r.KoIfNot,{condition:"$ctl._verifyHtmlContent($data)"},i(r.KoIf,{condition:"$ctl._verifyDynamicSection($data)"},i("div",{"data-bind":{pcControl:"$data",style:{width:"$ctl._applyWidth($data, $parent, $index())"}}})),i(r.KoIfNot,{condition:"$data && $ctl._verifyDynamicSection($data)"},i("div",{"class":gt,"data-bind":{pcControl:"$data"}})))))),nr=i(r.KoTemplate,{options:"{ name: 'sectionTemplate', data: $data.data }"}),hi=[ht,bt,dt,rt,kt,at,ni].join(" "),it={};it[3]=ht;it[0]=bt;it[4]=dt;it[2]=rt+" "+kt+" "+at;it[6]=rt+" "+ni;ut={mouseClick:"MouseClick",keyboardEvent:"KeyboardEvent",onLoad:"OnLoad",programmatically:"Programmatically"};Object.defineProperty(t,"createVm",{enumerable:!0,get:function(){return nt.create}});t.tryWeaveInnerContent=k.tryWeaveSectionInnerContent;vt=(function(n){function t(t,i,r){var u=n.call(this,t,i,r)||this,bt,d,v,ti,g,c,nt,b,ft,at,vt,yt;u._populateTimer=null;u._activeChangedByWidget=!1;u._hasColumn=ko.observable(!1);u._panelBaseId=MsPortalFx.getUniqueId();u._tabBaseId=MsPortalFx.getUniqueId();u._focusedTab=ko.observable(0);u._menuBtnAriaLabel=e.CommandBar.more;u._setTabOverflowContent=u.weaveContext?null:y.throttleByAnimationFrame((function(){var s=u.element.findByClassName(tt).outerWidth()||0,o=$(u.element.find("."+ri+" > div."+ct)[0]),e=o.find("> ."+et),f=o.width()-s,t,i,n,r;if(f<=0&&(f=320),t=0,i=0,u._tabHeaders=[],e.each((function(n,t){u._tabHeaders.push($(t));var r=u.options.children()[n];r&&r.active()&&(i=n)})),i>0){for(n=i;n>=0;n--)r=$(e[n]),t+=r.outerWidth(!0),r.toggleClass("fxc-section-tab-item-hidden",t>f);i++}for(n=i;n<e.length;n++)r=$(e[n]),t+=r.outerWidth(!0),r.toggleClass("fxc-section-tab-item-hidden",t>f);$(u.element.find("."+tt)[0]).toggleClass(wi,t>f)}));u._appliedWidthSubscription=new Map;var o=u.options,dt=o.children,h=u.ltm,ni=o.style()===4;if(o.disableStyles||t.addClass(pt),k.isAmdViewModel(o)&&ko.unwrap(o.leftLabelWidth)&&t.addClass(lt).addClass(ot).addClass(st),u.weaveContext||(o.style()===4&&(u._tabSetSize=ko.computed(h,[o.children],(function(n){return n.length}))),t.html(nr),(u.templateEngine=new s.StringTemplateEngine).setTemplate("sectionTemplate",gi),u._bindDescendants()),t.findByClassName(wt).each((function(n,t){var i="azc-form-guid-"+MsPortalFx.getUniqueId();t.id=i;$(t.parentElement).findByClassName(gt).each((function(n,t){$(t).attr("aria-labelledby",i);$(t).attr("role")||$(t).attr("role","group")}))})),d=y.throttleByAnimationFrame((function(n){bt!==n&&(bt=n,bt>480?t.addClass(ot).addClass(st):t.removeClass(ot).removeClass(st))})),k.isAmdViewModel(o)&&o.smartAlignLabel&&(t.addClass(lt).addClass(fi),d(u.element.width()),ni||p.track(h,u.element,(function(n){d(n)}))),ni&&(v=ko.contextFor(t[0]),ti=v&&v.$partName,u._extensionName=v&&v.$extensionName,u._extensionName&&(u._telemetrySource=["Extension",u._extensionName,"Blade",ti].join("/")),g=o.telemetrySource,g&&(u._extensionName=g.extension,u._telemetrySource=g.source),c=dt,u.weaveContext||($(window).setEvents(["resize",function(){u._toggleMenu(!1)},]),b=MsPortalFx.find(c(),(function(n){return n&&ko.unwrap(n.active)})),b||(ft=c()[0],ft&&ft.active&&(b=ft)),b&&u._tabActivated(b,u.options,ut.onLoad),o._msPortalFxSetFocusOnTab&&o._msPortalFxSetFocusOnTab.subscribeAndRun(h,(function(n){var r,t,i;MsPortalFx.isNullOrUndefined(n)||(r=u.element.closest(".fxs-blade"),(r.find(":focus").length||r[0]===document.activeElement)&&(t=u._tabSetSize(),t&&n>-1&&n<=t&&(i=ci(n,0,t-1),u._focusedTab(i),u._tabHeaders&&u._tabHeaders[i]&&u._tabHeaders[i].focus())))})),c.map(h,(function(n,t){t&&t.controlType===15&&t.active.subscribe(n,(function(n){n&&!u._activeChangedByWidget&&(u._activeChangedByWidget=!0,u._tabActivated(t,u.options,ut.programmatically),u._activeChangedByWidget=!1)}))}))),at=u.weaveContext?null:function(){c().forEach((function(n){if(n&&n.controlType===15){var t=n.tabHasBeenLoaded;n.populateSection();t&&!t()&&u._tabSelected(n)}}))},u.weaveContext||(nt=!1,vt=o.showRequiredStatusOnTabs,yt=o.showValidationStatusOnTabs,(vt||yt)&&ko.reactor(h,[vt,yt],(function(){nt=vt()||yt();nt&&at()})),u._populateTimer=setTimeout((function(){at();u._setTabOverflowContent()}),ai)),p.track(h,u.element,(function(n){u.weaveContext||u._setTabOverflowContent();k.isAmdViewModel(o)&&o.smartAlignLabel&&d(n)})),!u.weaveContext)){c.subscribeAndRun(h,(function(){u._setTabOverflowContent();nt&&at()}));var ii=function(n){var h=$(n.currentTarget),t=parseInt(h.attr("aria-posinset")||h.parent().parent().attr("aria-posinset"))-1,c=ko.contextFor(n.currentTarget).$parent,i=c.children(),l,r,e,s;ko.unwrap(u.vm.alertOnClose)&&i[t]&&i[t].dirty&&i[t].dirty()&&!window.confirm(f.Desktop.confirmEditScopeDiscard)||(l=i[t]&&i[t].active&&i[t].active(),u._tabHeaders&&u._tabHeaders.length&&u._tabHeaders.splice(t,1),i.splice(t,1),c.children(i),r=u._tabHeaders&&u._tabHeaders.length,r&&(e=0,t>r-1&&(e=r-1),s=o.children()[e],s&&(l&&s.active(!0),u._tabHeaders[e].focus())))},ei=function(n,t){var r,f,i,e;$(n.target).parents(".fxc-tabs-menu").length?(r=$(document.activeElement),t?r.prev().focus():r.next().focus()):(f=u._tabHeaders,i=ci(u._focusedTab()-(t?1:-1),0,u._tabSetSize()-1),$(f[i]).is(":visible")&&(n.stopPropagation(),e=u._tabHeaders,u._focusedTab(i),e[i].focus()))},kt="."+tt+" span[role=button]";u.ltm.registerForDispose(u.element.setEvents(["click","."+et,function(n){var t=ko.contextFor(n.currentTarget);u._tabActivated(t.$data,t.$parent,ut.mouseClick)}],["click","."+ui,function(n){return ii(n),!1}],["keydown","."+et,function(n){switch(n.which){case 13:n.stopPropagation();var t=ko.contextFor(n.target);u._tabActivated(t.$data,t.$parent,ut.keyboardEvent);break;case 37:case 38:return ei(n,!0),!1;case 39:case 40:return ei(n),!1;case 46:return ko.unwrap(o.allowClosableTabs)&&ii(n),!1}}],["click",kt,function(n){u._toggleMenu();n.stopPropagation()}],["keydown",kt,function(n){(n.which===13||n.which===32||n.which===40)&&(u._toggleMenu(),n.stopPropagation())}],["keydown","."+tt,function(n){n.which===27&&(u._toggleMenu(!1),u.element.find(kt).focus(),n.stopPropagation())}]))}return o.valid.subscribe(h,(function(n){return t.toggleClass(yi,!n)})),o.dirty.subscribe(h,(function(n){return t.toggleClass(pi,n)})),o.minHeight&&t.css("min-height",o.minHeight+"px"),u.weaveContext||(u.ltm.registerForDispose(u.element.setEvents(["keydown",function(n){if(n.which===13){var t=i.submit();if(t)return n.stopPropagation(),t().then((function(){}))}}])),dt.subscribeAndRun(h,(function(n){a.isChrome&&w.waitForBindings(t[0]).finally((function(){if(t.is(l.getUnhideSelector())){var n=t.find("> .fxc-left-label");n.length>1&&(n.removeClass("fxc-left-label"),setTimeout((function(){n.addClass("fxc-left-label")})))}}));u._hasColumn(o.style()===3&&n.some((function(n){return n.style&&n.style()===0})))}))),ko.computed(h,[o.style,u._hasColumn],(function(n,i){if(!o.disableStyles){var r=!i&&n===3?rt:it[n];r=r||rt;t.removeClass(hi).addClass(r);r===ht&&t.attr("role","presentation")}})),u}return __extends(t,n),t.prototype.dispose=function(){var i=this.options,t;this._cleanElement(pt,hi,i.cssClass(),lt,ot,st,fi||"");i.minHeight&&this.element.css("min-height","");this.weaveContext||(t=this._populateTimer,t!==null&&clearTimeout(t),this._populateTimer=null);n.prototype.dispose.call(this)},Object.defineProperty(t.prototype,"options",{get:function(){return this._options},enumerable:!1,configurable:!0}),t.prototype._applyWidth=function(n,t,i){var f=this,u;if((n.style()===0||n.width&&n.width())&&t.style()!==4){var r=0,e=0,o=t.children(),s=this._appliedWidthSubscription;o.forEach((function(n){var t=ko.unwrap(n.width);t&&(e++,r=r+t)}));u=r>100?1:n.width()?o[i].width():(100-r)/(t.children().length-e);s.get(n)||s.set(n,this.options.width.subscribe(this.ltm,(function(){f.element.attr("width",f._applyWidth(n,t,i))})))}return u?u+"%":""},t.prototype._getTelemetryName=function(n){var i=ko.unwrap(n.telemetryName),t;if(i)return i;if(t=ko.unwrap(n.name),k.isHtmlContent(t))t=t.htmlTemplate;else if(!v.looksLikeAnHtmlFragment(t))return t;return $($.parseHTML(t,vi)).text()},t.prototype._tabActivated=function(n,t,i){var r,u,f,e,o;if(this.weaveContext)throw new Error("_tabActivated shouldn't be called in Weave mode");(!n.disabled()||this._activeChangedByWidget)&&(r=this._tabActivateChildLifetime,r&&r.dispose(),r=this._tabActivateChildLifetime=this.ltm.createChildLifetime(),u=ko.unwrap(t.children),f=MsPortalFx.findIndex(u,(function(t){return t===n})),this._lastTabOpened?(e=new Date,o=e.getTime()-this._lastTabOpened.getTime(),this._lastTabOpened=e,yt.trace({action:"TabClosed",extension:this._extensionName,source:this._telemetrySource,duration:o,name:this._getTelemetryName(this._currentActiveTab),data:{index:MsPortalFx.findIndex(u,(function(n){return n&&n.active&&n.active()}))}})):this._lastTabOpened=new Date,n.active()?this.element.scrollTop(0):(this._activeChangedByWidget=!0,n.active(!0),this._activeChangedByWidget=!1),this._currentActiveTab=n,yt.trace({action:"TabOpened",extension:this._extensionName,source:this._telemetrySource,name:this._getTelemetryName(n),actionModifier:i,data:{index:f}}),t.children.map(r,(function(t,i){var r=i;r!==n&&r&&r.active(!1)})),n.tabHasBeenLoaded()||this._tabSelected(n),this._toggleMenu(!1),this.element.findByClassName("azc-br-active").is(":visible")||this._setTabOverflowContent(),this._focusedTab(f))},t.prototype._tabSelected=function(n){if(this.weaveContext)throw new Error("_tabSelected shouldn't be called in Weave mode");n.tabHasBeenLoaded(!0);var t=n.populateSection();typeof t=="function"?t().then(n.tabSection):n.tabSection(n)},t.prototype._toggleMenu=function(n){var f=this,t,i,r,u;if(this.weaveContext)throw new Error("_toggleMenu shouldn't be called in Weave mode");t=$(this.element.find("."+tt)[0]);typeof n!="boolean"&&(n=!t.hasClass(ii));t.toggleClass(ii,n).find("[role=button]").attr("aria-expanded",n);i=function(n){return!!$(n).parents(".fxc-tabs-menu-open").length&&0};r={dismissFn:function(){f._toggleMenu(!1)},shouldDismissOnFocusOutFn:i,shouldDismissOnMouseDownFn:i,shouldDismissOnMouseWheelFn:i,shouldDismissOnScroll:!1,logName:"tab menu"};n?($(t.findByClassName("fxc-section-tab-item")[0]).focus(),(!this._dismissHandleLifetime||this._dismissHandleLifetime.isDisposed())&&(o.dismissByLogName("tab menu"),o.register(r),u=this._dismissHandleLifetime=this.ltm.createChildLifetime(),u.registerForDispose((function(){o.unregister(r)})))):this._dismissHandleLifetime&&(this._dismissHandleLifetime.dispose(),this._dismissHandleLifetime=null)},t.prototype._panelUsedId=function(n,t){var i=t?this._tabBaseId:this._panelBaseId;return i+n},t.prototype._tabUsedId=function(n,t,i){var r=i?this._panelBaseId:this._tabBaseId,u=this.options.children().length;return t?r+(n+u):n<u?r+n:null},t.prototype._tabPosInSet=function(n){return n+1},t.prototype._verifyDynamicSection=function(n){return n&&n.controlType===15},t.prototype._verifyHtmlContent=function(n){return k.isHtmlContent(n)},t.prototype._focused=function(n,t){return n===this._focusedTab()&&!t?"0":"-1"},t.flightNewRender=!0,t})(h.Widget);t.Widget=vt;t.Section=b.createControlComponentForKO({widgetCtor:vt})}))