define("MsPortalImpl.Controls/Controls/Visualization/MonitorChartV2/AI/ME/Controls/AiTooltip",["require","exports","_oss/d3"],(function(n,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.AiTooltip=void 0;var r=(function(){function n(n){if(this._dynamicBody=!1,this._fullyOverridden=!1,this._overrideString="",this._landingOpacity=!n.opacity||n.opacity>1||n.opacity<0?"1":n.opacity.toString(),n.tooltipOverride){this._dynamicBody=!0;this._fullyOverridden=!0;this._overrideString=n.tooltipOverride;return}if(n.staticToolTipText){if(n.dynamicBody)throw new Error("Tooltip can not be both dynamic and static!");this._staticBody=n.staticToolTipText}n.dynamicBody&&(this._dynamicBody=n.dynamicBody);var t="body";n.htmlParentD3SelectPath&&(t=n.htmlParentD3SelectPath);this._init(t);this._resetToDefaultBody()}return n.prototype.ControlRequiresBody=function(){return!this._staticBody&&!this._dynamicBody},n.prototype.AddBody=function(n){if(this._fullyOverridden)throw new Error("AddBody not available for fully overridden tooltip");this._divBodyRoot.html(n)},n.prototype.ChangePosition=function(n,t,r){r&&this._fullyOverridden&&(this._divRoot=i.select(this._overrideString));var u=this._divRoot.style("left",n+10+"px").style("top",t+"px");r&&(this._resetToDefaultBody(),u.style("display","block").transition().style("opacity",this._landingOpacity))},n.prototype.Hide=function(){this._divRoot.transition().style("opacity","0").transition().duration(0).style("display","none")},n.prototype.Remove=function(){i.selectAll(".fxc-monitorchart-tooltip-root").remove()},n.prototype._init=function(n){if(!this._fullyOverridden){if(!n)throw new Error("A null appendTarget was given to the tooltip internals");i.selectAll(".fxc-monitorchart-tooltip-root").remove();this._divRoot=i.select(n).append("div").attr("class","fxc-monitorchart-tooltip-root");var t=this._divRoot.append("div").attr("class","fxc-monitorchart-tooltip-padding");t.append("div").attr("class","fxc-monitorchart-tooltip-chrome");this._divBodyRoot=t.append("div").attr("class","fxc-monitorchart-tooltip-body")}},n.prototype._resetToDefaultBody=function(){this._staticBody&&this.AddBody(this._staticBody)},n})();t.AiTooltip=r}));
define("MsPortalImpl.Controls/Controls/Visualization/MonitorChartV2/AI/ME/Controls/AiTimeSeriesChart",["require","exports","_oss/d3","MsPortalImpl.Controls/Controls/Visualization/MonitorChartV2/Strings","MsPortalImpl.Controls/Controls/Visualization/MonitorChartV2/AI/ME/Controls/AiTooltip","MsPortalImpl.Controls/Controls/Visualization/MonitorChartV2/Utils/LocaleFormatter","MsPortalImpl.Controls/Controls/Visualization/MonitorChartV2/AI/ME/Constants","MsPortalImpl.Controls/Controls/Visualization/MonitorChartV2/AI/ME/Telemetry","MsPortalImpl.Controls/Controls/Visualization/MonitorChartV2/AI/ME/Utilities/DateUtils","MsPortalImpl.Controls/Controls/Visualization/MonitorChartV2/AI/ME/Utilities/MetricsExplorerItemDataModelUtil","MsPortalImpl.Controls/Controls/Visualization/MonitorChartV2/AI/ME/Utilities/Util","MsPortalImpl.Controls/Controls/Visualization/MonitorChartV2/AI/ME/Utilities/UxUtil"],(function(n,t,i,r,u,f,e,o,s,h,c,l){"use strict";function d(n){return"A"+(n&&n.itemDataModelId||c.GUID())}function g(n){if(n)return"UTC";var r=(new Date).getTimezoneOffset(),u=Math.abs(r),t=Math.floor(u/60),i=Math.floor(u%60);return"UTC"+(r>0?"-":"+")+(t<10?"0"+t:t)+":"+(i<10?"0"+i:i)}function a(n,t){return[{data:n,index:t}]}function nt(n,t){return t===3?0:n}function tt(n,t){return t===3?.5:n}function b(n,t){return n+"-"+c.hashCode((t.metric||"")+(t.segment||""))}function v(n,t,i){return n+"-"+i.toString()+c.hashCode(t&&t.seriesMetadata?(t.seriesMetadata.resourceDisplayName?t.seriesMetadata.resourceDisplayName:"")+(t.seriesMetadata.displayName?t.seriesMetadata.displayName:""):"")}function w(n,t,i){var r=i?t?30:50:(t?100:112)+5;return Math.floor((i?n-40:n)/r)}function rt(n,t,i){var u=n.selectAll("rect.fxc-monitorchart-legend-bar").data((function(n,t){return a(v(i,n,t),t)}));return u.classed("fxc-monitorchart-legend-bar",!0).attr("height",t?25:45),u.enter().append("rect").classed("fxc-monitorchart-legend-bar",!0).attr({id:function(n){return"legend-rect-"+n.data},height:t?25:45,width:5,role:"button",name:r.colorPicker,title:r.colorPicker,"aria-label":r.colorPicker}),u.exit().remove(),u}function k(n){n&&!n.empty()&&n.remove()}function ut(n){var i=document.getElementById(n),t;return i?(t=i.getBoundingClientRect(),t.top<=(window.innerHeight||document.documentElement.clientHeight)&&t.left<=(window.innerWidth||document.documentElement.clientWidth)&&t.bottom>=0&&t.right>=0):!1}function ft(n,t){return t&&[1,2,0,11,5,].indexOf(t.userDataStatus)<0&&n!==2}function et(n){new MutationObserver(function(){document.getElementsByClassName("fxs-textspacing-helper")&&n()}).observe(document.body,{childList:!0})}var y,p,it;Object.defineProperty(t,"__esModule",{value:!0});t.AiTimeSeriesChart=t.generateUTCLabel=t.generateUniqueId=void 0;y=".fxc-monitorchart-brush";p=50;t.generateUniqueId=d;t.generateUTCLabel=g;it=(function(){function n(n,t,i,r,u,f,e){var h=this,s;this.keyset=[];this._hasLiveMetrics=!1;this._triggeredByBrush=!1;this._brushing=!1;this._transformedData=[];this._stackedDataset=[];this._isSegmented=!1;this._hasMissingValues=!1;this._pageNumber=1;this._totalPages=1;this.telemetryContext=t;this._aiChart=n;this._enableLegendInteractions=f;this._backendData=i;s=o.CreateOrAddOperation("AiTimeSeries.constructor",e,t);this._userDataStatusWithError=i?i.userDataStatusWithError||(!i.chartSeriesData||i.chartSeriesData.length===0)&&{userDataStatus:0}||{userDataStatus:1}:{userDataStatus:0};this._interactions=u||{};this._uniqueId=d(this.telemetryContext);this._keyboardSelectedSeriesIndex=-1;this._keyboardSelectedDataPointIndex=-1;this._isFocused=!1;this._watermark=l.CreateWaterMark(this._uniqueId,document.getElementById(this._aiChart.realm));et((function(){return h.createLegends()}));this.setVisualization(r,s.opTimer);s.opStop()}return n.prototype._onZoomHandler=function(n,t){if(this._interactions.OnZoom){var i={id:this._uniqueId,itemDataModelId:this.telemetryContext&&this.telemetryContext.itemDataModelId,chartType:this._visualOptions.chartType,isLive:this._hasLiveMetrics,xRange:{from:n,to:t}};this._interactions.OnZoom(i)}},n.prototype.getYAxisScale=function(){return this._yScaleStored},n.prototype.getXAxisScale=function(){return this._xScaleStored},n.prototype.getUniqueId=function(){return this._uniqueId},n.prototype.getVisualization=function(){return this._visualOptions},n.prototype.setVisualization=function(n,t){var i=o.CreateOrAddOperation("AiTimeSeriesChart.setVisualization",t,this.telemetryContext);this._visualOptions=n||c.cloneProperties(h.DefaultVisualizationOptions);this._refresh(9,i.opTimer);i.opStop()},n.prototype.navigateLegendPages=function(n){o.logCustomEvent("LegendPagination",this.telemetryContext,{PageUp:n});this._pageNumber=n?this._pageNumber<=1?this._totalPages:this._pageNumber-1:this._pageNumber>=this._totalPages?1:this._pageNumber+1;this.positionLegends(!0)},n.prototype.onLegendClick=function(n,t){if(t===void 0&&(t=!1),this._interactions.OnLegendClick){var i=this._transformedData[n],r=this._visualOptions.legend.hideSubtitle?100:112,u=this._visualOptions.legend.hideSubtitle?30:55,f=this._totalPages>1?25:0,e={id:this._uniqueId,itemDataModelId:this.telemetryContext&&this.telemetryContext.itemDataModelId,chartType:this._visualOptions.chartType,isLive:this._hasLiveMetrics,metricId:i&&i.metricId,aggregation:i&&i.aggregation,dimensionValue:this._isSegmented&&i?i.seriesMetadata.displayName:undefined,legendIndex:n,color:this._getSeriesColor(n),isKeyPress:t,xOffset:this._visualOptions.legend.position===4?0:25+n%w(this._chartWidth,this._visualOptions.legend.hideSubtitle)*r+f,yOffset:this._visualOptions.legend.position===2?0:5+n%w(this._chartHeight,this._visualOptions.legend.hideSubtitle,!0)*u};this._interactions.OnLegendClick(e)}},n.prototype.clearData=function(n,t,i){t===void 0&&(t=0);this.updateData({chartSeriesData:[],userDataStatusWithError:{userDataStatus:t}},n,i)},n.prototype.updateData=function(n,t,i,r){this._backendData=n;this._hasLiveMetrics?this._viewPortTimeRange=undefined:n.timeContext&&(this._viewPortTimeRange=n.timeContext.getTimerange());t===1&&(this._pageNumber=1);this._userDataStatusWithError=n.userDataStatusWithError;i&&(this._visualOptions=i);this._refresh(t,r)},n.prototype.changeToolTipBody=function(n){this._tooltip&&this._tooltip.AddBody(n)},n.prototype.hideToolTip=function(){this._tooltip&&this._tooltip.Hide()},n.prototype.removeToolTip=function(){this._tooltip&&(this._tooltip.Remove(),this._tooltip=null)},n.prototype.hideWatermark=function(){this._watermark.hide()},n.prototype._refresh=function(n,t){var e=o.CreateOrAddOperation("AiTimeSeriesChart._refresh",t,this.telemetryContext),i,f,s;this._chartWidth=this._aiChart.getActualWidth();this._chartHeight=this._aiChart.getActualHeight();this._transformedData=[];this.keyset=[];this._stackedDataset=[];this._isSegmented=!1;this._backendData&&this._backendData.chartSeriesData&&this.parseData(this._backendData.chartSeriesData,e.opTimer);i=ft(n,this._userDataStatusWithError);this._createAxes(i);this.createLegends();f=this._aiChart.svgElement.select("rect.fxc-monitorchart-clipPath-"+this._uniqueId);f.empty()||f.attr({x:p,y:7,width:Math.abs(this._chartWidth-5-p),height:this._chartHeight-30});k(this._aiChart.svgElement.selectAll(".fxc-monitorchart-bargroup"));k(this._aiChart.svgElement.selectAll(".fxc-monitorchart-scattergroup"));k(this._aiChart.svgElement.selectAll(".fxc-monitorchart-timeSeriesPoints"));this._chartHeight>0&&this._chartWidth>0&&(this._visualOptions.chartType===1?this._drawBars():this._visualOptions.chartType===7?this._drawPoints():this._drawLines(),i?(s=l.getErrorMessage(this._userDataStatusWithError,r.errorRetrievingDataMessage),this._watermark.show(s)):this.hideWatermark());!this._tooltip&&this._visualOptions.toolTip&&(this._tooltip=this._visualOptions.toolTip.enabled?new u.AiTooltip(this._visualOptions.toolTip):undefined);e.opStop()},n.prototype._mouseMoveHandler=function(n){var r=this,t=i.event,e=t&&t.target?i.mouse(t.target)[0]:0,o=t&&t.target?i.mouse(t.target)[1]:0,u,f;this._drawTempTicksAndGuideline(e,!this._hasLiveMetrics,o);this._tooltip&&(this._interactions.OnToolTipWillShowPoint&&this._interactions.OnToolTipWillShowPoint(this._selectedDataPoint),u=t&&t.pageX||0,f=t&&t.pageY||0,this._tooltip.ChangePosition(u,f,n));i.timer((function(){return!r._brushing&&r._interactions.OnHover&&r._interactions.OnHover(r._selectedDataPoint),!0}),50)},n.prototype._mouseOutHandler=function(){var n=this,t;this.hoverOut();t={id:this._uniqueId,itemDataModelId:this.telemetryContext&&this.telemetryContext.itemDataModelId,chartType:this._visualOptions.chartType,isLive:this._hasLiveMetrics};this.unfocusSeries();this._tooltip&&this._tooltip.Hide();i.timer.flush();i.timer((function(){return n._interactions.OnLeave&&n._interactions.OnLeave(t),!0}),100)},n.prototype._createClickCaptureRectangle=function(n){var t=this,r=n.select("rect.fxc-monitorchart-click-capture");if(r.empty())n.append("rect").classed({"fxc-monitorchart-graphContainerRect":!0,"fxc-monitorchart-click-capture":!0}).style("visibility","hidden").attr({"pointer-events":"all",x:p,y:15,width:Math.abs(this._chartWidth-5-p),height:Math.abs(this._chartHeight-25)}).on("mouseover",(function(){t._mouseMoveHandler(!0)})).on("mouseenter",(function(){t._mouseMoveHandler(!0)})).on("mousemove",(function(){t._mouseMoveHandler(!1)})).on("mouseout",(function(){t._mouseOutHandler()})).on("mouseleave",(function(){t._mouseOutHandler()})).on("mousedown",(function(){var r,u;t._visualOptions.timeBrushEnable&&(r=n.select(y).node(),event.stopImmediatePropagation(),u=new MouseEvent("mousedown",{clientX:i.event.clientX,clientY:i.event.clientY}),r&&r.dispatchEvent(u))})).on("click",(function(){t._triggeredByBrush&&(event.stopImmediatePropagation(),t._triggeredByBrush=!1)}));else r.attr({x:p,y:15,width:Math.abs(this._chartWidth-5-p),height:Math.abs(this._chartHeight-25)})},n.prototype._createTimeBrush=function(n){var t=this,r,u;this._visualOptions.timeBrushEnable&&!this._hasLiveMetrics?(this._brush=i.svg.brush().x(this._xScale()).on("brush",(function(){t._brushing=!0;t._triggeredByBrush=!0})).on("brushend",(function(){if(t._brushing=!1,t._brush.empty())t._triggeredByBrush=!1;else{var r=t._brush.extent()[0],u=t._brush.extent()[1];t._triggeredByBrush=!0;Math.abs(r.getTime()-u.getTime())>12e4&&(t._backendData.chartSeriesData=t.filterDataset(r,u),t._refresh(10),t._onZoomHandler(r,u))}i.timer((function(){return n.select(y).call(t._brush.clear()),!0}),50)})).extent([0,0]),r=void 0,n.select(y).empty()?r=n.append("g").attr({"class":"fxc-monitorchart-brush","pointer-events":"none"}).call(this._brush):(r=n.select(y),r.call(this._brush)),r.selectAll("rect.background").attr({height:this._chartHeight-25,width:this._chartWidth-5,"pointer-events":"none"}),r.selectAll("rect.extent").attr({height:this._chartHeight-25,width:this._chartWidth-5,"pointer-events":"none"}).style("fill-opacity",.1).style("fill","#00c1f6"),r.selectAll(".resize").style("display","inherit"),r.selectAll(".resize").select("line").empty()?r.selectAll(".resize").append("line").attr({x1:.5,x2:.5,y1:0,y2:this._chartHeight-25,"shape-rendering":"crispEdges"}).style("stroke","#015cda").style("stroke-dasharray",4):r.selectAll(".resize").select("line").attr({x1:.5,x2:.5,y1:0,y2:this._chartHeight-25,"shape-rendering":"crispEdges"}).style("stroke","#015cda").style("stroke-dasharray",4),this._brush.clear()):(u=n.select(y),u&&!u.empty()&&u.remove())},n.prototype.filterDataset=function(n,t){var f=i.bisector((function(n){return n})).left,r=this.keyset[f(this.keyset,n,1)],u=this.keyset[f(this.keyset,t,1,this.keyset.length-1)],e;return this._backendData.timeContext&&(e={absolute:{startTime:r,endTime:u},options:this._backendData.timeContext.toTimeContextOptionData()},this._backendData.timeContext.update(e),this._viewPortTimeRange=this._backendData.timeContext.getTimerange()),this._backendData.chartSeriesData.map((function(n){return n.metricResults&&(Array.isArray(n.metricResults.data)&&(n.metricResults.data=n.metricResults.data.map((function(n){return{dataPoints:n.dataPoints.filter((function(n){return n.timestamp.getTime()>=r.getTime()&&n.timestamp.getTime()<=u.getTime()})),summary:n.summary,segment:n.segment}}))),n.metricResults.startTime=r,n.metricResults.endTime=u,n.metricResults.timeRangeExtended=undefined),n}))},n.prototype._drawTempTicksAndGuideline=function(n,t,u){var l=this,v=this._xScaleStored,a=v.invert(n),s=!1,h,e,o,c,f;this._viewPortTimeRange&&this._viewPortTimeRange.startTime&&this._viewPortTimeRange.endTime&&(h=a.getTime(),(h>this._viewPortTimeRange.endTime.getTime()||h<this._viewPortTimeRange.startTime.getTime())&&(s=!0));this._aiChart.svgElement.select("line.fxc-monitorchart-guideline."+this._uniqueId).attr({x1:n,x2:n,y1:15,y2:this._chartHeight-25}).style("display",s||this._brushing?"none":"flex");i.timer((function(){return l._fadeTicksNearPosition(n),!0}),50);this._selectedDataPoint={x:a,metricId:undefined,dimensionValue:undefined,chartType:this._visualOptions.chartType,isLive:this._hasLiveMetrics,id:this._uniqueId,itemDataModelId:this.telemetryContext&&this.telemetryContext.itemDataModelId,stackedDataIndex:undefined,stackedDataColumn:[]};e=!1;!e&&t&&(this._selectClosestItemOnChart(n,s),e=!0,setTimeout((function(){e=!1}),300));u&&(o=Number.MAX_VALUE,c=-1,this._selectedDataPoint.stackedDataColumn.forEach((function(n,t){var i=l._yScaleStored(n&&n.y?n.y+n.y0:0);Math.abs(u-i)<o&&(o=Math.abs(u-i),c=t)})),o<=10?this.focusSeries(c):this.unfocusSeries());this._tooltip&&this._tooltip.ControlRequiresBody()&&(f=[],this._selectedDataPoint.stackedDataColumn.forEach((function(n){var t=n&&n.y?n.y:0;f.push(t.toFixed(2).toString())})),f.length<1&&f.push(r.noDataForMetric),this._tooltip.AddBody("<span>"+f.join(", ")+"<\/span>"))},n.prototype.hoverOn=function(n,t){ut(this._aiChart.realm)&&this._drawTempTicksAndGuideline(this._xScale()(n),t)},n.prototype.getTimeRange=function(){return this._viewPortTimeRange},n.prototype._selectClosestItemOnChart=function(n,t){var h=this;if(this._stackedDataset&&this._stackedDataset.length>0){var e=this._xScaleStored.invert(n),c=i.bisector((function(n){return n})).left,r=c(this.keyset,e,1),s=this._stackedDataset.filter((function(n){return n&&n[r-1]?!0:!1})),u=s&&s[0];if(u&&u[r-1]){var l=u[r-1].x,a=r<u.length?u[r].x:new Date(864e13),o=Math.abs(e.getTime()-l.getTime())>Math.abs(a.getTime()-e.getTime())?u[r]:u[r-1];this._selectedDataPoint.stackedDataIndex=o;this._getStackedDataByIndex();this._selectItemOnChart(o);this._aiChart.svgElement.select("text.fxc-monitorchart-temp-tick."+this._uniqueId).text((function(){return f.formatTickTime(o.x,h._visualOptions.axis.x.axisType===3)})).attr({x:n,y:this._chartHeight-5}).style("display",t?"none":"flex")}}},n.prototype._getStackedDataByIndex=function(){var n=this;this._selectedDataPoint&&this._selectedDataPoint.stackedDataIndex&&this._stackedDataset.forEach((function(t){var i=t.filter((function(t){return t?t.x.getTime()===n._selectedDataPoint.stackedDataIndex.x.getTime():!1}))[0];n._selectedDataPoint.stackedDataColumn.push(i)}))},n.prototype.hoverOut=function(){var n=this,r=this._aiChart.svgElement,e=this._aiChart.legendElement.selectAll(".fxc-monitorchart-legend"),t,u,f;i.selectAll("rect.fxc-monitorchart-bars").classed("fxc-monitorchart-translucent",!1);t=e.selectAll(".fxc-monitorchart-value").data((function(t,i){return a(v(n._uniqueId,t,i),i)}));u=[];t.text((function(t){var i=n._transformedData[t.index]&&n._transformedData[t.index].summary;return n._processUnit(i,t.index,u)}));t.enter().append("text").classed("fxc-monitorchart-value",!0).attr("id",(function(n){return"legend-value-"+n.data})).text((function(t){var i=n._transformedData[t.index]&&n._transformedData[t.index].summary;return n._processUnit(i,t.index,u)}));t.exit().remove();f=t.selectAll(".fxc-monitorchart-units").data((function(n,t){return a(u[t],t)}));f.text((function(n){return n.data}));f.enter().append("tspan").classed("fxc-monitorchart-units",!0).attr("id",(function(t){return"legend-units-"+v(n._uniqueId,n._transformedData[t.index],t.index)})).text((function(n){return" "+n.data}));f.exit().remove();r.selectAll(".fxc-monitorchart-guideline").attr({x1:this._chartWidth+5,x2:this._chartWidth+5}).style("display","none");r.selectAll(".fxc-monitorchart-temp-tick").attr("x",this._chartWidth+5+20).style("display","none");i.timer((function(){return r.selectAll("g.fxc-monitorchart-tick").select("text").attr("opacity",1),!0}),51);r.selectAll("circle.fxc-monitorchart-marker").style("display","none")},n.prototype._selectItemOnChart=function(n){n&&(this._visualOptions.chartType===1?this._selectItemOnBarChart(n):this._selectItemOnLineChart(n))},n.prototype._selectItemOnBarChart=function(n){return i.select("#graphContainer-"+this._uniqueId).selectAll("rect.fxc-monitorchart-bars").classed("fxc-monitorchart-translucent",!0),i.select("#graphContainer-"+this._uniqueId).selectAll("rect.fxc-monitorchart-bars").filter((function(t){return t.x.getTime()===n.x.getTime()})).classed("fxc-monitorchart-translucent",!1),this.updateLegendsOnHover(n),this._xScale()(n.x)+5},n.prototype._selectItemOnLineChart=function(n){var i=this,t=this._xScaleStored(n.x),r=this._yScaleStored;return this._aiChart.svgElement.selectAll("circle.fxc-monitorchart-marker."+this._uniqueId).data(this._stackedDataset.map((function(t){return t.filter((function(t){return t?t.x.getTime()===n.x.getTime():!1}))[0]}))).classed("missing",(function(n){return n&&n.missingValue})).style("fill",(function(n,t){return n&&n.missingValue?"":i._getSeriesColor(t)})).style({display:"inherit","stroke-opacity":"1"}).attr({cx:t,cy:function(n){return n?r(n.y+n.y0):0}}),this.updateLegendsOnHover(n),t},n.prototype._fadeTicksNearPosition=function(n){var t=this,i=this._xScale(),r;this._aiChart.svgElement.selectAll("g.fxc-monitorchart-tick").filter((function(r){return Math.abs(n-i(r))<t._chartWidth/8})).select("text").attr("opacity",(function(r){return.8*Math.abs(n-i(r))/(t._chartWidth/8)}));this._aiChart.svgElement.selectAll("g.fxc-monitorchart-tick").filter((function(r){return Math.abs(n-i(r))>=t._chartWidth/8})).select("text").attr("opacity",1);r=this._aiChart.svgElement.selectAll("text.x.fxc-monitorchart-utc-label");r.filter((function(){return Math.abs(n-t._chartWidth)<t._chartWidth/8})).attr("opacity",(function(){return.8*Math.abs(n-t._chartWidth)/(t._chartWidth/8)}));r.filter((function(){return Math.abs(n-t._chartWidth)>=t._chartWidth/8})).attr("opacity",1)},n.prototype.updateLegendsOnHover=function(n){var t=this,f=this._stackedDataset.map((function(t){return t.filter((function(t){return t.x.getTime()===n.x.getTime()}))[0]})).map((function(n,t){return{data:n,index:t}})),r=[],u=this._aiChart.legendElement.selectAll(".fxc-monitorchart-value").data(f),i;u.text((function(n){return t._processUnit(n.data&&!n.data.missingValue&&n.data.y,n.index,r)}));i=u.selectAll(".fxc-monitorchart-units").data((function(n,t){return a(r[t],t)}));i.text((function(n){return n.data}));i.enter().append("tspan").classed("fxc-monitorchart-units",!0).attr({id:function(n){return"legend-units-"+v(t._uniqueId,t._transformedData[n.index],n.index)},"aria-hidden":!0}).text((function(n){return" "+n.data}))},n.prototype.parseData=function(n,t){var ht=this,et,tt,k,v,d,a,g,r,u,ut,f,ot,ft,b,st;if(n&&!(n.length<1)){for(et=o.CreateOrAddOperation("AiTimeSeriesChart.parseData",t,this.telemetryContext),this._hasLiveMetrics=!!n[0]&&!!n[0].metricResults&&h.isLiveMetric(n[0].metricResults.metricId),tt=this._visualOptions&&(this._visualOptions.chartType===3||this._visualOptions.chartType===1),this._hasMissingValues=!1,v=[],d=0,g=0;g<n.length;g++)if(r=n[g],r){var e=r.visualization,nt=r.metricResults&&r.metricResults.aggregation||1,ct=e.missingDataFillType=this._visualOptions.chartType!==7&&this._visualOptions.chartType!==1&&nt!==7&&nt!==5&&nt!==1&&nt!==8?2:1;if(r.metricResults&&r.metricResults.data&&(r.metricResults.timeRangeExtended&&r.metricResults.timeRangeExtended.startTime&&r.metricResults.timeRangeExtended.endTime||r.metricResults.startTime&&r.metricResults.endTime)&&Array.isArray(r.metricResults.data)){k=s.convertISODurationToMilliseconds(r.metricResults.timeGrain);var it=void 0,rt=void 0,y=r.metricResults.timeRangeExtended;if(y&&y.startTime&&y.endTime?(it=y.startTime,rt=y.endTime):(it=r.metricResults.startTime,rt=r.metricResults.endTime),this.keyset=i.range(it.getTime()+k/2,rt.getTime()+k/2,k).map((function(n){return new Date(n)})),a=this.keyset,u=r.metricResults.data,ut=l.transformMetricResultForD3(a,u,e,ct,this._hasLiveMetrics,tt),this._hasMissingValues=this._hasMissingValues||u.some((function(n){return a.length>n.dataPoints.length})),this._isSegmented=!!(u&&u[0]&&u[0].segment&&u[0].segment[0]),u.length>0)for(f=0;f<u.length;f++){var p=ut.transformedMetricResult[f],lt=u[f].summary,w=null;if(this._isSegmented&&u[f].segment&&u[f].segment[0]&&(ot=u[f].segment[0].displayName||u[f].segment[0].value,w=c.cloneProperties(e),w.displayName=ot),ft=[],p&&p[0])for(b=0;b<p.length;b++)ft.push([new Date(p[b].timestamp.getTime()),p[b].value,w?w.displayName:r.metricResults.metricId]);st={seriesPoints:ft,summary:lt,seriesMetadata:w||e,metricId:r.metricResults.metricId,aggregation:r.metricResults.aggregation};this._transformedData.push(st);this._stackedDataset.push(ut.d3StackDataSet[f]);d++}else this._addEmptyDataSet(e,r.metricResults.metricId,r.metricResults.aggregation),v.push({index:d++,data:e})}else this._addEmptyDataSet(e,r.metricResults&&r.metricResults.metricId,r.metricResults&&r.metricResults.aggregation),v.push({index:d++,data:e})}v.length>0&&a&&a.length>0&&v.forEach((function(n){ht._stackedDataset[n.index]=l.createEmptyD3StackDataPoints(a,n.data).d3DataPoints}));tt&&(this._stackedDataset=this._stackedDataset&&this._stackedDataset.length>0?i.layout.stack()(this._stackedDataset):[]);et.opStop()}},n.prototype._addEmptyDataSet=function(n,t,i){this._transformedData.push({seriesPoints:[],summary:undefined,seriesMetadata:n,metricId:t,aggregation:i});this._stackedDataset.push([])},n.prototype._getSeriesColor=function(n){var t=this._transformedData[n]&&this._transformedData[n].seriesMetadata,i,r;return t?(this._isSegmented?(r=this._visualOptions.colorMap,i=r&&r[t.displayName]):i=t.color,i||null):null},n.prototype.getLegendDisplayName=function(n,t){var i=this._transformedData[n]&&this._transformedData[n].seriesMetadata;return t?(this._isSegmented&&(i=this._transformedData[0]&&this._transformedData[0].seriesMetadata),i?i.resourceDisplayName:""):i?i.displayName:""},n.prototype._getLegendUnits=function(n){return this._transformedData[n]&&this._transformedData[n].seriesMetadata&&this._transformedData[n].seriesMetadata.unit||1},n.prototype._createLegendText=function(n,t){var i=this,r;n.selectAll(".fxc-display").text((function(n){return i._transformLegendDisplayName(i.getLegendDisplayName(n.index,t))}));n.selectAll("title").text((function(n){return i.getLegendDisplayName(n.index,t)}));n.selectAll(".fxc-full").text((function(n){return i.getLegendDisplayName(n.index,t)}));r=n.enter().append("text").classed(t?"fxc-monitorchart-resource":"fxc-monitorchart-metric",!0).attr({id:function(n){return(t?"legend-resource-":"legend-metric-")+n.data},"aria-hidden":!0});r.append("tspan").classed("fxc-display",!0).text((function(n){return i._transformLegendDisplayName(i.getLegendDisplayName(n.index,t))}));r.append("svg:title").text((function(n){return i.getLegendDisplayName(n.index,t)}));r.append("tspan").classed("fxc-full",!0).text((function(n){return i.getLegendDisplayName(n.index,t)}));n.exit().remove()},n.prototype.createLegends=function(){var n=this,t=this._aiChart.legendElement.selectAll(".fxc-monitorchart-legendsContainer"),r=this._uniqueId,o,i,h,s,u,f,e;if(!this._visualOptions.legend.isVisible){t.attr("display","none");return}o=this._visualOptions.legend.hideSubtitle;t.empty()&&this._aiChart.legendElement.append("g").classed("fxc-monitorchart-legendsContainer",!0);t=this._aiChart.legendElement.selectAll(".fxc-monitorchart-legendsContainer");t.attr("display","inherit");i=t.selectAll(".fxc-monitorchart-legend").data(this._transformedData);i.classed("fxc-monitorchart-legend",!0);i.classed("fxc-clrgrp",!0);i.enter().append("g").classed("fxc-monitorchart-legend",!0).classed("fxc-clrgrp",!0).attr({id:function(n,t){return"legend-container-"+v(r,n,t)},"aria-labelledby":function(n,t){var i=v(r,n,t);return"legend-metric-"+i+" legend-resource-"+i+" legend-value-"+i+" legend-units-"+i},role:"group"}).on("mouseover",(function(i,r){n._brushing||(n._visualOptions.chartType===1?(n._aiChart.svgElement.selectAll(".fxc-monitorchart-bargroup").classed("notSelected",(function(n,t){return r!==t})),n._aiChart.svgElement.selectAll(".fxc-monitorchart-bargroup").classed("Selected",(function(n,t){return r===t}))):n._visualOptions.chartType===7?(n._aiChart.svgElement.selectAll(".fxc-monitorchart-scattergroup").classed("notSelected",(function(n,t){return r!==t})),n._aiChart.svgElement.selectAll(".fxc-monitorchart-scattergroup").classed("Selected",(function(n,t){return r===t})),n._aiChart.svgElement.selectAll("circle.fxc-monitorchart-timeSeriesPoints-dot").attr("r",3.5),n._aiChart.svgElement.selectAll(".fxc-monitorchart-scattergroup").filter((function(n,t){return r===t})).selectAll("circle.fxc-monitorchart-timeSeriesPoints-dot").attr("r",4.5)):(n._visualOptions.chartType===3||n._visualOptions.chartType===2)&&(n._aiChart.svgElement.selectAll(".fxc-monitorchart-lineContainer").classed("notSelected",(function(n,t){return r!==t})),n._aiChart.svgElement.selectAll(".fxc-monitorchart-lineContainer").classed("Selected",(function(n,t){return r===t}))),t.selectAll(".fxc-monitorchart-legend").classed("notSelected",(function(n,t){return r!==t})),t.selectAll(".fxc-monitorchart-legend").classed("Selected",(function(n,t){return r===t})))})).on("mouseout",(function(){n._brushing||(n._visualOptions.chartType===1?(n._aiChart.svgElement.selectAll(".fxc-monitorchart-bargroup").classed("notSelected",(function(t,i){return n._isFocused&&i!==n._keyboardSelectedSeriesIndex})),n._aiChart.svgElement.selectAll(".fxc-monitorchart-bargroup").classed("Selected",(function(t,i){return n._isFocused&&i===n._keyboardSelectedSeriesIndex}))):n._visualOptions.chartType===7?(n._aiChart.svgElement.selectAll(".fxc-monitorchart-scattergroup").classed("notSelected",(function(t,i){return n._isFocused&&i!==n._keyboardSelectedSeriesIndex})),n._aiChart.svgElement.selectAll(".fxc-monitorchart-scattergroup").classed("Selected",(function(t,i){return n._isFocused&&i===n._keyboardSelectedSeriesIndex})),n._aiChart.svgElement.selectAll("circle.fxc-monitorchart-timeSeriesPoints-dot").attr("r",3.5),n._aiChart.svgElement.selectAll(".fxc-monitorchart-scattergroup").filter((function(t,i){return n._keyboardSelectedSeriesIndex===i})).selectAll("circle.fxc-monitorchart-timeSeriesPoints-dot").attr("r",4.5)):(n._visualOptions.chartType===3||n._visualOptions.chartType===2)&&(n._aiChart.svgElement.selectAll(".fxc-monitorchart-lineContainer").classed("notSelected",(function(t,i){return n._isFocused&&i!==n._keyboardSelectedSeriesIndex})),n._aiChart.svgElement.selectAll(".fxc-monitorchart-lineContainer").classed("Selected",(function(t,i){return n._isFocused&&i===n._keyboardSelectedSeriesIndex}))),t.selectAll(".fxc-monitorchart-legend").classed("notSelected",(function(t,i){return n._isFocused&&i!==n._keyboardSelectedSeriesIndex})),t.selectAll(".fxc-monitorchart-legend").classed("Selected",(function(t,i){return n._isFocused&&i===n._keyboardSelectedSeriesIndex})))}));i.exit().remove();rt(i,o,r);h=i.selectAll(".fxc-monitorchart-metric").data((function(n,t){return a(v(r,n,t),t)}));this._createLegendText(h,!1);s=i.selectAll(".fxc-monitorchart-resource").data((function(n,t){return a(v(r,n,t),t)}));o?s.remove():this._createLegendText(s,!0);u=i.selectAll(".fxc-monitorchart-value").data((function(n,t){return a(n,t)}));f=[];u.text((function(t){return n._processUnit(t.data&&t.data.summary,t.index,f)}));u.enter().append("text").classed("fxc-monitorchart-value",!0).attr({id:function(n){return"legend-value-"+v(r,n.data,n.index)},"aria-hidden":!0}).text((function(t){return n._processUnit(t.data&&t.data.summary,t.index,f)}));u.exit().remove();e=u.selectAll(".fxc-monitorchart-units").data((function(n,t){return a(f[t],t)}));e.text((function(n){return n.data}));e.enter().append("tspan").classed("fxc-monitorchart-units",!0).attr({id:function(t){return"legend-units-"+v(r,n._transformedData[t.index],t.index)},"aria-hidden":!0}).text((function(n){return" "+n.data}));e.exit().remove();this.positionLegends()},n.prototype.positionLegends=function(n){var u=this,t=11,d=3,b,e=10,it=20,r=this._visualOptions.legend.hideSubtitle,h=this._visualOptions.legend.position===4,g=h?r?100-it:112-it:23,c=this._aiChart.legendElement.selectAll(".fxc-monitorchart-legendsContainer"),k=w(h?this._chartHeight:this._chartWidth,r,h),ft=c.selectAll(".fxc-monitorchart-legend"),f,tt,rt,o,ut,s;if(this._totalPages=Math.ceil(this._transformedData.length/k),(!this._pageNumber||this._pageNumber>this._totalPages)&&(this._pageNumber=1),ft.style("display",(function(n,t){return t<u._pageNumber*k&&t>=(u._pageNumber-1)*k?"inherit":"none"})),f=this._aiChart.legendElement.select(".fxc-monitorchart-pages"),this._totalPages>1&&k>0){var nt=this._aiChart.legendElement.select(".fxc-page"),l=this._aiChart.legendElement.select(".fxc-monitorchart-nav.up"),a=this._aiChart.legendElement.select(".fxc-monitorchart-nav.down");if(f.empty()){f=this._aiChart.legendElement.append("g").classed("fxc-monitorchart-pages",!0);tt={points:"-8,20, 20,20, 20,-8, -8, -8",opacity:0};l=f.append("g");l.append("path").attr("d","M10 8.1l-0.7 0.8L5.9 4.7 1.7 8.9l-0.7 -0.8 5 -5z ");l.append("polygon").attr(tt);l.on("click",(function(){event.stopImmediatePropagation();u.navigateLegendPages(!0)}));a=f.append("g");a.append("path").attr("d","M11 3.9l-.7-.8L6 7.4 1.7 3.1l-.7.8 5 5z");a.append("polygon").attr(tt);a.on("click",(function(){event.stopImmediatePropagation();u.navigateLegendPages()}));nt=f.append("text").text(this._pageNumber.toString()+"/"+this._totalPages.toString())}rt=r&&!h?20:40;l.attr({"class":"fxc-monitorchart-nav up",transform:"translate("+g+",5)"});a.attr({"class":"fxc-monitorchart-nav down",transform:"translate("+g+","+rt+")"});nt.text(this._pageNumber.toString()+"/"+this._totalPages.toString());nt.attr({"class":"fxc-page",transform:"translate("+(g+5).toString()+",32)",display:r&&!h?"none":"inherit"});b=25}else f.remove(),b=0;o=c.selectAll("rect.fxc-monitorchart-legend-bar");o.attr("class",(function(n){return"fxc-monitorchart-legend-bar msportalfx-chart-color-"+n.index%40})).style("fill",(function(n){return u._getSeriesColor(n.index)})).style("stroke",(function(n){return u._getSeriesColor(n.index)}));this._enableLegendInteractions&&o.on("click",(function(n){u.onLegendClick(n.index)})).on("keypress",(function(n){if(i.event.keyCode===32||i.event.keyCode===13)u.onLegendClick(n.index,!0)})).attr({cursor:"pointer",tabindex:"0",focusable:"true"});var v=c.selectAll(".fxc-monitorchart-metric"),y=c.selectAll(".fxc-monitorchart-resource"),p=c.selectAll(".fxc-monitorchart-value");switch(this._visualOptions.legend.position){case 4:o.attr({x:0,y:this._getD3LegendYValueDef(0)});v.attr({x:e,y:this._getD3LegendYValueDef(t)});v.selectAll(".fxc-full").attr("x",e).attr("y",this._getD3LegendYValueDef(t));r||(y.attr({x:e,y:this._getD3LegendYValueDef(t*2)}),y.selectAll(".fxc-full").attr("x",e).attr("y",this._getD3LegendYValueDef(t*2)));p.attr({x:e,y:r?this._getD3LegendYValueDef(t*2+d):this._getD3LegendYValueDef(t*4)});break;case 2:default:ut=this._getXValueDefForBottomLegend(b);s=this._getXValueDefForBottomLegend(e+b);o.attr({x:ut,y:n?-45:0});n&&o.transition().attr("y",0);v.selectAll(".fxc-full").attr("x",s).attr("y",t);v.attr({x:s,y:n?t-45:t});n&&v.transition().attr("y",t);r||(y.attr({x:s,y:n?t*2-45:t*2}),n&&y.transition().attr("y",t*2),y.selectAll(".fxc-full").attr("x",s).attr("y",t*2));p.attr({x:s,y:n?t-45:r?t*2+d:t*4});n&&p.transition().attr("y",(function(){return r?t*2+d:t*4}))}r?p.style("font-size","14px"):p.style("font-size","20px")},n.prototype._configureLegend=function(n,t){var i=!!(this._transformedData&&this._transformedData[t]&&this._transformedData[t].seriesMetadata&&this._transformedData[t].seriesMetadata.displaySIUnit),r=!!(this._transformedData&&this._transformedData[t]&&this._transformedData[t].seriesMetadata&&this._transformedData[t].seriesMetadata.useSIConversions),u=this._visualOptions.legend.maximumDecimalDigits;return l.GetFormattedValue(n,this._getLegendUnits(t),i,r,u)},n.prototype._createAxes=function(n){var k=this,h,v,u,e,o,a,s;if(this._xScaleStored=this._xScale(),this._yScaleStored=this._yScale(),h=this._xScale(),v=this._yScale(),this._visualOptions.axis.x.isVisible){var c=this._visualOptions.axis.x.axisType===3,y=i.svg.axis().outerTickSize(0).tickFormat((function(n){return f.formatAxisTime(n,c)})).scale(h).orient("bottom").ticks(4),p=this._aiChart.svgElement.select("g.x.fxc-monitorchart-axis"),d=this._aiChart.svgElement.select("text.x.fxc-monitorchart-utc-label"),w=g(c),l=c?0:25;p.empty()?(this._aiChart.svgElement.append("g").attr({"class":"x fxc-monitorchart-axis","pointer-events":"none",transform:"translate(0,"+Math.abs(this._chartHeight-25)+")"}).call(y),this._aiChart.svgElement.append("text").attr({"class":"x fxc-monitorchart-utc-label","pointer-events":"none",transform:"translate("+Math.abs(this._chartWidth-l)+","+Math.abs(this._chartHeight-9)+")"}).text(w)):(p.attr("transform","translate(0,"+Math.abs(this._chartHeight-25)+")").call(y),d.attr("transform","translate("+Math.abs(this._chartWidth-l)+","+Math.abs(this._chartHeight-9)+")").text(w));u=this._aiChart.svgElement.select(".x.fxc-monitorchart-axis");u.selectAll("g.tick").classed("fxc-monitorchart-tick",!0);u.selectAll("g.tick text").classed("fxc-monitorchart-tick-text",!0).attr("aria-hidden",!0);u.selectAll("g.tick line").classed("fxc-monitorchart-tick-line",!0);u.selectAll("path").classed("fxc-monitorchart-tick-path",!0);u.selectAll("g.fxc-monitorchart-tick").filter((function(n){return Math.abs(k._chartWidth-h(n))<l+10})).attr("display","none");this._aiChart.svgElement.selectAll("g.x.fxc-monitorchart-axis").attr("display","inherit")}else this._aiChart.svgElement.selectAll("g.x.fxc-monitorchart-axis").attr("display","none");if(this._visualOptions.axis.y.isVisible){var t=i.svg.axis().scale(v).orient("left").innerTickSize(5-this._chartWidth).outerTickSize(-5),nt=this._chartHeight,b=Math.floor(nt/30);b<10&&t.ticks(b);e=!!(this._transformedData&&this._transformedData[0]&&this._transformedData[0].seriesMetadata&&this._transformedData[0].seriesMetadata.displaySIUnit);o=!!(this._transformedData&&this._transformedData[0]&&this._transformedData[0].seriesMetadata&&this._transformedData[0].seriesMetadata.useSIConversions);switch(this._getLegendUnits(0)){case 6:t.tickFormat((function(n){var t=f.formatTime(n,1e3,!0);return t.value+t.unit}));break;case 7:t.tickFormat((function(n){var t=f.formatTime(n,1,!0);return t.value+t.unit}));break;case 5:t.tickFormat((function(n){return n+"%"}));break;case 2:t.tickFormat((function(n){var t=f.formatData(n,o,e);return t.value+t.unit}));break;case 8:t.tickFormat((function(n){var t=f.formatData(n,o,e);return t.value+t.unit+r.TimeUnitsDisplay[1e3]}));break;case 9:t.tickFormat((function(n){var t=f.formatData(n,o,e,!0);return t.value+t.unit+r.perSecond}));break;case 4:t.tickFormat((function(n){var t=f.formatData(n,o,e);return t.value+t.unit+r.perSecond}));break;case 3:t.tickFormat((function(n){var t=f.formatCounts(n);return t.value+t.unit+r.perSecond}));break;case 10:t.tickFormat((function(n){var t=f.formatCores(n,!0);return t.value+t.unit}));break;case 11:t.tickFormat((function(n){var t=f.formatCores(n*.001,!0);return t.value+t.unit}));break;case 12:t.tickFormat((function(n){var t=f.formatCores(n*.001*.001*.001,!0);return t.value+t.unit}));break;case 1:default:t.tickFormat((function(n){var t=f.formatCounts(n);return t.value+t.unit}))}a=this._aiChart.svgElement.select("g.y.fxc-monitorchart-axis");a.empty()?this._aiChart.svgElement.append("g").attr({"class":"y fxc-monitorchart-axis","pointer-events":"none",transform:"translate(25, 0)"}).call(t):a.call(t).selectAll("g.fxc-monitorchart-tick").classed("fxc-monitorchart-minor",!0).selectAll("text").classed("fxc-monitorchart-tick-text",!0).attr("aria-hidden",!0).attr({x:28,dy:-2}).selectAll("path").classed("fxc-monitorchart-tick-path",!0).style("display","none");s=this._aiChart.svgElement.selectAll("g.y.fxc-monitorchart-axis").attr("display","inherit");s.selectAll("g.tick").classed({"fxc-monitorchart-minor":!0,"fxc-monitorchart-tick":!0});s.selectAll("g.tick text").classed("fxc-monitorchart-tick-text",!0).attr("aria-hidden",!0).attr({x:28,dy:-2});s.selectAll("g.tick line").classed({"fxc-monitorchart-tick-line-nodata":n,"fxc-monitorchart-tick-line":!n});s.selectAll("path").classed("fxc-monitorchart-tick-path",!0).style("display","none")}else this._aiChart.svgElement.selectAll("g.y.fxc-monitorchart-axis").attr("display","none")},n.prototype._xScale=function(){var r=this._visualOptions.axis.x.axisType===2?i.time.scale():i.time.scale.utc(),t,n;return this._transformedData.length!==0&&this.keyset.length!==0?t=this._viewPortTimeRange&&this._viewPortTimeRange.startTime&&this._viewPortTimeRange.endTime?[this._viewPortTimeRange.startTime,this._viewPortTimeRange.endTime]:[this.keyset[0],this.keyset[this.keyset.length-1]]:(n=this._visualOptions.axis.x,t=n.max&&n.min?[new Date(n.min),new Date(n.max)]:[i.time.day.offset(new Date,e.DefaultChartDurationInDays),new Date]),r.domain(t).range([p,this._chartWidth-5])},n.prototype._yScale=function(){var o;if(this._stackedDataset&&this._stackedDataset.length!==0){var r=this._getMinYValue(),u=this._getMaxYValue(),n=void 0,f=void 0,t=this._visualOptions.axis.y;t.min!==null&&t.min!==undefined?n=t.min:(n=r,n=t.autoAdjust&&n>0?r===u?0:Math.floor(Math.max(0,r-(u-r)*e.yScaleBuffer)):n<0?n:0);t.max!==null&&t.max!==undefined?f=t.max:(f=u,t.autoAdjust&&u!==r?f=Math.ceil(u+(u-r)*e.yScaleBuffer):f*=1.15);o=[n||0,f===n?100:f,]}else o=[0,100];return i.scale.linear().domain(o).range([this._chartHeight-25,15])},n.prototype._getMinYValue=function(){return i.min(this._stackedDataset,(function(n){if(n)return i.min(n,(function(n){return n.y0+n.y}))}))},n.prototype._getMaxYValue=function(){var n=i.max(this._stackedDataset,(function(n){if(n)return i.max(n,(function(n){return n.y0+n.y}))}));return n||0},n.prototype._getOrCreateClipPathContainer=function(){var n=this._aiChart.svgElement.select("#clipPathContainer-"+this._uniqueId),t="url(#viewPort-clip-"+this._uniqueId+")";return n.empty()&&(n=this._aiChart.svgElement.append("g").attr({id:"clipPathContainer-"+this._uniqueId,fill:"transparent",width:"100%","pointer-events":"none"}).style("clip-path",t).classed("fxc-monitorchart-clipPathContainer",!0)),this._visualOptions.timeBrushEnable&&!this._hasLiveMetrics?n.style("cursor","crosshair"):n.style("cursor",null),n},n.prototype._getOrCreateChartContainerArtifacts=function(){var r=this._getOrCreateClipPathContainer(),n=r.select("#graphContainer-"+this._uniqueId),t,i;return n.empty()&&(n=r.append("g").attr({id:"graphContainer-"+this._uniqueId,fill:"transparent",width:"100%","pointer-events":"none"}).classed("fxc-monitorchart-graphContainer",!0).classed("fxc-clrgrp",!0)),t=this._aiChart.svgElement.selectAll("line.fxc-monitorchart-guideline."+this._uniqueId),t.empty()&&this._aiChart.svgElement.append("line").attr({"class":"fxc-monitorchart-guideline "+this._uniqueId,stroke:"grey","stroke-width":1,"pointer-events":"none"}).style("display","none"),t.attr({x1:this._chartWidth+5+20,y1:15,x2:this._chartWidth+5+20,y2:this._chartHeight-25}).style("display","none"),i=this._aiChart.svgElement.selectAll("text.fxc-monitorchart-temp-tick."+this._uniqueId),i.empty()&&this._aiChart.svgElement.append("text").attr("class","fxc-monitorchart-temp-tick "+this._uniqueId).text(""),i.attr({x:this._chartWidth+5+30,y:this._chartHeight-5}),n},n.prototype._drawBars=function(){var n=this,e=this._xScale(),t=this._yScale(),u=this._getOrCreateChartContainerArtifacts(),i;this._createTimeBrush(u);this._createClickCaptureRectangle(u);i=u.selectAll("g.fxc-monitorchart-bargroup").data(this._stackedDataset);i.style("fill",(function(t,i){return n._getSeriesColor(i)})).attr("pointer-events","none");i.enter().insert("g",y).style("fill",(function(t,i){return n._getSeriesColor(i)})).style("stroke","none").attr({"class":function(t,i){return"fxc-monitorchart-bargroup "+n._uniqueId+" msportalfx-chart-color-"+i%40},"pointer-events":"none"});i.exit().remove();var f=i.selectAll("rect.fxc-monitorchart-bars").data((function(n){return n})),o=this._stackedDataset[0]?this._stackedDataset[0].length:this._stackedDataset.length,s=(this._chartWidth-p-5)/o*.6,r=this._aiChart.svgElement.empty()?10:Math.max(s,5);f.attr({"class":"fxc-monitorchart-timeSeriesPoints fxc-monitorchart-bars",id:function(t){return"id-"+b(n._uniqueId,t)+"-"+t.x.getTime()},x:function(n){return e(n.x)-r/2},y:function(n){return t(n.y+n.y0)},width:r,height:function(n){return t(n.y)},"pointer-events":"none"});f.enter().append("rect").classed("fxc-monitorchart-timeSeriesPoints fxc-monitorchart-bars",!0).attr({id:function(t){return"id-"+b(n._uniqueId,t)+"-"+t.x.getTime()},x:function(n){return e(n.x)-r/2},y:function(n){return t(n.y+n.y0)},width:r,height:function(n){return t(n.y0)-t(n.y+n.y0)},"pointer-events":"none"});f.exit().remove()},n.prototype._drawPoints=function(){var n=this,u=this._xScale(),f=this._yScale(),r=this._getOrCreateChartContainerArtifacts(),t,i;this._createTimeBrush(r);this._createClickCaptureRectangle(r);this._drawHoverMarker();t=r.selectAll("g.fxc-monitorchart-scattergroup").data(this._stackedDataset);t.style("fill",(function(t,i){return n._getSeriesColor(i)})).attr("pointer-events","none");t.enter().insert("g",y).style("fill",(function(t,i){return n._getSeriesColor(i)})).style("stroke","none").attr({"class":function(t,i){return"fxc-monitorchart-scattergroup "+n._uniqueId+" msportalfx-chart-color-"+i%40},"pointer-events":"none"});t.exit().remove();i=t.selectAll("circle.fxc-monitorchart-timeSeriesPoints-dot").data((function(n){return n}));i.attr({"class":"fxc-monitorchart-timeSeriesPoints fxc-monitorchart-timeSeriesPoints-dot",id:function(t){return"id-"+b(n._uniqueId,t)+"-"+new Date(t.x).getTime()},r:3.5,cx:function(n){return u(n.x)},cy:function(n){return f(n.y)},"pointer-events":"none"}).style("display",(function(n){return n&&n.missingValue?"none":"flex"}));i.enter().append("circle").classed("fxc-monitorchart-timeSeriesPoints fxc-monitorchart-timeSeriesPoints-dot",!0).attr({id:function(t){return"id-"+b(n._uniqueId,t)+"-"+new Date(t.x).getTime()},r:3.5,cx:function(n){return u(n.x)},cy:function(n){return f(n.y)},"pointer-events":"none"}).style("display",(function(n){return n&&n.missingValue?"none":"flex"}));i.exit().remove()},n.prototype._drawLines=function(){var n=this._getOrCreateChartContainerArtifacts(),t,i,r;this._createTimeBrush(n);this._createClickCaptureRectangle(n);t=function(){return!0};this._hasMissingValues?(i=function(n){return!n.missingValue&&(!n.nextValueMissing||!n.previousValueMissing)},r=function(n){return n.missingValue||n.nextValueMissing||n.previousValueMissing},this._drawSVGPath(n,!1,i),this._drawSVGPath(n,!0,r)):this._drawSVGPath(n,!1,t);this._drawHoverMarker()},n.prototype._drawHoverMarker=function(){var n=this,r=this._getOrCreateClipPathContainer(),i=r.select("#hoverContainer-"+this._uniqueId),t;i.empty()&&(i=r.append("g").attr({id:"hoverContainer-"+this._uniqueId,fill:"transparent",width:"100%","pointer-events":"none"}).classed("fxc-monitorchart-hoverContainer",!0).classed("fxc-clrgrp",!0));t=i.selectAll("circle.fxc-monitorchart-marker."+this._uniqueId).data(this._transformedData);t.attr({r:4,"pointer-events":"none"}).style({display:"none",stroke:function(t,i){return n._getSeriesColor(i)}}).attr({"class":function(t,i){return"fxc-monitorchart-marker "+n._uniqueId+" msportalfx-chart-color-"+i%40}});t.enter().append("circle").attr({r:4,"pointer-events":"none"}).style({display:"none",stroke:function(t,i){return n._getSeriesColor(i)}}).attr({"class":function(t,i){return"fxc-monitorchart-marker "+n._uniqueId+" msportalfx-chart-color-"+i%40}});t.exit().remove()},n.prototype._adjustFillForAreaStroke=function(n,t){return t===3?this._getSeriesColor(n):"none"},n.prototype._drawSVGPath=function(n,t,r){var s=n.selectAll(".fxc-monitorchart-lineContainer").data(this._stackedDataset),u,f;s.enter().insert("g",y).classed("fxc-monitorchart-lineContainer",!0);s.exit().remove();t?(u=s.selectAll(".fxc-monitorchart-linePoints-missing").data((function(n,t){return a(n,t)})),f="fxc-monitorchart-timeSeriesPoints fxc-monitorchart-linePoints-missing"):(u=s.selectAll(".fxc-monitorchart-linePoints").data((function(n,t){return a(n,t)})),f="fxc-monitorchart-timeSeriesPoints fxc-monitorchart-linePoints");var c=this._xScale(),h=this._yScale(),o=i.svg.line().defined(r).x((function(n){return c(new Date(n.x))})).y((function(n){return h(n.y+n.y0)})),e;this._visualOptions.chartType===3&&(e=i.svg.area().defined(r).x((function(n){return c(new Date(n.x))})).y1((function(n){return h(n.y+n.y0)})).y0((function(n){return h(n.y0)})));e?(this._updateChartLines(u,o,2),this._updateChartLines(u,e,3)):this._updateChartLines(u,o,this._visualOptions.chartType);t?e?(this._addNewChartLinesForDottedLineForMissingValue(u,o,2,f),this._addNewChartLinesForDottedLineForMissingValue(u,e,3,f)):this._addNewChartLinesForDottedLineForMissingValue(u,o,this._visualOptions.chartType,f):e?(this._addNewChartLines(u,o,2,f,1),this._addNewChartLines(u,e,3,f,1)):this._addNewChartLines(u,o,this._visualOptions.chartType,f,1);u.exit().remove()},n.prototype._updateChartLines=function(n,t,i){var r=this;n.attr("pointer-events","none").attr({d:t,"stroke-width":2,"stroke-opacity":function(){return nt(1,i)},"fill-opacity":function(){return tt(1,i)}}).style("fill",(function(n){return r._adjustFillForAreaStroke(n.index,i)})).style("stroke",(function(n){return r._getSeriesColor(n.index)}))},n.prototype._addNewChartLinesForDottedLineForMissingValue=function(n,t,i,r){this._addNewChartLines(n,t,i,r,1).attr("stroke-dasharray","3, 3")},n.prototype._addNewChartLines=function(n,t,i,r,u){var f=this;return n.enter().append("path").attr({"pointer-events":"none",d:function(n){return t(n.data,n.index)},"stroke-width":2,"stroke-opacity":function(){return nt(u,i)},"fill-opacity":function(){return tt(1,i)}}).style("fill",(function(n){return f._adjustFillForAreaStroke(n.index,i)})).style("stroke",(function(n){return f._getSeriesColor(n.index)})).attr({"class":function(n){return r+" msportalfx-chart-color-"+n.index%40}})},n.prototype._transformLegendDisplayName=function(n){var t,i;return!n||typeof n!="string"?n||r.undefinedMetricOrSegment:(t=n.substring(0,14)+"...",this._visualOptions.legend.position===2?(i=window.getComputedStyle(document.body).letterSpacing==="1.92px",n.length>23&&this._transformedData.length>1?i?t:n.substring(0,20)+"...":n.length>14&&i&&this._transformedData.length>1?t:n):n.length>=17?t:n)},n.prototype._processUnit=function(n,t,i){if(n===!1||n===!0||n===null||isNaN(n))return i.push(""),"--";var r=this._configureLegend(n,t);return i.push(r.unit),r.value},n.prototype.focusFirstSeries=function(){this.focusSeries(0)},n.prototype.focusLastSeries=function(){this.focusSeries(this._transformedData.length-1)},n.prototype.focusNextSeries=function(){this.focusSeries(this._keyboardSelectedSeriesIndex+1)},n.prototype.focusPrevSeries=function(){this.focusSeries(this._keyboardSelectedSeriesIndex-1)},n.prototype.focusNextDataPoint=function(){this.focusSeries(this._keyboardSelectedSeriesIndex);this.focusDataPoint(this._keyboardSelectedDataPointIndex+1)},n.prototype.focusPrevDataPoint=function(){this.focusSeries(this._keyboardSelectedSeriesIndex);this.focusDataPoint(this._keyboardSelectedDataPointIndex-1)},n.prototype.unfocusSeries=function(){this._keyboardSelectedSeriesIndex=-1;this._removeSeriesVirtualFocus();this._isFocused=!1},n.prototype._removeSeriesVirtualFocus=function(){var n,t;this._aiChart.legendElement.selectAll(".fxc-monitorchart-legend").classed("notSelected",!1);this._aiChart.legendElement.selectAll(".fxc-monitorchart-legend").classed("Selected",!1);this._aiChart.svgElement.selectAll("circle.fxc-monitorchart-marker").classed("notSelected",!1);this._aiChart.svgElement.selectAll("circle.fxc-monitorchart-marker").classed("Selected",!1);this._visualOptions.chartType===1?(this._aiChart.svgElement.selectAll(".fxc-monitorchart-bargroup").classed("notSelected",!1),this._aiChart.svgElement.selectAll(".fxc-monitorchart-bargroup ").classed("Selected",!1)):this._visualOptions.chartType===7?(this._aiChart.svgElement.selectAll(".fxc-monitorchart-scattergroup").classed("notSelected",!1),this._aiChart.svgElement.selectAll(".fxc-monitorchart-scattergroup").classed("Selected",!1),this._aiChart.svgElement.selectAll("circle.fxc-monitorchart-timeSeriesPoints-dot").attr("r",3.5)):(this._visualOptions.chartType===2||this._visualOptions.chartType===3)&&(this._aiChart.svgElement.selectAll(".fxc-monitorchart-lineContainer").classed("notSelected",!1),this._aiChart.svgElement.selectAll(".fxc-monitorchart-lineContainer").classed("Selected",!1));n=document.getElementById(this._aiChart.realm);n.removeAttribute("aria-activedescendant");t=document.getElementById(this._aiChart.realm+"_ariaLive");t.setAttribute("aria-live","off")},n.prototype.deselect=function(){this._removeSeriesVirtualFocus();this.hoverOut();this._keyboardSelectedSeriesIndex=-1;this._keyboardSelectedDataPointIndex=-1;this._isFocused=!0},n.prototype.focusDataPoint=function(n){var i,h,t,l,s;if(!this._hasLiveMetrics&&(n!==undefined||this._keyboardSelectedDataPointIndex!==-1)){if(n===undefined&&(n=this._keyboardSelectedDataPointIndex),i=this._transformedData[this._keyboardSelectedSeriesIndex]&&this._transformedData[this._keyboardSelectedSeriesIndex].seriesPoints,h=document.getElementById(this._aiChart.realm),i&&i.length>0){var a=i.length-1,e=void 0,u=void 0;if(this._viewPortTimeRange)for(t=0;t<=a;t++)if(i[t][0]>=this._viewPortTimeRange.startTime&&e===undefined)e=t;else if(i[t][0]>this._viewPortTimeRange.endTime&&u===undefined){u=t-1;break}if(e!==undefined){u===undefined&&(u=a);this._keyboardSelectedDataPointIndex=n<e?e:n>u?u:n;var v=this._transformedData[this._keyboardSelectedSeriesIndex].seriesPoints[this._keyboardSelectedDataPointIndex],y=v[0],o=v[1],c=void 0,p=f.formatTickTime(y,this._visualOptions.axis.x.axisType===3);o!==!1&&o&&!isNaN(o)?(l=this._configureLegend(o,this._keyboardSelectedSeriesIndex),c=r.dataPointForNarrator.replace("{0}",l.value).replace("{1}",l.unit).replace("{2}",p)):c=r.legendNoValueForNarrator.replace("{0}",p);s=document.getElementById(this._aiChart.realm+"_ariaLive");h.removeAttribute("aria-activedescendant");s.getAttribute("aria-live")==="off"&&s.setAttribute("aria-live","polite");s.innerText=c;this.hoverOn(y,!this._hasLiveMetrics);return}}h.setAttribute("aria-activedescendant","fxc-monitorchart-watermark-text-id-"+this._uniqueId)}},n.prototype.focusSeries=function(n){var t=this,u,f,e;if(!this._hasLiveMetrics){if(this._isFocused===!1&&this._keyboardSelectedSeriesIndex===-1){this._isFocused=!0;return}if(this._keyboardSelectedSeriesIndex===-1||this._keyboardSelectedSeriesIndex!==n){n===undefined&&(n=this._keyboardSelectedSeriesIndex);var i=this._aiChart.legendElement.selectAll(".fxc-monitorchart-legend"),o=this._transformedData.length-1,r=document.getElementById(this._aiChart.realm);i&&i[0].length>0?(this._keyboardSelectedSeriesIndex=n<0?0:n>o?o:n,u=Math.floor(this._keyboardSelectedSeriesIndex/w(this._chartWidth,this._visualOptions.legend.hideSubtitle))+1,this._pageNumber!==u&&(this._pageNumber=u,this.positionLegends()),f=i.classed("notSelected",(function(n,i){return i!==t._keyboardSelectedSeriesIndex})).filter((function(n,i){return i===t._keyboardSelectedSeriesIndex})).attr("id"),i.classed("Selected",(function(n,i){return i===t._keyboardSelectedSeriesIndex})),e=this._aiChart.svgElement.selectAll("circle.fxc-monitorchart-marker."+this._uniqueId),e.classed("notSelected",(function(n,i){return i!==t._keyboardSelectedSeriesIndex})),e.classed("Selected",(function(n,i){return i===t._keyboardSelectedSeriesIndex})),this._visualOptions.chartType===1?(this._aiChart.svgElement.selectAll(".fxc-monitorchart-bargroup").classed("notSelected",(function(n,i){return i!==t._keyboardSelectedSeriesIndex})),this._aiChart.svgElement.selectAll(".fxc-monitorchart-bargroup").classed("Selected",(function(n,i){return i===t._keyboardSelectedSeriesIndex}))):this._visualOptions.chartType===7?(this._aiChart.svgElement.selectAll(".fxc-monitorchart-scattergroup").classed("notSelected",(function(n,i){return i!==t._keyboardSelectedSeriesIndex})),this._aiChart.svgElement.selectAll(".fxc-monitorchart-scattergroup").classed("Selected",(function(n,i){return i===t._keyboardSelectedSeriesIndex})),this._aiChart.svgElement.selectAll("circle.fxc-monitorchart-timeSeriesPoints-dot").attr("r",3.5),this._aiChart.svgElement.selectAll(".fxc-monitorchart-scattergroup").filter((function(n,i){return t._keyboardSelectedSeriesIndex===i})).selectAll("circle.fxc-monitorchart-timeSeriesPoints-dot").attr("r",4.5)):(this._visualOptions.chartType===2||this._visualOptions.chartType===3)&&(this._aiChart.svgElement.selectAll(".fxc-monitorchart-lineContainer").classed("notSelected",(function(n,i){return i!==t._keyboardSelectedSeriesIndex})),this._aiChart.svgElement.selectAll(".fxc-monitorchart-lineContainer").classed("Selected",(function(n,i){return i===t._keyboardSelectedSeriesIndex}))),r.getAttribute("aria-activedescendant")!==f&&r.setAttribute("aria-activedescendant",f)):r.setAttribute("aria-activedescendant","fxc-monitorchart-watermark-text-id-"+this._uniqueId)}}},n.prototype._getD3LegendYValueDef=function(n){var t=this,i=this._visualOptions.legend.hideSubtitle?30:50;return i+=5,function(r){return 5+r.index%w(t._chartHeight,t._visualOptions.legend.hideSubtitle,!0)*i+n}},n.prototype._getXValueDefForBottomLegend=function(n){var t=this,i=this._visualOptions.legend.hideSubtitle?100:112;return function(r){return 25+r.index%w(t._chartWidth,t._visualOptions.legend.hideSubtitle)*i+n}},n})();t.AiTimeSeriesChart=it}));
define("MsPortalImpl.Controls/Controls/Visualization/MonitorChartV2/AI/ME/Controls/Chart",["require","exports","_oss/d3","MsPortalImpl.Controls/Controls/Visualization/MonitorChartV2/Strings","MsPortalImpl.Controls/Controls/Visualization/MonitorChartV2/AI/ME/Telemetry","MsPortalImpl.Controls/Controls/Visualization/MonitorChartV2/AI/ME/Utilities/MetricsExplorerItemDataModelUtil","MsPortalImpl.Controls/Controls/Visualization/MonitorChartV2/AI/ME/Utilities/Util","MsPortalImpl.Controls/Controls/Visualization/MonitorChartV2/AI/ME/Utilities/UxUtil","MsPortalImpl.Controls/Controls/Visualization/MonitorChartV2/AI/ME/Controls/AiTimeSeriesChart"],(function(n,t,i,r,u,f,e,o,s){"use strict";function h(n,t){Object.keys(n).forEach((function(i){n[i]?t.setAttribute(i,n[i]):t.removeAttribute(i)}))}Object.defineProperty(t,"__esModule",{value:!0});t.Chart=void 0;var c=(function(){function n(n,t,r,o,h,c,l,a,v){var p,w,y;this.skins=[];p=u.CreateOrAddOperation("Chart.constructor",v,t);this.realm=n;this._realmElement=document.getElementById(this.realm);this.telemetryContext=t;this._uniqueId=s.generateUniqueId(this.telemetryContext);w=this._createContainerWithSpinner();this._visualization=e.cloneProperties(f.DefaultVisualizationOptions);o&&e.extendVisualization(this._visualization,o);this.svgContainerElement=i.select("#"+w);this.svgElement=this.svgContainerElement.append("svg");this.svgElement.style({"flex-grow":1});this.legendElement=this.svgContainerElement.append("svg");this._updateSvgContainerSize();y=this.svgElement.append("defs");y.append("pattern").attr({id:"pattern-stripe-"+this._uniqueId,width:"4",height:"4",patternUnits:"userSpaceOnUse",patternTransform:"rotate(45)"}).append("rect").attr({width:"2",height:"4",transform:"translate(0,0)",fill:"white"});y.append("mask").attr("id","mask-stripe-"+this._uniqueId).append("rect").attr({x:"0",y:"0",width:"100%",height:"100%",fill:"url(#pattern-stripe)"});y.append("clipPath").attr({id:"viewPort-clip-"+this._uniqueId}).append("rect").classed("fxc-monitorchart-clipPath-"+this._uniqueId,!0);this.chartControl=new s.AiTimeSeriesChart(this,this.telemetryContext,r,this._visualization,h,a,p.opTimer);l&&l.length>0&&(this.skins=l);this._realmElement&&this._initAccessibleOptions(c);p.opStop()}return n.prototype.changeToolTipBody=function(n){this.chartControl.changeToolTipBody(n)},n.prototype.getActualHeight=function(){if(this._visualization&&this._visualization.legend&&this._visualization.legend.position!==4){var t=this._visualization&&this._visualization.legend&&this._visualization.legend.isVisible,i=t?this._visualization.legend.hideSubtitle?30:50:0,n=this._height-i;return n>0?n:0}return this._height},n.prototype.getActualWidth=function(){var n=this._getChartSVGWidth();return n-85>0?n-30:0},n.prototype.getVisualization=function(){return this.chartControl.getVisualization()},n.prototype.setVisualization=function(n){this._visualization=n;this._updateSvgContainerSize();this.chartControl.setVisualization(n);this.skins.forEach((function(t){t.setVisualization(n)}))},n.prototype.hoverOn=function(n,t){this.chartControl.hoverOn(n,t)},n.prototype.clearSelection=function(){this.chartControl.hoverOut()},n.prototype.clearData=function(n,t,i){t===void 0&&(t=0);this._updateVisual(i);this.chartControl.clearData(n,t)},n.prototype.showSpinner=function(){this.chartControl.hideWatermark();this._divSvgContainer&&(this._divSvgContainer.style.opacity="0.2");this._spinner&&(this._spinner.style.display="inherit")},n.prototype.hideSpinner=function(){this._divSvgContainer&&(this._divSvgContainer.style.opacity="1");this._spinner&&(this._spinner.style.display="none")},n.prototype.updateData=function(n,t,i,r){this._updateVisual(i);this._realmElement&&(this.chartControl.updateData(n,t,i,r),this.skins.forEach((function(i){i.repaint(n,t)})))},n.prototype.updateAccessiblityOptions=function(n){this._realmElement&&(n&&n.ariaLabel?h({"aria-label":n.ariaLabel,"aria-labelledby":undefined},this._realmElement):h({"aria-label":undefined,"aria-labelledby":n&&n.ariaLabelledbyId},this._realmElement))},n.prototype.getAccessiblityOptions=function(){var n=this._realmElement;return n&&{role:n.getAttribute("role"),ariaLabel:n.getAttribute("aria-label"),ariaLabelledbyId:n.getAttribute("aria-labelledby"),ariaDescribedbyId:n.getAttribute("aria-describedby"),tabbable:n.getAttribute("tabIndex")==="0"}},n.prototype._updateVisual=function(n){n&&(this._visualization=n,this._updateSvgContainerSize(),this.skins.forEach((function(t){t.setVisualization(n)})))},n.prototype._getChartSVGWidth=function(){var t=this._visualization&&this._visualization.legend&&this._visualization.legend.isVisible&&this._visualization.legend.position===4;if(t){var i=this._visualization&&this._visualization.legend&&this._visualization.legend.isVisible&&this._visualization.legend.hideSubtitle,r=i?100:112,n=this._width-r;return n>0?n:0}return this._width},n.prototype._updateSvgContainerSize=function(){var n,r;this._height=this._visualization.containerSize&&this._visualization.containerSize.height;this._width=this._visualization.containerSize&&this._visualization.containerSize.width;(!this._height||this._height<=0)&&(this._height=306);(!this._width||this._width<=0)&&(this._width=505);this.svgContainerElement.style({width:this._width+"px",height:this._height+"px"});n=this._visualization&&this._visualization.legend&&this._visualization.legend.isVisible&&this._visualization.legend.position===4;this.svgContainerElement.style({"flex-direction":n?"row":"column"});var u=this._visualization&&this._visualization.legend&&this._visualization.legend.isVisible,t=0,i=0;u&&(r=this._visualization.legend.hideSubtitle,n?(i=this._height-5,t=r?100:112):(t=this._width,i=r?30:50));this.legendElement.style({width:t+"px",height:i+"px","padding-top":n?"5px":"0px"});this.svgElement.style({width:this._getChartSVGWidth()+"px",height:this.getActualHeight()+"px"})},n.prototype._initAccessibleOptions=function(n){h({role:"application","aria-describedby":this.realm+"_keyboardShortcuts",tabindex:"0"},this._realmElement);this.updateAccessiblityOptions(n);this.addKeyboardListener()},n.prototype.addKeyboardListener=function(){var n=this,t=!1;this._realmElement.addEventListener("keyup",(function(i){t=!1;var r=!0;switch(i.keyCode){case 37:n.chartControl.focusPrevDataPoint();break;case 38:n.chartControl.focusPrevSeries();break;case 39:n.chartControl.focusNextDataPoint();break;case 40:n.chartControl.focusNextSeries();break;case 33:n.chartControl.navigateLegendPages(!0);break;case 34:n.chartControl.navigateLegendPages(!1);break;case 27:n.chartControl.deselect();break;default:r=!1}r&&(i.preventDefault(),i.stopPropagation())}));this._realmElement.addEventListener("click",(function(){t=!0}));this._realmElement.addEventListener("blur",(function(){n.chartControl.hoverOut();n.chartControl.unfocusSeries()}));this._realmElement.addEventListener("focus",(function(){setTimeout((function(){t||(n.chartControl.focusSeries(),n.chartControl.focusDataPoint())}),100)}))},n.prototype._createContainerWithSpinner=function(){var t,i,n;return this._realmElement?(this._spinner=o.getSpinner(this._uniqueId,this._realmElement),t=document.createElement("div"),t.id=this.realm+"_keyboardShortcuts",t.style.display="none",t.innerText=r.chartKeyboardShortcutDescription,this._realmElement.appendChild(t),i=document.createElement("div"),i.id=this.realm+"_activedescendant",i.style.display="none",this._realmElement.appendChild(i),n=document.createElement("div"),n.id=this.realm+"_ariaLive",n.className+=" screenReaderText",n.setAttribute("aria-live","off"),n.setAttribute("tabindex","-1"),this._realmElement.appendChild(n),this._divSvgContainer=document.createElement("div"),this._divSvgContainer.id=this.realm+"svgContainer",this._divSvgContainer.style.display="flex",this._realmElement.appendChild(this._divSvgContainer),this._divSvgContainer.id):this.realm+"svgContainer"},n})();t.Chart=c}));
define("MsPortalImpl.Controls/Controls/Visualization/MonitorChartV2/AI/ME/MetricChart",["require","exports","MsPortalImpl.Controls/Controls/Visualization/MonitorChartV2/Utils/MappedUtils","MsPortalImpl.Controls/Controls/Visualization/MonitorChartV2/AI/ME/Constants","MsPortalImpl.Controls/Controls/Visualization/MonitorChartV2/AI/ME/Controls/Chart","MsPortalImpl.Controls/Controls/Visualization/MonitorChartV2/AI/ME/DataModels/MetricsExplorerItemDataModel","MsPortalImpl.Controls/Controls/Visualization/MonitorChartV2/AI/ME/RefreshManager","MsPortalImpl.Controls/Controls/Visualization/MonitorChartV2/AI/ME/ServiceContainer","MsPortalImpl.Controls/Controls/Visualization/MonitorChartV2/AI/ME/Skins/SkinConstants","MsPortalImpl.Controls/Controls/Visualization/MonitorChartV2/AI/ME/Stores/InteractionsStore","MsPortalImpl.Controls/Controls/Visualization/MonitorChartV2/AI/ME/Telemetry","MsPortalImpl.Controls/Controls/Visualization/MonitorChartV2/AI/ME/Utilities/ChartUtils","MsPortalImpl.Controls/Controls/Visualization/MonitorChartV2/AI/ME/Utilities/MetricsExplorerItemDataModelUtil","MsPortalImpl.Controls/Controls/Visualization/MonitorChartV2/AI/ME/Utilities/TimeUtils","MsPortalImpl.Controls/Controls/Visualization/MonitorChartV2/AI/ME/Utilities/Util","MsPortalImpl.Controls/Controls/Visualization/MonitorChartV2/AI/ME/Utilities/UxUtil","MsPortalImpl.Controls/Controls/Visualization/MonitorChartV2/AI/ME/ViewModels/MetricDataViewModel"],(function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w){"use strict";function d(n,t){if(b(n)||!n.metrics||n.metrics.length===0)return!1;var i=n.visualization;return t&&t.legend?(i?i.legend=t.legend:n.visualization={legend:t.legend},t.legend.isVisible):i&&i.legend?i.legend.isVisible:a.DefaultVisualizationOptions.legend.isVisible}function g(n){var t=[];return n&&n.chartSeriesData&&n.chartSeriesData.forEach((function(n){var i=n.metricResults&&n.metricResults.data;i&&i.forEach((function(n){n.dataPoints&&t.push(n)}))})),t}function k(n,t,i){return y.isEqualWrapper(n,t,(function(n,t){return n.isVisible===t.isVisible&&n.axisType===t.axisType&&i?t.min===n.min&&t.max===n.max:Math.abs((t.min||0)-(n.min||0))<i&&Math.abs((t.max||0)-(n.max||0))<i}))}function nt(n,t){return y.isEqualWrapper(n,t,(function(n,t){var i=n.containerSize,r=t.containerSize;return n.chartType===t.chartType&&y.isEqualWrapper(n.legend,t.legend,(function(n,t){return n.isVisible===t.isVisible&&n.position===t.position&&n.hideSubtitle===t.hideSubtitle}))&&y.isEqualWrapper(n.axis,t.axis,(function(n,t){var i=y.isHostedInShell()?1e3:5e3;return k(n.x,t.x,i)&&k(n.y,t.y)}))&&(i&&i.width)===(r&&r.width)&&(i&&i.height)===(r&&r.height)&&n.colorMap===t.colorMap}))}function tt(n){if(!n||!n.HasMetrics())return!0;var i=n.metrics[0],t=i&&i.id&&i.id.resourceDefinition,r=t&&t.subscription;return!!(t&&(t.id||r&&r.subscriptionId))}function b(n){return n&&n.MetricCount()===1&&a.isLiveMetric(n.metrics[0].id)}Object.defineProperty(t,"__esModule",{value:!0});t.ChartDEV=t.MetricChart=void 0;var it=(function(n){function t(t){var i=n.call(this)||this,r,o,f,s;return i.skins=[],i._containerName="MetricChart",r=t.itemDataModel,i.timeContext=t.timeContext,i.skipRefresh=t.skipRefresh,i._updateTimeContext=t.onTimeContextChanged,i.itemDataModel=r,i._telemetryContext=c.getOrCreateTelemetryContext(r),o=c.CreateOrAddOperation("MetricChart.constructor",t.telemetryData,i._telemetryContext),i.chartData={chartSeriesData:[],userDataStatusWithError:{userDataStatus:r.MetricCount()===0?5:0}},i._onUserDataStatusChanged=t&&t.onUserDataStatusChanged,i._onUserDataStatusChanged&&i._onUserDataStatusChanged(i.chartData.userDataStatusWithError.userDataStatus),i._interactionsStore=h.InteractionsStore.Instance(),f=y.cloneProperties(a.DefaultVisualizationOptions),r&&r.visualization&&y.extendVisualization(f,r.visualization),i.timeContext&&f.axis&&f.axis.x&&(s=i.timeContext.getTimerange(),s&&(f.axis.x.min=s.startTime.getTime(),f.axis.x.max=s.endTime.getTime())),i._visual=f,i.chart=new u.Chart(t.realm,i._telemetryContext,i.chartData,f,i._interactionsStore&&i._interactionsStore.Actions,{ariaLabel:r.title},i.skins,t.enableLegendInteractions,o.opTimer),r.alertThresholdOptions&&i._initializeSkins(r,f),i._interactionsRegistration={id:i.chart.chartControl.getUniqueId(),OnHover:function(n){if(n){var t=n;b(i.itemDataModel)?t.isLive&&i.chart.hoverOn(t.x,!1):t.isLive||i.chart.hoverOn(t.x,!0)}},OnLeave:function(){i.chart.clearSelection()},OnZoom:function(n){var t,r;n&&i._updateTimeContext&&(t=n,t.isLive||(r={options:{grain:1},absolute:{startTime:t.xRange.from,endTime:t.xRange.to}},i._updateTimeContext&&i._updateTimeContext(r)))}},i._interactionsStore.Register(i._interactionsRegistration),e.registerForRefresh(i),i._initialRefreshPromise=i.refresh(r,t.timeContext,5,o.opTimer).finally(o.opStop),i}return __extends(t,n),t.prototype.getInitialRefreshPromise=function(){return this._initialRefreshPromise},t.prototype.getVisualization=function(){return this.chart.getVisualization()},t.prototype.setVisualization=function(n){var t={};n&&(t=y.cloneProperties(this._visual),y.extendVisualization(t,n));this.chart.setVisualization(t);this._visual=t;this._updateSkins(this.itemDataModel)},t.prototype.dispose=function(){n.prototype.dispose.call(this);this._interactionsStore&&this._interactionsStore.Unregister(this._interactionsRegistration)},t.prototype.removeMetric=function(n,t){var f,r,u,i;if(t&&(this.itemDataModel=t,n)){if(f=y.GetUniqueId(n),r=this.chartData.chartSeriesData,r&&r.length>0)if(r.length===1)r[0].metricUniqueId===f&&(this.chartData.chartSeriesData=[]);else{for(u=this.chartData.chartSeriesData,i=0,i=0;i<u.length;i++)if(u[i]&&u[i].metricUniqueId===f)break;i<u.length&&r.splice(i,1)}this.chartData.userDataStatusWithError=this.itemDataModel.MetricCount()<=0?{userDataStatus:5}:{userDataStatus:this.chartData.userDataStatusWithError.userDataStatus};this._updateData(13,new c.OperationTelemetry("MetricChart.removeMetric",this._telemetryContext))}},t.prototype.onTimeContextUpdated=function(n,t){return this.onRefresh(n,6,t)},t.prototype.onRefresh=function(t,i,r,u){return n.prototype.onRefresh.call(this,t,i,r),this.refresh(u,t,i,r)},t.prototype.onSkippedRefresh=function(){this.itemDataModel&&this.itemDataModel.HasMetrics()&&b(this.itemDataModel)&&this._clearData(11,2)},t.prototype.refresh=function(n,t,i,u,f){var e=this,h=c.PerformanceNow(),rt=c.CreateOrAddOperation("MetricChart.refresh",u,this._telemetryContext),o=rt.opTimer,a=rt.opStop,v,k,s,y,p,ot;if(this._noDataPointsLimit=f,this.enableAutoRefresh=!f,!tt(n))return this._clearData(12,i),a(),this._logMetricChartPartLoad(h,{userDataStatus:12},i,o),Q();this._updateSkins();var ut=this._updateMetricChartInput(n,t,i),d=this._getNewVisual(this.itemDataModel,t),st=nt(d,this._visual);if(this._visual=d,this._telemetryContext=c.getOrCreateTelemetryContext(this.itemDataModel),this._telemetryContext&&(this._telemetryContext.customMetrics={}),this._updateRefreshInterval(),v=this.itemDataModel.MetricCount(),!this.itemDataModel&&v>0)return this._clearData(5,i,this._visual),a(),this._logMetricChartPartLoad(h,{userDataStatus:5},i,o),Q();var ft=l.computeTotalDataPoints(this.timeContext,1,this.itemDataModel.appliedISOGrain),it=ft*v,et=b(this.itemDataModel);return!et&&!this._noDataPointsLimit&&it>1e4?(this._clearData(8,i,d),c.logWarning("Too many datapoints.",this._telemetryContext,{ContainerName:this._containerName,Reason:i},{Count:it,MetricsCount:v}),a(),this._logMetricChartPartLoad(h,{userDataStatus:5},i,o),Q()):(k=l.computeMaxBucketCount(this.chart.getActualWidth(),25,5,this._visual.chartType),(ft>k||this.timeContext.maxBucketCount&&Math.abs(k-this.timeContext.maxBucketCount)>50)&&(ut=!0,this.itemDataModel.appliedISOGrain=undefined),this.timeContext.maxBucketCount=k,!ut)?(st||(this.setVisualization(this._visual),a(),this._logMetricChartPartLoad(h,{userDataStatus:3},i,o)),Q()):(s={userDataStatus:2,error:null},y=r.Result.Succeed,i!==2&&i!==4&&this.chart.showSpinner(),p=!1,ot={cause:i,segmentedTopCount:this.itemDataModel.grouping&&this.itemDataModel.grouping.top,ignoreDataPointLimit:this._noDataPointsLimit},w.fetchControlData(this.itemDataModel,this.timeContext,o,this._telemetryContext,ot).then((function(n){p=e.chartData&&n&&e.chartData.fetchStartTimeStamp&&n.fetchStartTimeStamp&&n.fetchStartTimeStamp<e.chartData.fetchStartTimeStamp;p||(e.chartData=n,s=e.chartData.userDataStatusWithError,s.userDataStatus===1||s.userDataStatus===2?y=r.Result.Succeed:(e.chartData.chartSeriesData&&e.chartData.chartSeriesData.forEach((function(n){n.metricResults=null})),y=r.Result.Fail))})).finally((function(){var n=g(e.chartData),t={ContainerName:e._containerName,Reason:i,Result:r.Result[y],IsObsoleteQuery:p,HasNonZeroData:n.some((function(n){return n.dataPoints.some((function(n){return n.value>0}))}))},u=!1,w=l.computeTotalDataPoints(e.timeContext,n.length,e.itemDataModel.appliedISOGrain),f={DataPoints:w,MetricsCount:v,SeriesCount:n.length};p?c.logCustomEvent("Skip obsolete query",e._telemetryContext,t,f,undefined,o):!et&&!e._noDataPointsLimit&&it>1e4?(s.userDataStatus=8,e._clearData(s.userDataStatus,i,e._visual),u=!0,c.logWarning("Too many datapoints.",e._telemetryContext,t,f,o)):(y!==r.Result.Fail||i!==2)&&(e.chartData.userDataStatusWithError=s,e._updateData(i,o,e._visual),u=!0);e.skins.some((function(n){return n.requiresLoading}))||e.chart.hideSpinner();e.handleRefreshFailure(s.userDataStatus);u||e.setVisualization(e._visual);a();e._logMetricChartPartLoad(h,s,i,o,t,f)})))},t.prototype._clearData=function(n,t,i){this.chart.clearData(t,n,i);t!==4&&this._onUserDataStatusChanged&&this._onUserDataStatusChanged(n)},t.prototype._updateData=function(n,t,i){var r=c.AddOperation("MetricChart.updateData",t).opStop;this.chart.updateData(this.chartData,n,i,t);this._onUserDataStatusChanged&&this._onUserDataStatusChanged(this.chartData&&this.chartData.userDataStatusWithError&&this.chartData.userDataStatusWithError.userDataStatus);r()},t.prototype._getNewVisual=function(n,t){var i=y.cloneProperties(this._visual),r,u,f;if(n&&n.visualization&&y.extendVisualization(i,n.visualization),t){if(r=t.getTimerange(),!r.startTime||!r.endTime){c.logError("The start or end time is null",this._telemetryContext,undefined,{ContainerName:"_updateData",Timecontext:JSON.stringify(t)});return}u={isVisible:i.axis&&i.axis.x?i.axis.x.isVisible:!0,min:r.startTime.getTime(),max:r.endTime.getTime(),axisType:t.getShowUTCTime()?3:2};i.axis?i.axis.x=u:i.axis={x:u,y:{isVisible:!0,axisType:1}}}return i&&this.itemDataModel&&(f=d(this.itemDataModel,n&&n.visualization),i.legend.isVisible=f),i},t.prototype._updateMetricChartInput=function(n,t,i){var r,u,e;return t?(this.timeContext=t,r=v.TimeContextEquals(this._previousTimeContext,t,!1),r||(this._previousTimeContext=this.timeContext.clone())):r=!0,n?(this.itemDataModel=n,e=f.MetricsEquals(this._previousItemdatamodel&&this._previousItemdatamodel.metrics,n.metrics),u=f.Equals(this._previousItemdatamodel,n,!1,!1,!1),u||(this._previousItemdatamodel=p.cloneDataModel(n))):(e=!0,u=!0),!n||e&&r||(n.appliedISOGrain=null),this.itemDataModel&&this.itemDataModel.HasMetrics()&&(!u||!r||i===1||i===2&&this.timeContext.getIsRelative())},t.prototype._updateSkinsMethod=function(n){var i=this,t;this._filterSkins(n);t=n&&n.alertThresholdOptions;t.simpleThreshold&&this._simpleThresholdStore&&(this._simpleThresholdStore.GetAction(this.itemDataModel.id).UpdateHighThreshold("high-threshold-changed",t.simpleThreshold.alertThresholdHigh),this._simpleThresholdStore.GetAction(this.itemDataModel.id).UpdateOperator("operator-changed",t.simpleThreshold.operator));t.dynamicThreshold&&this._dynamicThresholdStore&&this._dynamicThresholdStore.GetAction(this.itemDataModel.id).UpdateDynamicThreshold("DynamicThrehosldOptionsUpdated",t.dynamicThreshold);this.skins&&this.skins.forEach((function(n){t?(n.skinType===1&&(t.dynamicThreshold?n.setVisualization(i.getVisualization()):n.repaint(null,1,!0)),n.skinType===0&&(t.dynamicThreshold?n.repaint(null,1,!0):(n.setupSkin(i.chart,i._telemetryContext,null,i.getVisualization()),n.setVisualization(i.getVisualization())))):n.setVisualization(i.getVisualization())}))},t.prototype._updateSkins=function(n){var i=this,t;n&&n.alertThresholdOptions&&(t=[],this._thresholdStoreRegistered||t.push(r.thresholdBundleLoadedDefer.promise),this._simpleThresholdStore&&this._dynamicThresholdStore&&this._simpleThresholdStore.GetAction(this.itemDataModel.id)&&this._dynamicThresholdStore.GetAction(this.itemDataModel.id)||t.push(this._initializeSkins(n,this.getVisualization())),Q.all(t).then((function(){i._updateSkinsMethod(n)})))},t.prototype._logMetricChartPartLoad=function(n,t,r,u,f,e){if(!b(this.itemDataModel)){var o={ContainerName:this._containerName,Reason:p.RefreshTypeConst[r]},s={Duration:c.PerformanceNow()-n};f&&(o=i.extend(o,f));e&&(s=i.extend(s,e));c.logContainerLoad(this._telemetryContext,this._containerName,r,u,t,o,s)}},t.prototype.updateAccessibleOptions=function(n){this.chart.updateAccessiblityOptions(n)},t.prototype._filterSkins=function(n,t){var i=this;return t===void 0&&(t=this.getVisualization()),r.thresholdBundleLoadedDefer?r.thresholdBundleLoadedDefer.promise.then((function(){var f=[],e=[],r,u;n.alertThresholdOptions.simpleThreshold?(i._simpleThresholdStore=o.ServiceContainer.Instance().get(s.ThresholdConstants.SimpleThresholdStore),i._simpleThresholdStore.AttachThresholdSkinOptions(n.alertThresholdOptions.simpleThreshold,n.id),f=i.skins.filter((function(n){return n.skinType===0})),f.length<=0&&(r=o.ServiceContainer.Instance().get(s.ThresholdConstants.SimpleThresholdSkin),r.initSkin(n),r.setupSkin(i.chart,i._telemetryContext,i.chartData,t),i.skins.push(r))):i.skins=i.skins.filter((function(n){return n.skinType!==0}));n.alertThresholdOptions.dynamicThreshold?(i._dynamicThresholdStore=o.ServiceContainer.Instance().get(s.ThresholdConstants.DynamicThresholdStore),i._dynamicThresholdStore&&i._dynamicThresholdStore.AttachThresholdSkinOptions(n.alertThresholdOptions.dynamicThreshold,n.id),e=i.skins.filter((function(n){return n.skinType===1})),e.length<=0&&(u=o.ServiceContainer.Instance().get(s.ThresholdConstants.DynamicThresholdSkin),u.initSkin(n),u.setupSkin(i.chart,i._telemetryContext,i.chartData,t),i.skins.push(u)),i.skins.forEach((function(n){n.skinType!==1&&n.repaint(null,1,!0)})),i.skins=i.skins.filter((function(n){return n.skinType===1}))):i.skins=i.skins.filter((function(n){return n.skinType!==1}));i.chart.skins=i.skins;i.skins.length>0&&i.skins.forEach((function(n){n.setupSkin(i.chart,i._telemetryContext,i.chartData,t)}))})).catch((function(){return i._clearData(4,0),c.logWarning("Skins failed.",i._telemetryContext,{ContainerName:i._containerName}),Q()})):void 0},t.prototype._initializeSkins=function(n,t){return this._filterSkins(n,t),Q()},t.prototype._updateRefreshInterval=function(){if(this.itemDataModel&&this.itemDataModel.HasMetrics()){var n=this.refreshIntervalMs;b(this.itemDataModel)?this.refreshIntervalMs!==1e3&&(this.refreshIntervalMs=1e3):this.refreshIntervalMs!==0&&(this.refreshIntervalMs=0);n!==this.refreshIntervalMs&&this.onRefreshIntervalChanged()}},t})(e.BaseRefreshable);t.MetricChart=it}))