define("_generated/Less/MsPortalImpl.Controls/Controls/Documents/DiscussionThread.css",["module"],(function(n){"use strict";return{css:".fxc-discussionthread{border:2px solid #c5cbd1;background-color:#fff;font-family:az_ea_font,'Segoe UI',az_font,system-ui,-apple-system,BlinkMacSystemFont,Roboto,Oxygen,Ubuntu,Cantarell,'Open Sans','Helvetica Neue',sans-serif;font-weight:400;font-size:13px;line-height:1.385}.fxc-discussionthread .fxc-discussionthread-comments-container{list-style-type:none;margin:10px 5px 10px 0;padding:0}.fxc-discussionthread .fxc-discussionthread-comments-container>li{position:relative;margin-bottom:5px;margin-left:5px}.fxc-discussionthread .fxc-discussionthread-comments-container>li .fxc-discussionthread-comment-author-picture{position:absolute;top:0;left:5px;width:32px;height:32px;border-radius:3px}.fxc-discussionthread .fxc-discussionthread-comments-container>li .fxc-discussionthread-comment-content{margin:0 10px 0 45px}.fxc-discussionthread .fxc-discussionthread-comments-container>li .fxc-discussionthread-comment-content .fxc-discussionthread-comment-edit{position:relative}.fxc-discussionthread .fxc-discussionthread-comments-container>li .fxc-discussionthread-comment-content .fxc-discussionthread-comment-edit textarea{width:100%;margin:0;padding:1px 3px;border:1px solid transparent;resize:none;overflow:hidden;outline:none;white-space:pre-wrap;font-family:az_ea_font,'Segoe UI',az_font,system-ui,-apple-system,BlinkMacSystemFont,Roboto,Oxygen,Ubuntu,Cantarell,'Open Sans','Helvetica Neue',sans-serif;font-weight:400;font-size:13px;line-height:1.385}.fxc-discussionthread .fxc-discussionthread-comments-container>li .fxc-discussionthread-comment-content .fxc-discussionthread-comment-edit textarea:focus,.fxc-discussionthread .fxc-discussionthread-comments-container>li .fxc-discussionthread-comment-content .fxc-discussionthread-comment-edit textarea:hover{border-color:#dcdfe2}.fxc-discussionthread .fxc-discussionthread-comments-container>li .fxc-discussionthread-comment-content .fxc-discussionthread-comment-edit.fxc-discussionthread-comment-edit-disabled textarea:focus,.fxc-discussionthread .fxc-discussionthread-comments-container>li .fxc-discussionthread-comment-content .fxc-discussionthread-comment-edit.fxc-discussionthread-comment-edit-disabled textarea:hover{border-color:transparent}.fxc-discussionthread .fxc-discussionthread-comments-container>li .fxc-discussionthread-comment-content .fxc-discussionthread-comment-edit.fxc-discussionthread-comment-edit-empty textarea{border-color:#9cd5f4}.fxc-discussionthread .fxc-discussionthread-comments-container>li .fxc-discussionthread-comment-content .fxc-discussionthread-comment-edit .fxc-discussionthread-comment-edit-mirror{position:absolute;left:-999999px;height:0}.fxc-discussionthread .fxc-discussionthread-comments-container>li .fxc-discussionthread-comment-content .fxc-discussionthread-comment-status>*:nth-of-type(n+2)::before{content:' - '}.fxc-discussionthread .fxc-discussionthread-comments-container>li:nth-of-type(n+2){border-top:1px solid #dcdfe2}.fxc-discussionthread .fxc-discussionthread-comments-container>li:nth-of-type(n+2) .fxc-discussionthread-comment-author-picture{top:5px;left:25px}.fxc-discussionthread .fxc-discussionthread-comments-container>li:nth-of-type(n+2) .fxc-discussionthread-comment-content{margin-top:5px;margin-left:65px}",moduleId:n.id}}));
define("MsPortalImpl.Controls/Controls/Documents/DiscussionThread",["require","exports","MsPortalImpl.Controls/Controls/Base/Loadable","MsPortalImpl/Resources/ImplScriptResources","FxInternal/Css","_generated/Less/MsPortalImpl.Controls/Controls/Documents/DiscussionThread.css"],(function(n,t,i,r,u,f){"use strict";u.injectCss(f);var e;return (function(n){var h=MsPortalFx.ViewModels.Controls,c=h.Loadable.ViewModel,t=r.DiscussionThread,e="fxc-discussionthread",l="<!-- ko if: data.thread() && data.thread().comments().length > 0 --><ul data-bind='foreach: data.thread().comments' class='fxc-discussionthread-comments-container'><li><img data-bind='attr: { src: $data.author() ? $data.author().image : null }' class='fxc-discussionthread-comment-author-picture' /><div class='fxc-discussionthread-comment-content'><div data-bind='css: { \"fxc-discussionthread-comment-edit-disabled\": !isEditable(), \"fxc-discussionthread-comment-edit-empty\": !$ctl.getCommentMetadata($data, true).newContent() }' class='fxc-discussionthread-comment-edit'><textarea data-bind='value: $ctl.getCommentMetadata($data).newContent' class='fxc-discussionthread-comment-edit-mirror'><\/textarea><textarea data-bind='value: $ctl.getCommentMetadata($data).newContent, valueUpdate: \"input keyup\", attr: { readonly: !isEditable() }' class='fxc-discussionthread-comment-edit-original'><\/textarea><\/div><div class='fxc-discussionthread-comment-status'><!-- ko if: $data.author() --><span data-bind='text: $data.author().displayName'><\/span><!-- /ko --><!-- ko if: $ctl._showPublishedDate($data) --><span data-bind='text: $ctl._publishedDateString($data)'><\/span><!-- /ko --><!-- ko if: $ctl._showEditedText($data) --><span data-bind='text: $parent.data.resources().editedText'><\/span><!-- /ko --><!-- ko if: $ctl._showSaveText($data) --><span data-bind='text: $parent.data.resources().saveText'><\/span><!-- /ko --><!-- ko if: $ctl._showCancelText($data) --><span data-bind='text: $parent.data.resources().cancelText'><\/span><!-- /ko --><!-- ko if: $ctl._showCancelLink($data) --><span><a data-bind='text: $parent.data.resources().cancelLinkText' href='#' class='fxc-discussionthread-comment-cancel'><\/a><\/span><!-- /ko --><!-- ko if: $ctl._showReplyLink($data) --><span><a data-bind='text: $parent.data.resources().replyLinkText' href='#' class='fxc-discussionthread-comment-reply'><\/a><\/span><!-- /ko --><!-- ko if: $ctl._showDeleteLink($data) --><span><a data-bind='text: $parent.data.resources().deleteLinkText' href='#' class='fxc-discussionthread-comment-delete'><\/a><\/span><!-- /ko --><!-- ko if: $ctl.getCommentMetadata($data).message() --><span data-bind='text: $ctl.getCommentMetadata($data).message'><\/span><!-- /ko --><\/div><\/div><\/li><\/ul><!-- /ko -->",u=(function(){function n(){this.editedText=ko.observable(t.editedText);this.saveText=ko.observable(t.saveText);this.cancelText=ko.observable(t.cancelText);this.savingText=ko.observable(t.savingText);this.deletingText=ko.observable(t.deletingText);this.replyLinkText=ko.observable(t.replyLinkText);this.cancelLinkText=ko.observable(t.cancelLinkText);this.deleteLinkText=ko.observable(t.deleteLinkText)}return n})(),o,f,s;n.DiscussionControlResources=u;o=(function(n){function t(t){var i=n.call(this,t)||this;return i.author=ko.observable(null),i.thread=ko.observable(null),i.resources=ko.observable(new u),i.events=$.noop,i}return __extends(t,n),t})(c);n.ViewModel=o;f=(function(){function n(n,t,i,r,f){this.element=n;this.thread=t;this._metadataFinderDelegate=i;this._destroyDelegate=r;this._eventDelegate=f;this._currentSize={width:0,height:0};this._resources=new u;this._attachEvents();this.updateAllInputHeights()}return n.prototype.dispose=function(){this._detachEvents();this.element=null;this.thread=null;this._metadataFinderDelegate=null;this._destroyDelegate=null;this._eventDelegate=null},n.prototype.updateAllInputHeights=function(){var n=this;this.element.find(".fxc-discussionthread-comment-edit-original").each((function(t,i){n._updateInputHeight($(i))}))},n.prototype.focusIfNew=function(){this.thread.id()<0&&this.element.find(".fxc-discussionthread-comment-edit-original:last").focus()},n.prototype._attachEvents=function(){var n=this,t=this.element;this._inputChangeHandler=function(t){n._updateInputHeight($(t.target));n._fireSizeChangedEventIfNecessary()};this._inputFocusHandler=function(t){var r=ko.dataFor(t.target),i=n._metadataFinderDelegate(r);i.editing(!0);i.message(null);n._fireSizeChangedEventIfNecessary()};this._inputBlurHandler=function(t){var i=ko.dataFor(t.target),r=n._metadataFinderDelegate(i);r&&(n._save(i),r.editing(!1));n._fireSizeChangedEventIfNecessary()};this._inputKeyDownHandler=function(t){t.which===13?t.shiftKey||(n._save(ko.dataFor(t.target)),t.preventDefault()):t.which===27&&n._cancel(ko.dataFor(t.target));n._fireSizeChangedEventIfNecessary()};this._replyClickHandler=function(i){n.thread.addComment.execute().then((function(){var i=t.find(".fxc-discussionthread-comment-edit-original:last");n._updateInputHeight(i);n._fireSizeChangedEventIfNecessary();i.focus()}));i.preventDefault()};this._cancelClickHandler=function(t){n._cancel(ko.dataFor(t.target));n._fireSizeChangedEventIfNecessary()};this._deleteClickHandler=function(t){n._delete(ko.dataFor(t.target))};t.on("input keyup",".fxc-discussionthread-comment-edit-original",this._inputChangeHandler).on("focus",".fxc-discussionthread-comment-edit-original",this._inputFocusHandler).on("blur",".fxc-discussionthread-comment-edit-original",this._inputBlurHandler).on("keydown",".fxc-discussionthread-comment-edit-original",this._inputKeyDownHandler).on("click",".fxc-discussionthread-comment-reply",this._replyClickHandler).on("click",".fxc-discussionthread-comment-cancel",this._cancelClickHandler).on("click",".fxc-discussionthread-comment-delete",this._deleteClickHandler)},n.prototype._detachEvents=function(){var n=this.element;this._inputChangeHandler&&(n.off("input keyup",".fxc-discussionthread-comment-edit-original",this._inputChangeHandler),this._inputChangeHandler=null);this._inputFocusHandler&&(n.off("focus",".fxc-discussionthread-comment-edit-original",this._inputFocusHandler),this._inputFocusHandler=null);this._inputBlurHandler&&(n.off("blur",".fxc-discussionthread-comment-edit-original",this._inputBlurHandler),this._inputBlurHandler=null);this._inputKeyDownHandler&&(n.off("keydown",".fxc-discussionthread-comment-edit-original",this._inputKeyDownHandler),this._inputKeyDownHandler=null);this._replyClickHandler&&(n.off("click",".fxc-discussionthread-comment-reply",this._replyClickHandler),this._replyClickHandler=null);this._cancelClickHandler&&(n.off("click",".fxc-discussionthread-comment-cancel",this._cancelClickHandler),this._cancelClickHandler=null);this._deleteClickHandler&&(n.off("click",".fxc-discussionthread-comment-delete",this._deleteClickHandler),this._deleteClickHandler=null)},n.prototype._fireSizeChangedEventIfNecessary=function(){if(this._eventDelegate&&this.element){var n={width:this.element.outerWidth(),height:this.element.outerHeight()};(this._currentSize.width!==n.width||this._currentSize.height!==n.height)&&(this._currentSize=MsPortalFx.clone(n),this._eventDelegate("sizeChanged",n))}},n.prototype._updateInputHeight=function(n){var r=n.height(),t=n.siblings("textarea"),i=t[0].scrollHeight+t.outerHeight();return i!==r?(n.height(i),!0):!1},n.prototype._save=function(n){var u=n.content(),t=this._metadataFinderDelegate(n),i=t.newContent(),r=this.thread;i&&i!==u&&(r.id()<0?(t.message(this._resources.savingText()),r.save.execute(i).then((function(u){t.message(null);n.content(i);u&&(u.id&&r.id(u.id),u.publishedDate&&r.publishedDate(u.publishedDate),u.lastUpdatedDate&&r.lastUpdatedDate(u.lastUpdatedDate),n.threadId(u.id),u.commentResult&&(u.commentResult.id&&n.id(u.commentResult.id),u.commentResult.publishedDate&&n.publishedDate(u.commentResult.publishedDate),u.commentResult.lastUpdatedDate&&n.lastUpdatedDate(u.commentResult.lastUpdatedDate)))})).catch((function(n){t.message(n)}))):(t.message(this._resources.savingText()),n.save.execute(i).then((function(r){t.message(null);n.content(i);r&&(r.id&&n.id(r.id),r.publishedDate&&n.publishedDate(r.publishedDate),r.lastUpdatedDate&&n.lastUpdatedDate(r.lastUpdatedDate))})).catch((function(n){t.message(n)}))))},n.prototype._cancel=function(n){var t,r,i;n.id()<0?(this.thread.comments.remove(n),this.thread.comments().length===0&&this._destroyDelegate&&this._destroyDelegate()):(i=this._metadataFinderDelegate(n),r=i.newContent(),t=n.content(),r!==t&&i.newContent(t))},n.prototype._delete=function(n){var t=this,i=this._metadataFinderDelegate(n);n.canDelete()&&(i.message(this._resources.deletingText()),this.thread.deleteComment.execute(n.id()).then((function(){i.message(null);t._fireSizeChangedEventIfNecessary();t.thread.comments().length===0&&t._destroyDelegate&&t._destroyDelegate()})).catch((function(n){i.message(n)})))},n})();n.DiscussionInteractionManager=f;s=(function(n){function t(t,i,r){var u=n.call(this,t,i,r)||this;u._allCommentMetadata=[];t.addClass(e).html(l);u._bindDescendants();var o=function(n){return u.getCommentMetadata(n)},s=function(){u._destroyIfNoCommentExists()},h=function(n,t){return u.options.events(n,t)};return u._interactionManager=new f(t,i.thread(),o,s,h),u._initializeSubscriptions(),u}return __extends(t,n),t.prototype.dispose=function(){this._checkExistsOrRegisterDestroyId(n.prototype.dispose)||(this._interactionManager.dispose(),ko.cleanNode(this.element[0]),this._cleanElement(e),this._allCommentMetadata=null,n.prototype.dispose.call(this))},Object.defineProperty(t.prototype,"options",{get:function(){return this._options},enumerable:!1,configurable:!0}),t.prototype.getCommentMetadata=function(n,t){t===void 0&&(t=!1);var i=MsPortalFx.find(this._allCommentMetadata,(function(t){return t&&t.comment===n}));return!i&&t&&(i=this._addCommentMetadata(n)),i},t.prototype.updateAllInputHeights=function(){this._interactionManager.updateAllInputHeights()},t.prototype.focusIfNew=function(){this._interactionManager.focusIfNew()},t.prototype._initializeSubscriptions=function(){var n=this;this.options.thread()&&this.options.thread().comments()&&this.options.thread().comments.subscribeArrayChanges(this.ltm,(function(t){n._addCommentMetadata(t)}),(function(t){var i=-1;n._allCommentMetadata.some((function(n,r){return n.comment===t?(i=r,!0):!1}));i>=0&&n._allCommentMetadata.splice(i,1)}))},t.prototype._destroyIfNoCommentExists=function(){this.dispose();this.options.events("destroyed")},t.prototype._addCommentMetadata=function(n){var t={comment:n,editing:ko.observable(!1),message:ko.observable(null),newContent:ko.observable(n.content())};return this._allCommentMetadata.push(t),t},t.prototype._publishedDateString=function(n){var t=n.publishedDate();return t?t.toRelativeString():""},t.prototype._showPublishedDate=function(n){return n.id()>0&&!!n.publishedDate()},t.prototype._showEditedText=function(n){var t=n.publishedDate(),i=n.lastUpdatedDate();return t&&i?t.getTime()!==i.getTime():!1},t.prototype._showSaveText=function(n){var t=this.getCommentMetadata(n);return t.editing()&&(n.id()<0||t.newContent()!==n.content())},t.prototype._showCancelText=function(n){var t=this.getCommentMetadata(n);return t.editing()&&(n.id()<0||t.newContent()!==n.content())},t.prototype._showCancelLink=function(n){var t=this.getCommentMetadata(n);return!t.editing()&&!t.newContent()},t.prototype._showReplyLink=function(n){var t=this.options.thread().comments();return n.id()>0&&t[t.length-1]===n},t.prototype._showDeleteLink=function(n){return n.id()>0&&n.canDelete()},t})(i.Widget);n.Widget=s})(e||(e={})),e}));
define("MsPortalImpl.Controls/Controls/Documents/Editor.Extension",["require","exports"],(function(){"use strict";var n;return (function(n){var t,i;(function(n){n[n.Editor=1]="Editor";n[n.DiffEditorSxS=2]="DiffEditorSxS";n[n.DiffEditorInline=3]="DiffEditorInline"})(t=n.EditorMode||(n.EditorMode={}));i=(function(){function n(n,t,i){this._initialized=!1;this._editorValue=n;this._editorMode=t;this._options=i;this._initializeWidgets()}return Object.defineProperty(n.prototype,"editor",{get:function(){return this._editorValue},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"editorMode",{get:function(){return this._editorMode},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isDiffEditor",{get:function(){return this._editorMode!==t.Editor},enumerable:!1,configurable:!0}),n.prototype.getCodeEditor=function(n){return(n===void 0&&(n=!0),this.isDiffEditor)?n?this._editorValue.getModifiedEditor():this._editorValue.getOriginalEditor():this._editorValue},Object.defineProperty(n.prototype,"options",{get:function(){return this._options},enumerable:!1,configurable:!0}),n.prototype.dispose=function(){this._editorValue=null},n.prototype.onDiffRenderModeChanged=function(n){this._editorMode=n?t.DiffEditorSxS:t.DiffEditorInline},n.prototype._initializeWidgets=function(){},n})();n.Extension=i})(n||(n={})),n}));
define("_generated/Less/MsPortalImpl.Controls/Controls/Documents/Editor.DiscussionExtension.css",["module"],(function(n){"use strict";return{css:".fxc-discussionextension-zonewidget-filler{width:100%;height:100%;background-color:#f1f1f8}.fxc-discussionextension-zonewidget-filler-emptyblock{width:100%;height:100%;background-image:url(data:image/png;base64\\,iVBORw0KGgoAAAANSUhEUgAAAAkAAAAJCAYAAADgkQYQAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAadEVYdFNvZnR3YXJlAFBhaW50Lk5FVCB2My41LjEwMPRyoQAAAChJREFUKFNjOH/+fAMDDgCSu3Dhwn9c8gwwBTgNGR4KQP4HhQOhsAIAZCBTkhtqePcAAAAASUVORK5CYII=)}.fxc-discussionextension-gutterwidget-add-thread{height:16px;width:16px;left:2px;cursor:pointer;z-index:100;top:-1000px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAAQCAIAAACUZLgLAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAE3SURBVDhPlZM/ToVAEMb3gYEQrkFNZWFjQUIHhVpxCA/ADSSx9RQUakNtYbWegYQjqAXLv4frJzMiSF5e3i8v+74Z5svszsJOaz2OY9/34hfLskzT5OAAPzaWp2A0TcPyFAz6wz7hv7g/xw8CIeUPwbbl2QBCmLd0XUcFO6WU4zhoQvHMy+1rFEUcTLium2WZ53m2bZ/Bw+k1+ks/PT5zMFFVVZqmeZ5D8ySxAazBwyVW9MEK2zDsIZZc31wVRYFOfDbcFQkAQ98NW88SthHoQ62OsrJhBkf7ECsbwLlZbcAjDJP038uFOynLErOq65oyAMPMsjv5JqGXFyBgm2nbFtc4EwTBx/tnkiQcK4UCqlzZwH4CbwmKYIvjWEqJjVCei7T+fzZ8MsAwOB+Goe/79CkBSgohvgFrxfA75oE/YAAAAABJRU5ErkJggg==)}",moduleId:n.id}}));
define("MsPortalImpl.Controls/Controls/Documents/Editor.DiscussionExtension",["require","exports","MsPortalImpl.Controls/Controls/Documents/DiscussionThread","MsPortalImpl.Controls/Controls/Documents/Editor.Extension","FxInternal/Css","_generated/Less/MsPortalImpl.Controls/Controls/Documents/Editor.DiscussionExtension.css"],(function(n,t,i,r,u,f){"use strict";u.injectCss(f);var e;return (function(n){function o(n){var t=function(t,i,r){n.call(this,t,{showFrame:!1,showArrow:!1});this._element=i;this._options=r||{};var u=r.elementClassName;u&&i.addClass(u);this._heightInLines=0};return u.__extends(t,n),t.prototype.showWidget=function(){var n=this._options;this.create();this.show(n.position,this._heightInLines)},t.prototype.fillContainer=function(t){n.prototype.fillContainer.call(this,t);var i=this._measureHeight();this._calculateHeightInLines(i);this._element.appendTo(t)},t.prototype.dispose=function(){var t=this._element;t&&t.remove();this._element=null;n.prototype.dispose.call(this)},t.prototype.onWidth=function(n){var t=this._options,i;t.widthChangeDelegate&&(t.widthChangeDelegate(n),i=this._element.outerHeight(),this.updateHeight(i))},t.prototype.updateHeight=function(n){var t=this._calculateHeightInLines(n);t&&this._updateHeight(this._heightInLines)},t.prototype.getElement=function(){return this._element},t.prototype.getHeight=function(){var n=this.editor.getConfiguration().lineHeight;return n*this._heightInLines},t.prototype._updateHeight=function(n){var t=this,i=this.editor,r=this.position,u=FxImpl.createElement("div"),f=i.getConfiguration().lineHeight,o=n*f;i.changeViewZones((function(i){t.zoneId!==-1&&i.removeZone(t.zoneId);var f=new e(u,r.lineNumber,r.column,n,function(n){return t.onViewZoneTop(n)},function(n){return t.onViewZoneHeight(n)});t.zoneId=i.addZone(f)}));this.container.style.height=o+"px"},t.prototype._measureHeight=function(){var n,i=this._options;return t.measureElement||(t.measureElement=$(FxImpl.createElement("div")).css("position","absolute").css("top","-99999px").css("left","-99999px").appendTo(document.body)),n=this.editor.getLayoutInfo().width,n-=i.rightMargin||0,t.measureElement.width(n),this._element.appendTo(t.measureElement),i.widthChangeDelegate&&i.widthChangeDelegate(n),this._element.outerHeight()},t.prototype._calculateHeightInLines=function(n){var t=this._options,i=this.editor.getConfiguration().lineHeight,r=n+(t.heightOffset||0),u=this._heightInLines;return this._heightInLines=Math.ceil(r/i),this._heightInLines!==u},t}var u=window,e=(function(){function n(n,t,i,r,u,f){this.domNode=n;this.afterLineNumber=t;this.afterColumn=i;this.heightInLines=r;this._onDomNodeTop=u;this._onComputedHeight=f}return n.prototype.onDomNodeTop=function(n){this._onDomNodeTop(n)},n.prototype.onComputedHeight=function(n){this._onComputedHeight(n)},n})(),t=(function(){function n(){this._domNode=null;this._lineNumber=0}return n.hideConditionally=function(n,t){t===void 0&&(t=!0);n&&t&&n.hide()},n.prototype.getId=function(){return n.addThreadId},n.prototype.getDomNode=function(){var n=this;return this._domNode||(this._domNode=$(FxImpl.createElement("div")).addClass("fxc-discussionextension-gutterwidget-add-thread").click((function(t){n._clickHandler&&n._clickHandler(n._lineNumber,t)}))[0]),this._domNode},n.prototype.getPosition=function(){return null},n.prototype.setPosition=function(n,t){this._lineNumber=n;this.getDomNode().style.top=t+"px"},n.prototype.setClickHandler=function(n){this._clickHandler=n},n.prototype.hide=function(){this.setPosition(0,-1e3)},n.addThreadId="add-thread-gutter",n})(),s=5,h=10,c=5,f=5,l=(function(n){function e(t,i,r,u){var f=n.call(this,i,r,u)||this;return f._widgetAssociations=[],f._ltm=t,f}return __extends(e,n),Object.defineProperty(e.prototype,"options",{get:function(){return this._options},enumerable:!1,configurable:!0}),e.prototype.dispose=function(){this._originalGutterWidget&&(this.getCodeEditor(!1).removeOverlayWidget(this._originalGutterWidget),this._originalGutterWidget=null);this._modifiedGutterWidget&&(this.getCodeEditor(!0).removeOverlayWidget(this._modifiedGutterWidget),this._modifiedGutterWidget=null);this._destroyZoneWidgets();n.prototype.dispose.call(this)},e.prototype.onDiffRenderModeChanged=function(t){n.prototype.onDiffRenderModeChanged.call(this,t);this._destroyZoneWidgets();this._initializeZoneWidgets()},e.prototype._initializeWidgets=function(){var t=this;n.prototype._initializeWidgets.call(this);this.isDiffEditor?u.requirejs(["vs/editor/contrib/diffNavigator/diffNavigator"],(function(n){var i=new n.DiffNavigator(t.editor);i.onDidUpdateDiff((function(){t._initialize()}))})):this._initialize()},e.prototype._destroyZoneWidgets=function(){var n=this;this._widgetAssociations.forEach((function(t){n._destroyWidgetAssociation(t)}));this._widgetAssociations=[];this._threadsSubscriptionLifetime&&this._threadsSubscriptionLifetime.dispose()},e.prototype._destroyWidgetAssociation=function(n){n.threadWidget&&(n.threadWidget.dispose(),n.threadWidget=null);n.zoneWidget&&(n.zoneWidget.dispose(),n.zoneWidget=null)},e.prototype._initialize=function(){this._initialized||(this._initializeZoneWidgets(),this._initializeGutterWidgets(),this._initializeGlyphs(),this._initialized=!0)},e.prototype._initializeZoneWidgets=function(){var n=this;this._threadsSubscriptionLifetime&&this._threadsSubscriptionLifetime.dispose();this._threadsSubscriptionLifetime=this._ltm.createChildLifetime();this.options.threads().filter((function(n){return n.comments().length>0})).forEach((function(t){n._createZoneWidget(t)}));this.options.threads.subscribeArrayChanges(this._threadsSubscriptionLifetime,(function(t){n._createZoneWidget(t)}),(function(t){var i=MsPortalFx.find(n._widgetAssociations,(function(n){return n&&n.threadWidget&&n.threadWidget.options.thread()===t}));i&&n._destroyWidgetAssociation(i)}))},e.prototype._createZoneWidget=function(n){var u=this,t=this._createDiscussionThreadWidget(this.options.author(),n),r=this._createDiscussionZoneWidget(t),i;t.focusIfNew();i={threadWidget:t,zoneWidget:r};this._widgetAssociations.push(i);t.options.events=function(n,t){var f;return n==="sizeChanged"?(f=t,r.updateHeight(f.height)):n==="destroyed"&&(i.threadWidget=null,u._destroyWidgetAssociation(i)),null}},e.prototype._createDiscussionThreadWidget=function(n,t){var r=new i.ViewModel(this._ltm);return r.author(n),r.thread(t),new i.Widget($(FxImpl.createElement("div")),r)},e.prototype._createDiscussionZoneWidget=function(n){var u=n.options.thread().position().isModifiedSide,i,t;return this._ensureZoneWidgetType(),i=this._discussionZoneWidgetType,t=new i(this.getCodeEditor(this.editorMode===r.EditorMode.DiffEditorInline?!0:u),this._getDiscussionZoneWidgetElement(n),this._getDiscussionZoneWidgetOptions(n)),t.showWidget(),t},e.prototype._getDiscussionZoneWidgetElement=function(n){var t=n.element,i=n.options.thread().position().isModifiedSide,r=this.getCodeEditor(i).getLayoutInfo().lineNumbersWidth;return t.css("margin-left",r+h+"px"),t.css("margin-right",f+"px"),t.css("margin-top",s+"px"),t},e.prototype._getDiscussionZoneWidgetOptions=function(n){var u=n.options.thread(),t=u.position(),i=Math.max(t.startLine,t.endLine),e=t.isModifiedSide;return e||this.editorMode!==r.EditorMode.DiffEditorInline||(i=this.editor.getDiffLineInformationForOriginal(i).equivalentLineNumber),{position:{lineNumber:i,column:Math.floor((t.startColumn+t.endColumn)/2)},rightMargin:f,heightOffset:c,widthChangeDelegate:function(){n.updateAllInputHeights()},elementClassName:"fxc-discussionextension-zonewidget"}},e.prototype._ensureZoneWidgetType=function(){var n;this._discussionZoneWidgetType||(n=u.requirejs("vs/editor/contrib/zoneWidget/zoneWidget").ZoneWidget,this._discussionZoneWidgetType=o(n))},e.prototype._initializeGutterWidgets=function(){this.isDiffEditor?(this._modifiedGutterWidget=this._createGutterWidget(!0),this._originalGutterWidget=this._createGutterWidget(!1)):this._modifiedGutterWidget=this._createGutterWidget(!0)},e.prototype._createGutterWidget=function(n){var i=this,r=this.getCodeEditor(n),f=new t;u.requirejs("vs/editor/core/constants");f.setClickHandler((function(t){i.options.addThread&&i.options.addThread.execute({isModifiedSide:n,startColumn:1,endColumn:1,startLine:t,endLine:t})}));r.addOverlayWidget(f);r.onMouseMove((function(t){i._onEditorMouseMove(t.target,n)}));r.onMouseLeave((function(){t.hideConditionally(i._originalGutterWidget);t.hideConditionally(i._modifiedGutterWidget)}));return f},e.prototype._onEditorMouseMove=function(n,i){var r=n.position?n.position.lineNumber:0,f=i?this._modifiedGutterWidget:this._originalGutterWidget,u=this.getCodeEditor(i);(r!==this._lastMouseOverLineNumber||i!==this._lastMouseOverIsModifiedSide)&&n.detail!==t.addThreadId&&(t.hideConditionally(this._originalGutterWidget,!n.position||i),t.hideConditionally(this._modifiedGutterWidget,!n.position||!i),n.position&&f.setPosition(r,u.getTopForLineNumber(r)-u.getScrollTop()),this._lastMouseOverIsModifiedSide=i,this._lastMouseOverLineNumber=r)},e.prototype._initializeGlyphs=function(){},e})(r.Extension);n.DiscussionExtension=l})(e||(e={})),e}));
define("_generated/Less/MsPortalImpl.Controls/Controls/Documents/Editor.css",["module"],(function(n){"use strict";return{css:".fxc-editor{box-sizing:border-box;border-width:1px;border-style:solid;overflow:hidden}.fxc-editor.fxc-editor-disabled{opacity:.5}.fxc-editor .fxc-editor-content{height:100%;width:100%}.monaco-editor.vs .line-numbers{color:#0058ad}.monaco-editor>.context-view{overflow-y:auto}.monaco-editor.vs-dark .line-numbers{color:#777}.monaco-quick-open-widget{position:relative}",moduleId:n.id}}));
define("MsPortalImpl.Controls/Controls/Documents/Editor",["require","exports","MsPortalImpl.Controls/Controls/Controls.CommandHelpers","MsPortalImpl/Base/JQueryHelper","MsPortalImpl/Base/Themes","Viva.Controls/Util/Viva.Resize","MsPortalImpl.Controls/Controls/Base/Loadable","MsPortalImpl.Controls/Controls/Documents/Editor.DiscussionExtension","MsPortalImpl.Controls/Controls/Documents/Editor.Extension","MsPortalImpl/Interactions/Interactions.DismissHandler","FxInternal/Css","_generated/Less/MsPortalImpl.Controls/Controls/Documents/Editor.css","MsPortalImpl/Resources/ImplScriptResources"],(function(n,t,i,r,u,f,e,o,s,h,c,l,a){"use strict";c.injectCss(l);var v;return (function(t){function it(n){var t=[],i={suggestions:t},r=function(n){return n?n.charAt(0).toUpperCase()+n.slice(1):null};return n.forEach((function(n){var i={label:null,kind:null,insertText:null,range:null};typeof n=="string"?(i.label=n,i.kind=monaco.languages.CompletionItemKind.Text,i.insertText=n):(i.label=n.label,i.kind=monaco.languages.CompletionItemKind[r(n.type)],i.insertText=n.codeSnippet,n.documentationLabel&&(i.documentation=n.documentationLabel));t.push(i)})),i}function l(n){return!n.hasOwnProperty("options")}var w=MsPortalFx.Base,g=w.Diagnostics,b=w.Resources,y=MsPortalFx.ViewModels.Controls.Documents.Editor,c=y.ContentType,nt=MsPortalFx.clone,k=i.attachHandler,p=window,d="fxc-editor",tt="<div class='fxc-editor-content'><\/div>",v=g.createLog(n),rt=(function(n){function t(t,i,r){var u=n.call(this,t,i,$.extend({fillBehavior:3},r))||this;return u._decorations=[],u._ignoreUpdateFromKeyboard=!1,u._isDestroyed=!1,v.verbose("instance created"),i.content.extend({notify:"always"}),t.addClass(d+" fxs-portal-border").html(tt),u._saving=!1,u._editorModelValue=null,u._editorValue=null,u._editorExtensions=[],p.MonacoEnvironment||(p.MonacoEnvironment={}),p.MonacoEnvironment.getWorkerUrl=function(n,t){var i="",r=MsPortalEarly.query.clientoptimizations;return r&&r.toLowerCase()==="false"&&(i="ClientOptimizations=false&"),b.getAppRelativeUri("Editor/WebWorker")+"?"+i+"label="+t},p.requirejs(["vs/editor/editor.main"],(function(){u._content=t.findByClassName("fxc-editor-content");l(i)?(i.ariaLabel.subscribeAndRun(u.ltm,(function(n){u._content.attr("aria-label",n)})),i.refreshPayload.subscribe(u.ltm,(function(n){n&&(u._refresh(),i.refreshPayload(!1))})),i.savePayload.subscribe(u.ltm,(function(n){n&&(u._save(),i.savePayload(!1))}))):(u._content.attr("aria-label",i.options().ariaLabel),k(u.ltm,i.save,u._save,u._canSave,u),k(u.ltm,i.refresh,u._refresh,u._canRefresh,u));u._load();u._initializeSubscriptions();u._disableElement(i.disabled());u._resetResizeTracking()})),u}return __extends(t,n),t.prototype.dispose=function(){this._checkExistsOrRegisterDestroyId(n.prototype.dispose)||(this._isDestroyed=!0,v.verbose("instance disposed"),this._editorExtensions.forEach((function(n){n.dispose()})),this._editorExtensions=null,this._editorValue&&(this._editorValue.dispose(),this._editorValue=null),n.prototype.dispose.call(this),this._cleanElement(d))},Object.defineProperty(t.prototype,"options",{get:function(){return this._options},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_editor",{get:function(){return this._editorValue},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_editorModel",{get:function(){return this._editorModelValue},set:function(n){this._editorModelValue=n},enumerable:!1,configurable:!0}),t.prototype._isCustomLanguage=function(n){return n===c.Custom},t.prototype._editorLanguage=function(n){switch(n){case c.Bat:return"text/x-bat";case c.C:return"text/x-c";case c.CoffeeScript:return"text/coffeescript";case c.Cpp:return"text/x-cpp";case c.CSharp:return"text/x-csharp";case c.CSHtml:return"text/x-cshtml";case c.Css:return"text/css";case c.Dockerfile:return"text/x-dockerfile";case c.FSharp:return"text/x-fsharp";case c.Go:return"text/x-go";case c.Handlebars:return"text/x-handlebars-template";case c.Html:return"text/html";case c.Ini:return"text/x-ini";case c.Pug:return"pug";case c.Java:return"text/x-java-source";case c.JavaScript:return"text/javascript";case c.JSHtm:return"text/x-jshtm";case c.Json:return"application/json";case c.Less:return"text/x-less";case c.Lua:return"text/x-lua";case c.MarkDown:return"text/x-markdown";case c.ObjectiveC:return"objective-c";case c.Php:return"application/x-php";case c.PowerShell:return"text/x-powershell";case c.Python:return"text/x-python";case c.R:return"text/x-r";case c.Ruby:return"text/x-ruby";case c.Sql:return"sql";case c.Swift:return"swift";case c.TypeScript:return"text/typescript";case c.VisualBasic:return"text/x-vb";case c.Xaml:return"application/xaml+xml";case c.Xml:return"text/xml";case c.MySQL:return"mysql";case c.PgSQL:return"pgsql";case c.Yaml:return"yaml";case c.Text:default:return"text/plain"}},t.prototype._addContentChangedListenerToModel=function(){var n=this;this._editorModel.onDidChangeContent((function(){n.options.dirty(!0);n._handleAutoSave()}))},t.prototype._handleAutoSave=function(){var n=this,t=l(this.options)?this.options.autoSaveDelay:this.options.autoSaveTimeout();t&&(this._autoSaveHandle&&clearTimeout(this._autoSaveHandle),this._autoSaveHandle=setTimeout((function(){n._autoSaveHandle=null;n._save()}),t))},t.prototype._getEditorOptions=function(){var t={roundedSelection:!0,contextmenu:!0,readOnly:!1,scrollBeyondLastLine:!1,fixedOverflowWidgets:!0,minimap:{enabled:!1}},r,u,f,i,e,n;return l(this.options)?(n=this.options,r=n.readOnly(),u=n.showLineNumbers(),f=n.enhancedScrollbar(),i=n.wrappingColumn(),e=n.selectionHighlight()):(n=this.options.options(),r=n.readOnly,u=n.lineNumbers,f=n.enhancedScrollbar,i=n.wrappingColumn),this.$disabled()?t.readOnly=!0:r!==undefined&&(t.readOnly=r),u!==undefined&&(t.lineNumbers=u?"on":"off"),f!==undefined&&(t.minimap.enabled=f),i!==undefined&&(i===-1?t.wordWrap="off":i===0?t.wordWrap="on":(t.wordWrap="wordWrapColumn",t.wordWrapColumn=i)),e!==undefined&&(t.selectionHighlight=e),t},t.prototype._initializeWidgets=function(){this._bindDescendants()},t.prototype._subscribeTheme=function(){var n=this,t=this._diContainer;return t?t.getAsync(u.ThemeManager).then((function(t){var r=t&&t.currentTheme,i;return r&&r.subscribe(n.ltm,(function(){n._updateTheme(t)})),i=t&&t.highContrastMode,i&&i.subscribe(n.ltm,(function(){n._updateTheme(t)})),t})):Q(null)},t.prototype._load=function(){var n=this;v.verbose("load initiated");this._subscribeTheme().then((function(t){if(v.verbose("required amd editor modules loaded"),n._isDestroyed){v.verbose("disposed before required amd editor modules loaded");return}n.options.loading(!1);n._setSyntaxHighlightTokens();n._createEditorAndModel();n._updateEditorOptions();n._updateModelOptions();n._updateLanguage();n._updateMinHeight();n._updateTheme(t);n._initializeExtensions()}))},t.prototype._getContentUri=function(){if(this.options&&this.options.contentUri&&this.options.contentUri()){var n=this.options.contentUri(),t=/^([^:/?#]+?:([/]+|[\\]?))?(.*)?/.exec(n);return n=(t[1]||"schema://")+MsPortalFx.getUniqueId()+t[3],monaco.Uri.parse(n,!1)}return null},t.prototype._setSyntaxHighlightTokens=function(){var n=[{token:"info-token",foreground:"6796e6"},{token:"warn-token",foreground:"cd9731"},{token:"error-token",foreground:"f44747"},{token:"debug-token",foreground:"b267e6"},];monaco.editor.defineTheme("lightTheme",{base:"vs",inherit:!0,rules:[{token:"info-token",foreground:"316bcd"},{token:"warn-token",foreground:"cd9731"},{token:"error-token",foreground:"cd3131"},{token:"debug-token",foreground:"800080"},],colors:{}});monaco.editor.defineTheme("darkTheme",{base:"vs-dark",inherit:!0,rules:n,colors:{}});monaco.editor.defineTheme("darkHighContrastTheme",{base:"hc-black",inherit:!0,rules:n,colors:{}})},t.prototype.createModel=function(n,t){return monaco.editor.createModel(n||"",t?null:"text/plain",t)},t.prototype._addLanguageReferenceToContextMenu=function(){this._editor.addAction({id:"languageReferenceID",label:a.Controls.Editor.languageReference,contextMenuGroupId:"10_languageReferenceID",run:function(){window.open("https://docs.microsoft.com/en-us/azure/governance/resource-graph/concepts/query-language")}})},t.prototype._isArgSchema=function(n){return n&&!("clusterType"in n)},t.prototype._modifyUnsupportedMenuItems=function(){var r=this,n,t,i;(function(n){n[n.GoToDefinition=0]="GoToDefinition";n[n.GoToReferences=1]="GoToReferences";n[n.Peek=2]="Peek";n[n.HorizontalBorder1=3]="HorizontalBorder1";n[n.FormatCommandUnderCursor=4]="FormatCommandUnderCursor";n[n.RenameSymbol=5]="RenameSymbol";n[n.ChangeAllOccurences=6]="ChangeAllOccurences";n[n.FormatDocument=7]="FormatDocument";n[n.HorizontalBorder2=8]="HorizontalBorder2";n[n.LanguageReference=9]="LanguageReference";n[n.HorizontalBorder3=10]="HorizontalBorder3";n[n.Cut=11]="Cut";n[n.Copy=12]="Copy";n[n.Paste=13]="Paste";n[n.HorizontalBorder4=14]="HorizontalBorder4";n[n.CommandPalette=15]="CommandPalette"})(n||(n={}));t=$("div.fxc-editor-content");i=t.offset();this._content[0].addEventListener("contextmenu",(function(u){u.preventDefault();var f=[n.GoToDefinition,n.Peek,n.HorizontalBorder1,n.RenameSymbol,],e=r._content[0].getElementsByClassName("shadow-root-host")[0].shadowRoot,o=e.querySelector("div").getElementsByClassName("actions-container")[0].getElementsByClassName("action-item");return f.forEach((function(n){o[n].setAttribute("style","display: none")})),t.offset(i),!1}),!1)},t.prototype._convertToEngineSchema=function(n){var i=(n===null||n===void 0?void 0:n.tables)||[],t={name:"ARGDatabase",tables:i,functions:[],majorVersion:0,minorVersion:0},r={connectionString:"",databases:[t]};return{cluster:r,database:t,clusterType:"Engine"}},t.prototype._createKustoEditor=function(){var t=this,n=b.getContentUri("Content/Scripts/_oss/monaco-editor/0.25.2/min/vs/language/kusto/");p.requirejs(["vs/editor/editor.main",n+"bridge.min.js"],(function(){p.requirejs([n+"newtonsoft.json.min.js",n+"kusto.javascript.client.min.js",n+"Kusto.Language.Bridge.min.js","vs/language/kusto/monaco.contribution"],(function(){return __awaiter(t,void 0,void 0,(function(){var i,r,u,n,t=this;return __generator(this,(function(f){switch(f.label){case 0:return l(this.options)?(i={value:this.options.content(),language:"kusto"},this._editorValue=monaco.editor.create(this._content[0],i),this._addLanguageReferenceToContextMenu(),[4,monaco.languages.kusto.getKustoWorker()]):[3,3];case 1:return r=f.sent(),this._editorModel=this._editorValue.getModel(),u=this,[4,r(this._editorModel)];case 2:u._kustoWorker=f.sent();n=this.options.contentSchema();this._modifyUnsupportedMenuItems();n?this._isArgSchema(n)?this._kustoWorker.setSchema(this._convertToEngineSchema(n)):this._kustoWorker.setSchema(n):this._kustoWorker.setSchema(this._convertToEngineSchema(null));this.applyBindings();this._editorModel.onDidChangeContent((function(){var n=t._editorModel.getValue();t._ignoreUpdateFromKeyboard=!0;t.options.content(n);t._ignoreUpdateFromKeyboard=!1}));f.label=3;case 3:return[2]}}))}))}))}))},t.prototype.applyBindings=function(){var n=this,i,t;v.verbose("editor created with the plain text model");i={dismissFn:MsPortalFx.noop,logName:"editor"};this._editor.onDidFocusEditorWidget((function(){h.register(i);n.ltm.registerForDispose((function(){h.unregister(i)}))}));this._editor.onDidBlurEditorWidget((function(){h.unregister(i)}));if(l(this.options)){t=this.options;this._editor.addCommand(monaco.KeyMod.CtrlCmd|monaco.KeyCode.KEY_S,(function(){n._save()}));this.options.customCommands().forEach((function(t){var i=t.keyModifier?t.keyModifier|t.keyCode:t.keyCode;n._editor.addCommand(i,(function(){t.commandCallback(t.keyCode,t.keyModifier)}))}));this._editor.onDidChangeCursorPosition((function(){t.dirty()||n._saving||n.updateCursorPosition()}));this._editor.onDidChangeCursorSelection((function(i){var r,u;if(t.dirty()||n._saving||n.updateSelection(),t.blockHighlight()){if(!i.selection.isEmpty()){n._decorations=n._editor.deltaDecorations(n._decorations,[]);return}r=t.defineBlock?t.defineBlock(i.selection.getStartPosition(),n._editor.getModel().getLinesContent()):n._getCurrentCommandRange(n._editor,i.selection.getStartPosition());u=[{range:r,options:{className:"selectionHighlight"}}];n._decorations=n._editor.deltaDecorations(n._decorations,u);t.blockContent(n._editor.getModel().getValueInRange(r))}}))}},t.prototype._createEditorAndModel=function(){v.verbose("creating plain text model");this._editorModel=this.createModel(this.options.content(),this._getContentUri());this._addContentChangedListenerToModel();v.verbose("creating editor using the plain text model");this.options.contentType()===c.Kql?this._createKustoEditor():(this._editorValue=monaco.editor.create(this._content[0],{model:this._editorModel}),this.applyBindings())},t.prototype._onDisabledChanged=function(n){this._disableElement(n)},t.prototype._onContentChanged=function(n){this._editorModel&&!this._saving&&(this._editorModel.setValue(n||""),this.options.dirty(!1))},t.prototype._onContentUriChanged=function(){if(this._editorModel){var n=this._editorModel;this._editorModel=this.createModel(n.getValue(),this._getContentUri());this._addContentChangedListenerToModel();this._editor.setModel(this._editorModel);this._updateModelOptions();this._updateLanguage()}},t.prototype._canRefresh=function(){return this.options.visible()},t.prototype._refresh=function(){this._canRefresh()&&(this._resetResizeTracking(),this._refreshLayout())},t.prototype._refreshLayout=function(){this._editor&&this._editor.layout()},t.prototype._resetResizeTracking=function(){var n=this;this._resizeTrackingLifetime&&this._resizeTrackingLifetime.dispose();this._resizeTrackingLifetime=this.ltm.createChildLifetime();f.track(this._resizeTrackingLifetime,this.element,(function(){n._refreshLayout()}))},t.prototype._onVisibleChanged=function(n){r.toggle(this.element,n!==!1);n&&this._refresh()},t.prototype._onSelectedRangeChanged=function(n){if(this._editor&&!this._saving){var t=this._editor;n===null&&(n={startLineNumber:t.getPosition().lineNumber,startColumn:t.getPosition().column,endLineNumber:t.getPosition().lineNumber,endColumn:t.getPosition().column});this._cachedSelectionRange&&n.startLineNumber===this._cachedSelectionRange.startLineNumber&&n.startColumn===this._cachedSelectionRange.startColumn&&n.endLineNumber===this._cachedSelectionRange.endLineNumber&&n.endColumn===this._cachedSelectionRange.endColumn||(t.setSelection(n),t.revealRangeInCenter(n))}},t.prototype._onPositionChanged=function(n){if(this._editor&&!this._saving){var t=this._editor;n===null||this._cachedCursorPosition&&n.column===this._cachedCursorPosition.column&&n.lineNumber===this._cachedCursorPosition.lineNumber||(t.setPosition(n),t.revealPositionInCenter(n))}},t.prototype._canSave=function(){return this.options.dirty()},t.prototype._save=function(){var n,t;try{this._saving=!0;var r=this.options,i=this._editorModel,u=this._editor;u&&i&&(n=i.getValue(),r.content(n),t=this._generateOutput,t&&t(n),this.updateSelection(),this.updateCursorPosition());this.options.dirty(!1)}finally{this._saving=!1}},t.prototype.updateCursorPosition=function(){var n=this.options;this._cachedCursorPosition=this._editor.getPosition();l(n)?n.cursorPosition(this._cachedCursorPosition):n.position(this._cachedCursorPosition)},t.prototype.updateSelection=function(){var n=this.options,t=this._editor.getSelection();this._cachedSelectionRange=t||new monaco.Selection(1,1,1,1);t.isEmpty()?n.selectedContent(""):n.selectedContent(this._editorModel.getValueInRange(t));n.selectedRange(this._cachedSelectionRange)},t.prototype._initializeSubscriptions=function(){var t=this,r,n=this.options,i=!0,f,u;l(n)?(ko.reactor(this.ltm,[n.readOnly,n.showLineNumbers,n.enhancedScrollbar,n.wrappingColumn,n.selectionHighlight,n.tabFocus,this.$disabled,],(function(){i||t._updateEditorOptions()})),ko.reactor(this.ltm,[n.tabSize,n.insertSpaces,],(function(){i||t._updateModelOptions()})),ko.reactor(this.ltm,[n.minVisibleLines,],(function(){i||t._updateMinHeight()}))):ko.reactor(this.ltm,[this.options.options,this.$disabled,],(function(){i||(t._updateEditorOptions(),t._updateModelOptions(),t._updateMinHeight())}));l(this.options)&&((r=this.vm.contentSchema)===null||r===void 0?void 0:r.subscribe(this.ltm,(function(n){t._kustoWorker&&(n?t._isArgSchema(n)&&(n=t._convertToEngineSchema(n)):n=t._convertToEngineSchema(null),t._kustoWorker.setSchema(n))})));n.content.subscribe(this.ltm,(function(n){t._ignoreUpdateFromKeyboard||t._onContentChanged(n)}));n.selectedRange.subscribe(this.ltm,(function(n){t._onSelectedRangeChanged(n)}));f=l(n)?n.cursorPosition:n.position;f.subscribe(this.ltm,(function(n){t._onPositionChanged(n)}));n.contentUri.subscribe(this.ltm,(function(n){t._onContentUriChanged(n)}));n.contentType.subscribe(this.ltm,(function(){t._updateLanguage()}));u=l(n)?n.customConfig:n.customContentType;u&&u.subscribe(this.ltm,(function(){t._updateLanguage()}));n.markers.subscribe(this.ltm,(function(n){t._updateMarkers(n)}));this.$disabled.subscribeAndRun(this.ltm,(function(n){t._onDisabledChanged(n)}));n.visible.subscribe(this.ltm,(function(n){t._onVisibleChanged(n)}));i=!1},t.prototype._initializeExtensions=function(){(this.options.extensions&y.Extensions.Discussion)>0&&!!this.options.extensionOptions.discussion&&this._editorExtensions.push(new o.DiscussionExtension(this.ltm,this._editor,this._getEditorMode(),this.options.extensionOptions.discussion))},t.prototype._getEditorMode=function(){return s.EditorMode.Editor},t.prototype._disableElement=function(n){this.element.toggleClass("fxc-editor-disabled",n);this.element.find("textarea").attr("tabindex",n?"-1":"0")},t.prototype._updateTheme=function(n){this._editor&&(n&&n.highContrastMode&&n.highContrastMode()===2?monaco.editor.setTheme("darkHighContrastTheme"):n&&n.highContrastMode&&n.highContrastMode()===1?monaco.editor.setTheme("lightTheme"):n&&n.currentTheme&&n.currentTheme().mode===1?monaco.editor.setTheme("darkTheme"):monaco.editor.setTheme("lightTheme"))},t.prototype._updateEditorOptions=function(){var t,n;this._editor&&(t=this._getEditorOptions(),this._editor.updateOptions(t),n=l(this.options)?this.options.tabFocus():this.options.options().tabFocusMode,n!==undefined&&this._editor.createContextKey("editorTabMovesFocus",n))},t.prototype._updateModelOptions=function(){var r={},t,i,n;l(this.options)?(n=this.options,t=n.tabSize(),i=n.insertSpaces()):(n=this.options.options(),t=n.tabSize,i=n.insertSpaces);t&&(r.tabSize=t);i!==undefined&&(r.insertSpaces=i);this._setOptions(r)},t.prototype._setOptions=function(n){this._editorModel&&this._editorModel.updateOptions(n)},t.prototype._updateMinHeight=function(){var n=this._editor,i,t,r;n&&n.getOriginalEditor&&(n=n.getOriginalEditor());i=0;n&&n.getOption&&(i=n.getOption(monaco.editor.EditorOption.lineHeight));i!==0&&(t=l(this.options)?this.options.minVisibleLines():this.options.options().minVisibleLines,r=t===0?t:t&&t>0?t:2,this._currentMinLines!==r&&(this._currentMinLines=r,this._content.css("min-height",i*r+"px"),this._refreshLayout()))},t.prototype._updateMarkers=function(n){var t=this;this._saving||(n=n||[],this._setMarker("markers",n.filter((function(n){return n.range||v.warning("Marker '{0}' skipped. Text range property was not set".format(n.message)),!!n.range})).map((function(n){return{severity:t._getSeverity(n.severity),message:n.message,startLineNumber:n.range.startLineNumber,startColumn:n.range.startColumn,endLineNumber:n.range.endLineNumber,endColumn:n.range.endColumn}}))))},t.prototype._getSeverity=function(n){switch(n){case y.MarkerSeverity.Hint:return monaco.MarkerSeverity.Hint;case y.MarkerSeverity.Info:return monaco.MarkerSeverity.Info;case y.MarkerSeverity.Warning:return monaco.MarkerSeverity.Warning;case y.MarkerSeverity.Error:return monaco.MarkerSeverity.Error;default:return 0}},t.prototype._setMarker=function(n,t){this._editorModel&&monaco.editor.setModelMarkers(this._editorModel,n,t)},t.prototype._updateLanguage=function(){v.verbose("setting the language");this._setLanguage(this._loadLanguage());v.verbose("updating markers");this._updateMarkers(this.options.markers())},t.prototype._setLanguage=function(n){this._editorModel&&monaco.editor.setModelLanguage(this._editorModel,n)},t.prototype._loadLanguage=function(){var n=l(this.options)?this.options.customConfig:this.options.customContentType;return this.options.contentType&&n&&this._isCustomLanguage(this.options.contentType())?this._createCustomLanguage(n()):this._loadStandardLanguage(this._editorLanguage(this.options.contentType()))},t.prototype._loadStandardLanguage=function(n){if(v.verbose("loading standard language"),l(this.options))n==="application/json"&&this.options.json?this._configureJSON(this.options.json):n==="text/typescript"&&this.options.typescript&&this._configureTypeScript(this.options.typescript);else{var t=this.options.configuration;t&&n&&(n==="application/json"&&t.json?this._configureJSON(t.json):n==="text/typescript"&&t.typescript&&this._configureTypeScript(t.typescript))}return v.verbose("standard language '{0}' was loaded.".format(n)),n},t.prototype._configureJSON=function(n){var t=n.schemas?n.schemas.map((function(n){var t=n.uri,i=n.schema,r=n.fileMatch;return{uri:t,schema:i,fileMatch:r}})):null;monaco.languages.json.jsonDefaults.setDiagnosticsOptions({validate:!0,schemas:t,allowComments:n.allowComments})},t.prototype._configureTypeScript=function(n){var r=this,i=monaco.languages.typescript,e=n.extraLibs||[],u,t,f;e.forEach((function(n){r.ltm.registerForDispose(i.typescriptDefaults.addExtraLib(n.content,n.path))}));u=n.compilerOptions;t={};u&&(t.target=l(this.options)?u.target:u.target===y.TypeScriptScriptTarget.ES6?i.ScriptTarget.ES2015:i.ScriptTarget.ES5);t.noEmit=!0;t.noLib=!0;t.allowNonTsExtensions=!0;i.typescriptDefaults.setDiagnosticsOptions({noSemanticValidation:!1,noSyntaxValidation:!1});i.typescriptDefaults.setCompilerOptions(t);f=l(this.options)?this.options.typescriptOutput:n.output;f&&p.requirejs(["vs/language/typescript/lib/typescriptServices"],(function(n){r._generateOutput=function(i){f(n.transpileModule(i,{compilerOptions:{module:n.ModuleKind.AMD,target:t.target,noLib:!0,noResolve:!0,suppressOutputPathCheck:!0}}).outputText)};var i=r._editorModel;i&&r._generateOutput(i.getValue())}))},t.prototype._createCustomLanguage=function(n){if(v.verbose("loading custom language"),!n||!n.tokenizer)return v.verbose("requested null custom language"),null;var r=nt(n,!0,!0),i="custom."+(++t.CUSTOM_CONTENT_TYPE_ID).toString();return monaco.languages.register({id:i}),monaco.languages.setMonarchTokensProvider(i,r),n.suggestSupport&&monaco.languages.registerCompletionItemProvider(i,{triggerCharacters:n.suggestSupport.triggerCharacters||[],provideCompletionItems:function(){return it(r.suggestSupport.snippets)}}),v.verbose("custom language was loaded.".format(i)),i},t.prototype._getCurrentCommandRange=function(n,t){var o=t.lineNumber-1,i=n.getModel().getLinesContent(),f=0,e=0,r,u;if(i[o].trim()==="")return{startLineNumber:t.lineNumber,startColumn:1,endLineNumber:t.lineNumber,endColumn:i[t.lineNumber]?i[t.lineNumber].length+1:1};for(r=o;i[r].trim()!==""&&r>0;)r--;for(f=i[r].trim()!==""?r:r+1,u=f;u<i.length;u++)if(i[u].trim()==="")break;else e=u;return{startLineNumber:f+1,startColumn:1,endLineNumber:e+1,endColumn:i[e].length+1}},t.CUSTOM_CONTENT_TYPE_ID=0,t})(e.Widget);t.Widget=rt})(v||(v={})),v}));
define("MsPortalImpl.Controls/Controls/Documents/DiffEditor",["require","exports","MsPortalImpl.Controls/Controls/Documents/Editor","MsPortalImpl.Controls/Controls/Documents/Editor.Extension"],(function(n,t,i,r){"use strict";var u;return (function(n){function t(n){return!n.hasOwnProperty("options")}var u="fxc-diffeditor",f=(function(n){function i(i,r,f){var e=n.call(this,i,r,f)||this;return(t(e.options)?e.options.oldContent:e.options.originalContent).extend({notify:"always"}),i.addClass(u),e._oldEditorModel=null,e}return __extends(i,n),i.prototype.dispose=function(){this._checkExistsOrRegisterDestroyId(n.prototype.dispose)||(n.prototype.dispose.call(this),this._cleanElement(u))},Object.defineProperty(i.prototype,"options",{get:function(){return this._options},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"_diffEditor",{get:function(){return this._editorValue},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"_newEditorModel",{get:function(){return this._editorModelValue},set:function(n){this._editorModelValue=n},enumerable:!1,configurable:!0}),i.prototype._getRenderSideBySide=function(){var i=t(this.options)?this.options:this.options.options(),n=ko.unwrap(i.renderSideBySide);return n!==undefined?n:!0},i.prototype._getEditorMode=function(){return this._getRenderSideBySide()?r.EditorMode.DiffEditorSxS:r.EditorMode.DiffEditorInline},i.prototype._getEditorOptions=function(){var i=n.prototype._getEditorOptions.call(this),r=t(this.options)?this.options:this.options.options();return i.enableSplitViewResizing=ko.unwrap(r.enableSplitViewResizing),i.renderSideBySide=this._getRenderSideBySide(),i},i.prototype._createEditorAndModel=function(){this._editorValue=monaco.editor.createDiffEditor(this._content[0]);this._oldEditorModel=monaco.editor.createModel((t(this.options)?this.options.oldContent:this.options.originalContent)()||"","text/plain");this._newEditorModel=monaco.editor.createModel(this.options.content()||"","text/plain");this._diffEditor.setModel({original:this._oldEditorModel,modified:this._newEditorModel})},i.prototype._onOriginalContentChanged=function(n){this._oldEditorModel&&this._oldEditorModel.setValue(n||"")},i.prototype._initializeSubscriptions=function(){var r=this,i=this.options,u=!0;t(i)&&ko.reactor(this.ltm,[i.renderSideBySide,i.enableSplitViewResizing,],(function(){u||r._updateEditorOptions()}));(t(i)?i.oldContent:i.originalContent).subscribe(this.ltm,(function(n){r._onOriginalContentChanged(n)}));n.prototype._initializeSubscriptions.call(this);u=!1},i.prototype._updateEditorOptions=function(){var t=this;(n.prototype._updateEditorOptions.call(this),this._editor)&&this._editorExtensions.forEach((function(n){n.onDiffRenderModeChanged(t._getRenderSideBySide())}))},i.prototype._setOptions=function(n){this._oldEditorModel&&this._newEditorModel&&(this._oldEditorModel.updateOptions(n),this._newEditorModel.updateOptions(n))},i.prototype._setMarker=function(n,t){this._oldEditorModel&&this._newEditorModel&&(monaco.editor.setModelMarkers(this._oldEditorModel,n,t),monaco.editor.setModelMarkers(this._newEditorModel,n,t))},i.prototype._setLanguage=function(n){this._oldEditorModel&&this._newEditorModel&&(monaco.editor.setModelLanguage(this._oldEditorModel,n),monaco.editor.setModelLanguage(this._newEditorModel,n))},i})(i.Widget);n.Widget=f})(u||(u={})),u}))