define("_generated/Less/MsPortalImpl/Widgets/Widgets.GlobalNotificationBanner.css",["module"],(function(n){"use strict";return{css:".fxs-global-notification-banner-item{position:relative}.fxs-global-notification-banner-content{font-size:13px;padding:10px 20px}.fxs-global-notification-banner-title{font-size:14px;font-weight:600;margin-right:10px}.fxs-global-notification-banner-message{font-size:13px;display:block;display:-webkit-box;max-height:36px;overflow:hidden;text-overflow:ellipsis;-webkit-line-clamp:2;-webkit-box-orient:vertical;line-height:18px;position:relative;white-space:pre-wrap}.fxs-global-notification-banner-expandedmessage{max-height:100%;overflow-y:auto;-webkit-line-clamp:initial;-webkit-box-orient:vertical}.fxs-global-notification-banner-seemore-container{display:inline-block;width:100%}.fxs-notification-banner-seemore-link{display:flex;margin-top:2px;float:right}.fxs-global-notification-banner-see-more-less{padding-right:5px}.fxs-global-notification-banner-expandicon{cursor:pointer;background-color:transparent;border:0;margin:0;padding:0;height:10px;width:10px;opacity:.4}.fxs-global-notification-banner-dismissicon{cursor:pointer;background-color:transparent;border:0;margin:0;padding:0;height:14px;width:10px;opacity:.4;top:0;right:0;position:absolute;margin-left:auto}",moduleId:n.id}}));
define("MsPortalImpl/Widgets/Widgets.GlobalNotificationBanner.Component",["require","exports","MsPortalImpl/UI/UI.AuthStateManager","Weave/DirectMode","MsPortalImpl/Resources/ImplScriptResources","MsPortalImpl/Base/Base.KnockoutTemplateSanitizer","MsPortalImpl/Services/Services.PortalPollingManager","_generated/Less/MsPortalImpl/Widgets/Widgets.GlobalNotificationBanner.css","Weave","FxInternal/Weave/Util","MsPortalImpl/Weave/Components","MsPortalImpl/Base/Base.BrowserDetection","MsPortalImpl/Services/Services.BrowserTelemetry"],(function(n,t,i,r,u,f,e,o,s,h,c,l,a){"use strict";function nt(n,t,i){var o,s=Object.keys((o=n.affectedBrowsers)!==null&&o!==void 0?o:{}).length,f,u,e,r;return!(n===null||n===void 0?void 0:n.affectedBrowsers)||!s?!0:(f=g[t],u=n.affectedBrowsers[Object.keys(n.affectedBrowsers).find((function(n){if(f!==null&&f!==void 0)return f.includes(n.toLowerCase())}))],u===undefined&&s)?!1:!u||!i?!0:u?(e=u.split(".").map((function(n){return n.toLowerCase()==="x"||isNaN(parseInt(n,10))?-1:parseInt(n,10)})),r={major:e[0],minor:e[1],patch:e[2]},r.major<0||i.major<0)?!0:r.major!==i.major?!1:r.minor<0||i.minor<0?!0:r.minor!==i.minor?!1:r.patch<0||i.patch<0?!0:r.patch!==i.patch?!1:!0:void 0}function tt(n,t){var i;return!((i=n===null||n===void 0?void 0:n.affectedPortalDomains)===null||i===void 0?void 0:i.length)||n.affectedPortalDomains.includes(t)}function it(n,t){var i;return!((i=n===null||n===void 0?void 0:n.affectedTenants)===null||i===void 0?void 0:i.length)||n.affectedTenants.includes(t)}function rt(n,t){var r,u,f;if(t.includes(n)){var o=new RegExp("\\s"+n+"/((\\d|\\.)+[\\s]|(\\d|\\.)+$)"),e=o.exec(t),i=e&&e[1]&&e[1].trim().split(".").map((function(n){return isNaN(parseInt(n,10))?-1:parseInt(n,10)}));return(i===null||i===void 0?void 0:i.length)>=2?{major:(r=i[0])!==null&&r!==void 0?r:-1,minor:(u=i[1])!==null&&u!==void 0?u:-1,patch:(f=i[2])!==null&&f!==void 0?f:-1}:null}}function b(n,t,i,r,u){return n.filter((function(n){return tt(n,i)})).filter((function(n){return it(n,r)})).filter((function(n){return nt(n,t,u)}))}function ut(t){var w,d,g;v("ReceiveNotifications",{notifications:t.notifications});var tt=(w=t.container.get(i.AuthStateManager).getCurrentUser())===null||w===void 0?void 0:w.tenantId.toLowerCase(),it=(g=(d=p===null||p===void 0?void 0:p.location)===null||d===void 0?void 0:d.hostname)===null||g===void 0?void 0:g.toLowerCase(),nt=l.isChrome?"Chrome":l.isEdge?"Edge":l.isChromiumEdge?"Edg":l.isFirefox?"Firefox":l.isSafari?"Safari":"Other",ut=rt(nt,a.getBrowserInfo().UserAgent),ot=s.makeWritableComputation(!1),f=s.makeArrayComputation(b(t.notifications,nt,it,tt,ut).map(k)),st={},ht={};return v("SetNotifications",{notifications:f.value}),f.value.forEach((function(n){ht[n.id]=n})),r(s.GetContext,{fn:function(t){return r(s.LifetimeManagerScoped,{fn:function(i){var l=t.diContainer,a=l.get(e.PollingManager);return s.subscribe(i,[a.getPolledDataObservable()],(function(n){var t=et(b(n.outages,nt,it,tt,ut),ht,st);f.setAll(t)})),r(s.If,{condition:f.compose(h.isNonEmptyArray),concealmentBehavior:"remove",trueFn:function(){return r(s.Fragment,null,r(s.Css,{css:o}),r("div",{className:"fxs-global-notification-banner-content fxs-portal-text",role:"banner"},r(s.ForEach,{collection:f,fn:function(t){var i=t.item,e=i.seeMoreString;return r("div",{className:"fxs-global-notification-banner-item",afterMount:function(n){var t=n.parentNode.querySelector(".fxs-global-notification-banner-message").scrollHeight>36||$(n).hasClass("fxs-global-notification-banner-expandedMessage");ot(t);i.isExpanded(!t)}},r("div",{className:"fxs-global-notification-banner-title"},i.title),r("button",{className:"fxs-global-notification-banner-dismissicon",image:y.Close(),onClick:function(){return ft(i.id,f,st)},tabindex:"0",title:u.NotificationMenu.dismissNotification,"aria-label":u.NotificationMenu.dismissNotification}),r("div",{className:["fxs-global-notification-banner-message msportalfx-tooltip-overflow",{"fxs-global-notification-banner-expandedmessage":i.isExpanded}]},r(c.ShellHtml,{content:i.message,require:n})),r(s.If,{condition:ot,concealmentBehavior:"remove",trueFn:function(){return r("div",{className:"fxs-global-notification-banner-seemore-container"},r("a",{href:"#",tabindex:"0",className:"fxs-notification-banner-seemore-link",onClick:i.onClickToggleExpandedState},r("div",{className:"fxs-global-notification-banner-see-more-less",title:e,"aria-label":e},e),r("div",{className:"fxs-global-notification-banner-expandicon",image:i.expandIcon})))}}))}})))}})}})}})}function v(n,t){d.trace({source:"GlobalNotificationBanner",action:n,data:t})}function k(t){var r=t.trackingId,i=s.makeWritableComputation(!1);return{expandIcon:i.compose((function(n){return n?y.CaretUp():y.CaretDown()})),id:r,isExpanded:i,message:s.makeWritableComputation(f.sanitizeHTML(t.message,n).sanitizedMarkup),onClickToggleExpandedState:function(){return i(!i.value)},seeMoreString:i.compose((function(n){return n?u.NotificationMenu.collapse:u.NotificationMenu.seeMore})),title:s.makeWritableComputation(f.sanitizeHTML(t.title,n).sanitizedMarkup)}}function ft(n,t,i){t.removeIf((function(t){return t.id===n}));v("DismissNotification",{trackingId:n});i[n]=!0}function et(n,t,i){return!n||!n.length?[]:n.reduce((function(n,r){var f=r.trackingId,u=t[f],e=k(r),o,s;return u?(o=e.title.value,s=e.message.value,(u.title.value!==o||u.message.value!==s)&&(u.title(o),u.message(s),i[f]=undefined),i[f]||n.push(u),n):(i[f]||(v("ShowGlobalNotification",{id:f}),n.push(e)),n)}),[])}Object.defineProperty(t,"__esModule",{value:!0});t.DEV=t.GlobalNotificationBanner=void 0;var w=MsPortalFx.Base,d=w.Diagnostics.Telemetry,y=w.Images,p=window,g={Edg:["chromiumedge","edgechromium","edge"],Edge:["legacyedge","edgelegacy","edge"],Chrome:["chrome"],Safari:["safari"],Firefox:["firefox"]};t.GlobalNotificationBanner=ut}))