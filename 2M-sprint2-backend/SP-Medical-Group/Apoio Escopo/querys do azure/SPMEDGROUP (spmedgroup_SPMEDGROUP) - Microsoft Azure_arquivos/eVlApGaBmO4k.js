define("MsPortalImpl.Controls/Controls/Visualization/MonitorChartV2/AI/ME/Utilities/CallbackRegistrationMap",["require","exports"],(function(n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.CallbackRegistrationMap=void 0;var i=(function(){function n(){this._map={}}return n.prototype.Register=function(n){if(this._map[n.id])throw new Error("Error: Reregistering an existing id is not allowed. id = "+n.id);else this._map[n.id]=n},n.prototype.Unregister=function(n){delete this._map[n]},n.prototype.ExecuteAction=function(n,t,i){var r,u;for(r in this._map)this._map.hasOwnProperty(r)&&(i&&r===n||!i&&r!==n)&&(u=this._map[r],t(u))},n.prototype.IsEmpty=function(){return Object.keys(this._map).length===0},n.prototype.GetCallbackRegistrationInfo=function(n){return this._map[n]},n})();t.CallbackRegistrationMap=i}));
define("MsPortalImpl.Controls/Controls/Visualization/MonitorChartV2/AI/ME/Stores/ItemDataModelStore",["require","exports","MsPortalImpl.Controls/Controls/Visualization/MonitorChartV2/AI/ME/Constants","MsPortalImpl.Controls/Controls/Visualization/MonitorChartV2/AI/ME/DataModels/MetricsExplorerItemDataModel","MsPortalImpl.Controls/Controls/Visualization/MonitorChartV2/AI/ME/Telemetry","MsPortalImpl.Controls/Controls/Visualization/MonitorChartV2/AI/ME/Utilities/CallbackRegistrationMap","MsPortalImpl.Controls/Controls/Visualization/MonitorChartV2/AI/ME/Utilities/FilterTreeHelper","MsPortalImpl.Controls/Controls/Visualization/MonitorChartV2/AI/ME/Utilities/ResourceTypes","MsPortalImpl.Controls/Controls/Visualization/MonitorChartV2/AI/ME/Utilities/Util"],(function(n,t,i,r,u,f,e,o,s){"use strict";function c(n){return u.getOrCreateTelemetryContext(n&&h.Instance().GetItemDataModel(n))}Object.defineProperty(t,"__esModule",{value:!0});t.ItemDataModelStore=t.populateDataModelStore=t.getOrCreateTelemetryContextFromItemDataModelId=void 0;t.getOrCreateTelemetryContextFromItemDataModelId=c;var h=(function(){function n(t){if(n._instance)throw new Error("Error: Instantiation failed: use ItemDataModelStore.Instance() instead of new.");this._iDMs=[];this._chartListenerMap=t||{};this._storeListenerMap={}}return n.Instance=function(){return n._instance=n._instance||new n,n._instance},n._reset=function(){n._instance=null},n.prototype.getCount=function(){return this._iDMs.length},n.prototype.getItemIds=function(){return this._iDMs.map((function(n){return n.itemDataModel&&n.itemDataModel.id}))},n.prototype.Register=function(n){this._chartListenerMap[n.chartId]||(this._chartListenerMap[n.chartId]=new f.CallbackRegistrationMap);this._chartListenerMap[n.chartId].Register(n)},n.prototype.Unregister=function(n){this._chartListenerMap[n.chartId]&&(this._chartListenerMap[n.chartId].Unregister(n.id),this._chartListenerMap[n.chartId].IsEmpty()&&delete this._chartListenerMap[n.chartId])},n.prototype.RegisterStoreChange=function(n){this._storeListenerMap[n.id]||(this._storeListenerMap[n.id]=new f.CallbackRegistrationMap);this._storeListenerMap[n.id].Register(n)},n.prototype.UnRegisterStoreChange=function(n){this._storeListenerMap[n.id]&&(this._storeListenerMap[n.id].Unregister(n.id),this._storeListenerMap[n.id].IsEmpty()&&delete this._storeListenerMap[n.id])},n.prototype.AttachItemDataModel=function(n,t,i){var r=this,o,f;i===void 0&&(i=!1);this.GetItem(n.id)||(o={UpdateFilter:function(t,i){var o=r.GetItem(n.id),u=o.itemDataModel,f=u.filters;e.updateFilter(i.filter,f);u.Update({filters:f});r.raiseNotification(n.id,t,(function(n){r._isUpdateCallback(n)&&n.OnFiltersUpdated(f)}));u.titleKind===1&&o.actions.UpdateTitle(t,1)},AddFilter:function(t,i){var o=r.GetItem(n.id),u=o.itemDataModel,f=u.filters;e.addFilter(i.newFilter,i.parentFilterId,f,!1);u.Update({filters:f});r.raiseNotification(n.id,t,(function(n){r._isUpdateCallback(n)&&n.OnFiltersUpdated(f)}));u.titleKind===1&&o.actions.UpdateTitle(t,1)},RemoveFilter:function(t,i){var o=r.GetItem(n.id),u=o.itemDataModel,f=u.filters;e.removeFilter(i.id,f);u.Update({filters:f});r.raiseNotification(n.id,t,(function(n){r._isUpdateCallback(n)&&n.OnFiltersUpdated(f)}));u.titleKind===1&&o.actions.UpdateTitle(t,1)},UpdateGrouping:function(t,i){var f=r.GetItem(n.id),u=f.itemDataModel;u.Update({grouping:i});r.raiseNotification(u.id,t,(function(n){r._isUpdateCallback(n)&&n.OnGroupingUpdated(t,i)}));u.titleKind===1&&f.actions.UpdateTitle(t,1)},AddMetric:function(t,i,u){var o=r.GetItem(n.id),e=o.itemDataModel,f=e.metrics.slice(),s,h;e.metrics.length===0||u===e.metrics.length?f.push(i):u===0?f=[i].concat(f):(s=f.slice(0,u),h=f.slice(u),f=s.concat([i],h));e.Update({metrics:f,appliedISOGrain:undefined});r.raiseNotification(e.id,t,(function(n){r._isUpdateCallback(n)&&n.OnMetricAdded(t,i)}));e.titleKind===1&&o.actions.UpdateTitle(t,1)},UpdateMetric:function(t,i,u){var f=r.GetItem(n.id);u&&!u.color&&f.itemDataModel.metrics[i]&&f.itemDataModel.metrics[i].color&&(u.color=f.itemDataModel.metrics[i].color);f.itemDataModel.metrics[i]=u;f.itemDataModel.appliedISOGrain=undefined;r.raiseNotification(n.id,t,(function(n){r._isUpdateCallback(n)&&n.OnMetricUpdated(t,u)}));f.itemDataModel.titleKind===1&&f.actions.UpdateTitle(t,1)},RemoveMetric:function(t,i){var f=r.GetItem(n.id),u=f.itemDataModel,e=u.metrics[i];u.Update({metrics:u.metrics.filter((function(n,t){return t!==i}))});r.raiseNotification(u.id,t,(function(n){r._isUpdateCallback(n)&&n.OnMetricRemoved(t,e)}));u.titleKind===1&&f.actions.UpdateTitle(t,1)},UpdateVisual:function(t,i){var u=r.GetItem(n.id).itemDataModel;u.Update({visualization:i});r.raiseNotification(u.id,t,(function(n){r._isUpdateCallback(n)&&n.OnVisualUpdated(t,i)}))},UpdateTitle:function(t,i,u){var f=r.GetItem(n.id).itemDataModel;(f.titleKind!==i||f.title!==u||i===1)&&(f.titleKind=i,f.title=u,r.raiseNotification(f.id,t,(function(n){r._isUpdateCallback(n)&&n.OnTitleChanged(t,u,f.titleKind)})))},HasRendered:function(t){var i=r.GetItem(n.id).itemDataModel;r.raiseNotification(i.id,t,(function(n){r._isRenderCallback(n)&&n.OnHasRendered(t)}))},UpdateISOGrain:function(t,i){var u=r.GetItem(n.id).itemDataModel,f,e;r._iDMs.length>0&&(f=r._iDMs[0].itemDataModel.appliedISOGrain,r._iDMs[0].itemDataModel.appliedISOGrain&&(f=r._iDMs[0].itemDataModel.appliedISOGrain));e=!1;r._iDMs.forEach((function(n){n.itemDataModel.appliedISOGrain!==f&&(e=!0)}));u.Update({appliedISOGrain:i});e?r.raiseStoreNotification(t,(function(n){n.OnVariableGrainChanged(t,"Variable")})):r.raiseStoreNotification(t,(function(n){n.OnVariableGrainChanged(t,i)}));u.appliedISOGrain!==i&&r.raiseStoreNotification(t,(function(n){n.OnItemDataModelISOGrainChanged(t,u.id,i)}))},UpdateItemDataModel:function(t,i){var o,e,f;if(n.id!==i.id){o=u.getOrCreateTelemetryContext(n);e="ItemDataModelStore.AttachItemDataModel.UpdateItemDataModel: Mismatching id between newItemDataModel.id and itemDataModel.id";u.traceMessage(e,o);throw Error(e);}f=r.GetItem(n.id).itemDataModel;f.Update(i);f.appliedISOGrain=undefined;r.raiseNotification(n.id,t,(function(n){r._isUpdateCallback(n)&&n.ItemDataModelUpdated(t,f)}))}},f=0,t&&this._iDMs.filter((function(n,i){n.itemDataModel.id===t&&(f=i+1)})),this._iDMs.splice(f,0,{itemDataModel:n,actions:o,chartHeight:0}),this.raiseStoreNotification("",(function(t){t.OnItemDataModelAttached(n.id)})))},n.prototype.DetachItemDataModel=function(n){delete this._chartListenerMap[n];this._iDMs.splice(this.indexOf(n),1).length!==0&&this.raiseStoreNotification("",(function(t){t.OnItemDataModelDetached(n)}))},n.prototype.CanMoveUp=function(n){return this._iDMs.length>1&&this.indexOf(n)>0},n.prototype.MoveItemUp=function(n){if(this.CanMoveUp(n)){var i=this.indexOf(n),t=this._iDMs.slice(),r=t[i];t[i]=t[i-1];t[i-1]=r;this._iDMs=t;this.raiseStoreNotification("",(function(n){n.OnIdListChanged("")}))}},n.prototype.CanMoveDown=function(n){var t=this.indexOf(n);return this._iDMs.length>1&&t!==-1&&t!==this._iDMs.length-1},n.prototype.MoveItemDown=function(n){if(this.CanMoveDown(n)){var i=this.indexOf(n),t=this._iDMs.slice(),r=t[i];t[i]=t[i+1];t[i+1]=r;this._iDMs=t;this.raiseStoreNotification("",(function(n){n.OnIdListChanged("")}))}},n.prototype.GetNextChartId=function(n){var i=this._iDMs.length,t;if(i>1){if(t=this.indexOf(n),t+1<i)return this._iDMs[t+1].itemDataModel.id;if(t>0)return this._iDMs[t-1].itemDataModel.id}},n.prototype.GetAction=function(n){var t=this.GetItem(n);return t&&t.actions},n.prototype.GetItemDataModel=function(n){if(n){var t=this.GetItem(n);return t&&t.itemDataModel}},n.prototype.GetAllItemDataModels=function(){return this._iDMs.map((function(n){return n.itemDataModel}))},n.prototype.GetFirstItem=function(){return this._iDMs&&this._iDMs[0]},n.prototype.HasThresholdConfigurations=function(){return this._iDMs&&this._iDMs.length>0?this._iDMs.some((function(n){return!!n.itemDataModel.alertThresholdOptions})):!1},n.prototype.GetUniqueResourceIds=function(){var n={};return this._iDMs.forEach((function(t){t&&t.itemDataModel&&t.itemDataModel.metrics&&t.itemDataModel.metrics.forEach((function(t){n[s.getResourceDefinitionUniqueId(t.id.resourceDefinition)]=!0}))})),n},n.prototype.raiseNotification=function(n,t,i){var r=this._chartListenerMap[n];r&&r.ExecuteAction(t,i)},n.prototype.raiseStoreNotification=function(n,t){var i=this;Object.keys(this._storeListenerMap).forEach((function(r){var u=i._storeListenerMap[r];u.ExecuteAction(n,t)}))},n.prototype.indexOf=function(n){for(var i,t=0;t<this._iDMs.length;t++)if(i=this._iDMs[t],i&&i.itemDataModel&&i.itemDataModel.id===n)return t;return-1},n.prototype.GetItem=function(n){var t=this.indexOf(n);return t!==-1&&this._iDMs[t]},n.prototype._isUpdateCallback=function(n){return n.OnMetricAdded!==undefined},n.prototype._isRenderCallback=function(n){return n.OnHasRendered!==undefined},n})();t.ItemDataModelStore=h}))