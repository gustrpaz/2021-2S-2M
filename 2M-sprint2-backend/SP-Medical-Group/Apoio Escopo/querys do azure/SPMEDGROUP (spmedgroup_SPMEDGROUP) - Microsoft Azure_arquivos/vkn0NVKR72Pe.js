define("MsPortalImpl.Controls/Controls/Visualization/MonitorChartV2/AI/ME/Utilities/ChartUtils",["require","exports","MsPortalImpl.Controls/Controls/Visualization/MonitorChartV2/AI/ME/DateSpan","MsPortalImpl.Controls/Controls/Visualization/MonitorChartV2/AI/ME/Telemetry","MsPortalImpl.Controls/Controls/Visualization/MonitorChartV2/AI/ME/Utilities/DateUtils","MsPortalImpl.Controls/Controls/Visualization/MonitorChartV2/AI/ME/Utilities/TimeUnits","MsPortalImpl.Controls/Controls/Visualization/MonitorChartV2/AI/ME/Utilities/TimeUtils","MsPortalImpl.Controls/Controls/Visualization/MonitorChartV2/AI/ME/Utilities/Util"],(function(n,t,i,r,u,f,e,o){"use strict";function g(n,t,i,r){var u=0,f=n-t-i-25;switch(r){case 1:u=Math.floor(f/8);u=u>0?u:1;break;case 3:u=Math.floor(f/3);u=u>1?u:2;break;case 7:u=Math.floor(f/7);u=u>0?u:1;break;case 2:default:u=Math.floor(f/3);u=u>1?u:2}return u}function nt(n,t,i,u){var o;if(i===void 0&&(i=144),u===void 0&&(u=1),!n||n.length===0)return undefined;if(n.length===1)return n[0];if(!t)return r.logWarning("ChartUtils: no timespan specified",null),undefined;if(o=a(n,u),o)return o;i||(i=144);var l=t.endTime.getTime()-t.startTime.getTime(),s=Number.MAX_VALUE,f,h,c=0;return n.forEach((function(n){var t=e.convertIsoDurationToMs(n),u=l/t,r=i-u;0<=r&&r<s&&(f=n,s=r);t>c&&(h=n,c=t)})),f||(f=h),f}function a(n,t){if(t!==1&&n&&n.length>0){var i=l[t];if(n.indexOf(i)>=0)return i}}function h(n){var t=n.getAppliedISOGrain(),r;return!n.getIsRelative()&&t?(r=i.convertIsoDurationToDateSpan(t),s(r)):n.getHasAutoGrain()?ut(n.getDurationMs(),n.maxBucketCount):et(n.getGrain())}function v(n,t){var f=r.getOrCreateTelemetryContext(),i=rt(n),e,o,s,h,u;if(!i)return r.logWarning("GetISO8601Grain; stringGrain is falsy, return default 'PT1M'",f,{ContainerName:"GetISO8601Grain"},undefined,t),"PT1M";if(e=i.substr(i.length-1),e==="s")return"PT1M";if(o=d[e],!o)return r.logWarning('GetISO8601Grain; unrecognizable stringGrain. return default "PT1M"',f,{ContainerName:"GetISO8601Grain"},undefined,t),"PT1M";if(s=parseInt(i.substr(0,i.length-1),10),isNaN(s))return r.logWarning('GetISO8601Grain; not parsable number. return default "PT1M"',f,{ContainerName:"GetISO8601Grain"},undefined,t),"PT1M";if(h=o.filter((function(n){return s>=n})),h.length>0){u=h[0];switch(e){case"m":return"PT"+u+"M";case"h":return"PT"+u+"H";case"d":return"P"+u+"D";case"w":return"P"+u+"W";case"M":return"P"+u+"M"}}else return r.logWarning("Invalid grain "+i+'. Return default "PT1M"',f,{ContainerName:"GetISO8601Grain"},undefined,t),"PT1M";return"PT1M"}function tt(n,t,i,r,f,e){if(f===void 0&&(f=-10),t&&t.getIsRelative()&&n&&n.absolute&&n.timeGrain&&n.timeGrain!=="PT1S"&&i!==1&&i!==2){var s=u.addSeconds(e||new Date,f),o=y(t,r,n.timeGrain,s);if(u.compare(o.absolute.endTime,n.absolute.endTime)!==0)return o}}function y(n,t,i,r){var f=i?p(i):h(n),o=n.getSnappedTimeContext(f,n.getIsRelative(),r),u=o.cloneMetricTimespan(t);return u.timeGrain=i||v(h(n),t),u.absolute=e.getAbsoluteTimespan(u),u}function it(n,t,i){var r=n.getTimerange(),f=i&&p(i)||h(n),e=u.dateSpanToSeconds(f);return Math.ceil((r.endTime.getTime()-r.startTime.getTime())/(1e3*e))*t}function rt(n){return n.months>0?n.months.toString()+"M":n.days>0&&n.days%7==0?(n.days/7).toString()+"w":n.days>0?n.days.toString()+"d":n.hours>0?n.hours.toString()+"h":n.minutes>0?n.minutes.toString()+"m":n.seconds.toString()+"s"}function p(n){return s(i.convertIsoDurationToDateSpan(n))}function s(n){var t=new i.DateSpan(0,0,0,0,1);return ft(n,t)>=0?n:t}function ut(n,t){t||(t=144);var h=f.convert(n,1,1e3),l=h/t,e=function(n){return l<=n},u,r=o.find(w,e);return r?(u=new i.DateSpan(0,0,0,0,0,r),s(u)):(r=o.find(b,e),r)?(u=new i.DateSpan(0,0,0,0,r/60),s(u)):(r=o.find(k,e),r)?(u=new i.DateSpan(0,0,0,r/3600),s(u)):(r=o.find(c,e),r===undefined&&(r=c[c.length-1]),u=new i.DateSpan(0,0,r/86400),s(u))}function ft(n,t){return u.dateSpanToSeconds(n)-u.dateSpanToSeconds(t)}function et(n){switch(n){case 2:return new i.DateSpan(0,0,0,0,1);case 3:return new i.DateSpan(0,0,0,1);case 4:return new i.DateSpan(0,0,1);case 5:return new i.DateSpan(0,0,7);case 6:return new i.DateSpan(0,1);case 7:return new i.DateSpan(0,0,0,0,5);case 8:return new i.DateSpan(0,0,0,0,15);case 9:return new i.DateSpan(0,0,0,0,30);case 10:return new i.DateSpan(0,0,0,6);case 11:return new i.DateSpan(0,0,0,12);default:return undefined}}var l;Object.defineProperty(t,"__esModule",{value:!0});t.ChartUtilDEV=t.computeTotalDataPoints=t.getIdealTimeSpan=t.getLooseTimeSpan=t.ConvertToISO8601Grain=t.getGrainDateSpanFromTimeContext=t.findChosenGrain=t.findBestFitTimegrain=t.computeMaxBucketCount=void 0;var w=[10,30],b=[1,5,15,30].map((function(n){return n*60})),k=[1,6,12].map((function(n){return n*3600})),c=[1,2,7,14,30,60].map((function(n){return n*86400})),d={m:[30,15,10,5,1],h:[12,6,4,3,2,1],d:[1],w:[1],M:[1]};t.computeMaxBucketCount=g;t.findBestFitTimegrain=nt;l=["","","PT1M","PT1H","P1D","P1W","P1M","PT5M","PT15M","PT30M","PT6H","PT12H",];t.findChosenGrain=a;t.getGrainDateSpanFromTimeContext=h;t.ConvertToISO8601Grain=v;t.getLooseTimeSpan=tt;t.getIdealTimeSpan=y;t.computeTotalDataPoints=it}))