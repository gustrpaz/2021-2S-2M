define("MsPortalImpl/Commands/Commands.FileDownloadCommand",["require","exports","MsPortalImpl/Commands/FileDownloadUtil","MsPortalImpl/Resources/ImplScriptResources","MsPortalImpl/UI/UI.DialogManager","MsPortalImpl/Base/Base.ImplUtils"],(function(n,t,i,r,u,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.FileDownloadCommand=void 0;var s=MsPortalFx.Base,h=s.Net2,c=s.Resources,l=MsPortalFx.ViewModels,a=l.Dialogs,e=r.FileDownloadCommand,o=412,v=(function(){function t(n,t,i,r,u){this._context=n;this._diContainer=t;this._formTarget=i;this._sourceTarget=r;this._locator=u;this.canExecute=ko.observable(!0);this._getResources()}return t.prototype.execute=function(){var r=this,t,s,l,a;return this.canExecute()?(this.canExecute(!1),t=this._context,s=i.getHttpMethod(t),!s)?(i.notifyError(t,o,e.typeError),this.canExecute(!0),Q()):(t.downloadStatus(null),l=this._diContainer.getAsync(u.DialogManager),a=l.then((function(n){return r._getTargetUri(n)})),Q.all([l,a]).spread((function(n,u){var f=u&&u.startsWith("data:");if(!c.isUriAbsolute(u)&&!f){i.notifyError(t,o,e.absoluteUriError);return}if(t.onStart&&t.onStart(),t.showDownloadProgressDialog&&t.showDownloadProgressDialog()&&r._showDldProgressDlg(n),f)i.dataUriHandler(t,n,u);else return h.ajaxExtended(i.getAjaxOptions(t,u,s)).then((function(r){return i.onSuccess(t,n,r.content,r.textStatus,r.jqXHR)}),(function(r){var u=r;i.onError(t,n,u.textStatus,u.jqXHR.status,u.errorThrown);return Q.reject(r)}))})).catch((function(t){t&&f.logToExtension(n,r._sourceTarget,2,t)})).finally((function(){r.canExecute(!0)}))):Q()},t.prototype._getTargetUri=function(n){var f=this,r=Q.defer(),t=this._context,h=t.targetUriCallback&&t.targetUriCallback(),c=t.showUriCallbackConfirmationDialog&&t.showUriCallbackConfirmationDialog(),s;return h?(c&&this._showUriCbProgressDlg(n),Q(h()).then((function(s){if(!s){i.notifyError(t,o,e.uriError);r.reject(new Error(e.uriError));i.dismissDialog(n,t);return}if(c){var h=new u.MessageBox(f._dnldTitle,f._dnldText,2);return h.defaultButtonText=f._defaultBtnText,h.cancelButtonText=f._cancelBtnText,n.showDialog(h,f._formTarget,f._sourceTarget,{locator:f._locator}).then((function(n){n===4?r.resolve(s):r.reject(null)}))}r.resolve(s);i.dismissDialog(n,t)})).catch((function(){var u=t.errorMessage()||e.downloadTargetUriCallbackFailed;i.dismissDialog(n,t);i.notifyError(t,o,u);r.reject(new Error(u))}))):(s=t.targetUri?t.targetUri():null,s?r.resolve(s):(i.notifyError(t,o,e.uriError),r.reject(new Error(e.uriError)))),r.promise},t.prototype._showUriCbProgressDlg=function(n){this._showProgressDlg(n,this._uriCbProgressTitle,this._uriCbProgressText)},t.prototype._showDldProgressDlg=function(n){this._showProgressDlg(n,this._progressTitle,this._progressText)},t.prototype._showProgressDlg=function(n,t,i){var r=new a.ProgressBox(t,i);n.showDialog(r,this._formTarget,this._sourceTarget,{locator:this._locator})},t.prototype._getResources=function(){var t=this._context,n=t.uriCallbackConfirmationDialogOptions||{},i=t.downloadProgressDialogOptions||{};this._uriCbProgressTitle=n.uriCallbackProgressTitle||e.uriCallbackProgressTitle;this._uriCbProgressText=n.uriCallbackProgressText||e.uriCallbackProgressText;this._dnldTitle=n.downloadTitle||e.downloadTitle;this._dnldText=n.downloadText||e.downloadText;this._defaultBtnText=n.defaultButtonText||e.defaultButtonText;this._cancelBtnText=n.cancelButtonText||e.cancelButtonText;this._progressTitle=i.downloadProgressTitle||e.downloadProgressTitle;this._progressText=i.downloadProgressText||e.downloadProgressText},t})();t.FileDownloadCommand=v}));
define("MsPortalImpl/Commands/Commands.FxFileDownloadCommand",["require","exports","MsPortalImpl/Base/Base.BrowserDetection","MsPortalImpl/Commands/FileDownloadUtil","Fx/Controls/FileDownload","MsPortalImpl/Resources/ImplScriptResources","FxInternal/Controls/FileDownload","MsPortalImpl/UI/Hubs/UI.NotificationManager","MsPortalImpl/UI/UI.DialogManager","MsPortalImpl/Base/Base.ImplUtils"],(function(n,t,i,r,u,f,e,o,s,h){"use strict";function p(n){return n&&n.targetUri&&b.Resources.isUriAbsolute(n.targetUri)}function it(n){var i=n.contentType===2?"binary":"text",r=n.authorizationToken,u=n.httpMethod||"GET",f=n.httpRequestContent||null,o=n.httpRequestContentType||"application/json",e=MsPortalFx.clone(n.headers||{}),t;return r&&(e.Authorization=r),t={uri:n.targetUri,type:u,dataType:i,headers:e,checkVersion:!1},i==="binary"&&(t.processData=!1,t.responseType="arraybuffer"),u!=="POST"||!f||(t.data=f,t.contentType=o),t}function v(n,t,i){i===void 0&&(i=null);var r={status:t,errorMessage:i};n.downloadStatus(r);n.onComplete&&n.onComplete(r)}function a(n,t){var i=t.downloadDialogOptions();n&&i&&(i.showDownloadProgressDialog||i.showCallbackProgressDialog||i.showDownloadConfirmationDialog)&&n.dismissOpenDialog()}function rt(n,t,i){if(i===void 0&&(i=null),v(n,t,i),!n.disableNotifications){var r=n.errorTitle()||c.downloadCommandError;o.getNotificationManager().addClientNotification({title:r,description:i,status:MsPortalFx.Hubs.Notifications.NotificationStatus.Error,timestamp:new Date})}}function l(n,i,r){var f=n.errorMessage()?c.downloadErrorDetails2.format(n.errorMessage(),i):i;return a(r,n),t.notifyError(n,u.Status.DownloadPreConditionFailed,f),Q.reject(new Error(i))}function ut(n,i,r){return a(i,n),t.notifyError(n,u.Status.DownloadError,c.downloadErrorDetails.format(n.errorMessage()||c.downloadError,r.textStatus,r.jqXHR.status,r.errorThrown)),Q.reject(r)}var k,d;Object.defineProperty(t,"__esModule",{value:!0});t.FxFileDownloadCommand=t.ajaxSuccessHandler=t.notifyError=void 0;var b=MsPortalFx.Base,g=b.Net2,nt=MsPortalFx.ViewModels,tt=nt.Dialogs;t.notifyError=rt;var w=window,c=f.FileDownloadCommand,y="UserDownloadCancel_NoOp";k=function(n,t,i,f){var e=t.targetFileName||r.getContentDispostionOrDefaultFileName(f.jqXHR),o=new Blob([f.content],{type:"application/octet-stream"});return a(i,n),r.saveAsDlg(o,e),v(n,u.Status.Success),Q()};t.ajaxSuccessHandler=k;d=(function(){function f(n,t,i,r,u){this._downloadVM=n;this._diContainer=t;this._formTarget=i;this._sourceTarget=r;this._locator=u;this.canExecute=ko.observable(!0)}return f.prototype.execute=function(){var t=this,r,i;return this.canExecute()?(r=this._downloadVM,i=r.downloadType,this.canExecute(!1),r.downloadStatus(null),this._diContainer.getAsync(s.DialogManager).then((function(n){return i===e.DownloadType.OAuth?t._handleOAuthDownload(n):i===e.DownloadType.SasLike?t._handleSasLikeDownload(n):i===e.DownloadType.DataUri?t._handleDataUriDownload(n):i===e.DownloadType.BlobUri?t._handleBlobUriDownload(n):void 0})).catch((function(i){i&&i.message!==y&&h.logToExtension(n,t._sourceTarget,2,i)})).finally((function(){t.canExecute(!0)}))):Q()},f.prototype._getDownloadContext=function(n){var r=this,t=this._downloadVM,i=t.downloadDialogOptions();return t.downloadContextCallback?(i&&i.showCallbackProgressDialog&&this._showUriCbProgressDlg(n),Q(t.downloadContextCallback()).then((function(u){if(!u||!u.targetUri)return Q.reject(new Error(c.uriError));if(i&&i.showDownloadConfirmationDialog){var f=new s.MessageBox(i.downloadConfirmationTitle||c.downloadTitle,i.downloadConfirmationText||c.downloadText,2);return f.defaultButtonText=i.downloadConfirmationOKButtonText||c.defaultButtonText,f.cancelButtonText=i.downloadConfirmationCancelButtonText||c.cancelButtonText,n.showDialog(f,r._formTarget,r._sourceTarget,{locator:r._locator}).then((function(n){return n===4?Q(u):Q.reject(y)}))}return a(n,t),Q(u)})).catch((function(i){var r=t.errorMessage()||c.downloadTargetUriCallbackFailed;return a(n,t),i&&i===y?(r=y,Q.reject(new MsPortalFx.Errors.CanceledError(r))):(i&&(r=c.downloadErrorDetails2.format(r,i)),l(t,r,n))}))):t.downloadContext?Q(t.downloadContext):l(t,c.downloadContextNotProvided,n)},f.prototype._handleOAuthDownload=function(n){var r=this,i=this._downloadVM;return this._getDownloadContext(n).then((function(u){if(!p(u))return l(i,c.absoluteUriError,null);var f=u.httpMethod||"GET";return f!=="GET"&&f!=="POST"?l(i,c.typeError,null):(i.onStart&&i.onStart(),i.downloadDialogOptions()&&i.downloadDialogOptions().showDownloadProgressDialog&&r._showDldProgressDlg(n),g.ajaxExtended(it(u)).then((function(r){return t.ajaxSuccessHandler(i,u,n,r)}),(function(t){return ut(i,n,t)})))}))},f.prototype._handleDataUriDownload=function(n){var i=this;return this._getDownloadContext(n).then((function(n){var f=i._downloadVM,o,e;if(!n||!n.targetUri||!n.targetUri.startsWith("data:"))return l(f,c.dataUriParseError,null);o=n.targetFileName||c.defaultFileName;e=r.convertDataUriToBlob(n.targetUri,n.contentType===2?"binary":"text");f.onStart&&f.onStart();e.errorMessage||!e.blob?t.notifyError(f,u.Status.UriError,e.errorMessage):(r.saveAsDlg(e.blob,o),v(f,u.Status.Success))}))},f.prototype._handleBlobUriDownload=function(n){var t=this._downloadVM;return this._getDownloadContext(n).then((function(n){if(!n||!n.targetUri||!n.targetUri.startsWith("blob:"))return l(t,c.blobUriError,null);t.onStart&&t.onStart();var r=i.isIe11;return t.extensionisInWebWorker?e.downloadBlobUri(n.targetUri,n.targetFileName,r).then((function(){v(t,u.Status.Success)})):t.onBlobUriDownload(n.targetUri,n.targetFileName,r).then((function(){v(t,u.Status.Success)}))}))},f.prototype._handleSasLikeDownload=function(n){var i=this._downloadVM,r=i.downloadDialogOptions(),f;return i.downloadContextCallback&&r&&r.showDownloadConfirmationDialog?this._getDownloadContext(n).then((function(n){if(!p(n))return l(i,c.absoluteUriError,null);i.onStart&&i.onStart();w.open(n.targetUri,"_blank")})):i.downloadContextCallback?(f=w.open("about:blank","_blank"),r&&r.showCallbackProgressDialog&&this._showUriCbProgressDlg(n),Q(i.downloadContextCallback()).then((function(t){if(!p(t))return l(i,c.absoluteUriError,n);a(n,i);i.onStart&&i.onStart();f.location.href=t.targetUri})).catch((function(r){var e=i.errorMessage()||c.downloadTargetUriCallbackFailed;r&&(e=c.downloadErrorDetails2.format(e,r));a(n,i);t.notifyError(i,u.Status.DownloadPreConditionFailed,e);f&&f.close()}))):p(i.downloadContext)?(i.onStart&&i.onStart(),w.open(i.downloadContext.targetUri,"_blank"),Q()):l(i,c.absoluteUriError,null)},f.prototype._showUriCbProgressDlg=function(n){var t=this._downloadVM.downloadDialogOptions()||{};this._showProgressDlg(n,t.callbackProgressTitle||c.uriCallbackProgressTitle,t.callbackProgressText||c.uriCallbackProgressText)},f.prototype._showDldProgressDlg=function(n){var t=this._downloadVM.downloadDialogOptions()||{};this._showProgressDlg(n,t.downloadProgressTitle||c.downloadProgressTitle,t.downloadProgressText||c.downloadProgressText)},f.prototype._showProgressDlg=function(n,t,i){var r=new tt.ProgressBox(t,i);n.showDialog(r,this._formTarget,this._sourceTarget,{locator:this._locator})},f})();t.FxFileDownloadCommand=d}));
define("_generated/Less/MsPortalImpl/Controls/Controls.FileDownloadButton.css",["module"],(function(n){"use strict";return{css:".fxc-fileDownloadButton{display:inline-flex;max-width:100%}.fxc-fileDownloadButton .fxc-simplebutton{display:inherit}.azc-toolbarButton-link-disabled[role=link]{cursor:default;color:rgba(127,127,127,.7)}",moduleId:n.id}}));
define("MsPortalImpl/Controls/Controls.FileDownloadButton",["require","exports","MsPortalImpl/TsxStringMode/Tsx","MsPortalImpl/TsxStringMode/Tsx","MsPortalImpl/Base/Base.BrowserDetection","MsPortalImpl/Commands/Commands.FileDownloadCommand","MsPortalImpl/Resources/ImplScriptResources","MsPortalImpl.Controls/Controls/Base/Loadable","Fx/Controls/Button","MsPortalImpl/Commands/Commands.FxFileDownloadCommand","MsPortalImpl/Weave/Util","FxInternal/Css","_generated/Less/MsPortalImpl/Controls/Controls.FileDownloadButton.css"],(function(n,t,i,r,u,f,e,o,s,h,c,l,a){"use strict";l.injectCss(a);var v;return (function(n){function w(n){return"downloadContext"in n}var t="fxc-fileDownloadButton",v="fxs-button",y="fxs-portal-button-primary",l="fxs-button-disabled",p=i(r.Root,null,i(r.KoIfNot,{condition:"$vm.asLink"},i("div",{"data-bind":{pcControl:"$ctl.buttonViewModel",attr:{title:"$ctl.tooltip"}}})),i(r.KoIf,{condition:"$vm.asLink"},i("a",{role:"link","class":"fxs-fileDownloadLink","aria-haspopup":"dialog","data-bind":{text:"$vm.label",css:{"azc-toolbarButton-link-disabled":"$disabled"},attr:{title:"$ctl.tooltip",tabindex:'!$disabled() ? $tabIndex : "-1"',"aria-disabled":"$disabled","aria-label":"$vm.ariaLabel",href:'!$disabled() ? "#" : null'},click:"$ctl.handler"}})),i("div",{"class":"fxc-dialogContainer"})),a=(function(n){function i(t,i,r){var u=n.call(this,t,i,r)||this;return u._initializeWidgets(),u}return __extends(i,n),i.prototype.dispose=function(){this._cleanElement(t,v,y,l);n.prototype.dispose.call(this)},Object.defineProperty(i.prototype,"options",{get:function(){return this._options},enumerable:!1,configurable:!0}),i.prototype.getForm=function(){return this.element.findByClassName("fxc-dialogContainer")[0]},i.prototype.hideForm=function(){},i.prototype.showForm=function(){},i.prototype._initializeWidgets=function(){var n=this,r;this.element.addClass(t);this.element.html(p);var i=this.options,o=this._diContainer,c=ko.observable(null),a=this.element[0];w(i)?(this.command=new h.FxFileDownloadCommand(i,o,this,a),c=i.toolTip):this.command=new f.FileDownloadCommand(i.context(),o,this,a);this.tooltip=ko.computed(this.ltm,(function(){if(u.isSafari&&u.webKitVersion<u.safari_11_webKitVersion)return n.command.canExecute(!1),e.FileDownloadCommand.safariDownload;var t=ko.unwrap(c);return t?t:n.options.ariaLabel()?n.options.ariaLabel():n.options.label()}));r=ko.pureComputed((function(){var t=!n.command.canExecute()||i.disabled();return n.options.asLink||n.element.toggleClass(l,t),t}));this.handler=function(t,u){u&&(u.stopPropagation(),u.preventDefault());r()||n.command.execute(i)};this.buttonViewModel=s.create(this.ltm,{text:this.options.label,icon:ko.pureComputed((function(){return n.options.icon&&{position:0,image:n.options.icon()}})),ariaLabel:this.options.ariaLabel,onClick:this.handler,disabled:r});this._bindDescendants();this.options.asLink||(this.element.find(".fxs-button").attr("aria-haspopup","dialog"),ko.computed(this.ltm,(function(){n.element.find(".fxs-button").attr("title",n.tooltip())})))},i})(o.Widget);n.Widget=a;n.FileDownloadButton=c.createControlComponentForKO({widgetCtor:a})})(v||(v={})),v}));
define("MsPortalImpl/Widgets/Widgets.SettingsPane.Component",["require","exports","Weave/DirectMode","MsPortalImpl/Resources/ImplScriptResources","Weave","MsPortalImpl.Controls/Fields/Section","MsPortalImpl/Controls/Controls.FileDownloadButton","Fx/Composition","MsPortalImpl/Resources/HelpMenuResources","MsPortalImpl/Base/Languages"],(function(n,t,i,r,u,f,e,o,s,h){"use strict";function a(n){var t;return((t=n===null||n===void 0?void 0:n.selectedFormatCulture)===null||t===void 0?void 0:t.toLowerCase())==="fr-fr"&&(n===null||n===void 0?void 0:n.selectedDisplayLanguage)==="fr"}function v(n){var t=n.vm,l=window.fx.environment.links,v=MsPortalFx.Base.Images.Hyperlink(),y=new o.ClickableLink("#menu/directory","_self","",function(){return MsPortalFx.Base.Diagnostics.Telemetry.trace({source:"SettingsPane",action:"SettingsPaneSwitchDirectory"})});return i("div",{className:"fxs-settingspane-scrollcontent msportalfx-padding"},i("div",{className:"fxs-settingspane-body"},i("div",{className:"fxs-settingspane-globalsubs-link"},i("div",null,r.UiSettings.globalSubscriptionsLabel),i("a",{href:"#",title:r.UiSettings.clickHereLabel,fxclick:y},r.UiSettings.clickHereLabel)),i(f.Section,{vm:t.tabs})),i("div",{className:"fxs-settingspane-bottom fxs-portal-border"},i("h3",{className:"fxs-settingspane-h3"},r.UiSettings.usefulLinks),i("a",{className:"fxs-settingspane-resetlayout-link",href:"#"},r.UiSettings.resetStateLabel),i(e.FileDownloadButton,{className:"fxs-settingspane-exportall-link",vm:t.downloadButton}),i("a",{className:"fxs-settingspane-deleteall-link",href:"#"},r.UiSettings.deleteAllLabel),l.privacyAndTerms?i("a",{className:"fxs-settingspane-link",title:s.HelpMenu.legalLabel,fxclick:c(l.privacyAndTerms,"_blank","PrivacyStatementClicked")},i("span",null,s.HelpMenu.legalLabel),i("span",{className:"fxs-settingspane-icon fxs-portal-svg",image:v})):null,a(h.currentLocaleContext)?i("a",{className:"fxs-settingspane-link",title:"Accessibilité: partiellement conforme",fxclick:c("https://go.microsoft.com/fwlink/?linkid=2121428","_blank","FrenchConformanceLinkClicked")},i("span",null,"Accessibilité: partiellement conforme"),i("span",{className:"fxs-settingspane-icon fxs-portal-svg",image:v})):null,MsPortalFx.isFeatureEnabled("hidepartneridlink")?null:i(u.Fragment,null,i("div",{className:"fxs-settingspane-management-partner-label"},r.UiSettings.managementPartnerBladeLabel),i("a",{href:"#",className:"fxs-settingspane-management-partner-link",onClick:t.openManagementPartnerBlade},r.UiSettings.managementPartnerBladeText))))}function c(n,t,i,r){return new o.ClickableLink(n,t,"",function(){return y(i,r)})}function y(n,t){l.trace({source:"SettingsPane",action:n,data:t})}Object.defineProperty(t,"__esModule",{value:!0});t.SettingsPaneInner=void 0;var l=MsPortalFx.Base.Diagnostics.Telemetry;t.SettingsPaneInner=v}));
define("_generated/Less/MsPortalImpl/Widgets/Widgets.SettingsPane.css",["module"],(function(n){"use strict";return{css:'.fxs-settingspane{width:355px;max-width:100%;height:100%;box-sizing:border-box}.fxs-settingspane .fxc-resourcefilter-summary-title{display:none}.fxs-settingspane-scrollcontent{display:flex;flex-direction:column;padding-top:10px;overflow:auto;height:100%}.fxs-settingspane-label{color:#fff;padding-bottom:3px}.fxs-settingspane-header{flex:0 0 auto}.fxs-settingspane-body{flex:1 1 auto}.fxs-settingspane-globalsubs-link{padding-bottom:15px}.fxs-settingspane-link,.fxs-settingspane-resetlayout-link,.fxs-settingspane-deleteall-link,.fxs-settingspane-exportall-link{cursor:pointer;font-size:13px;display:block}.fxs-settingspane-exportall-link{display:inline-block}.fxs-settingspane-apply{margin-right:10px}.fxs-settingspane-separator{border-top-width:1px;border-top-style:solid;margin:10px auto 20px auto}.fxs-settingspane-item{margin-top:20px}.fxs-settingspane-bottom{padding-top:20px;flex:0 0 auto}.fxs-settingspane-icon{display:inline-block;width:10px;height:10px;margin-left:4px;margin-bottom:6px}.msportalfx-settingspane-idletimecontainer{display:flex;width:50%;margin-top:-5px;margin-bottom:15px}.fxs-settingspane-idletimeoverridecheckbox{margin-top:15px;margin-bottom:-15px}.fxs-settingspane-idletimeconfigurelink{display:block;margin-bottom:15px;margin-top:-5px}.msportalfx-settingspane-idletimemargin{margin-left:15px}.msportalfx-settingspane-theme-radio{margin-bottom:9px;cursor:default}.msportalfx-settingspane-theme-legend{margin-bottom:3px;font-size:13px;line-height:normal}.msportalfx-settingspane-theme{display:block;height:1px;width:1px;position:absolute;overflow:hidden;opacity:0}.msportalfx-settingspane-theme+.msportalfx-settingspane-theme-selection::after{content:"";display:block;width:3px;height:7px;border:solid #00bcf2;border-width:0 2px 2px 0;position:absolute;top:11px;left:15px;transform:rotate(45deg)}.msportalfx-settingspane-theme+.msportalfx-settingspane-theme-selection::before{content:"";height:15px;width:15px;background-color:#fff;display:block;position:absolute;top:8px;right:7px;border-radius:50%;border:1px solid #aab3bd}.msportalfx-settingspane-theme:focus+.msportalfx-settingspane-theme-container{outline-width:1px;outline-style:solid;outline-offset:1px}.msportalfx-settingspane-theme-container{display:inline-block;position:relative;height:33px;width:33px;cursor:pointer;margin-right:7px}.fxs-settingspane-h3{font-weight:600;font-size:15px;margin:0 0 7px}.fxs-settingspane-management-partner-label{margin-top:13px}.msportalfx-language-tab .fxc-simplebutton{margin-right:7px}',moduleId:n.id}}));
define("MsPortalImpl/Widgets/Widgets.SettingsPane",["require","exports","MsPortalImpl/TsxStringMode/Tsx","MsPortalImpl/TsxStringMode/Tsx","Fx/Ajax","MsPortalImpl/Base/Languages","MsPortalImpl/Base/Themes","MsPortalImpl/Services/Services.GeneralSettings","MsPortalImpl/Services/Services.Storage","MsPortalImpl/UI/UI.AuthStateManager","MsPortalImpl/UI/UI.DialogManager","MsPortalImpl/UI/UI.NavigationManager","MsPortalImpl/UI/UI.ContextPane","MsPortalImpl/Widgets/Widgets.WidgetBase","MsPortalImpl/Services/Services.Settings","MsPortalImpl/UI/Hubs/UI.NotificationManager","Fx/Controls/Button","Fx/Controls/CheckBox","Fx/Controls/DropDown","Fx/Controls/NumericTextBox","Fx/Controls/OptionsGroup","Fx/Controls/Section","Fx/Controls/TabControl","MsPortalImpl/Resources/ImplScriptResources","MsPortalImpl/UI/Commands/Base.PortalFunctions","MsPortalImpl/Weave/DirectRender","MsPortalImpl/Widgets/Widgets.SettingsPane.Component","Fx/Controls/FileDownload","FxInternal/Css","_generated/Less/MsPortalImpl/Widgets/Widgets.SettingsPane.css"],(function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut,ft,et,ot,st){"use strict";function ii(n,t,i,r,u){return function(f){var o=f.type,e;(o==="click"||o==="keydown"&&f.keyCode===13)&&(f.preventDefault(),e=Q.defer(),n.getAsync(c.DialogManager).then((function(n){return n.showModalDialog({title:t,description:i,buttons:4,uiShield:{hidePromise:e.promise}})})).then((function(t){t===6?(ct(u),r().then((function(){n.get(s.StorageService).clearAll();var t=new lt.UriBuilder(location.pathname+location.search);t.query.removeParameter("l");n.get(l.WindowManager).redirect({uri:t.toString(),reason:"clearSettingsAndReloadPortal"})})).catch((function(){e.resolve(null);n.get(p.NotificationManager).addClientNotification({title:ht.resetSettingsErrorTitle,description:it.genericErrorMessage,status:si.Error,timestamp:new Date})}))):e.resolve(null)})))}}function ct(n,t,i){var r;t&&(r={enabled:t.toString()});at.trace({source:"SettingsPane",action:n,name:i,data:r})}function ir(n,t,i,r,u){var e=i(),f=b.create(n,{label:t,labelOnRight:!0,value:e,suppressDirtyBehavior:!0});return u=u||function(){return},f.value.subscribe(n,(function(n){i(n);u(n?"true":"false");ct(r,n?"true":"false")})),f}function fi(n){switch(n){case 2:return"Dashboard";case 1:return"Home";case 4:return"InitAsDashboard";case 3:return"InitAsHome";default:return""}}function ei(n){switch(n){case 2:return"Docked";case 1:return"FlyOut";case 4:return"InitAsDocked";case 3:return"InitAsFlyOut";default:return""}}function oi(n){switch(n){case 1:return"Enabled";case 2:return"Disabled";case 3:return"InitAsEnabled";case 4:return"InitAsDisabled";default:return""}}var ti,ri,ui;Object.defineProperty(t,"__esModule",{value:!0});t.Widget=t.ViewModel=t.locales=t.currentLocaleContext=void 0;ot.injectCss(st);var lt=MsPortalFx.Base,at=lt.Diagnostics.Telemetry,si=MsPortalFx.Hubs.Notifications.NotificationStatus,wt=window,hi=wt.fx.environment,ci="#blade/HubsExtension/ConfigureIdleTimeout",li=lt.Resources.getAppRelativeUri("/api/Settings/DeleteAll"),ai=lt.Resources.getAbsoluteUri("/api/Settings/ExportAll"),vi=MsPortalFx.isDevelopmentMode||MsPortalFx.isFeatureEnabled("canmodifyextensions")||MsPortalFx.isDiagnosticsEnabled,pt="click keydown keyup",ht=it.UiSettings,yt=it.Shell.Dialogs,yi=ht.exportAllLabel,vt=ht.HighContrastToggleOption,pi=ht.LandingPageToggle.info,wi=ht.SideBarLayoutToggle.info,bi=ht.HorizontalScrollBarToggle.info,bt=ht.NotificationToastToggleOption,kt=ht.PaneButtons,ki=ht.settingsBladeTitle,dt=ht.Tabs,di=ht.ThemePicker.label,gi="fxs-settingspane-deleteall-link",nr="fxs-settingspane-resetlayout-link",tr="fxs-settingspane",gt="msportalfx-settingspane-theme",ni=".fxs-topbar-settings";t.currentLocaleContext=f.currentLocaleContext;ti=FxImpl.knownCulturesMap;t.locales=t.currentLocaleContext&&t.currentLocaleContext.selectableFormatCultures.map((function(n){return{text:ko.observable(n.localizedName),value:n.locale}}));ri=(function(n){function t(){var t=n!==null&&n.apply(this,arguments)||this;return t.tenantLevelIdleTimeoutDescription=ko.observable(""),t.selectedTheme=ko.observable(),t}return __extends(t,n),t})(v.ViewModel);t.ViewModel=ri;ui=(function(s){function c(u,c,v,y){var p=s.call(this,u,c)||this,nr,cr,yt,pt,ki,fr,ui,st,er,or,sr,ar,vr,yr,pr;p._diContainer=v;p._languageBtnsDisabled=ko.observable(!0);p._isVisible=!1;p._contextPane=v.get(a.RightContextPane);p._getAuthToken=y;var hr=v.get(o.GeneralSettingsManager),wr=v.get(e.ThemeManager),br=v.get(h.AuthStateManager),ft=p._settings=hr.value,ot=p.options,ut=p.ltm,gi=g.create(ut,{items:[{text:vt.off,value:0},{text:vt.light,value:1},{text:vt.dark,value:2},],value:ko.observable(ft.highContrastKey()),label:vt.label,infoBalloonContent:vt.infoText,suppressDirtyBehavior:!0,cssClass:"msportalfx-settingspane-highcontrast",uniformItemWidth:!0});gi.value.subscribe(ut,(function(n){ft.highContrastKey(n);ct("SettingsPaneToggleHighContrast",n.toString())}));ko.computed(ut,(function(){gi.value(ft.highContrastKey())}));ot.themes=p._initializeThemes(wr,ot.selectedTheme);nr=ir(ut,bt.label,ft.notificationToastEnabledKey,"SettingsPaneToggleNotificationToasts");nr.infoBalloonContent(bt.info);cr=t.currentLocaleContext.selectableDisplayLanguages.map((function(n){return{text:ko.observable(n.localizedName),value:n.locale}}));p._languageDropdown=k.create(ut,{label:{htmlTemplate:ht.languageSelectionTitle},ariaLabel:ht.languageSelectionTitle,items:cr,suppressDirtyBehavior:!0,cssClass:"msportalfx-settings-language-dropdown"});p._regionalFormatDropdown=k.create(ut,{label:{htmlTemplate:ht.localeSelectionTitle},items:t.locales,suppressDirtyBehavior:!0,filter:!0});p._resetDropdownValue();yt=!1;pt=!1;p._languageDropdown.value.subscribe(ut,(function(n){p._regionalFormatDropdown.value(MsPortalFx.find(t.locales,(function(t){return t.value===(ti[n].specificCulture||n)})).value);yt=t.currentLocaleContext.selectedDisplayLanguage!==n;p._newLanguage=yt?n:null;p._languageBtnsDisabled(!(yt||pt))}));p._regionalFormatDropdown.value.subscribe(ut,(function(n){pt=t.currentLocaleContext.selectedFormatCulture!==n;p._newRegionalFormat=pt?n:null;p._languageBtnsDisabled(!(yt||pt))}));var kr=w.create(ut,{text:ht.Debug.buttonText,style:0,onClick:function(){MsPortalFx.require("./Widgets.DebugContextPane",n).then((function(n){n.show(v)}))},visible:vi}),lr=br.bootstrapState||{},dr=ko.observable((lr.user||{}).isTenantAdmin),ni=Math.ceil((lr.idleTimeoutSeconds||0)/60),tr=ko.computed(ut,(function(){return!!ot.tenantLevelIdleTimeoutDescription()})),ii,rr,ri,si,li,ur=ko.observable(!1);return ni?(ot.tenantLevelIdleTimeoutDescription(ht.idleTimeoutForced.format(ni)),ni>1?(ii=b.create(ut,{label:ht.idleTimeoutOverrideLabel,infoBalloonContent:ht.idleTimeoutOverrideDetails,labelOnRight:!0,suppressDirtyBehavior:!0,visible:tr}),rr=d.create(ut,{allowEmpty:!1,ariaLabel:ht.idleTimeoutOverrideMinutes,label:"",placeHolderText:ht.idleTimeoutOverrideMinutes,min:1,max:ni-1,suppressDirtyBehavior:!0,disabled:ko.computed(ut,(function(){return!ii.value()})),visible:tr}),ki=ft.idleTimeoutMins(),ki&&ki<ni?(ii.value(!0),rr.value(ki)):(ii.value(!1),ft.idleTimeoutMins(0))):ft.idleTimeoutMins(0)):(ri=k.create(p.ltm,{label:ht.idleTimeoutDropdownLabel,items:[{text:ht.idleTimeoutNever,value:0},{text:ht.idleTimeout15Minutes,value:15},{text:ht.idleTimeout30Minutes,value:30},{text:ht.idleTimeout45Minutes,value:45},{text:ht.idleTimeout60Minutes,value:60},{text:ht.idleTimeout90Minutes,value:90},{text:ht.idleTimeout120Minutes,value:120},{text:ht.idleTimeoutCustom,value:-1},],suppressDirtyBehavior:!0,visible:ko.computed(p.ltm,(function(){return!p.options.tenantLevelIdleTimeoutDescription()}))}),si=d.create(p.ltm,{label:ht.idleTimeoutHoursLabel,allowEmpty:!1,decimalPoint:0,suppressDirtyBehavior:!0}),li=k.create(p.ltm,{label:ht.idleTimeoutMinutesLabel,items:[{text:"00",value:0},{text:"15",value:15},{text:"30",value:30},{text:"45",value:45},],suppressDirtyBehavior:!0}),fr=function(n){return[0,15,30,45,60,90,120].indexOf(n)>-1},ui=ft.idleTimeoutMins(),fr(ui)?ri.value(ui):(ri.value(-1),li.value(ui%60),si.value(Math.floor(ui/60))),ko.reactor(p.ltm,(function(){var n=ri.value(),t,i;fr(n)?ur(!1):(ur(!0),t=si.value()||0,i=li.value(),n=t*60+i);ct("SettingsPaneSwitchIdleTimeout",null,(n||"").toString());ft.idleTimeoutMins(n)}))),st=v.get(FxImpl.Features),er=g.create(ut,{items:ko.observableArray([{text:it.AzureHome.home,value:1},{text:it.NavBar.home,value:2},]),value:ko.observable(o.isLandingPageDashboard(v)?2:1),label:ko.observable(it.LandingPage.saveText),ariaLabel:ko.observable(it.LandingPage.save),visible:st.isEnabled("azurehome")&&!st.isEnabled("hidedashboards"),suppressDirtyBehavior:!0,infoBalloonContent:pi,uniformItemWidth:!0}),er.value.subscribe(p.ltm,(function(n){var t=p._settings.landingPage();p._settings.landingPage(n);at.trace({source:"SettingsPane",action:"DefaultLandingPageSwitched",name:fi(n),data:{previousSelection:fi(t)}})})),or=g.create(ut,{items:ko.observableArray([{text:it.SideBarLayout.flyOut,value:1},{text:it.SideBarLayout.docked,value:2},]),value:ko.observable(o.isSideBarDocked(v)?2:1),label:ko.observable(it.SideBarLayout.saveText),ariaLabel:ko.observable(it.SideBarLayout.save),visible:st.isEnabled("sidebarhamburgermode")&&!hi.chrome.hideSidebarNav,suppressDirtyBehavior:!0,infoBalloonContent:wi,uniformItemWidth:!0}),or.value.subscribe(p.ltm,(function(n){var t=p._settings.sideBarLayout();p._settings.sideBarLayout(n);at.trace({source:"SettingsPane",action:"DefaultSideBarLayouSwitched",name:ei(n),data:{previousSelection:ei(t)}})})),sr=g.create(ut,{items:ko.observableArray([{text:it.HorizontalScrollBarMode.enabled,value:1},{text:it.HorizontalScrollBarMode.disabled,value:2},]),value:ko.observable(o.isFocusNavigationEnabled(v)?1:2),label:ko.observable(it.HorizontalScrollBarMode.saveText),ariaLabel:ko.observable(it.HorizontalScrollBarMode.save),visible:st.isEnabled("reservehozscroll")&&st.isEnabled("allowdisablehozscroll"),suppressDirtyBehavior:!0,infoBalloonContent:bi,uniformItemWidth:!0}),sr.value.subscribe(p.ltm,(function(n){var t=p._settings.focusNavigationMode();p._settings.focusNavigationMode(n);at.trace({source:"SettingsPane",action:"HorizontalScrollModeSwitched",name:oi(n),data:{previousSelection:oi(t)}})})),ot.openManagementPartnerBlade=function(){ct("ManagementPartnerBladeOpen","SettingsPane");p._contextPane.close(!0);v.get(rt.RoutePortalFunc).invoke("#blade/Microsoft_Azure_Billing/managementpartnerblade","SettingsPane")},ar=w.create(ut,{text:kt.discard,style:0,onClick:function(){p._resetDropdownValue()},disabled:p._languageBtnsDisabled}),vr=w.create(ut,{text:kt.apply,style:0,onClick:function(){var r=t.currentLocaleContext.selectedDisplayLanguage,u=t.currentLocaleContext.selectedFormatCulture,e=f.localeDelimiter,s=p._newLanguage||r,o=p._newRegionalFormat||u,n=s,h=r+e+u,i;o&&(n+=e+o);p._newLanguage&&at.trace({source:"SettingsPane",action:"SettingsPaneSwitchLanguage",name:p._newLanguage,data:{current:h,"new":n}});ft.rawLocale(n);i=new lt.UriBuilder(wt.location.href);i.query.setParameter("l",n);hr.flush().then((function(){v.get(l.WindowManager).redirect({uri:i.toString(),reason:"settingsApplied"})}))},disabled:p._languageBtnsDisabled}),ot.downloadButton=et.createOAuthDownload(ut,{label:yi,displayStyle:1,downloadContext:function(){return p._getAuthToken().then((function(n){return{httpMethod:"POST",targetUri:ai,targetFileName:"settings.json",authorizationToken:n}}))}}),yr=nt.create(ut,{name:dt.general,telemetryName:"GeneralTab",children:[{htmlTemplate:i(r.KoIf,{condition:"$data.showtimeout"},i("div",{"class":"msportalfx-text-regular","data-bind":{text:"tenantLevelIdleTimeoutDescription"}})),viewModel:{tenantLevelIdleTimeoutDescription:ot.tenantLevelIdleTimeoutDescription,showtimeout:tr}},ii,rr,{htmlTemplate:i(r.KoIf,{condition:"isTenantAdmin"},i("a",{"class":"msportalfx-settingspane-idletimeconfigurelink","data-bind":{text:"configureText",attr:{href:"configureLink"}}})),viewModel:{configureText:ht.idleTimeoutConfigure,configureLink:ci,isTenantAdmin:dr}},ri,{htmlTemplate:i(r.KoIf,{condition:"showCustomTimeoutControls"},i("div",{"class":"msportalfx-settingspane-idletimecontainer"},i("div",{"data-bind":{pcControl:"idleHoursTextBox"}}),i("div",{"class":"msportalfx-settingspane-idletimemargin","data-bind":{pcControl:"idleMinutesDropdown"}}))),viewModel:{idleHoursTextBox:si,idleMinutesDropdown:li,showCustomTimeoutControls:ur}},er,or,sr,{htmlTemplate:i("fieldset",{"class":"msportalfx-settingspane-theme-radio",role:"radiogroup","aria-labelledby":"settingsPaneThemeLabelId"},i("legend",{"class":"msportalfx-settingspane-theme-legend msportalfx-text-sublabel",id:"settingsPaneThemeLabelId"},MsPortalFx.encodeHtml(di)),i("div",{"data-bind":{foreach:"$data.themes"}},i("label",null,i("input",{"class":gt,type:"radio","data-bind":{attr:{"aria-label":"theme.title",value:"theme.name","aria-posinset":"$index() + 1","aria-setsize":"$parent.themes().length"}}}),i("span",{"class":"msportalfx-settingspane-theme-container","data-bind":{image:"theme.svg",attr:{title:"theme.title"},css:{"msportalfx-settingspane-theme-selection":"$parent.selectedTheme().name === theme.name"}}})))),viewModel:{themes:ot.themes,selectedTheme:ot.selectedTheme}},gi,nr,].concat(kr)}),pr=nt.create(ut,{name:dt.languageAndRegion,cssClass:"msportalfx-language-tab",telemetryName:"LanguageTab",children:[p._languageDropdown,p._regionalFormatDropdown,vr,ar,]}),ot.tabs=tt.create(ut,{tabs:[yr,pr],cssClass:"msportalfx-form",telemetrySource:{extension:"SettingsPane",source:"SettingsPaneSwicthLanguageTab"}}),p}return __extends(c,s),c.prototype.dispose=function(){this._removeEventHandlers();s.prototype.dispose.call(this)},c.prototype.toggleSettingsContextPane=function(){var n=this._contextPane;return this._isVisible?Q(n.close(!0)):n.tryOpen(this)},c.prototype.onAddingContent=function(n){var t=this,i=FxImpl.createElement("div",{"class":tr});return n.getWidget().getBladeHost($(i),{title:ki,bladeWidth:0}).then((function(r){n.getWidget().addChild(r);t._isVisible=!0;ut.applyToElement({element:i,ltm:r.ltm,weaveNode:ft.SettingsPaneInner({vm:t.options}),weaveContext:{diContainer:t._diContainer},opName:"SettingsPane"});t._attachEventHandlers($(i));$(i).find("input[value="+t.options.selectedTheme().name+"]").attr("checked","checked");$.querySelectorAll(ni).addClass("fxs-topbar-active");n.openedFromTopBar(!0);n.getRootElement().addClass("fxs-portal-contextpane-from-topbar")}))},c.prototype.onRemovingContent=function(n){this._isVisible=!1;this._languageBtnsDisabled()||this._resetDropdownValue();n.getWidget().clear();this._removeEventHandlers();$.querySelectorAll(ni).removeClass("fxs-topbar-active");n.openedFromTopBar(!1);n.getRootElement().removeClass("fxs-portal-contextpane-from-topbar")},c.prototype._initializeThemes=function(n,t){ko.computed(this.ltm,(function(){t(n.currentTheme())}));return ko.observableArray(n.getThemes().map((function(t){return{theme:t,onClick:function(){ct("SettingsPaneSwitchTheme",null,t.name);n.currentTheme(t)}}})))},c.prototype._resetDropdownValue=function(){var n=this._languageDropdown,i=this._regionalFormatDropdown,u=MsPortalFx.find(n.items(),(function(n){return t.currentLocaleContext.selectedDisplayLanguage===n.value}))||MsPortalFx.first(n.items()),r;n.value(u.value);r=MsPortalFx.find(i.items(),(function(n){return t.currentLocaleContext.selectedFormatCulture===n.value}))||MsPortalFx.first(i.items());i.value(r.value)},c.prototype._attachEventHandlers=function(n){var t=this;this._events=n.setEvents([pt,"."+gt,function(n){var t=n.type,i=n.keyCode;(t==="click"||t==="keyup"&&(i===39||i===37))&&ko.dataFor(n.target).onClick()},],[pt,"."+nr,ii(this._diContainer,yt.reloadMessageTitle,yt.reloadMessageDescription,(function(){return t._diContainer.get(y.SettingsManager).clearSettings()}),"SettingsPaneRestoreDefaults"),],[pt,"."+gi,ii(this._diContainer,yt.reloadMessageTitle,yt.deleteSettingsDescription,(function(){return u.ajax({uri:li,type:"POST"})}),"SettingsPaneDeleteSettings"),])},c.prototype._removeEventHandlers=function(){MsPortalFx.disposeDisposable(this._events);this._events=null},c})(v.Widget);t.Widget=ui}))