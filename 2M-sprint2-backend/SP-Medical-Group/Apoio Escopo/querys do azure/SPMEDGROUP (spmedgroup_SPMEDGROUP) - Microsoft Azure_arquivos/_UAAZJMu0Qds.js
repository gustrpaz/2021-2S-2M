define("MsPortalImpl/UI/Compositions/UI.Composition.BladeOpener.Helpers",["require","exports","MsPortalImpl/Extension/Extension.Definition.Locator","MsPortalImpl/Services/Services.AssetTypes","MsPortalImpl/UI/Compositions/UI.Composition.PropertyBinding","MsPortalImpl/UI/Compositions/UI.Composition.PropertyTransformers"],(function(n,t,i,r,u,f){"use strict";function c(n){var t={master:{part:n.masterPartId,property:n.masterInvocationProperty,command:n.masterCommandName}};return MsPortalFx.toSortedString(t)}function l(n,t,i){var f={},r=new u.PropertyTransformerArgs(n,t,null,f,null);return r.propertyChanges.push(u.ObservableChangeArgs.forObject(i.targetProperty,t)),i.opensDynamicBlades&&h(r),i.targetProperty||s(r),r.propertyChanges.forEach((function(n){var t=n.propertyName;t&&(f[t]=n.propertyValue)})),f}function a(n,t,u,f){var l=n.get(i.DefinitionFinder),e=t,h=t.getExtensionLocator(),a=i.Locator.forBladeRedirect(h.name,t.name),c={},s;return l.tryLocate(a,c)?(s=c.value,s.type===3?e=i.Locator.forExtension("HubsExtension").withBlade(o.BladeNames.Hubs.ResourceMenuBlade):s.type===2&&(e=i.Locator.forExtension(s.toExtension||h.name).withBlade(s.toBlade))):e=n.get(r.AssetTypeService).getMappedBladeLocator(t),e&&f&&f.matchesLocatorAndModel(e,u)&&(e=t),e}Object.defineProperty(t,"__esModule",{value:!0});t.getMappedBladeLocator=t.mapMasterModelToBladeModel=t.getBladeOpenerJourneyPathSegment=void 0;var e=MsPortalFx.Base,o=e.Constants,s=f.PropertyTransformers.getModelToPropertyMapper(),h=f.PropertyTransformers.getDynamicSelectionMapper();t.getBladeOpenerJourneyPathSegment=c;t.mapMasterModelToBladeModel=l;t.getMappedBladeLocator=a}));
define("_generated/Less/MsPortalImpl/Widgets/Widgets.BreadCrumb.css",["module"],(function(n){"use strict";return{css:".fxs-breadcrumb-wrapper{display:flex;align-items:center;height:100%}.fxs-breadcrumb-wrapper>.fxs-breadcrumb-crumb{cursor:text}.fxs-breadcrumb-wrapper>.fxs-breadcrumb-crumb-active{cursor:pointer}.fxs-breadcrumb-wrapper>.fxs-breadcrumb-crumb-active:hover{text-decoration:underline}.fxs-breadcrumb-crumb{font-size:14px;flex:0 0 auto;height:100%;display:flex;align-items:center;padding:0 3px;box-sizing:border-box}.fxs-breadcrumb-divider{flex:0 0 auto;display:flex;align-items:center;justify-content:center;height:100%;text-align:center;padding:0 3px}.fxs-breadcrumb-divider svg{transform:rotate(90deg);height:10px;width:10px;margin-top:1px}.fxs-breadcrumb-overflow-btn{flex:0 0 auto;display:flex;align-items:center;justify-content:center;font-weight:200;font-size:24px;box-sizing:border-box;height:20px;width:32px;padding-bottom:14px}.fxs-breadcrumb-dropmenu{flex:0 0 auto}.fxs-breadcrumb-dropmenu .fxs-dropmenu-content{width:220px}.fxs-breadcrumb-overflow .fxs-breadcrumb-crumb{display:block;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;line-height:32px;padding:0 10px !important}.fxs-breadcrumb-container{display:flex;padding:0 17px;height:20px}.fxs-breadcrumb-crumb:not(.fxs-breadcrumb-crumb-active){display:none}",moduleId:n.id}}));
define("MsPortalImpl/Widgets/Widgets.BreadCrumb",["require","exports","MsPortalImpl/Resources/ImplScriptResources","MsPortalImpl/Base/Base.Timers","MsPortalImpl/Widgets/Widgets.WidgetBase","Viva.Controls/Util/Viva.Resize","MsPortalImpl/Interactions/Interactions.KeyboardNavigation","MsPortalImpl/Base/Base.DeepLink","WeaveDOM/DirectRender/DataAttribute","Weave/Core/Computation","FxInternal/Css","_generated/Less/MsPortalImpl/Widgets/Widgets.BreadCrumb.css","MsPortalImpl/Base/Base.KeyboardHelper","Weave"],(function(n,t,i,r,u,f,e,o,s,h,c,l,a,v){"use strict";function w(n,t,i,r){var u;ko.computed(n,t,(function(t){var h=r?t.slice().reverse():t,c=h.length,e,o,s,l,a,f;if(u&&u.dispose(),u=n.createChildLifetime(),e=i(),o=c-e.length,o>0){for(s=[],f=0,l=Math.max(o,5);f<l;f++)s.push({bladeId:null,bladeTitle:ko.observable(),visible:ko.observable(!0),href:ko.observable(),isDefaultItemSelected:ko.observable(!1)});i.push.apply(i,s)}for(a=function(n){var t=e[n],i;n<c?(i=h[n],t.bladeId=i.bladeId,i.bladeTitle.subscribeAndRun(u,(function(n){t.bladeTitle(n)})),i.href.subscribeAndRun(u,(function(n){t.href(n)})),t.visible(!0),i.isDefaultItemSelected.subscribeAndRun(u,(function(n){t.isDefaultItemSelected(n)}))):t.visible(!1)},f=0;f<e.length;f++)a(f)}))}function tt(n){return p.measureText(n).width+6}var b,p;Object.defineProperty(t,"__esModule",{value:!0});t.DEV=t.Widget=t.ViewModel=void 0;c.injectCss(l);var k=MsPortalFx.Base,d={deferred:!0},y="rootpagelink",g="> .fxs-breadcrumb-crumb-active, .fxs-breadcrumb-dropmenu:not(.weave-display-none2) .fxs-dropmenu-button",nt=(function(n){function t(t){var i=n.call(this)||this;return i.getRootPageType=t,i.breadCrumbs=ko.observableArray(),i.breadCrumbsVisibleUI=ko.observableArray([]),i.breadCrumbsOverflowUI=ko.observableArray([]),i.hasOverflow=v.makeWritableComputation(!1),i.lastVisibleIdx=v.makeWritableComputation(0),i}return __extends(t,n),t})(u.ViewModel);t.ViewModel=nt;b=(function(n){function t(t,u){var v=n.call(this,t,u)||this,p=v.element,b=v.options,c=v.ltm,ht=[{bladeId:y,bladeTitle:ko.observable(""),deepLink:ko.observable("#")}],l=ko.observableArray([]),nt,rt,ft,et,ut,ot,st,it;return ko.computed(c,(function(){var n=b.breadCrumbs(),t=n.length&&n[n.length-1].bladeTitleResolved?n[n.length-1].bladeTitleResolved():!0;ko.ignoreDependencies((function(){var r=l().slice(),f=ht.concat(n),e=n.length&&n[0].isCustomHome;e&&f.splice(1,1);f.forEach((function(n,t){var s=r[t]={bladeId:n.bladeId,bladeTitle:n.bladeTitle,visible:r[t]&&r[t].visible||ko.observable(!0),href:n.deepLink,isDefaultItemSelected:n.isDefaultItemSelected||ko.observable(!1)},f,e;if(n.bladeId===y){f=void 0;e=void 0;switch(u.getRootPageType()){case"Home":f=i.AzureHome.home;e=o.getHomeDeeplink();break;case"Dashboard":f=i.NavBar.home;e=o.getDefaultDashboardDeeplink();break;default:f=i.SideBar.allServices;e=o.getAllServicesDeeplink()}s.bladeTitle(f);s.href(e)}}));r.splice(f.length);t||r.splice(r.length-1,1);MsPortalFx.deepEquals(r,l())||(p.toggleClass("fxs-display-none",r.length<2),l(r))}))})),nt=l.filter(c,(function(n){return!n.visible()})),nt.extend(d),rt=v.breadCrumbsVisible=l.filter(c,(function(n){return n.visible()})),w(c,rt,b.breadCrumbsVisibleUI,!1),w(c,nt,b.breadCrumbsOverflowUI,!1),ft=p.findByClassName("fxs-breadcrumb-container"),et=p.findByClassName("fxs-breadcrumb-wrapper"),nt.subscribeAndRun(c,(function(n){return b.hasOverflow(n.length>0)})),ut=function(){var n=l(),u=ft.width(),i=n.map((function(n){return tt(n.bladeTitle())})),e=i.reduce((function(n,t){return n+t}),0)+Math.max(0,i.length-1)*16,r,t,f;if(e<=u)n.forEach((function(n){return n.visible(!0)}));else{for(r=u-32,t=n.length-1;t>=0&&r>=0;)r-=16+i[t--];f=t+1;n.forEach((function(n,t){return n.visible(t<=f?!1:!0)}))}},ot=r.throttleByAnimationFrame(ut),f.track(c,p,ut),ko.computed(c,(function(){var t=l(),n=MsPortalFx.last(t);n&&n.bladeTitle();ot()})),st=new e.KeyboardNavigation(c,{element:et,tabTriggers:12,itemSelector:g}),c.registerForDispose([p.setEvents(["click keydown",".fxs-breadcrumb-crumb",function(n){var r;if(a.isCtrlOrCommandOnly(n)||n.shiftKey)return!0;if(n.type==="click"||n.which===13||n.which===32){var u=$(n.currentTarget),f=s.getElementData(n.currentTarget),i=f.bladeId,t=i===y;u.hasClass("fxs-breadcrumb-crumb-active")&&i&&(r=t?undefined:{bladeId:i},k.Diagnostics.Telemetry.trace({source:"Desktop",action:t?"BreadCrumbHomeClicked":"BreadCrumbClicked",data:r}),t||u.trigger("fxbreadcrumbclick",r));t||(n.preventDefault(),n.stopPropagation())}},]),]),it=!1,ko.computed(c,rt,(function(n){b.lastVisibleIdx(n.length-1);it||(it=!0,h.invokeAfterChangePropagation((function(){it=!1;st.correctState()})))})),v}return __extends(t,n),t})(u.Widget);t.Widget=b;p=document.createElement("canvas").getContext("2d");p.font="14px az_ea_font,'Segoe UI',az_font,system-ui,-apple-system,BlinkMacSystemFont,Roboto,Oxygen,Ubuntu,Cantarell,'Open Sans','Helvetica Neue',sans-serif"}));
define("MsPortalImpl/Widgets/Widgets.BreadCrumb.Component",["require","exports","Weave/DirectMode","MsPortalImpl/Resources/ImplScriptResources","Weave","_generated/MsPortalImpl/Svg/Startup/CaretUp.svg","FxInternal/Weave/Util","MsPortalImpl/Widgets/Widgets.DropMenu.Component","MsPortalImpl/Widgets/Widgets.DropMenu","Fx/Weave"],(function(n,t,i,r,u,f,e,o,s,h){"use strict";function c(n){var t=n.vm;return i("div",{className:"fxs-breadcrumb-container"},i("nav",{className:"fxs-breadcrumb-wrapper","aria-label":r.Breadcrumb.navlabel},i(u.If,{condition:t.hasOverflow,trueFn:function(){var n=new s.ViewModel(undefined,undefined,".fxs-breadcrumb-crumb-active",!0),f,c;return n.setItemFocusWhenOpen=!0,n.buttonTooltip(r.Breadcrumb.navhistory),n.alignMenu=0,f=i("div",{className:"fxs-breadcrumb-overflow-btn fxs-portal-hover",role:"presentation"},"..."),c=i("ul",{className:"fxs-breadcrumb-overflow"},i(u.ForEach,{collection:h.toComputation(t.breadCrumbsOverflowUI),fn:function(n){var t=n.item;return i("li",{className:["fxs-portal-hover",{"fxs-display-none":h.toComputation(t.visible).compose(e.negation)}]},i("a",{className:["fxs-breadcrumb-crumb",{"fxs-breadcrumb-crumb-active":h.toComputation(t.visible)}],title:h.toComputation(t.bladeTitle),href:h.toComputation(t.href),tabindex:"-1",data:t},h.toComputation(t.bladeTitle)))}})),i("div",{className:"fxs-breadcrumb-dropmenu",afterMount:function(t,i){i.registerForDispose(new s.Widget($(t),n,!0))}},i(o.DropMenuInner,{button:f,content:c,vm:n}))}}),i(u.ForEach,{collection:h.toComputation(t.breadCrumbsVisibleUI),fn:function(n){var r=n.item,o=n.index,s=h.toComputation(r.visible).compose(e.negation),c=u.composeComputation([h.toComputation(r.visible),h.toComputation(r.isDefaultItemSelected),o,t.lastVisibleIdx],a);return i(u.Fragment,null,i(u.If,{condition:u.composeComputation([o,t.hasOverflow],l),concealmentBehavior:"remove",trueFn:function(){return i("div",{className:["fxs-breadcrumb-divider fxs-portal-svg-secondary",{"fxs-display-none":s}],image:f})}}),i("a",{className:["fxs-breadcrumb-crumb fxs-portal-text",{"fxs-display-none":s,"fxs-breadcrumb-crumb-active":c}],href:h.toComputation(r.href),tabindex:"-1",data:r},h.toComputation(r.bladeTitle)))}})))}function l(n,t){return n>0||t}function a(n,t,i,r){return n&&(i<r||!t)}Object.defineProperty(t,"__esModule",{value:!0});t.BreadCrumbInner=void 0;t.BreadCrumbInner=c}));
define("_generated/Less/MsPortalImpl/Widgets/Widgets.Journey.css",["module"],(function(n){"use strict";return{css:".fxs-journey{overflow-x:hidden;overflow-y:auto;display:flex;flex-direction:column}.fxs-journey-layout{flex:1 1 auto;z-index:0;position:relative}.fxs-journey-layout>.fxs-blade{display:none}.fxs-journey-layout>.fxs-blade.fxs-blade-display-in-journey:last-of-type{display:flex}.fxs-journey-breadcrumb{display:none;z-index:1;box-sizing:border-box;padding-top:8px;flex:0 0 auto}.fxs-show-journey .fxs-journey-breadcrumb{display:block}.fxs-journey-placeholder{display:none}@media(min-width:640px) and (min-height:500px){.fxs-journey .fxs-blade.fxs-blade-display-in-journey{display:flex}.fxs-journey-placeholder:last-child{display:block;flex:0 0 auto}}@media(min-height:500px){.fxs-journey{overflow:hidden}.fxs-journey-layout{height:100%;overflow-x:auto;overflow-y:hidden}.fxs-blade{overflow:hidden}}@media(max-height:499.99999px){.fxs-journey .fxc-gc-vscroll{max-height:calc(100vh - 45px)}.fxs-blade{min-height:calc(100vh - 40px - 20px - 8px)}}",moduleId:n.id}}));
define("MsPortalImpl/Widgets/Widgets.Journey",["require","exports","MsPortalImpl/Widgets/Widgets.WidgetBase","MsPortalImpl/Widgets/Widgets.Blade","MsPortalImpl/Widgets/Widgets.LayoutBase","MsPortalImpl/Widgets/Widgets.StackLayout","MsPortalImpl/Widgets/Widgets.UIElementBase","MsPortalImpl/Widgets/Widgets.BreadCrumb","Viva.Controls/Util/Viva.Resize","MsPortalImpl/Base/Base.BrowserDetection","MsPortalImpl/Base/Base.Timers","MsPortalImpl/Widgets/Widgets.BreadCrumb","MsPortalImpl/Widgets/Widgets.BreadCrumb.Component","MsPortalImpl/Weave/DirectRender","FxInternal/Css","_generated/Less/MsPortalImpl/Widgets/Widgets.Journey.css","MsPortalImpl/Services/Services.GeneralSettings"],(function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w){"use strict";function pt(n,t){var i=n.length,r=n[i-1],u=n[i-2];i>0&&(r.visibleInJourney?g(n,t)&&(u.visibleInJourney=!0):ct(n,t,!0))}function wt(n,t){var r=n.length,i,u;if(n[r-1].subjourney)for(i=r-2;i>=0&&n[i].visibleInJourney;--i)n[i].visibleInJourney=!1;else u=d(n,t),u.freespace<0&&lt(n,r-(g(n,t)?3:2))}function ct(n,t,i){i===void 0&&(i=!1);var r=d(n,t,i);lt(n,r.unfitIdx)}function lt(n,t){for(var i=t+1;i<n.length&&!n[i].visibleInJourney;)n[i++].visibleInJourney=!0;while(t>=0&&n[t].visibleInJourney)n[t--].visibleInJourney=!1}function d(n,t,i){var f;i===void 0&&(i=!1);for(var e=t,u=n.length,r=u-1;r>=0&&(i||n[r].visibleInJourney)&&t>=0&&(r===u-1||!n[r+1].subjourney);)f=n[r],f.maximized?t=-1:t-=f.idealWidth,(t>=0||r===u-1)&&--r;return r===u-2&&g(n,e)&&--r,{freespace:t,unfitIdx:r}}function g(n,t){var i=n.length,r=n[i-1],u=n[i-2];return i>1&&u.actStyle&&!r.appblade&&!r.subjourney&&t>=k&&t>=r.idealWidth+u.idealWidth}function bt(n,t,i,r){var u=n.length;return n.map((function(n,f){var e=n.blade,o=e.options,s=e.getContentWidget().options.bladeStyle.value===12,h=!s&&!n.pending&&o.useActivationStyle&&(f!==u-1||t&&e.element.hasClass(ut)),c=s||n.pending||o.displayState()===2&&!h;return{widget:e,idealWidth:e.idealWidth(h),actStyle:h,maximized:c,subjourney:o.asSubJourney,visibleInJourney:i&&r||e.element.hasClass(ft)||!e.element[0].style.width,appblade:s}}))}function kt(n,t){n.forEach((function(i,r){var u=n[r-1];!i.appblade&&u&&u.actStyle&&!i.subjourney&&(i.actStyleCanFit=t>=k&&u.displayWidth+i.idealWidth<=t);i.displayWidth=i.maximized?i.actStyleCanFit?t-u.displayWidth:Math.max(i.idealWidth,t):i.idealWidth}))}function dt(n,t,i){var f=MsPortalFx.isFeatureEnabled("reservehozscroll"),e=n.widget.element,u={},r;f&&et?u.width=n.displayWidth+"px":(r=n.maximized?"100%":n.idealWidth+"px",window.innerWidth<640?r="100%":n.maximized&&i&&i.visibleInJourney&&i.actStyle&&(n.actStyleCanFit||!(f&&t))&&!n.subjourney&&!n.appblade&&(r="calc(100% - "+i.idealWidth+"px)"),u.width=r);e.css(u).toggleClass(ut,n.actStyle).toggleClass("fxs-blade-maximized",n.maximized).toggleClass("fxs-blade-appblade",n.appblade).toggleClass("fxs-blade-has-activation-fit",n.actStyleCanFit)}var k,st,ht;Object.defineProperty(t,"__esModule",{value:!0});t.Widget=t.ViewModel=t.EventNames=t.scrollLogDebounce=void 0;y.injectCss(p);var b=window,nt=b.fx.environment,tt="fxs-journey",at=".fxs-blade",vt="fxs-blade-firstblade",it="fxs-blade-lastblade",rt="fxs-journey-placeholder",ut="fxs-blade-has-activation",ft="fxs-blade-display-in-journey",yt="fxs-blade-shows-pending",et=h.isIe&&!h.isEdge,ot=2e3;t.scrollLogDebounce=1e3;k=1280;t.EventNames={addingChild:"addingChild",removingChild:"removingChild"};st=(function(n){function t(t,i,r){var e=n.call(this,t)||this,o;return e.getRootPageType=i,e.diContainer=r,o=new f.ViewModel("fxs-journey-stacklayout-instanceid",undefined,".fxs-extension-frame"),o.orientation(u.Orientation.Horizontal),e.stackLayoutOptions=o,e}return __extends(t,n),t.prototype.getViewSettings=function(){return{}},t})(e.ViewModel);t.ViewModel=st;ht=(function(n){function u(t,u){var ut,e=n.call(this,t,u)||this,h,b,y,k,p,st;e._childElementCount=ko.observable();e._rePosArgs=[];e._lastBladeCalcInfo=[];e._scheduleFocusOnLastChild=c.throttleByAnimationFrame((function(n){if(e.ltm&&!e.ltm.isDisposed()&&n&&e._childElementCount()>0){var t=e.options.stackLayoutOptions.childElements(),u=t[t.length-1],f=i.Widget.getWidget(u,r.Widget);f.setFocus()}}));e._loadingBladeIdList=[];t.addClass(tt);t.toggleClass("fxs-journey-nobladeheader",!!nt.chrome.hideBladeHeader);h=t.findByClassName("fxs-journey-layout");e._layout=new f.Widget(h,u.stackLayoutOptions);e._childElementCount(0);b=[e._layout,function(){return e.element.removeClass(tt)}];y=[["fxbladerepos",function(n,t){e._rePosArgs.push(t);e._rePositionBlades()},],];nt.chrome.hideBreadcrumb||(k=t.findByClassName("fxs-journey-breadcrumb"),p=new l.ViewModel(u.getRootPageType),v.applyToElement({element:k[0],ltm:e.ltm,weaveNode:a.BreadCrumbInner({vm:p}),weaveContext:{diContainer:u.diContainer},opName:"breadCrumb"}),b.push(new o.Widget(k,p)),y.push(["fxbreadcrumbclick",function(n,t){for(var u,f=t.bladeId,r=e.getBlades(),i=0;i<r.length;++i)if(u=r[i],u.options.id===f){i<r.length-1&&r[i+1].close(!1);i===r.length-1?u.goToDefaultItem():u.goToFirstDetailContent();break}else if(u.goToDetailContent(f)){i<r.length-1&&r[i+1].close(!1);break}},]),y.push(["fxbreadcrumbupdate",function(){var n=e.getBlades();p.breadCrumbs(MsPortalFx.mapMany(n,(function(n){return n.getBreadCrumbs()})))},]));e.ltm.registerForDispose(b.concat((ut=e.element).setEvents.apply(ut,y)));var ht=t.parent(".fxs-panorama"),g=MsPortalFx.isFeatureEnabled("reservehozscroll"),lt=e.options.diContainer.get(w.GeneralSettings);return lt.focusNavigationMode.subscribe(e.ltm,(function(){e._rePositionBlades()})),st=c.throttleByAnimationFrame((function(n){var t=h.scrollLeft();Math.max(0,n)!==t&&h.scrollLeft(n)})),e._rePositionBlades=c.throttleByAnimationFrame((function(){var t,b,u,c,f,y,r,p;if(e.ltm&&!e.ltm.isDisposed()){t=ht.width();b=e._rePosArgs.length&&e._rePosArgs.every((function(n){return n&&n.noScroll}));e._rePosArgs=[];var n=e._getBladeCalculatedInfo(),i=n.length,s=e._lastBladeCalcInfo.length;if(e._lastBladeCalcInfo=n,u=!w.isFocusNavigationEnabled(e.options.diContainer),i&&n[i-1].actStyle&&setTimeout((function(){e._rePosArgs.push({noScroll:!0});e._rePositionBlades()}),ot),g&&u||(s>i?pt(n,t):s===i?ct(n,t):wt(n,t)),c=!1,f=-1,n.forEach((function(t,i){var s=t.widget,h=s.element,e,o,r;for(dt(t,u,n[i-1]),h.toggleClass(vt,t.visibleInJourney&&!c).removeClass(it),t.widget.options.collapseVisible(t.actStyle),t.widget.options.hideCloseButton(!(g&&u)),t.actStyle||t.widget.options.collapsed(!1),t.visibleInJourney&&(c=!0,f=i),t.widget.element.toggleClass(ft,t.visibleInJourney),e=document.getElementsByClassName("fxs-part-reactframe"),o=document.createEvent("Event"),o.initEvent("resize",!0,!0),r=0;r<e.length;r++)e[r].dispatchEvent(o)})),f>=0&&n[f].widget.element.addClass(it),i&&e.trigger("fxshowjourney"),g){var l=0,a=0,o=0;if(i){var nt=d(n,t),k=nt.unfitIdx+1,v=n[k];o=n.reduce((function(n,t){return n+t.displayWidth}),0);a=v.idealWidth<t&&!v.subjourney?o-t:n.reduce((function(n,t,i){return n+(i<k?t.displayWidth:0)}),0);v.subjourney&&(y=o-a,y<t&&(l=t-y))}r=h.findByClassName(rt);l>0?(r.length||(r=$(FxImpl.createElement("div",{"class":rt})),h.append(r)),r.css("width",l+"px")):r.remove();i===s&&b||st(a);et&&(p=t<o?h[0].clientHeight+"px":"",n.forEach((function(n){return n.widget.element.css("height",p)})),r.css("height",p))}}})),s.track(e.ltm,e.element,(function(){e._rePosArgs.push({noScroll:!0});e._rePositionBlades()}),{ignoreInitialState:!0}),e}return __extends(u,n),u.prototype.hasChildren=function(){return this._childElementCount()>0},u.prototype.addChild=function(n){this.insertChild(n,undefined)},u.prototype.insertChild=function(n,i){var r=n.element?n.element:n,u=e.Widget.getId(r);this.trigger(t.EventNames.addingChild,u);this._scheduleFocusOnLastChild(!1);i>=0?this._layout.insertChild(n,i):this._layout.addChild(n);this._childElementCount(this._childElementCount()+1);this.trigger("fxbladerepos");this.trigger("fxbreadcrumbupdate")},u.prototype.getBladeDisplayWidth=function(n){var t=MsPortalFx.find(this._getBladeCalculatedInfo(),(function(t){return t.widget.options.id===n}));return t&&t.displayWidth||0},u.prototype._getBladeCalculatedInfo=function(){var n=MsPortalFx.isFeatureEnabled("reservehozscroll"),t=!w.isFocusNavigationEnabled(this.options.diContainer),r=this.element.parent(".fxs-panorama").width(),u=this.getBlades(),f=u.map((function(n){var i=n.isMenuBladeLoadingDetailBlade(),t=n.bladeDefinitionLoaded&&!i;return{blade:n,pending:!t&&n.element.hasClass(yt),loaded:t}})).filter((function(n){return n.loaded||n.pending})),e=b.fx.getTimestamp(),o=this._loadingBladeIdList.some((function(n){return n.ts+ot>e})),i=bt(f,o,n,t);return n&&t&&kt(i,r),i},u.prototype.removeChild=function(n){var i=this._layout.removeChild(n);return i&&(this.trigger(t.EventNames.removingChild,n),this._childElementCount(this._childElementCount.peek()-1),this.trigger("fxbladerepos"),this.trigger("fxbreadcrumbupdate"),this._scheduleFocusOnLastChild(!0)),i},u.prototype.removeChildren=function(n){var r=this,t=this.options,i=t&&t.stackLayoutOptions&&t.stackLayoutOptions.childElements();i&&i.slice(0).forEach((function(t){var i=e.Widget.getId(t);n&&n(i);r.removeChild(i)}))},u.prototype.saveViewSettings=function(){return this.options.getViewSettings()},u.prototype.setFocus=function(){if(this._childElementCount()>0){var t=this.options.stackLayoutOptions.childElements(),u=t[0],n=i.Widget.getWidget(u,r.Widget);n&&n.setFocus()}},u.prototype.getBlades=function(){var n=[];return this._childElementCount()>0&&(n=this.options.stackLayoutOptions.childElements().map((function(n){return i.Widget.getWidget(n,r.Widget)}))),n},u.prototype.close=function(){var n=this.getBlades()[0];n&&n.close(!1)},u.prototype.getFocusedBlade=function(){var n=$(document.activeElement).closest(at)[0],t=null;return n&&(t=MsPortalFx.find(this.getBlades(),(function(t){return t.element[0]===n}))),t},u.prototype.setFocusedBlade=function(n){var i=b.document.querySelectorAll(".fxs-blade.fxs-blade-active"),r=n.parentElement.parentElement,t;for(r.classList.add("fxs-blade-active"),t=0;t<i.length;++t)i[t]!==r&&i[t].classList.remove("fxs-blade-active")},u.prototype.loadingHint=function(n,t){var r=MsPortalFx.findIndex(this._loadingBladeIdList,(function(t){return t.id===n})),i=this._loadingBladeIdList[r],u=b.fx.getTimestamp();t?i?i.ts=u:this._loadingBladeIdList.push({id:n,ts:u}):i&&this._loadingBladeIdList.splice(r,1)},u})(e.Widget);t.Widget=ht}));
define("MsPortalImpl/UI/Compositions/UI.Composition.DelayedBladeManager",["require","exports","MsPortalImpl/UI/Compositions/UI.Composition.Finder","MsPortalImpl/UI/UI.JourneyManager","MsPortalImpl/Base/Telemetry","MsPortalImpl/Base/Base.ImplUtils","MsPortalImpl/Widgets/Widgets.Journey","MsPortalImpl/Widgets/Widgets.Portal.init"],(function(n,t,i,r,u,f,e,o){"use strict";function s(n,t){n&&n.enableTrace&&a.verbose(t+" Debug Id: '"+n.debugId+"'.")}var l;Object.defineProperty(t,"__esModule",{value:!0});t.DelayedBladeManager=void 0;var h=MsPortalFx.Base,c=h.Diagnostics.Telemetry,a=h.Diagnostics.createLog(n),v=MsPortalFx.getUniqueIdGenerator("DBS");l=(function(){function t(n,t,i){var f,e;if(this._journeyEventAttached=!1,this._loadingVisible=!1,this._config=i,this._portal=o.getPortalViewModel(i.diContainer),i&&i.enableTrace===undefined&&(i.enableTrace=u.isDesktopTraceEnabled),this._loadingHintId=v(),t){var r=void 0,s=void 0,h="Selectable";t.delayedBladeSelection?(f=t,r=f.delayedBladeSelection,s=function(n){f.selectedValue(n);f.isSelected(!0)}):t._msPortalFxDelayedBladeSelection&&(h="SelectableSet",e=t,r=e._msPortalFxDelayedBladeSelection,s=function(n){e.selectedItems.splice(0,0,n);e.activateAllSelectedItems()});r&&(c.trace({source:"Shell",action:"DelayedBladeManagerSubscribe",extension:i.extension,data:{viewModelType:h,id:i.debugId}}),this._processDelayedBladeSelection(n,r,s,i.extension))}}return t.prototype._loadingHintSignal=function(n){this._loadingVisible!==n&&(this._loadingVisible=n,this._portal.customEvents.trigger("fxloadingontopbar",{id:this._loadingHintId,cancel:!n}))},t.prototype._processDelayedBladeSelection=function(n,t,i,r){var u=this;t.subscribeAndRun(n,(function(t){t&&(u._journeyEventAttached||(u._journeyEventAttached=!0,u._portal.customEvents.addHandler(n,e.EventNames.addingChild,(function(){return u._abort()})),n.registerForDispose([function(){u._loadingHintSignal(!1)},])),u._processDelayedBladeSelectionChange(t,i,r))}))},t.prototype._abort=function(){this._currentBladeSelectionPromise=null;this._loadingHintSignal(!1)},t.prototype._processDelayedBladeSelectionChange=function(t,u,e){var h=this,o=this._config,p=o.diContainer.get(r.JourneyManager),w=o.diContainer.get(i.Finder),v=o.getSelectableContainerComposition(),l=w.findBlades(v).filter((function(n){return!(n.flags&1)})),y,a;if(l.length>0)if(p.confirmBladesCanClose(l))y=l[0].widget,y&&y.options.loaded(!1),s(o,"Closing all detail blades except the first one."),(l||[]).forEach((function(n,t){t&&p.forceCloseBlade(n)}));else{s(o,"Closing of detail blade(s) was cancelled by user, aborting delayed blade selection operation.");this._abort();return}else this._currentBladeSelectionPromise||this._loadingHintSignal(!0);a=this._currentBladeSelectionPromise=Q(t.selectedValuePromise);MsPortalFx.tryImmediateResolve(a,(function(n){a===h._currentBladeSelectionPromise?(c.trace({source:"Shell",action:"DelayedBladeManagerOpenBlade",extension:h._config.extension,data:{selectedValue:n,id:h._config.debugId}}),h._loadingHintSignal(!1),s(o,"Activate master selectable. Value: {0}.".format(ko.toJSON(n))),u(n)):s(o,"Another delayed operation is underway, selected value will be ignored. Value: {0}.".format(ko.toJSON(n)))}),(function(t){a===h._currentBladeSelectionPromise&&h._loadingHintSignal(!1);var i=v&&v.toString()||"N/A",r=FxImpl.createError("Promise provided to Selectable.delayedBladeSelection/SelectableSet.setCreateDelayedBladeSelection has been rejected. PartId:"+i,{innerErrors:t});f.logToExtension(n,e,2,r)}))},t})();t.DelayedBladeManager=l}));
define("MsPortalImpl/UI/Compositions/UI.Composition.SelectableSetBinder",["require","exports","MsPortalImpl/UI/Compositions/UI.Composition.PropertyBinding","MsPortalImpl/UI/Compositions/UI.Composition.CompositionBinder"],(function(n,t,i,r){"use strict";var u;return (function(n){function s(n,i,r){return MsPortalFx.find(n.selectableItems(),(function(n){return t(i,n.data,r)}))}function u(n,i,r){return MsPortalFx.find(n(),(function(n){return t(i,r,n)}))}function t(n,t,r){return Object.getOwnPropertyNames(n).reduce((function(u,f){var o,e;return u?(e=i.getModelValue(r,f,!0),e.exists)?(o=i.getModelValue(t,n[f],!0),MsPortalFx.deepEquals(e.value,o.value,!0)):!1:u}),!0)}function a(n,t,i,r,u,f){var e=t.itemsWithChildEdits;h(n,e,i,(function(n,t){return n.editScopeId===t.editScopeId&&u(n.item,t.item)}),(function(n){return{editScopeId:n.editScopeId,item:r(n.item)}}),(function(){}),(function(n){f(n.item)}));h(n,i,e,(function(n,t){return t.editScopeId===n.editScopeId&&u(t.item,n.item)}),(function(n){var i=MsPortalFx.find(t.selectableItems(),(function(t){return u(t.data,n.item)}));return i?{editScopeId:n.editScopeId,item:i.data}:undefined}),(function(n){f(n.item)}),(function(){}))}function h(n,t,i,r,u,f,e){var o=[];ko.reactor(n,(function(){var n=ko.utils.compareArrays(o,t());n.forEach((function(n){switch(n.status){case"added":case"retained":if(!i().some((function(t){return r(n.value,t)}))){var t=u(n.value);t&&i.push(t)}break;case"deleted":i.remove((function(t){return r(n.value,t)?(e(t),!0):!1}));f(n.value)}}));o=t.slice(0)}))}var c=FxImpl.TriggerableLifetimeManager,f=r.CompositionBinder,l=" - [SelectableSetElement]",e=(function(n){function t(t,i,r,u,f,e){var o=n.call(this)||this;return o._diContainer=t,o._bindings=[],o._selectablePath=i,o._modelId=r,o._modelIdPostFix=u,o._inputs=f,o._referenceComposition=e,o.registerForDispose((function(){o._bindings.forEach((function(n){n.unbind()}));o._bindings=[]})),o}return __extends(t,n),Object.defineProperty(t.prototype,"selectablePath",{get:function(){return this._selectablePath},enumerable:!1,configurable:!0}),t.prototype.createTargetForSelectedItem=function(n){var t=this._bindElement(n,this._inputs,this._referenceComposition);return this._deleteBindings(t),t},t.prototype._bindElement=function(n,t,r,u){var c=[],o=[];t.forEach((function(n){n.valuesFrom[0].referenceType===6?c.push(n):o.push(n)}));var e=u?u:{},l=this._modelId+this._modelIdPostFix,s=new i.PropertyBindings(l,e),h;return this._bindings.push(s),o.length>0&&(h=f.mapInputBindingDefinitions(o,r),h.forEach((function(n){i.setModelValue(e,n.targetProperty,ko.observable())})),f.setupPropertyBindings(this._diContainer,r,s,h)),c.forEach((function(t){i.getModelValue(e,t.property).exists||i.setModelValue(e,t.property,ko.observable());s.mapProperty(t.valuesFrom[0].property,t.property).bind(l,n,!0)})),e},t.prototype._deleteBindings=function(n){var t=this._findBindings(n);t&&(t.unbind(),MsPortalFx.remove(this._bindings,t))},t.prototype._findBindings=function(n){return MsPortalFx.find(this._bindings,(function(t){return t.targetModel===n}))},t})(c),o;n.SelectableSetBinderBase=e;o=(function(n){function i(i,r,f,e,o,h,c){var v=n.call(this,i,r,f,l,h,c)||this,w=!1,b=!1,p=h.reduce((function(n,t){var i=t.valuesFrom;return i&&i.length&&i[0].referenceType===6&&(n[t.property]=i[0].property),n}),{}),y=o.activatedItems,k;return y().forEach((function(n){var t=s(e,p,n);t&&(t.isActivated(!0),t.isSelected(!0),v._bindElement(t.data,h,c,n))})),e.activatedItems().forEach((function(n){var t=u(y,p,n);t||y.push(v._bindElement(n,h,c))})),y().length>v._bindings.length&&(k=v.createChildLifetime(),e.selectableItems.subscribeArrayAdds(k,(function(n){var t=u(y,p,n.data);t===null||v._findBindings(t)||(n.isSelected(!0),n.isActivated(!0),v._bindElement(n.data,h,c,t),v._bindings.length>=y().length&&k.dispose())}))),e.activatedItems.subscribeArrayChanges(v,(function(n){if(!b){var t=u(y,p,n);try{w=!0;t||y.splice(0,0,v._bindElement(n,h,c))}finally{w=!1}}}),(function(n){if(!b)try{w=!0;y.remove((function(i){return t(p,n,i)?(v._deleteBindings(i),!0):!1}))}finally{w=!0}})),y.subscribeArrayChanges(v,(function(n){var t=s(e,p,n);if(t){if(!w)try{b=!0;t.isSelected(!0);t.isActivated(!0)}finally{b=!1}v._findBindings(n)||v._bindElement(t.data,h,c,n)}}),(function(n){if(!w)try{b=!0;e.activatedItems.remove((function(i){return t(p,i,n)?(v._deleteBindings(n),!0):!1}))}finally{b=!1}})),a(v,e,o.itemsWithChildEdits,(function(n){return v._bindElement(n,h,c)}),(function(n,i){return t(p,n,i)}),(function(n){v._deleteBindings(n)})),v}return __extends(i,n),i})(e);n.SelectableSetBinder=o})(u||(u={})),u}));
define("MsPortalImpl/UI/Compositions/UI.Composition.BladeOpener",["require","exports","Fx/DependencyInjection","MsPortalImpl/Base/Base.ImplUtils","MsPortalImpl/Base/Base.Pipeline","MsPortalImpl/Base/Base.Selectable2","MsPortalImpl/Extension/Extension.Definition.Locator","MsPortalImpl/UI/UI.JourneyManager","MsPortalImpl/UI/Compositions/UI.Composition","MsPortalImpl/UI/Compositions/UI.Composition.BladeOpenerBase","MsPortalImpl/UI/Compositions/UI.Composition.BladeOpener.Helpers","MsPortalImpl/UI/Compositions/UI.Composition.CompositionBinder","MsPortalImpl/UI/Compositions/UI.Composition.DelayedBladeManager","MsPortalImpl/UI/Compositions/UI.Composition.Finder","MsPortalImpl/UI/Compositions/UI.Composition.PropertyBinding","MsPortalImpl/UI/Compositions/UI.Composition.SelectableSetBinder"],(function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p){"use strict";function g(n){return!!(n.value&&n.value.flags&16)}function ni(){return h.DefaultConfiguration}function ut(n,t,i,r,u){return l.CompositionBinder.mapInputBindingDefinitions(n,t,(function(n){n.source.scope=i;n.selectableSetV1=u!==undefined?u:r&&r.isMultiple;n.opensDynamicBlades=r&&!r.blade}))}function ti(n,t,i,r,u){var o,e,s,f=t.referenceComposition,h=n.get(v.Finder);return f?(o=ut(r.additionalInputArguments,f,y.ReferenceScope.MasterContainer),e=ut(u.invocationInputArguments,f,y.ReferenceScope.MasterContainer,r,u.isSelectableSetV1)[0],s=l.CompositionBinder.mapInputBindingDefinitions(r.outputArguments,f,(function(n){n.source.scope=y.ReferenceScope.DetailsContainer})),new a.DelayedBladeManager(i,ft(t,e),{diContainer:n,debugId:t.masterModelId,extension:t.referenceExtension.name,getSelectableContainerComposition:function(){return h.findPartsContainer(f)}})):e={targetProperty:undefined,source:{property:u.invocationInputArguments[0].valuesFrom[0].property,modelType:0,scope:1,cardinality:0,partLocator:undefined,id:"Desktop"},optional:!1,isIdentityInput:!1,selectableSetV1:!1,opensDynamicBlades:!0},{additionalInputs:o||[],invocationInput:e,invocationOutputs:s||[],detailsDefinition:r}}function lt(n,t){var i=n.referenceExtension;return t.blade&&t.bladeExtension?rt(t.bladeExtension).withBlade(t.blade):t.blade&&i?rt(i.name).withBlade(t.blade):null}function at(n,t){var i=n.lastIndexOf("."),r=i>0?n.substring(0,i):"";return y.getModelValue(t,r).value}function ft(n,t){return at(t.source.property,n.masterModel)}function it(n,t,i){var r=ko.unwrap(i?y.getModelValue(t,i).value:t);return n(r)}function ii(n,t){return it(tt.isSelectable2,n,t)}function ri(n,t,i){return it((function(t){return f.getOrCreate(n,t)}),t,i)}function ui(n,t){return!!it(tt.tryGetSelectableViewModelContract,n,t)}function fi(n,t){return it(tt.tryGetSelectableViewModelContract,n,t)}function vt(n,t,i,r,u,f){var c;if(f){var o=l.CompositionBinder.mapInputBindingDefinitions(r.selectableBindings,i.referenceComposition),s={},h=new y.PropertyBindings(i.masterModelId+"-[Selection]",s),a=y.getModelValue(i.masterModel,u).value,e=si(i,a,u);c=function(){e&&e.setInternalSelectedValue(!0)};o.length>0&&(i.configureBindings&&i.configureBindings(o),n.registerForDispose((function(){h.unbind()})),o.forEach((function(n){var t=y.getModelValue(s,n.targetProperty).value;y.setModelValue(s,n.targetProperty,ko.observable(t))})),l.CompositionBinder.setupPropertyBindings(t,i.referenceComposition,h,o),c=function(){e&&(e.lock(),e.setInternalSelectedValue(h.targetModel),o.forEach((function(t){s[t.targetProperty].subscribe(n,(function(){a.isSelected()&&e.setInternalSelectedValue(h.targetModel)}))})))})}return{invocationInputArguments:[{valuesFrom:[{property:u+".value",referenceType:0}]}],updateSelectedValue:c||w,isSelectableSetV1:!1,viewStatePropertyRemovals:[],success:!0}}function ei(n,t,i,r,u,f){var s,rt=i.masterModel,v=oi(u.selectablePath),b=u.selectablePath+".activatedItems",g,tt=gt,h="",c="",it=[],a=!0,o=y.getModelValue(i.masterModel,u.selectablePath).value,l,e;return o&&o.activatedItems&&(g=o.activatedItems),l=nt(rt),e=u.selectablePath,f?(c=tt+"._sets."+l._sets().length.toString(),h=c+".activatedItems",l._sets.push(v),it.push(b,e+".selectedItems",e+".itemsWithChildEdits"),o&&g?(s=new p.SelectableSetBinder(t,e,i.masterModelId,o,v,u.selectableBindings,i.referenceComposition),r.push(s),n.registerForDispose((function(){s.dispose();MsPortalFx.remove(r,s)}))):(k(i,"The view model for '"+i.masterModelId+"' is missing the required property '"+b+"' needed to open the child blade(s) '"+u.blade+"'"),a=!1)):(l._sets().some((function(n,t){return n.path()===e?(c=tt+"._sets."+t.toString(),h=c+".activatedItems",!0):!1})),h===""&&(d.error("Failed to find a selectable set reflection for view model '"+i.masterModelId+"'. Selectable set path is '"+e+"'"),a=!1)),{invocationInputArguments:[{valuesFrom:[{property:h,referenceType:0}]}],updateSelectedValue:w,isSelectableSetV1:!0,viewStatePropertyRemovals:it,success:a}}function oi(n){return{path:ko.observable(n),activatedItems:ko.observableArray(),itemsWithChildEdits:ko.observableArray()}}function nt(n){var t=n.internal.selectable();return t||(t={_sets:ko.observableArray(),_selectables:ko.observableArray(),_dynamicSelections:ko.observableArray(),_selectable2Invocations:{},_contextMenu2Selectables:ko.observable({}),_wizardShim:ko.observableArray([]),commandBar2Selectables:ko.observable({}),callbacks:ko.observableArray()},n.internal.selectable(t)),t}function si(n,t,i){var r=t;return t?(r.lock&&r.setInternalSelectedValue&&r.isLocked||(k(n,"This property '"+i+"' must be of type MsPortalFx.ViewModels.Selectable, view model = '"+n.masterModelId+"'"),r={lock:w,setInternalSelectedValue:function(n){t.selectedValue(n)},isLocked:w}),r):undefined}function hi(n,t,i,r,u){var c=function(t,i,r,u){t.forEach((function(t,f){var o=ot(n,t,r),e=MsPortalFx.find(i,(function(n){return st(o,n.invocationModel)}));u(t,f,e&&e.editScopeId)}))},e,o;if(r.length===0)e=t.itemsWithChildEdits,o=e().length,o>0&&e.splice(0,o);else{var s=MsPortalFx.mapMany(r,(function(n){var f,t,r,u;if(n.path.length-i.length>2)return[];f=n.path[i.length];try{t=MsPortalFx.parseSortedString(f)}catch(e){d.error("Failed to parse journey path segment. Path: '"+JSON.stringify(n.path)+"'. Error: '"+e.message+"'.")}return r=t&&t.model,u=n&&n.value&&n.value.editScope&&n.value.editScope.editScopeId,r&&u?[{invocationModel:r,editScopeId:u}]:[]})),f=t.itemsWithChildEdits().slice(),h=!1;c(t.activatedItems(),s,u,(function(n,t,i){if(i){var r=f.some((function(t){return st(t.item,n)}));r||(h=!0,f.push({item:n,editScopeId:i}))}}));f.length>s.length&&c(f.map((function(n){return n.item})),s,u,(function(n,t,i){i||(h=!0,f.splice(t,1))}));h&&t.itemsWithChildEdits(f.slice())}}function yt(n,t,i,r,u){var o=t.findBlades(i.referenceComposition).filter((function(n){return!n.isDisposed()&&n.masterInvocationProperty===u.source.property&&i.isBladeOpenedByMaster(n)})),s=n.confirmBladesCanClose(o),f,e;if(s)for(f=o.length-1;f>=0;f--)e=o[f],i.removeOutputBindings(e),r.set(e,!0),n.forceCloseBlade(e);return s}function ci(n,t,i,r,u){return vt(n,t,i,r,"container.selectable",u)}function li(n,t,i,r){nt(t.masterModel);var u=fi(t.masterModel,r);return u._msPortalFxSelectable2?pt(n,t,i,r+"._msPortalFxSelectable2"):(r=r+"._msPortalFxSelectable",i[0].valuesFrom[0].property=r+".value",{success:!0,isSelectableSetV1:!1,invocationInputArguments:i,viewStatePropertyRemovals:[],updateSelectedValue:w})}function pt(n,t,i,r){var f=t.masterModel,e=nt(f),u=ri(n,f,r),o=r.replace(/\./g,"_");return e._selectable2Invocations[o]=u.value,e.callbacks.push(u.callbacks),i[0].valuesFrom[0].property="internal.selectable._selectable2Invocations."+o,{success:!0,isSelectableSetV1:!1,invocationInputArguments:i,viewStatePropertyRemovals:[],updateSelectedValue:w,selectable2:u}}function ai(n,t,i,r){var u=ft(t,i);if(u&&u.isSelected&&u.isCommandSelected){var f=u.isSelected,o=u.isCommandSelected,s=n.get(v.Finder),e=s.findBlades(t.referenceComposition).filter((function(n){return n.masterInvocationProperty===i.source.property&&t.isBladeOpenedByMaster(n)}));o()&&e.length===0&&o(!1);f()&&e.length===0?(f(!1),r()):!f()&&e.length>0?(r(),f(!0)):r()}}function wt(n,t,i,r,u,f){var e=i,o=i,s=t.findPartsContainer(n.referenceComposition).journeyPath.concat([u]),h=r.ambientSettings.getItemsUnderPath(s);e&&e.selectedValue?e.hasChildEdits(h.length>0):o&&o.itemsWithChildEdits&&hi(n.masterModelId,o,s,h,f)}function vi(n,t,i,r,u){var l=t.get(o.JourneyManager),e=l.activeJourney(),f,h=i.referenceComposition&&i.referenceComposition.getCompositionType()===s.CompositionType.StartboardPart,c=null,a=function(u){if(u&&u.originTile){if(h&&u.originTile.id!==i.referenceComposition.id)return;if(f=n.createChildLifetime(),yi(t,i,f,u,r),h)u.onDispose((function(){f&&(f.dispose(),f=null)}))}else return};a(e);h&&(c=function(){f||(e=l.activeJourney(),a(e))},u.add(c),n.registerForDispose((function(){u.remove(c)})))}function yi(n,t,i,r,u){var e,f,o,s;if(!r)throw new Error("Journey is required.");e=ft(t,u);f={locator:null,masterInvocationProperty:u.source.property};t.configureBindings&&f.bindings&&f.bindings.length&&t.configureBindings(f.bindings);t.configureBladeDescriptor(f);o=c.getBladeOpenerJourneyPathSegment(f);s=n.get(v.Finder);wt(t,s,e,r,o,u);r.ambientSettings.getObservable().subscribe(i,(function(){wt(t,s,e,r,o,u)}))}function pi(n,t){var i=at(n,t);return i&&i.controlType===107&&i}function wi(n,t,i){return t.parameterCollector&&n?!!pi(n,i):!1}function bi(n,t,i,r){var s=MsPortalFx.find(i.additionalInputArguments,(function(n){return n.property==="internal_bladeCallId"})).valuesFrom[0].property,u=ko.unwrap(y.getModelValue(r,t).value),e=ko.unwrap(y.getModelValue(r,s).value),f=ko.observable(u),o,h;return ko.reactor(n,(function(){var i=ko.unwrap(y.getModelValue(r,t).value),n;i!==u&&(u=i);n=ko.unwrap(y.getModelValue(r,s).value);n&&u!==f.peek()&&(!e||n>e)?(e=n,f(u)):n||i||f(i)})),f.subscribe(n,(function(n){n||y.setModelValue(r,t,n)})),o=nt(r),h=o._wizardShim().length,o._wizardShim.push(f),"internal.selectable._wizardShim."+h}function bt(n,t,i,r,u,f){var e,o,c,l=function(n){return n.map((function(n){return MsPortalFx.clone(n,!0,!1)}))},s;if(r.invocationInputArguments&&r.invocationInputArguments.length>0){if(o=r.invocationInputArguments,c=r.isMultiple,o=l(r.invocationInputArguments),!r.blade&&r.invocationInputArguments[0].valuesFrom&&r.invocationInputArguments[0].valuesFrom.length>0){if(e=r.invocationInputArguments[0].valuesFrom[0].property,s=t.masterModel,e=e==="container.selectable"?"container":e,ui(s,e))return li(n,t,o,e);if(ii(s,e))return pt(n,t,o,e);h.isSelectableSet(s,e)?(c=!0,o[0].valuesFrom[0].property=e+".activatedItems"):h.isSelectable(s,e)?(c=!1,o[0].valuesFrom[0].property=e+".value"):wi(e,r,s)&&(o[0].valuesFrom[0].property=bi(i,e,r,s))}return{success:!0,isSelectableSetV1:c,invocationInputArguments:o,viewStatePropertyRemovals:[],updateSelectedValue:w}}return ki(n,t,i,r,u,f)}function ki(n,t,i,r,u,f){var e={success:!0,isSelectableSetV1:!1,invocationInputArguments:null,viewStatePropertyRemovals:[],updateSelectedValue:w};if(r.selectablePath)if(h.isSelectableSet(t.masterModel,r.selectablePath)){if(!r.selectableBindings||!r.selectableBindings.some((function(n){return n.valuesFrom&&n.valuesFrom.length>0?n.valuesFrom[0].referenceType===6:!1})))return e.success=!1,k(t,"The view model '"+t.masterModelId+"' has a selectable source '"+r.selectablePath+"' that is a selectable set.  There must be at least one <BladeInput> which has SelectedItem as the Source for a selectable set to indentify which row is opening the blade."),e;e=ei(i,n,t,f,r,u)}else h.isSelectable(t.masterModel,r.selectablePath)?e=vt(i,n,t,r,r.selectablePath,u):(e.success=!1,k(t,"The view model for '"+t.masterModelId+"' with property '"+r.selectablePath+"' must of type MsPortalFx.ViewModels.Selectable or MsPortalFx.ViewModels.SelectableSet to open the child blade(s) '"+r.blade+"'"));else e=ci(i,n,t,r,u);return e}function k(t,i,u){r.logToExtension(n,t.referenceExtension.name,2,i,{contextData:u})}var ct,kt;Object.defineProperty(t,"__esModule",{value:!0});t.createOrGetInternalSelectionState=t.BladeOpener=void 0;var tt=FxImpl,et=tt.TriggerableLifetimeManager,dt=MsPortalFx.Base.Diagnostics,ot=c.mapMasterModelToBladeModel,st=MsPortalFx.deepEquals,d=dt.createLog(n),w=MsPortalFx.noop,gt="internal.selectable",ht=ko.toJS,rt=e.Locator.forExtension,b=u.createDescriptor(h.Configuration,h.Resources,undefined);b.registerAsync("MsPortalImpl/UI/Compositions/UI.Composition.BladeOpener.Handler","OpenBladeHandler",(function(n,t,i){return!g(i)}));b.registerAsync("MsPortalImpl/UI/Compositions/UI.Composition.BladeOpener.Selectable1","SelectableV1Handler",(function(n,t,i){return!t.selectable2&&!g(i)}));b.registerAsync("MsPortalImpl/UI/Compositions/UI.Composition.BladeOpener.Selectable2","SelectableV2Handler",(function(n,t,i){return t.selectable2&&!g(i)}));b.registerAsync("MsPortalImpl/UI/Compositions/UI.Composition.BladeOpener.PendingBladeHint","PendingBladeHandler",(function(n,t,i){return g(i)}));b.registerAsync("MsPortalImpl/UI/Compositions/UI.Composition.BladeOpener.PPV3","ParameterProviderV3Handler",(function(n,t,i){return!g(i)&&t.selectable2&&i.value&&!!i.value.container}));ct=(function(t){function r(n,i){var r=t.call(this)||this;return r._diContainer=n,r.bladeOpenedCallbacks=$.Callbacks(),r.selectableSetBinders=[],r.options=MsPortalFx.extend2(ni(),i),r.invocationPropertyBindings=new y.PropertyBindings(r.options.masterModelId+"-[Invocation]",{}),r.invocationQueue=r._diContainer.get(kt),r.bladeOpenedCallbacks.add(r.options.onBladeOpened),r.registerForDispose([function(){r.invocationPropertyBindings.unbind()},function(){return r.bladeOpenedCallbacks.empty()},]),r}return __extends(r,t),r.prototype.registerInvocationProperty=function(n,t,i){var u=this,e=this.createChildLifetime(),p=this._diContainer.get(o.JourneyManager),w=this._diContainer.get(v.Finder),nt=null,tt=w.findPartsContainer(this.options.referenceComposition),it=lt(this.options,n),s=bt(this._diContainer,this.options,e,n,!0,this.selectableSetBinders),r={container:tt,bladeOpenedCallbacks:this.bladeOpenedCallbacks,bladesClosedByPart:new WeakMap,detailsBladeLocator:it,disableInvocation:t,isThrottled:ko.observable(!1),resettingMasterArrayValue:!1,registrationInfo:undefined,prevValue:undefined,previousInvocationPromise:undefined},l=function(){var n=y.getModelValue(u.options.masterModel,f.source.property).value;return r.selectable2?n():ht(n)},g,f,c,a;if(r.selectable2=s.selectable2,g=b.createPipeline(this._diContainer,e,this.options,r),s.success)return r.registrationInfo=ti(this._diContainer,this.options,e,n,s),f=r.registrationInfo.invocationInput,r.prevValue=l(),ai(this._diContainer,this.options,f,(function(){s.updateSelectedValue()})),vi(e,this._diContainer,this.options,f,this.bladeOpenedCallbacks),t&&t.subscribe(e,(function(n){n?(h.traceInvocationChange(d,"Disabled listening for invocation property change.",u._diContainer,u.options,f,l()),yt(p,w,u.options,r.bladesClosedByPart,f)):(r.prevValue=l(),r.prevValue!==undefined&&k(u.options,"Selectability was enabled for the part (container.isSelectable(true)) and the part is already in a selected state.  Current selection state will be ignored and blade will not be opened. Part Id: "+u.options.masterModelId,r.prevValue))})),c=f.source.property,a=this.invocationPropertyBindings,y.setModelValue(a.targetModel,c,ht(r.prevValue)),nt=a.addProperty(c).bind(this.options.masterModelId,this.options.masterModel,!!r.selectable2,(function(n){var t=l(),i={value:t,invocationInput:f,propertyChanges:n};h.traceInvocationChange(d,"Detected invocation property change.",u._diContainer,u.options,f,t);r.selectable2?u.invocationQueue.enqueue({id:c,pipeline:g,taskArgs:i}):g.startTask(i)}),(function(n){k(u.options,"Failed to subscribe to changes for the selectable "+c+". Error: "+n)})),e.registerForDispose((function(){p.activeJourney()&&!u._diContainer.isDisposed()&&yt(p,w,u.options,r.bladesClosedByPart,f);a.removeProperty(nt)})),i&&i.registerForDispose(e),{viewStatePropertyRemovals:s.viewStatePropertyRemovals}},r.prototype.modifyViewStateProperties=function(n,t){return n.filter((function(n){return!t.viewStatePropertyRemovals.some((function(t){return n===t}))}))},r.prototype.createBladeModelForSelectedItem=function(n,t){var r=this,u=n.invocationInputArguments,o=new et,s=bt(this._diContainer,this.options,o,n,!1,this.selectableSetBinders),c=ut(s.invocationInputArguments,this.options.referenceComposition,y.ReferenceScope.MasterContainer,n)[0],i={},e,f=lt(this.options,n),l=function(){var n=r.options.referenceComposition;return n.containerModel||n.getBindableContainer().getViewModel()};return s.updateSelectedValue(),f||n.blade||(f=h.mapDynamicSelectionToBladeLocator(this._diContainer,t,rt(this.options.referenceExtension.name),this.options.masterModelId)),u&&u.length&&u[0].property?i[c.targetProperty]=t:(e=t,!u&&n.selectablePath&&this.selectableSetBinders.some((function(i){return i.selectablePath===n.selectablePath?(e=i.createTargetForSelectedItem(t),!0):!1})),i=ot(this.options.referenceComposition.locator.toString(),e,c)),(n.additionalInputArguments||[]).forEach((function(n){if(n.valuesFrom&&n.valuesFrom.length){var u=n.property,t=n.valuesFrom[0];t.referenceType!==0||t.part&&t.part!==r.options.referenceComposition.locator.name?t.referenceType===1?i[u]=l()[t.property]:(i[u]=undefined,d.warning("Part Selection: Blade "+f+" Property "+u+" has an input that's from part "+t.part+" instead of its list part "+r+" or the blade.")):i[u]=y.getModelValue(r.options.masterModel,t.property).value}})),o.dispose(),{model:i,locator:f}},__decorate([__metadata("fx:diagnostics",[n,"BladeOpener"]),i.Class("composition"),__metadata("design:paramtypes",[i.Container,h.OpenerConfiguration])],r)})(et);t.BladeOpener=ct;t.createOrGetInternalSelectionState=nt;kt=(function(){function t(){this.queue=[]}return t.prototype.enqueue=function(n){var t=this.queue,r=!t.length,i;MsPortalFx.remove(t,(function(t){return t.pipeline===n.pipeline}),1);t.push(n);i=function(n){n.pipeline.startTask(n.taskArgs).finally((function(){t.shift();t.length&&i(t[0])}))};r&&i(t[0])},__decorate([__metadata("fx:diagnostics",[n,"InvocationQueue"]),i.Class()],t)})()}))